var t;import{q as e,b3 as i,b4 as n,a as o,o as a,a2 as s,w as r}from"./topic.mg5xph6vf09b6144.js";import{a as l,u as c,c as d,j as u,m as p}from"./comm_utils.mg5xph6v4fda8a3d.js";import{D as h,a as m,A as _,m as w}from"./private_share.mg5xph6v1a0c9c7e.js";import{C as g}from"./class.mg5xph6vd1a660bd.js";import{T as b}from"./tmpl.mg5xph6v1af565c1.js";import"./appmsgext.mg5xph6v82836ebd.js";import{a as f,A as v}from"./page_utils.mg5xph6v15e313ed.js";import{p as A}from"./page_utils.mg5xph6vb076ad9f.js";import{r as y,a as k}from"./report.mg5xph6vbb75e91a.js";import{n as x}from"./_plugin-vue2_normalizer.mg5xph6vfc2fb13f.js";import{h as C}from"./moment.mg5xph6v07db360f.js";import{r as I}from"./pre_loading.mg5xph6vb171249d.js";import{E as T}from"./event_bus.mg5xph6vf7643e49.js";import{p as E}from"./channel_product_utils.mg5xph6v963e429f.js";const S="weui-btn_disabled",B="page_no_scroll",W="".concat(screen.height/4*3,"px"),N={top:h.os.pc?"20%":"".concat(screen.height/4-(screen.height-window.innerHeight),"px"),btnText:"提交",hasHeader:!0,clickMask2Hide:!0,animationType:"bottom",scroll2Hide:!0,sideslip2Hide:!0};function j(t,e,i,n){i=n?"".concat(i,"px"):i,t.style[e]=i}class L{constructor(t,e={}){e=Object.assign({},N,e);const i=document.createElement("div");i.innerHTML=b.tmpl('<div class="wx_bottom_modal_wrp legacy <#=extClass#>">\n  <div\n    class="weui-half-screen-dialog wx_bottom_modal js_bottom_modal_content"\n    role="dialog"\n    aria-modal="true"\n    aria-hidden="true"\n    tabindex="0"\n    <# if (!autoHeight) { #>\n      style="max-height: none;"\n    <# } else { #>\n      style="max-height: <#=maxHeight#>;"\n    <# } #>\n  >\n    <# if (hasHeader) { #>\n      <div class="weui-half-screen-dialog__hd__wrp">\n        <div class="weui-half-screen-dialog__hd js_bottom_modal_hd">\n          <div class="weui-half-screen-dialog__hd__side">\n            <button class="weui-btn_icon js_close_bottom_modal weui-wa-hotarea">关闭<i class="weui-icon-half-screen-close"></i></button>\n          </div>\n\n          <div class="weui-half-screen-dialog__hd__main">\n            <strong class="weui-half-screen-dialog__title js_bottom_modal_title">标题</strong>\n          </div>\n\n          <div class="weui-half-screen-dialog__hd__side">\n            <# if (hasBtn) { #>\n              <# if (btnSlot) { #>\n                <div role="button" class="js_submit_bottom_modal weui-wa-hotarea">\n                  <#==btnSlot#>\n                </div>\n              <# } else { #>\n                <button class="weui-btn weui-btn_primary weui-btn_xmini js_submit_bottom_modal weui-wa-hotarea"><#=btnText#></button>\n              <# } #>\n            <# } #>\n            <button class="weui-btn_icon" style="display:none;">更多<i class="weui-icon-more"></i></button>\n          </div>\n        </div>\n      </div>\n    <# } #>\n    <div class="weui-half-screen-dialog__bd js_bottom_modal_bd">\n      <div role="alert" class="wx_bottom_modal_msg_wrp js_modal_loading" style="display: none;">\n        <div class="wx_bottom_modal_msg">\n          <i class="weui-loading" role="img" aria-label="加载中"></i>\n        </div>\n      </div>\n      \x3c!-- 上下拉加载loading --\x3e\n      <div role="alert" class="weui-loadmore js_pull_loading" style="display: none;">\n        <i class="weui-loading"></i>\n        <span class="weui-loadmore__tips">正在加载</span>\n      </div>\n\n      \x3c!-- 加载完成的dom，插到js_bottom_modal_bd下 --\x3e\n      <div role="option" class="weui-loadmore weui-loadmore_line weui-loadmore_dot js_modal_end_line" style="display: none;">\n        <div class="weui-hidden_abs">已无更多数据</div>\n        <span class="weui-loadmore__tips"></span>\n      </div>\n    </div>\n    <# if (hasFooter) { #>\n      <div class="weui-half-screen-dialog__ft js_bottom_modal_ft"></div>\n    <# } #>\n  </div>\n  <# if (hasMask) { #>\n    \x3c!-- 透明mask，用于防止点透 --\x3e\n    <div class="wx_bottom_modal_mask_fixed js_bottom_modal_mask_not_click"></div>\n\n    \x3c!-- 有底色的mask --\x3e\n    <div class="weui-mask wx_bottom_modal_mask js_bottom_modal_mask"></div>\n  <# } #>\n</div>',{hasBtn:e.hasBtn,btnText:e.btnText,extClass:e.extClass||"",hasMask:!e.removeMask,isTopic:!!e.isTopic,hasHeader:e.hasHeader,hasFooter:!!e.footerEl,btnSlot:e.btnSlot,autoHeight:e.autoHeight,maxHeight:W});const n=i.firstChild;this.scrollLock=!1,this.curScrollTop=0,this.touches={startX:0,startY:0,curX:0,curY:0,isScreenLeft:!1,direction:"",times:0},this.opt=e,this.rootEle=n,this.contentEle=t,this.contentAreaWrp=n.getElementsByClassName("js_bottom_modal_bd")[0],this.contentAreaWrp.appendChild(t),this.contentArea=n.getElementsByClassName("js_bottom_modal_content")[0],this.loading=this.rootEle.getElementsByClassName("js_modal_loading")[0],this.pullLoading=this.rootEle.getElementsByClassName("js_pull_loading")[0],this.endLine=this.rootEle.getElementsByClassName("js_modal_end_line")[0],this.enableGesture=!1,this.triggerEl=null,this.isAutoFocus=!0,e.removeMask||(this.maskEle=n.getElementsByClassName("js_bottom_modal_mask")[0],this.maskNotClick=n.getElementsByClassName("js_bottom_modal_mask_not_click")[0],e.transparentMask&&j(this.maskEle,"opacity",0)),e.hasHeader&&(this.headAreaWrp=n.getElementsByClassName("js_bottom_modal_hd")[0],this.submitBtn=this.headAreaWrp.getElementsByClassName("js_submit_bottom_modal")[0],this.closeBtn=this.headAreaWrp.getElementsByClassName("js_close_bottom_modal")[0],this.setTitle(e.title)),e.footerEl&&(this.footAreaWrp=n.querySelector(".js_bottom_modal_ft"),this.footAreaWrp.appendChild(e.footerEl)),"right"===e.animationType&&this.rootEle.classList.add("wx_bottom_modal_right"),document.body.appendChild(n),e.cb&&e.cb(),this.bindEvent()}bindEvent(){this.maskEle&&(this.opt.clickMask2Hide&&m.tap(this.maskEle,(()=>{this.hide()})),m.on(this.contentArea,"transitionend",(t=>{t.target!==this.contentArea||"transform"!==t.propertyName&&"-ms-transform"!==t.propertyName||(""!==this.contentArea.style.transform?this.contentArea.style.removeProperty("transform"):this.getShowStatus()?"function"==typeof this.opt.onShowAfterAnimation&&this.opt.onShowAfterAnimation():(j(this.maskNotClick,"visibility","hidden"),!this.opt.autoHeight&&j(this.contentArea,"top",this.opt.top)))})),m.tap(this.maskNotClick,(()=>setTimeout((()=>{this.hide(),j(this.maskNotClick,"visibility","hidden"),!this.opt.autoHeight&&j(this.contentArea,"top",this.opt.top)}),300))),m.on(this.maskEle,"touchmove",(t=>{t.preventDefault()}))),this.headAreaWrp&&(m.on(this.headAreaWrp,"touchstart",(t=>this.onTouchStart(t))),m.on(this.headAreaWrp,"touchmove",(t=>{t.preventDefault();const e=t.changedTouches[0];this.getTouchDirection(e)&&this.moveByDirection(e)})),m.on(this.headAreaWrp,"touchend",(t=>this.onTouchEnd(t)))),this.footAreaWrp&&(m.on(this.footAreaWrp,"touchstart",(t=>this.onTouchStart(t))),m.on(this.footAreaWrp,"touchmove",(t=>{t.preventDefault();const e=t.changedTouches[0];this.getTouchDirection(e)&&this.moveByDirection(e)})),m.on(this.footAreaWrp,"touchend",(t=>this.onTouchEnd(t)))),this.closeBtn&&m.on(this.closeBtn,"click",(()=>{this.hide()})),this.submitBtn&&m.on(this.submitBtn,"click",(()=>{g.hasClass(this.submitBtn,S)||this.opt.btnClickCb&&this.opt.btnClickCb()})),m.on(this.contentAreaWrp,"scroll",(()=>{this.checkReachBoundary(),this.contentAreaWrp.scrollTop>0?g.addClass(this.contentArea,"weui-half-screen-dialog_headline"):g.removeClass(this.contentArea,"weui-half-screen-dialog_headline")})),this.headAreaWrp&&m.tap(this.headAreaWrp.getElementsByClassName("js_bottom_modal_title")[0],(()=>{this.opt.titleClickCb&&this.opt.titleClickCb()})),m.on(this.contentAreaWrp,"touchstart",(t=>this.onTouchStart(t))),m.on(this.contentAreaWrp,"touchmove",(t=>{const e=t.changedTouches[0];if(this.getTouchDirection(e)){if("Y"===this.touches.direction){const n=this.contentAreaWrp,o=e.pageY,a=o-this.touches.startY,s=n.scrollTop<=0&&a>0,r=(i=n,Math.ceil(i.scrollTop+i.offsetHeight)>=i.scrollHeight&&a<0);s||r?(s&&!this.opt.onPullDownLoad&&this.move(o),t.preventDefault()):this.resetMovement(),this.touches.curY=o}else t.preventDefault(),this.moveByDirection(e)}var i})),m.on(this.contentAreaWrp,"touchend",(t=>this.onTouchEnd(t))),m.on(window,"unload",(()=>{this.opt.removeMask||e.hide()}))}checkReachBoundary(t=!0,e=!0){this.scrollLock&&0!==this.contentAreaWrp.scrollTop||(this.scrollLock=!0,setTimeout((()=>{this.scrollLock=!1}),50),t&&!this.pullingDownLock&&this.contentAreaWrp.scrollTop<=0&&(this.opt.onPullDownLoad&&this.opt.onPullDownLoad(),this.pullingDownLock=!0),setTimeout((()=>{e&&!this.pullingUpLock&&this.contentAreaWrp.scrollTop+this.contentAreaWrp.offsetHeight+100>this.contentEle.offsetHeight&&(this.opt.onPullUpLoad&&this.opt.onPullUpLoad(),this.pullingUpLock=!0)}),100),this.opt.onScroll&&this.opt.onScroll(this.contentAreaWrp.scrollTop>this.curScrollTop?"up":"down"),this.curScrollTop=this.contentAreaWrp.scrollTop)}onTouchStart(t){const e=t.touches[0];this.touches={startX:e.pageX,startY:e.pageY,curX:e.pageX,curY:e.pageY,isScreenLeft:this.enableGesture&&e.pageX<=30,direction:"",times:0},this.contentArea.style.transition="none"}onTouchEnd(t){const e=this.touches.direction,i="X"===e?100:this.contentArea.offsetHeight/4,n=t.changedTouches[0]["page".concat(e)]-this.touches["start".concat(e)],o=this.contentArea.dataset;this.contentArea.style.removeProperty("transition"),o.distance&&(n>i?this.hide():this.contentArea.style.transform="translateY(0)",delete o.distance)}getTouchDirection(t){if(this.touches.direction)return!0;if(!this.touches.isScreenLeft)return this.touches.direction="Y",!0;this.touches.times++;const e=Math.abs(t.pageX-this.touches.startX),i=Math.abs(t.pageY-this.touches.startY);return this.touches.times>=3?(this.touches.direction=e>=i?"X":"Y",!0):e>=5&&e>=i?(this.touches.direction="X",!0):i>=5&&(this.touches.direction="Y",!0)}moveByDirection(t){const e=this.touches.direction,i=t["page".concat(e)];i-this.touches["start".concat(e)]>0?this.move(i):this.resetMovement(),this.touches["cur".concat(e)]=i}move(t){if(this.opt.sideslip2Hide&&"X"===this.touches.direction||this.opt.scroll2Hide&&"Y"===this.touches.direction){const e=this.contentArea.dataset;e.distance=1*(e.distance||0)+t-this.touches["cur".concat(this.touches.direction)],this.contentArea.style.transform="translateY(".concat(e.distance,"px)")}}resetMovement(){delete this.contentArea.dataset.distance,this.contentArea.style.removeProperty("transform")}show(t,n,o,a=!0){g.addClass(document.body,B),this.triggerEl=o||window.event&&window.event.target,this.isAutoFocus=a,this.getShowStatus()||(t||this.opt.autoHeight||(j(this.contentArea,"top",this.opt.top),console.log(this.contentArea.offsetHeight)),j(this.contentArea,"visibility","visible"),g.addClass(this.rootEle,"wx_bottom_modal_show"),this.setAriaHidden(!1),this.contentArea.focus(),this.maskEle&&this.opt.clickMask2Hide&&j(this.maskNotClick,"visibility","visible"),this.opt.removeMask||e.show({alpha:this.opt.transparentMask?0:.6,callback:t=>{t&&"function"==typeof this.opt.onShowNavShadow&&this.opt.onShowNavShadow()},onClick:()=>{this.hide()}}),this.opt.sideslip2Hide&&(h.os.ios?_.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!0},(t=>{/:ok$/.test(t.err_msg)&&(this.enableGesture=!0)})):i.disable({onGoBack:()=>{this.hide()},onDisable:()=>{this.enableGesture=!0},onEnable:()=>{this.enableGesture=!1}})),t&&(g.addClass(this.rootEle,"wx_bottom_modal_form"),j(this.contentArea,"top","25px")),setTimeout((()=>{t||"right"===this.opt.animationType&&(j(this.contentArea,"-ms-transform","translateX(0)"),j(this.contentArea,"transform","translateX(0)"))})),t&&(setTimeout((()=>{"bottom"===this.opt.animationType?j(this.contentArea,"top","100%"):j(this.contentArea,"top",this.opt.top),console.log(this.contentArea.offsetHeight),g.removeClass(this.rootEle,"wx_bottom_modal_form"),setTimeout((()=>{j(this.contentArea,"top",this.opt.top),"right"===this.opt.animationType&&(j(this.contentArea,"-ms-transform","translateX(0)"),j(this.contentArea,"transform","translateX(0)"))}))}),50),h.os.ios?n.focus():(this.tmpInputEle||(this.tmpInputEle=n.cloneNode(!0)),this.tmpInputEle.style.opacity=0,this.tmpInputEle.style.position="fixed",this.tmpInputEle.style.top=0,this.tmpInputEle.style.zIndex="-1",document.body.appendChild(this.tmpInputEle),setTimeout((()=>{n.focus(),this.opt.makeInputEleBigger&&this.opt.makeInputEleBigger(),document.body.removeChild(this.tmpInputEle)}),300),this.tmpInputEle.focus()),h.os.ios&&!this.hasBindInputEvent&&this.opt.makeFakeInputEle&&this.opt.removeInputEle&&(this.hasBindInputEvent=!0,m.on(n,"focus",(()=>{setTimeout((()=>{n.style.opacity=1,this.opt.removeInputEle()}),50)})),m.on(n,"blur",(()=>{this.opt.makeFakeInputEle(),n.style.opacity=0})))),this.opt.onShow&&this.opt.onShow())}hide(t){g.removeClass(document.body,B),t&&j(this.maskNotClick,"visibility","hidden"),this.getShowStatus()&&(this.contentArea.style.removeProperty("-ms-transform"),this.contentArea.style.removeProperty("transform"),g.removeClass(this.rootEle,"wx_bottom_modal_show"),this.setAriaHidden(!0),this.isAutoFocus&&function(t){if(!(t&&t instanceof HTMLElement))return!1;const e=window.getComputedStyle(t);return 0!==e.width&&0!==e.height&&0!==e.opacity&&"none"!==e.display&&"hidden"!==e.visibility&&null!==t.offsetParent}(this.triggerEl)&&(this.triggerEl.setAttribute("tabindex","0"),this.triggerEl.focus()),this.opt.removeMask||e.hide(),this.opt.sideslip2Hide&&(h.os.ios?_.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!1},(t=>{/:ok$/.test(t.err_msg)&&(this.enableGesture=!1)})):i.enable()),this.opt.onHide&&this.opt.onHide())}disableBtn(){this.submitBtn&&g.addClass(this.submitBtn,S)}enableBtn(){this.submitBtn&&g.removeClass(this.submitBtn,S)}finishPullUpLoad(){this.pullingUpLock=!1}finishPullDownLoad(){this.pullingDownLock=!1}setTitle(t){this.headAreaWrp&&("string"==typeof t?this.headAreaWrp.getElementsByClassName("js_bottom_modal_title")[0].innerHTML=t:"object"==typeof t&&t.innerHTML&&(this.headAreaWrp.getElementsByClassName("js_bottom_modal_title")[0].innerHTML=t.innerHTML))}scrollTo(...t){this.contentAreaWrp.scrollTo(...t)}getRootEle(){return this.rootEle}getBdEle(){return this.contentAreaWrp}getScrollEle(){return this.contentAreaWrp}setCloseBtnStyle(t){if(this.closeBtn){const e=this.closeBtn.getElementsByTagName("i")[0],i="weui-icon-close-thin",n="weui-icon-back-arrow-thin";"back"===t?(g.removeClass(e,i),g.addClass(e,n)):(g.removeClass(e,n),g.addClass(e,i))}}getShowStatus(){return g.hasClass(this.rootEle,"wx_bottom_modal_show")}showLoading(){j(this.loading,"display","block")}hideLoading(){j(this.loading,"display","none")}showPullUpLoading(){this.contentAreaWrp.appendChild(this.pullLoading),j(this.pullLoading,"display","block")}hidePullUpLoading(){j(this.pullLoading,"display","none")}showPullDownLoading(){this.contentAreaWrp.insertBefore(this.pullLoading,this.contentAreaWrp.firstChild),j(this.pullLoading,"display","block")}hidePullDownLoading(){j(this.pullLoading,"display","none")}showEndLine(){this.contentAreaWrp.appendChild(this.endLine),j(this.endLine,"display","block")}setAriaHidden(t){this.contentArea.setAttribute("aria-hidden",t.toString())}disablePullDownLoad(){this.opt.onPullDownLoad=null}}const D={itemClassName:"album_read_directory_item",albumId:(null==(t=window.target_album_info)?void 0:t.id)||"",pageCount:10,isPC:w.isWindows||w.isMac&&!w.isIOS,isInsertBlock:!1};let P;const H="&cur_album_id=".concat(D.albumId),M=document.createElement("div");function U(){var t;const e=document.createElement("div"),i=document.createElement("span");return i.setAttribute("role","option"),i.innerHTML=(null==(t=window.target_album_info)?void 0:t.title)||"",e.appendChild(i),e.innerHTML}function R({ComponentType:t=0}){var e;const i=document.createElement("div");i.style.position="relative",i.style.cursor="pointer",i.setAttribute("role","listbox");let n,o,a,s,r,c=[],d=!0,u=!0,p=1;function h(t,e=!1,i=!0){const l=document.createDocumentFragment();if(o)if(e){p=1;for(let e=0;e<t.length;e++)if(t[e].msgid.toString()===window.appmsgid.toString()&&t[e].itemidx.toString()===window.idx.toString()){p=e;break}t.forEach(((t,e)=>{t.index=a?n-(e-p):n+(e-p)}))}else i?t.forEach(((t,e)=>{t.index=a?r.index-e-1:r.index+e+1})):t.forEach(((e,i)=>{e.index=a?s.index+(t.length-i):s.index-(t.length-i)}));return t.forEach((t=>{const e=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div");if(g.addClass(e,D.itemClassName),g.addClass(i,"album_item_left"),g.addClass(a,"album_item_right"),t.msgid.toString()===window.mid.toString()&&t.itemidx.toString()===window.idx.toString()?g.addClass(e,"album_read_directory_current"):1===t.user_read_status&&(g.addClass(e,"album_read_directory_disabled"),g.addClass(e,"js_wx_tap_highlight"),g.addClass(e,"wx_tap_cell")),[8,10].includes(1*t.item_show_type)){if(g.addClass(e,"is_image"),t.cover_img_1_1){const e=document.createElement("div");e.style.backgroundImage="url(".concat(t.cover_img_1_1,")"),e.classList.add("album_item_cover"),i.appendChild(e)}}else g.addClass(e,"is_appmsg");if(o){const e=document.createElement("span");e.className="album_read_directory_item_index",e.innerText="".concat(void 0===n?t.pos_num:t.index,"."),a.appendChild(e)}const s=document.createElement("span");s.className="album_read_directory_title_wrp";const r=document.createElement("span");r.className="album_read_directory_title",r.innerText=t.title,s.appendChild(r),e.setAttribute("data-url",t.url),e.setAttribute("role","option");const c=document.createElement("span");if(t.is_paid){const t="已付费";g.addClass(c,"wx_icon_pay_tag"),g.addClass(c,"wx_icon_pay_tag_paid"),c.innerText=t,s.appendChild(c)}else if(t.is_pay_subscribe){const t="付费";g.addClass(c,"wx_icon_pay_tag"),c.innerText=t,s.appendChild(c)}a.appendChild(s),e.appendChild(i),e.appendChild(a),l.appendChild(e)})),l}function _(t){1*t.reverse_continue_flag||(d=!1,P.disablePullDownLoad()),1*t.continue_flag||(u=!1)}const w={extClass:"album_read_directory weui-half-screen-dialog_fold",hasBtn:!0,btnSlot:'<div id="js_topic_detail" class="weui-btn__word-wrp">\n                <span class="weui-btn__word link-style">详情</span>\n              </div>',title:U(),btnClickCb(){y({ActionType:6,ComponentType:t}),k(15),function(){const t=window.target_album_info;if(t.link){const e=t.link.replace("#wechat_redirect","&subscene=159&subscene=".concat(window.source,"&scenenote=").concat(encodeURIComponent(window.location.href),"&nolastread=1#wechat_redirect"));f.openUrlWithExtraWebview(e.htmlDecode())}}()},cb(){var t;t=t=>{P.hideLoading(),a=t.base_info.is_reverse,n=t.base_info.cur_article_num,o=t.base_info.is_numbered,i.appendChild(h(t.article_list,!0)),s=t.article_list[0],r=t.article_list[t.article_list.length-1],_(t),u||P.showEndLine(),d&&(i.firstChild.parentNode.insertBefore(M,i.firstChild),D.isInsertBlock=!0,P.scrollTo(0,i.firstChild.offsetTop+1));const e=i.childNodes[p];setTimeout((()=>{e.offsetTop+e.clientHeight>P.contentAreaWrp.clientHeight&&P.scrollTo(0,i.offsetHeight)}),200)},l({type:"GET",url:"/mp/appmsgalbum?action=paging&__biz=".concat(window.biz,"&album_id=").concat(D.albumId,"&cur_msgid=").concat(window.appmsgid,"&cur_itemidx=").concat(window.idx,"&count=").concat(D.pageCount),timeout:5e3,dataType:"json",success:function(e){e.base_resp&&0===e.base_resp.ret&&t(e.getalbum_resp)},error(){console.log("[error]")}})},onShow(){y({ActionType:4,ComponentType:t}),k(14)},onPullUpLoad(){u&&(P.showPullUpLoading(),l({type:"GET",url:"/mp/appmsgalbum?action=paging&__biz=".concat(window.biz,"&album_id=").concat(D.albumId,"&begin_msgid=").concat(r.msgid,"&begin_itemidx=").concat(r.itemidx,"&count=").concat(D.pageCount),timeout:5e3,dataType:"json",success:function(t){P.hidePullUpLoading();if(0===(t.base_resp&&1*t.base_resp.ret)){const e=t.getalbum_resp.article_list;_(t.getalbum_resp),i.appendChild(h(e,!1,!0)),c=c.concat(e),P.finishPullUpLoad(),r=c[c.length-1],1*t.getalbum_resp.continue_flag||P.showEndLine()}},error:function(){}}))},onPullDownLoad(){d&&(D.isInsertBlock&&(M.parentNode.removeChild(M),D.isInsertBlock=!1),P.showPullDownLoading(),l({type:"GET",url:"/mp/appmsgalbum?action=paging&__biz=".concat(window.biz,"&album_id=").concat(D.albumId,"&begin_msgid=").concat(s.msgid,"&begin_itemidx=").concat(s.itemidx,"&count=").concat(D.pageCount,"&isbackward=1"),timeout:5e3,dataType:"json",success:function(t){P.hidePullDownLoading();if(0===(t.base_resp&&1*t.base_resp.ret)){const e=t.getalbum_resp.article_list,n=t.getalbum_resp.continue_flag;t.getalbum_resp.continue_flag=t.getalbum_resp.reverse_continue_flag,t.getalbum_resp.reverse_continue_flag=n,_(t.getalbum_resp);const o=h(e,!1,!1),a=i.firstChild;i.insertBefore(o,a),c=e.concat(c),P.scrollTo(0,a.offsetTop-62),setTimeout((()=>{P.finishPullDownLoad()}),500),s=c[0]}},error:function(){}}))}};(null==(e=window.target_album_info)?void 0:e.size)<=4&&(w.top="".concat(screen.height/2-(screen.height-window.innerHeight),"px")),P=new L(i,w),P.showLoading(),!D.isPC&&P.show(),function(t,e=0){t&&m.on(t,"click",".".concat(D.itemClassName),(t=>{const i=t.delegatedTarget;if(g.hasClass(i,"album_read_directory_current"))return;let n;n=i.dataset.url.includes("#")?i.dataset.url.replace("#","".concat(H,"&scene=190#")):i.dataset.url+"".concat(H,"&scene=190"),y({ActionType:5,Url:n,ComponentType:e}),A.jumpUrl(n,!0,{useFastLoad:!0}),g.addClass(i,"album_read_directory_disabled")}))}(i,t)}M.style.height="1px";const O=t=>new RegExp("^".concat(location.protocol,"//")).test(t)?t:t.replace(/^.*\/\//,"".concat(location.protocol,"//"));const z=x({name:"mp-keep-read",components:{[n.name]:n},props:{notPcDailog:{type:Boolean,default:!1}},data:()=>({isPC:w.isWindows||w.isMac&&!w.isIOS,pcPopoverShow:!1}),computed:{...o({targetAlbumInfo:t=>t.cgiData.target_album_info,albumKeepReadInfo:t=>{var e;return null==(e=t.cgiData)?void 0:e.album_keep_read_info},AlbumInfoLength:t=>{var e;return(null==(e=t.cgiData.album_info_list)?void 0:e.length)||0}}),canShowCard(){var t,e,i,n;return!!this.targetAlbumInfo&&(null==(t=this.targetAlbumInfo)?void 0:t.albumId)===(null==(e=this.albumKeepReadInfo)?void 0:e.album_id)&&((null==(i=this.albumKeepReadInfo)?void 0:i.pre_article_link)||(null==(n=this.albumKeepReadInfo)?void 0:n.next_article_link))},canShowTag(){return!!this.targetAlbumInfo&&1===this.AlbumInfoLength},canShow(){return this.canShowCard||this.canShowTag}},watch:{albumKeepReadInfo:{handler(){this.canShow&&this.$nextTick((()=>{this.initExposeReport()}))},immediate:!0}},methods:{onShow(){this.pcPopoverShow=!0,!h.os.pc&&document.body.classList.add("page_no_scroll")},onHide(){this.pcPopoverShow=!1,!h.os.pc&&document.body.classList.remove("page_no_scroll")},showBottomModal(){this.isPC&&this.notPcDailog?this.gotoAlbumInfo():(P?!this.isPC&&P.show():R({ComponentType:this.canShowCard?1:2}),this.isPC&&(P.contentAreaWrp.style.height="355px",P.endLine.childNodes[3].style.background="var(--weui-BG-5)",this.$refs.pcPopoverContent&&this.$refs.pcPopoverContent.appendChild(P.contentAreaWrp)),this.canShowCard||y({ActionType:8,ComponentType:2}))},jumpPrev(){let t;y({ActionType:2,SubActionType:1,ComponentType:this.canShowCard?1:2}),k(12),t=this.albumKeepReadInfo.pre_article_link.includes("#")?this.albumKeepReadInfo.pre_article_link.replace("#","".concat(H,"&scene=189#")):this.albumKeepReadInfo.pre_article_link+"".concat(H,"&scene=189"),location.href=O(t.replace(/&amp;/g,"&"))},jumpNext(){let t;y({ActionType:2,SubActionType:2,ComponentType:this.canShowCard?1:2}),k(13),t=this.albumKeepReadInfo.next_article_link.includes("#")?this.albumKeepReadInfo.next_article_link.replace("#","".concat(H,"&scene=189#")):this.albumKeepReadInfo.next_article_link+"".concat(H,"&scene=189"),location.href=O(t.replace(/&amp;/g,"&"))},gotoAlbumInfo(){if(y({ActionType:6,ComponentType:this.canShowCard?1:2}),k(15),this.targetAlbumInfo.link){const t=this.targetAlbumInfo.link.replace("#wechat_redirect","&subscene=159&subscene=".concat(window.source,"&scenenote=").concat(encodeURIComponent(window.location.href),"&nolastread=1#wechat_redirect"));f.openUrlWithExtraWebview(t.htmlDecode())}},initExposeReport(){let t;const{albumKeepRead:e}=this.$refs,i=e&&e.offsetHeight/2||0,n=()=>{if(t)return;const n=a.getOffset(e).offsetTop||0,o=c.getScrollTop();o+c.getInnerHeight()>=n+i&&o<=n+i&&(this.canShowCard?y({ActionType:1,ComponentType:1}):y({ActionType:7,ComponentType:2}),k(11),t=!0)};c.bindDebounceScrollEvent(n),n()}}},(function(){var t=this,e=t._self._c;return t.canShow?e("div",{ref:"albumKeepRead",staticClass:"album_con"},[t.canShowCard?e("div",{staticClass:"appmsg_card_context album_read_card",class:{has_pc_popover:t.pcPopoverShow}},[e("div",{staticClass:"album_read_hd weui-flex",attrs:{role:"button"},on:{click:function(e){return e.stopPropagation(),t.showBottomModal.apply(null,arguments)}}},[t.isPC?e("mp-popover",{attrs:{"wrp-class":"popover-wrp-class","ext-class":"popover-ext-class"},on:{show:t.onShow,hide:t.onHide}},[e("div",{staticClass:"album_read_source",attrs:{slot:"target"},slot:"target"},[e("span",{staticClass:"wx_tap_link js_album_directory__name"},[t._v(t._s(t.targetAlbumInfo.title.htmlDecode())+" · 目录")]),e("i",{staticClass:"weui-icon-read"})]),e("div",{staticClass:"album_name_title",attrs:{slot:"title"},on:{click:function(e){return e.stopPropagation(),t.gotoAlbumInfo.apply(null,arguments)}},slot:"title"},[t._v("#"+t._s(t.targetAlbumInfo.title.htmlDecode()))]),e("div",{ref:"pcPopoverContent"})]):e("div",{staticClass:"album_read_source"},[e("span",{staticClass:"wx_tap_link js_album_directory__name"},[t._v(t._s(t.targetAlbumInfo.title.htmlDecode())+" · 目录")]),e("i",{staticClass:"weui-icon-read"})])],1),e("div",{staticClass:"album_read_bd weui-flex"},[t.albumKeepReadInfo.pre_article_link?e("span",{staticClass:"album_read_nav_item album_read_nav_prev weui-flex__item wx_tap_link js_wx_tap_highlight",attrs:{role:"button"},on:{click:t.jumpPrev}},[e("span",{staticClass:"album_read_nav_inner"},[e("span",{staticClass:"album_read_nav_btn"},[t._v("上一篇")]),e("span",{staticClass:"album_read_nav_title"},[e("span",{staticClass:"album_read_nav_title_inner"},[t._v(t._s(t.albumKeepReadInfo.pre_article_title.htmlDecode()||""))])])])]):t._e(),t.albumKeepReadInfo.next_article_link?e("span",{staticClass:"album_read_nav_item album_read_nav_next weui-flex__item wx_tap_link js_wx_tap_highlight",attrs:{role:"button"},on:{click:t.jumpNext}},[e("span",{staticClass:"album_read_nav_inner"},[e("span",{staticClass:"album_read_nav_btn"},[t._v("下一篇")]),e("span",{staticClass:"album_read_nav_title"},[e("span",{staticClass:"album_read_nav_title_inner"},[t._v(t._s(t.albumKeepReadInfo.next_article_title.htmlDecode()||""))])])])]):t._e()])]):t.canShowTag?e("div",{staticClass:"album_tag_context",on:{click:function(e){return e.stopPropagation(),t.showBottomModal.apply(null,arguments)}}},[e("span",{staticClass:"album_tag_pre"},[t._v("收录于")]),e("span",{staticClass:"album_tag_icon"}),t.isPC&&!t.notPcDailog?e("mp-popover",{attrs:{"wrp-class":"popover-wrp-class","ext-class":"popover-ext-class"},on:{show:t.onShow,hide:t.onHide}},[e("span",{staticClass:"album_tag_name",attrs:{slot:"target"},slot:"target"},[t._v(t._s(t.targetAlbumInfo.title.htmlDecode()))]),e("div",{staticClass:"album_name_title",attrs:{slot:"title"},on:{click:function(e){return e.stopPropagation(),t.gotoAlbumInfo.apply(null,arguments)}},slot:"title"},[t._v("#"+t._s(t.targetAlbumInfo.title.htmlDecode()))]),e("div",{ref:"pcPopoverContent"})]):e("span",{staticClass:"album_tag_name"},[t._v(t._s(t.targetAlbumInfo.title.htmlDecode()))])],1):t._e()]):t._e()}),[],!1,null,null,null,null).exports,F=t=>{const e=t+"";return e.length>=2?e:"0"+e},X=t=>{const e=new Date(1e3*t);return e.getFullYear()<=(new Date).getFullYear()?"".concat(F(e.getMonth()+1),"月").concat(F(e.getDate()),"日 ").concat(F(e.getHours()),":").concat(F(e.getMinutes())):"".concat(e.getFullYear(),"年").concat(F(e.getMonth()+1),"月").concat(F(e.getDate()),"日 ").concat(F(e.getHours()),":").concat(F(e.getMinutes()))},Y={getFullTime:X,getStatusWording:(t,e)=>{let i;switch(t=parseInt(t,10),e=parseInt(e,10),t){case 0:i=0===e?"预约":"已预约";break;case 1:i="已失效";break;case 2:i="观看直播";break;case 3:case 4:i="已结束";break;case 5:i="观看回放";break;default:i="预约"}return i},getStatusDesc:(t,e)=>{let i;switch(e=parseInt(e,10)){case 0:i="将在".concat(X(t)," 直播");break;case 1:case 3:i="".concat(X(t)," 直播");break;case 2:default:i="正在直播";break;case 4:i="已结束直播，正在生成回放";break;case 5:i="已结束直播，可观看回放"}return i}},J={report:(t,e,i,n)=>{let o=0;try{o=1*window.atob(window.biz)}catch(a){}d.report(22035,{BizUin:o,AppMsgID:window.parseInt(window.mid,10)||0,ItemIndex:window.parseInt(window.idx,10)||0,Scene:window.parseInt(window.scene,10)||0,Enterid:window.parseInt(window.enterid,10)||0,Action:t,Status:n||"",ActionTS:Math.ceil(Date.now()/1e3),Noticeid:e||"",Username:i||""})}},K={report:(t,e)=>{let i=0;try{i=1*window.atob(window.biz)}catch(n){}d.report(24980,{BizUin:i,AppMsgID:window.parseInt(window.mid,10)||0,ItemIndex:window.parseInt(window.idx,10)||0,Scene:window.parseInt(window.scene,10)||0,Enterid:window.parseInt(window.enterid,10)||0,Action:t,ActionTS:Math.ceil(Date.now()/1e3),EventId:e+""||""})}},V=document.getElementById("js_content");function q(t){const{dom:e,callback:i,idkey:n,idkeyItem:o,detectName:a,title:r,contentDesc:l}=t,c=s({startElem:e,endElem:V||document.getElementById("js_content")},{rules:["CSS[Opacity<1]","CSS[Height=0]"]});if(c.length>0&&!h.os.pc){u.setSum(n,o,1),_.invoke("confirmDialog",{title:r,contentDesc:l,confirmText:"允许",cancelText:"取消"},(t=>{(t.err_msg.indexOf("confirmDialog:ok")>-1||t.err_msg.includes("function_not_implement"))&&i()}));const t="biz=".concat(window.biz,"&mid=").concat(window.mid,"&idx=").concat(window.idx);window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("".concat(a),"".concat(t),{mid:"mmbizwap:appmsg_covertest",view:"wap_business",_info:{url:location.href,hitArr:c}})}else i()}let $=[],G=[],Q=[],Z=[],tt=[],et=[],it=[],nt=1,ot=0;const at=document.getElementById("img-content"),st={maxWidth:at?at.getBoundingClientRect().width:0};try{ot=1*window.atob(window.biz)}catch(Lt){}function rt(){return!!h.os.pc&&(!(!w.isMac||!w.cpVersion("3.1.0",1,!0,"mac"))||(!!(w.isWindows&&w.getWindows()>="63030000")||!!h.os.unifiedPC))}function lt(t,e,i){d.report(21146,{BizUin:ot,AppMsgID:window.parseInt(window.mid,10)||0,ItemIndex:window.parseInt(window.idx,10)||0,ExportId:e||"",Action:t,Username:i||"",Scene:window.parseInt(window.scene,10)||0,Subscene:window.parseInt(window.subscene,10)||0,EnterId:window.parseInt(window.enterid,10)||0})}function ct(t){w.isNewMpApp?(window.weui||window).alert("请使用微信手机客户端打开"):"live"!==t&&"topic"!==t?("1"!==t&&0!==t||w.isInMiniProgram&&window.weui.alert("暂不支持从小程序进入视频号"),w.isAndroid&&window.clientversion>"2700135F"&&window.clientversion<"27001400"?window.weui.alert("当前版本暂不支持查看"):(w.isWechat&&h.os.pc?window.weui.alert("当前版本暂不支持查看，请在手机上查看"):w.isWechat||alert("请使用微信手机客户端打开"),!w.isWechat||h.os.pc||w.isWxWork||v.jumpUrl("https://support.weixin.qq.com/update/",!0))):w.isAndroid&&window.clientversion<"2700143c"||w.isIOS&&window.clientversion<"17001228"?window.weui.alert("请升级微信客户端版本后查看"):w.isWechat&&h.os.pc?window.weui.alert("当前版本暂不支持查看，请在手机上查看"):w.isInMiniProgram?window.weui.alert("暂不支持从小程序进入直播间"):w.isWechat||alert("请使用微信手机客户端打开")}function dt(t){if(!w.isWechat||h.os.pc||w.isWxWork||w.isNewMpApp||w.isAndroid&&window.clientversion<"2700143c"||w.isIOS&&window.clientversion<"17001228")ct("profile");else{let e={action:"openFinderProfile",finderUserName:t,commentScene:5,reportExtraInfo:JSON.stringify({scenenote:{bizUin:ot,msgid:window.parseInt(window.mid,10)||0,idx:window.parseInt(window.idx,10)||0,scene:window.parseInt(window.scene,10)||0,enterid:window.parseInt(window.enterid,10)||0,action:5,status:nt,actionTS:Math.ceil(Date.now()/1e3),url:window.msg_link},biz_enter_id:window.finder_biz_enter_id})};_.invoke("openFinderView",{extInfo:e},(t=>{console.log("openFinderView",t)}))}}function ut(t,e){let i;if(e){let t=window.location.protocol||"https:";e=encodeURIComponent(e),i=t+"//channels.weixin.qq.com/web/pages/live?eid=".concat(e)}!w.isNewMpApp&&(w.isWxWork&&w.cpVersion("4.1.6",1,!0,"wxwork")||!(!w.isWechat||h.os.pc||w.isAndroid&&window.clientversion<"2700143c"||w.isIOS&&window.clientversion<"17001228"||window.is_teenager&&(window.weui.alert("未成年人模式下，不支持观看直播"),1)))?_.invoke("openFinderView",{extInfo:{action:"autoOpenFinderLive",finderUserName:t,commentScene:5,wxworkUrl:i,reportExtraInfo:JSON.stringify({scenenote:{bizUin:ot,msgid:window.parseInt(window.mid,10)||0,idx:window.parseInt(window.idx,10)||0,scene:window.parseInt(window.scene,10)||0,enterid:window.parseInt(window.enterid,10)||0,action:4,status:nt,actionTS:Math.ceil(Date.now()/1e3),url:window.msg_link},biz_enter_id:window.finder_biz_enter_id})}},(t=>{console.log("openFinderLive",t)})):rt()?e?_.invoke("openUrlWithExtraWebview",{url:i,openType:1},(t=>{console.log("openUrlWithExtraWebview",t)})):ct():ct("live")}function pt(t,e,i){!w.isWechat||h.os.pc||w.isWxWork||w.isNewMpApp||w.isAndroid&&window.clientversion<"2700143c"||w.isIOS&&window.clientversion<"17001228"||_.invoke("openFinderView",{extInfo:{action:"autoOpenFinderLive",finderUserName:t,commentScene:5,feedID:e,nonceID:i,exportId:e,enableReplay:!0,reportExtraInfo:JSON.stringify({biz_enter_id:window.finder_biz_enter_id})}})}function ht(t,e,i,n,o,a={}){lt(2,t,i);let s="";if(o){let t=window.location.protocol||"https:";o=encodeURIComponent(o),s=t+"//channels.weixin.qq.com/web/pages/feed?eid=".concat(o)}w.isNewMpApp||!(w.isWxWork&&w.cpVersion("4.1.6",1,!0,"wxwork")||w.isDonutAPP)&&(!w.isWechat||h.os.pc||w.isIOS&&w.ltVersion("7.0.15",!1)||window.clientversion&&w.isAndroid&&window.clientversion<="27001337"||window.clientversion&&w.isAndroid&&window.clientversion>"2700135F"&&window.clientversion<"27001400")?rt()?o?_.invoke("openUrlWithExtraWebview",{url:s,openType:1},(t=>{console.log("openUrlWithExtraWebview",t)})):ct(n):(lt(3,t,i),ct(n)):_.invoke("openFinderView",{extInfo:Object.assign({action:"openFinderFeed",feedID:t,nonceID:e,notGetReleatedList:9===n?"1":0,shareScene:11,requestScene:34,wxworkUrl:s,reportExtraInfo:JSON.stringify({mp:{scene:1},bizUin:ot,url:window.msg_link,biz_enter_id:window.finder_biz_enter_id})},a)},(t=>{console.log("openFinderDetailView",t)}))}function mt(t,e){!w.isWechat||h.os.pc||w.isWxWork||w.isNewMpApp||w.isAndroid&&window.clientversion<"28000130"||w.isIOS&&window.clientversion<"18000622"||window.is_teenager&&(window.weui.alert("未成年人模式下，不支持观看直播"),1)?ct("topic"):_.invoke("openFinderTopicView",{extInfo:{title:t,topicType:7,eventEncryptedTopicId:e,entryScene:5}},(t=>{console.log("openFinderTopicView",t)}))}function _t(t){if(!t)return 0;const e=1e4;return t<e?t:t>1e5?"10万+":(t/e).toFixed(1)/1+"万"}function wt(t){return G.filter((e=>e.export_id===t))}function gt(t){return Q.filter((e=>e.notice_id===t))}function bt(t){return tt.filter((e=>e.event_id===t))}function ft(t){let e=t;if(e){let i,n=function(){ht(o,s,l,d,u)},o=e.getAttribute("data-id"),a=wt(o);a&&a.length>0&&(i=a[0]);let s=i&&i.nonce_id?i.nonce_id:e.getAttribute("data-nonceid"),r=i&&i.flag||0,l=i&&i.username?i.username:e.getAttribute("data-username"),c=i&&i.nickname?i.nickname:e.getAttribute("data-nickname"),d=i&&i.media_type?i.media_type:e.getAttribute("data-mediatype"),u=i&&i.export_id;0===r&&q({dom:t,callback:n,idkey:299174,idkeyItem:4,detectName:"videoSnapCoverDetect",title:"即将打开视频号",contentDesc:"".concat(c)})}}function vt(t){if(t){let e=t.getAttribute("data-eventid")||"event/UzFfAgtgekIEAQAAAAAA8PsgAc-cEgAAAAstQy6ubaLX4KHWvLEZgBPE8KNsXHhHYfj-zNPgMI5VOd7tKLpk98zswwl8bF9v",i=bt(e),n=i.length>0?i[0]:{event_info:{}};0===n.event_info.flag?(mt(n.event_info.name,e),K.report(2,e)):K.report(3,e)}}function At(t){let e=gt(t);e&&e.length>0&&(e=e[0]);let{status:i}=e,{reservation:n}=e;return 0===i?0===n?1:2:1===i?5:2===i?3:3===i?4:1}function yt(t,e,i){!w.isWxWork&&w.isWechat?window.is_teenager?window.weui.alert("未成年人模式下，不支持预约直播"):l({url:"/mp/appmsg_video_snap?action=reserve_live",type:"POST",dataType:"json",async:!0,data:{username:t,notice_id:e,reserve_status:i,live_scene:4},success(t){if(t&&t.base_resp&&0===t.base_resp.ret){let t=document.querySelectorAll('.js_wechannel_live_card[data-noticeid="'.concat(e,'"]'));for(let e=0;e<t.length;e++){let n=t[e];const o=1===i?1:0;n.setAttribute("data-reservation",o)}let n=gt(e);n&&n.length>0&&n.forEach((t=>{t.reservation=1===i?1:0}))}else window.weui.alert("系统繁忙，请稍后再试")},error(){window.weui.alert("操作失败")}}):window.weui.alert("请在微信内操作")}function kt(){if(Z&&Z.length&&et.length===Z.length)m.off(window,"scroll",kt);else for(let t=0;t<Z.length;t++){let e=Z[t],i=e;if(i&&i.getBoundingClientRect().top>0&&i.getBoundingClientRect().top+i.getBoundingClientRect().height/2<=c.getInnerHeight()){let t=e.getAttribute("data-id")||e.getAttribute("data-noticeid")||e.getAttribute("data-eventid"),i=e.getAttribute("data-username"),n=e.getAttribute("data-type");-1===et.indexOf(t)&&(et.push(t),"live"===n?J.report(1,t,i,At(t)):"topic"===n?K.report(1,t):lt(1,t,i))}}}function xt(t,e,i,n){let o=document.querySelectorAll('.js_wechannel_live_card[data-noticeid="'.concat(t,'"]'));for(let a=0;a<o.length;a++){let t=o[a],s=Y.getStatusDesc(n,e);t.setAttribute("data-desc",s),t.setAttribute("data-reservation",i),t.setAttribute("data-status",e)}}function Ct(){let t={__biz:window.biz||"",mid:window.mid||"",idx:window.idx||"",uin:window.uin||"",key:window.key||"",pass_ticket:window.pass_ticket||"",video_snap_num:Q.length};for(let i=0;i<Q.length;i++){let e=Q[i].notice_id,{username:n}=Q[i];t["notice_id_".concat(i)]=e,t["username_".concat(i)]=n}let e="/mp/appmsg_video_snap?action=batch_get_flag_info";for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e+="&"+i+"="+encodeURIComponent(t[i]));l({url:e,type:"GET",dataType:"json",async:!0,success(t){if(t&&t.base_resp&&0===t.base_resp.ret&&(console.log("batch_get_flag_info:",t),t.live_info&&t.live_info.length>0))for(let e=0;e<t.live_info.length;e++){let i=t.live_info[e],n=gt(i.notice_id);if(n&&n.length>0){let t=n[0];i.status===t.status&&i.reservation===t.reservation||(t.reservation=i.reservation,t.status=i.status,xt(i.notice_id,i.status,i.reservation,t.start_time))}}},error(){}})}function It(){!function(){let t=document.getElementsByClassName("js_wechannel_img_card");for(let e=0;e<t.length;e++){let i=t[e];m.on(i,"click",(()=>{ft(i)}))}}(),function(){let t=document.getElementsByClassName("js_wechannel_video_card");for(let e=0;e<t.length;e++){let i=t[e];m.on(i,"click",(()=>{ft(i)}))}}(),setTimeout((()=>{let t=t=>{let e=t.currentTarget,i=e.getAttribute("data-noticeid"),n=e.getAttribute("data-username"),o="";return Q instanceof Array&&Q.forEach((t=>{t.notice_id===i&&(o=t.export_id)})),J.report(4,i,n,At(i)),nt=At(i),ut(n,o),!1},e=document.getElementsByClassName("js_wechannel_live_card");if(console.log(e),e.length>0)for(let i=0;i<e.length;i++){let n=e[i].wrapper.$children[0].$refs.reserveButton,o=parseInt(n.getAttribute("data-status"),10);if(2===o)m.on(n,"click",t);else if(0===o)m.on(n,"click",(()=>{if(window.is_temp_url)return window.weui.alert("预览状态下无法操作"),!1;if(w.isNewMpApp)return window.weui.alert("请前往微信客户端操作"),!1;let t=n.getAttribute("data-noticeid"),e=n.getAttribute("data-reservation"),i=n.getAttribute("data-username");return"0"===e?J.report(2,t,i,At(t)):J.report(3,t,i,At(t)),yt(i,t,"0"===e?1:2),!1}));else if(5===o){const t=n.getAttribute("data-noticeid"),e=n.getAttribute("data-username"),i=gt(t)||[],o=i[0]&&i[0].export_id;m.on(n,"click",(()=>{pt(e,o,t)}))}}}),0),function(){let t=document.getElementsByClassName("js_wechannel_live_card");const e=t=>{let e=t.currentTarget,i=e.getAttribute("data-username"),n=e.getAttribute("data-noticeid");J.report(5,n,i,At(n)),nt=At(n),dt(i)};for(let i=0;i<t.length;i++){let n=t[i];m.on(n,"click",e)}}(),function(){let t=document.getElementsByClassName("js_wechannel_topic_card");for(let e=0;e<t.length;e++){let i=t[e];m.on(i,"click",(()=>{vt(i)}))}}(),m.bindVisibilityChangeEvt((t=>{t&&Ct()})),_.on("onWindowFocusChanged",(t=>{(w.isIOS?1*t.hasFocus:!t.hasFocus)||Ct()})),m.on(window,"scroll",kt)}function Tt(t,e){if(e){if(e.isSaveEnter)return t.replace(/\n/g,"<br>");if(e.isDecodeEnter)return t.replace(/&lt;br&gt;/g,"<br>")}return t}function Et(){let t=document.getElementById("js_content");if(!t)return;$=Array.from(t.getElementsByTagName("mpvideosnap"))||[];const e=Array.from(t.getElementsByTagName("mp-common-videosnap"))||[],i=document.getElementById("rumor-video-card")?Array.from([document.getElementById("rumor-video-card")]):[],n=$.concat(e).concat(i);console.log(n);let o=null;function a(t){if("MPVIDEOSNAP"===t.tagName){const e=document.createElement("mp-common-videosnap");return t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t),e}return t}for(let s=0;s<n.length;s++){let t=n[s];if(o=t.parentNode.getBoundingClientRect().width,w.isIOS){let e=t.parentNode;for(;!o&&e.parentNode&&(e=e.parentNode,o=e.getBoundingClientRect().width,!(o||o>=st.maxWidth)););o||(o=st.maxWidth)}o=Math.min(o,st.maxWidth);let e,i=t.getAttribute("data-id")||t.getAttribute("data-noticeid")||"",r=t.getAttribute("data-type")||"video";if("live"===r){let i=gt(t.getAttribute("data-noticeid")||""),n=i.length>0?i[0]:{};e={snapType:"live",headImgUrl:n.head_url||t.getAttribute("data-headimgurl")||"",nickname:n.nickname||t.getAttribute("data-nickname")||"",desc:Y.getStatusDesc(n.start_time,n.status)||t.getAttribute("data-desc")||"",reservation:n.reservation||0,status:n.status||0,username:n.username||t.getAttribute("data-username")||"",noticeid:n.notice_id||t.getAttribute("data-noticeid")||"",flag:1===n.spam_flag||2===n.spam_flag?1:0,intro:Tt(n.introduction||"",{isSaveEnter:!0})},it.push({noticeid:n.notice_id||t.getAttribute("data-noticeid")||"",status:n.status||0});const{snapType:o,headImgUrl:r,nickname:l,desc:c,reservation:d,status:u,username:p,noticeid:h,flag:m,intro:_}=e;if(t=a(t),t.setAttribute("data-index",s),t.setAttribute("data-headimgurl",r),t.setAttribute("data-username",p),t.setAttribute("data-nickname",l),t.setAttribute("data-desc",c),t.setAttribute("data-intro",_),t.setAttribute("data-type",o),t.setAttribute("data-status",u),t.setAttribute("data-flag",m),t.setAttribute("data-reservation",d),t.setAttribute("data-noticeid",h),t.classList.add("js_wechannel_live_card"),t.classList.add("js_wx_tap_highlight"),t.wrapper.$children[0]&&t.wrapper.$children[0].$refs&&t.wrapper.$children[0].$refs.reserveButton){t.wrapper.$children[0].$refs.reserveButton.addEventListener("touchstart",(t=>{t.stopPropagation()}))}Z.push(t)}else if("video"===r||"image"===r){let n=wt(i),l=n.length>0?n[0]:{},c=_t(1*l.feed_like_num),d=4===l.media_type||9===l.media_type?"video":"image",u=((1*t.getAttribute("data-ratio")||1)>1?l.feed_share_cover_url||l.feed_full_cover_url||l.feed_thumb_url:l.feed_cover_url||l.feed_thumb_url)||t.getAttribute("data-url")||"";"image"===r&&(u=l.feed_thumb_url||t.getAttribute("data-url")||""),e={snapType:l&&l.media_type?d:t.getAttribute("data-type"),url:u,headImgUrl:l.head_url||t.getAttribute("data-headimgurl")||"",authiconUrl:l.auth_info&&l.auth_info.auth_icon_url||"",nickname:l.nickname||t.getAttribute("data-nickname")||"",desc:l.feed_desc||t.getAttribute("data-desc")||"",flag:l.flag||0,likenum:c,feedShareCoverUrl:l.feed_share_cover_url||"",feedFullCoverUrl:l.feed_full_cover_url||"",feedThumbUrl:l.feed_thumb_url||"",feedCoverUrl:l.feed_cover_url||"",id:t.getAttribute("data-id"),username:l.username||t.getAttribute("data-username"),nonceid:l.nonce_id||t.getAttribute("data-nonceid"),width:t.getAttribute("data-width"),height:t.getAttribute("data-height"),isNews:l.is_news},"image"===e.snapType&&(e=Object.assign(e,{imgCount:parseInt(l.media_num||"0",10)||parseInt(t.getAttribute("data-imgcount")||"0",10)||0}));const{url:p,headImgUrl:h,authiconUrl:m,nickname:_,desc:w,flag:g,likenum:b,id:f,username:v,nonceid:A,width:y,height:k,isNews:x,feedShareCoverUrl:C,feedFullCoverUrl:I,feedThumbUrl:T,feedCoverUrl:E}=e;if(0!==g){const t=document.querySelector(".refuted_appmsg_card");t&&(t.style.display="none")}t=a(t),t.setAttribute("data-index",s),t.setAttribute("data-url",p),t.setAttribute("data-headimgurl",h),t.setAttribute("data-username",v),t.setAttribute("data-nickname",_),t.setAttribute("data-desc",w),t.setAttribute("data-flag",g),t.setAttribute("data-nonceid",A),t.setAttribute("data-type",e.snapType),t.setAttribute("data-authiconurl",m),t.setAttribute("data-feedsharecoverurl",C),t.setAttribute("data-feedfullcoverurl",I),t.setAttribute("data-feedthumburl",T),t.setAttribute("data-feedcoverurl",E),t.setAttribute("data-width",y),t.setAttribute("data-height",k),t.setAttribute("data-isnews",x?1:0),t.setAttribute("data-likenum",b),t.setAttribute("data-parentwidth",o),t.setAttribute("data-maxwidth",st.maxWidth),t.setAttribute("data-id",f),"video"===e.snapType?t.classList.add("js_wechannel_video_card"):(t.classList.add("js_wechannel_img_card"),t.classList.add("js_wechannel_img_context")),t.classList.add("js_wx_tap_highlight"),Z.push(t)}else if("topic"===r){let i=bt(t.getAttribute("data-eventid")||"event/UzFfAgtgekIEAQAAAAAA8PsgAc-cEgAAAAstQy6ubaLX4KHWvLEZgBPE8KNsXHhHYfj-zNPgMI5VOd7tKLpk98zswwl8bF9v"),n=i.length>0?i[0]:{event_info:{}},o=C.unix(n.event_info.end_time).format("YYYY年MM月DD日 HH:mm");e={snapType:"topic",headImgUrl:n.event_info.head_url,nickname:n.event_info.nickname,desc:n.event_info.desc,flag:n.event_info.flag,endTime:o,eventId:n.event_id,closeFlag:n.event_info.close_flag,title:n.event_info.name};const{snapType:r,headImgUrl:l,nickname:c,desc:d,flag:u,endTime:p,closeFlag:h,title:m,eventId:_}=e;t=a(t),t.setAttribute("data-index",s),t.setAttribute("data-headimgurl",l),t.setAttribute("data-nickname",c),t.setAttribute("data-desc",d),t.setAttribute("data-endtime",p),t.setAttribute("data-flag",u),t.setAttribute("data-name",m),t.setAttribute("data-closeflag",h),t.setAttribute("data-type",r),t.setAttribute("data-eventid",_),t.classList.add("js_wechannel_topic_card"),t.classList.add("js_wx_tap_highlight"),Z.push(t)}I(t,i)}kt(),It()}function St(){!function(){let t=[];try{t=JSON.parse(window.video_snap_json).list}catch(Lt){console.log(Lt)}let e={},i={__biz:window.biz||"",mid:window.mid||"",idx:window.idx||"",uin:window.uin||"",key:window.key||"",pass_ticket:window.pass_ticket||""},n=0;for(let o=0;o<t.length;o++){let a=t[o].export_id||t[o].notice_id||t[o].event_id,{username:s}=t[o];e[a]?e[a].push(o):(e[a]=[o],t[o].export_id?i["exportid_".concat(n)]=a:t[o].notice_id?i["notice_id_".concat(n)]=a:t[o].event_id&&(i["export_event_id_".concat(n)]=a),i["username_".concat(n)]=s,n++)}i.video_snap_num=Object.keys(e).length,l({url:"/mp/appmsg_video_snap?action=batch_get_video_snap",type:"POST",dataType:"json",async:!0,data:i,success(t){t&&t.base_resp&&0===t.base_resp.ret&&(G=t.video_snap_info||[],Q=t.live_info||[],tt=t.event_info||[]),Et()},error(){Et()}})}()}const Bt="/mp/c_psmaterial_info?action=get_windowproduct";function Wt(t,e){const i={base_req:{action:t},ext_info:JSON.stringify(e)};return{data:JSON.stringify(i)}}function Nt(t){var e,i;const n=JSON.parse(t.getAttribute("data-url-params")||"{}"),o=Object.assign({},n,{exportkey:p.getQuery("exportkey"),__biz:window.biz,isPreview:window.is_temp_url,article_info:btoa(JSON.stringify({mp_biz:atob(window.biz),item_idx:Number(window.itemidx||window.idx),appmsgid:Number(window.mid),item_show_type:Number(window.item_show_type),mp_article_scene:Number(window.source),mp_sub_scene:Number(window.subscene),mp_get_a8key_scene:Number(window.ascene),carrier_type:(null==(i=null==(e=window.cgiData)?void 0:e.product_activity)?void 0:i.activity_type)||0,search_click_id:p.getQuery("search_click_id")}))});t.setAttribute("data-url-params",JSON.stringify(o)),t.setAttribute("data-loaded","1"),t.addEventListener("iframe-message",(e=>{const i=function(t){try{const{action:e,value:i}=JSON.parse(t);return{action:e,value:i}}catch(e){console.error(e)}return{}}((e=e.detail).data);if(i){const{value:e}=i,n=t.shadowRoot.querySelector("iframe").contentWindow;switch(i.action){case"onFrameReady":!function(t){r.saveSpeeds({sample:1,uin:window.user_uin,pid:2982,speeds:{sid:27,time:Date.now()-window.__setBottomPlaceholderTime}}),r.send(),t.__timer&&clearTimeout(t.__timer)}(t);break;case"report":!function(t,e){if(!t)return;const{data:i}=t;i.params&&(i.params=JSON.parse(i.params),i.params=JSON.stringify({...i.params,scene:Number(window.source),subscene:Number(window.subscene),ClientVersion:parseInt(window.clientversion||"",16),SessionId:window.sessionid||""})),l({type:"POST",url:Bt,timeout:5e3,dataType:"json",data:Wt("ReportMMData23782",{...i}),success(){},error(){console.log("[error]")}})}(e);break;case"jsapi":_.invoke(e.methodName,e.args,(t=>{E(n,"jsapicallback",{res:t,uuid:e.uuid})}))}}})),T.on("ext-success",(e=>{console.log("???????????/ext success"),t.setAttribute("data-wap-export-token",e.wap_export_token)})),r.saveSpeeds({sample:1,uin:window.user_uin,pid:2982,speeds:{sid:26,time:Date.now()-window.__setBottomPlaceholderTime}}),r.send();const a=setTimeout((()=>{window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("load timeout","load timeout",{mid:"mmbizwap:lottery",view:"wap_business",_info:{url:location.href,newUrlParam:o}})}),1e4);t.__timer=a}function jt(){function t(){document.querySelectorAll("mp-common-bluepacket").forEach((t=>{Nt(t)}))}window.__second_open_wait_a8key__&&window.__second_open_wait_a8key_task__?window.__second_open_wait_a8key_task__.push(t):t()}export{L as B,St as a,q as b,Y as c,It as d,jt as i,z as k,Tt as r};
