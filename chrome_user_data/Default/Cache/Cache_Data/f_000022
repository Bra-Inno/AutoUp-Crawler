import{Z as t,P as e,aC as i,aD as n,I as o,aE as s,aF as a,B as r,aG as l,s as d}from"./topic.mg5xph6vf09b6144.js";import{m as u,A as c,a as p,D as h,i as m}from"./private_share.mg5xph6v1a0c9c7e.js";import{m as y,a as g,d as _,j as f,c as v,l as w,L as I}from"./comm_utils.mg5xph6v4fda8a3d.js";import"./appmsgext.mg5xph6v82836ebd.js";import{_ as S}from"./loadscript.mg5xph6v2014a786.js";import{w as b}from"./page_utils.mg5xph6vb076ad9f.js";import{T}from"./tmpl.mg5xph6v1af565c1.js";import{C as L}from"./class.mg5xph6vd1a660bd.js";import{c as k}from"./report.mg5xph6vbb75e91a.js";import{o as C}from"./page_utils.mg5xph6v15e313ed.js";import{n as P}from"./_plugin-vue2_normalizer.mg5xph6vfc2fb13f.js";const x={hasInit:!1,synPlayStatusId:null,synPlayStatusArr:[],inWechat:u.isWechat&&!u.isWindowsWechat&&!u.isMacWechat,mutexCount:0,ev:0!=window._empty_v.indexOf(window.location.protocol)?"http:"+window._empty_v:window._empty_v,debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1,_playtype:1*W("_playtype")||0,isAndroidLow:/android\s2\.3/i.test(navigator.userAgent),isAndroid:u.isAndroid,surportType:"addEventListener"in window?2:0,mutexPlayers:{},mutexPlayers2:{},wxtag:"__wxtag__".concat(window.biz,"-").concat(window.mid,"-").concat(window.idx),playbackRate:1,autoplayAudioList:[],autoplayAudioListLen:10,isFromTingPlayer:[267,268,90,0,268,126].indexOf(parseInt(window.source))>=0,mmlistenPlaylistInfoBuffer:window.mmlisten_playlist_info_buffer,tingScene:1*window.item_show_type==0?1105:1*window.item_show_type==7?1106:0};function A(t){x.hasInit||(x.hasInit=!0,x.jsapiGlobalEvent={error:j,pause:N,stop:U,play:F,preempted:U,waiting:H},B("onBackgroundAudioStateChange"),B("onTingAudioStateChanged",t),x.surportType>0&&x.isAndroidLow&&window.addEventListener("canplay",(function(t){t.target&&"function"==typeof t.target.play&&t.target.play()}),!0))}function D(t){this._o={plugins:[],protocal:"",wxIndex:0,type:0,src:"",jsapi2Src:"",mid:"",autoPlay:!1,duration:0,needVioceMutex:!0,title:"",allowPause:!1,singer:"",epname:"",coverImgUrl:"",webUrl:"",musicbar_url:"",fileSize:0,onStatusChange:function(t,e){},onTimeupdate:function(t){},onError:function(t,e){},onUpdateSeekRange:function(t){},albumId:"",audioList:[],playAudioId:"",speedList:[.75,1,1.25,1.5,2],articleCoverCdnUrl1_1:"",albumInfo:{},tingExtInfo:{},albumClientPlayMpAuidoId:"",isClMusic:!1},this._extend(t),this._o.audioList.length&&this._o.audioList.forEach((t=>{t.srcId=x.wxtag+this._o.albumId+"_"+t.audioId})),this._status=-1,this._g={mutexKey:"",jsapiSrcId:"",hasCheckPlay:!1,playTimeoutId:null,stateChangeCallback:{},_blockPlugin:{},hasInitH5Event:!1,h5Event:{},totalPlayTime:0,hasPlayedDuration:0},A(this._o),this._initPlugins(),this._fixAndroidSizeLimit(),0!==x.surportType&&(this._initData(),this._synPlayStatus())}function E(t){R({cur:t,stopCur:!1})}function R(t){if(0==x.mutexCount){var e=t.cur,i=!0===t.stopCur,n=t.callback,o=0;for(var s in x.mutexPlayers)for(var a=0,r=x.mutexPlayers[s].length;a<r;a++)o++;for(var s in x.mutexPlayers)for(a=0,r=x.mutexPlayers[s].length;a<r;a++){var l=x.mutexPlayers[s][a];if(l&&l!==e){var d=l.getSurportType(),u="";2!=d||1!=l._status&&4!=l._status?1!=d&&3!=d||1!=l._status&&2!=l._status&&4!=l._status||(u="stop"):u=l._o.allowPause?"pause":"stop",u&&"function"==typeof l[u]?l[u](i,(function(){x.mutexCount++,c()})):(x.mutexCount++,c())}else x.mutexCount++,c()}}else setTimeout((function(){R(t)}),200);function c(){if(x.mutexCount==o&&(o=0,x.mutexCount=0,"function"==typeof n)){var t=0;1==x.surportType?t=2e3:3==x.surportType&&(t=0),setTimeout((function(){n()}),t)}}}function O(t){return"&"+x.wxtag+"="+t}function B(t,e={}){c.on(t,(function(t){if(console.log("+++++++++++++++onBackgroundAudioStateChange log:"+JSON.stringify(t||{})),!t.state&&!t.status)return;var i;t.src&&(t.src=V(t.src,"t")),t.albumId?(i=t.albumId,t.srcId=""):t.srcId&&t.audioId&&(i=t.srcId.match(new RegExp(x.wxtag+"(.*?)_"+t.audioId)))?(i=i[1],t.srcId="",t.albumId=i):t.status?e.albumId?(i=e.albumId,t.srcId="",t.audioId=t.item&&t.item.srcId||""):x.isFromTingPlayer&&t.item.mpInfo?(t.src=t.item.srcId,t.srcId=t.item.srcId,i="".concat(t.item.mpInfo.username,"_").concat(t.item.mpInfo.audioId)):(t.src=t.item.srcId,t.srcId=t.item.srcId):(i=W(x.wxtag,t.src)||"")&&(i=O(i));var n,o=x.mutexPlayers[t.src]||x.mutexPlayers2[t.src]||x.mutexPlayers[i];if(!o)return void Object.keys(x.mutexPlayers).forEach((e=>{var i;const n=x.mutexPlayers[e];null==(i=null==n?void 0:n.forEach)||i.call(n,(e=>x.jsapiGlobalEvent.stop(t,e,!0)))}));if(t.srcId){for(var s=0,a=o.length;s<a;s++)if(o[s]._g.jsapiSrcId===t.srcId){n=o[s];break}}else if(1==o.length)n=o[0];else for(s=0,a=o.length;s<a;s++)if(-1!=o[s]._status&&0!=o[s]._status&&3!=o[s]._status){n=o[s];break}if(!n||!n._g.stateChangeCallback)return void Object.keys(x.mutexPlayers).forEach((e=>{var i;const n=x.mutexPlayers[e];null==(i=null==n?void 0:n.forEach)||i.call(n,(e=>x.jsapiGlobalEvent.stop(t,e,!0)))}));const r=1*n._o.isTingOpen==1&&!!t.item&&!!t.item.mpInfo&&!!t.item.mpInfo.albumId&&t.item.mpInfo.albumId===n._o.albumId&&t.item.srcId!==n.getPlayAudioId();r&&n.setAlbumClientPlayMpAuidoId(t.item.mpInfo.audioId),(t.albumId&&t.albumId===n._o.albumId&&t.audioId!==n.getPlayAudioId()||r)&&(n.setPlayAudioId(t.audioId),n._initJsapiData());var l=t.state,d=t.status,u=!1;if(d){l={idle:"stop",loading:"waiting",playing:"play",paused:"pause"}[d],"idle"===d&&+t.currentTime>=+t.duration&&(u=!0)}else"ended"===l&&(l="stop",u=!0),"wait"==l&&(l="waiting");console.log("state, isEnded",l,u);var c=!1,p=JSON.stringify(t||{});if("error"==l)for(var h in n.jsapiLog("onBackgroundAudioStateChange error;res:"+p),n._g.stateChangeCallback)n._g.stateChangeCallback.hasOwnProperty(h)&&"function"==typeof n._g.stateChangeCallback[h]&&(c=!0,n._g.stateChangeCallback[h](-1,t.errMsg||""),n._g.stateChangeCallback[h]=null);else"function"==typeof n._g.stateChangeCallback[l]&&(console.log("excute stateChangeCallback :"+l),n.jsapiLog("onBackgroundAudioStateChange "+l+";res:"+p),c=!0,n._g.stateChangeCallback[l](0),n._g.stateChangeCallback[l]=null);c||"function"!=typeof x.jsapiGlobalEvent[l]||(n.jsapiLog("onBackgroundAudioStateChange "+l+" unHandle;res:"+p),"stop"===l?x.jsapiGlobalEvent[l](t,n,u):x.jsapiGlobalEvent[l](t,n))}))}function j(t,e){e.stop(!1),e._trigger("jsapi2PlayingErr")}function U(t={},e,i){e.stop(!1,null,t,i),e._trigger("jsapi2PlayingStop")}function N(t={},e){e.pause(!1,null,!0,t),e._trigger("jsapi2PlayingPause")}function F(t={},e){1!=e._status&&e.resume(!1,null,!0,t)}function H(t,e){e.onload()}function W(t,e){var i=arguments[1]||window.location.search,n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=i.substr(i.indexOf("?")+1).match(n);return null!=o?o[2]:""}function J(t){0===t&&(t=1);const e=1*t;x.playbackRate=isNaN(e)?1:e}function V(t,e){if(!t)return;if(!e)return t;const i=new URL(t),{origin:n,pathname:o,searchParams:s,hash:a}=i;if(s){if(s.has(e)){s.delete(e);const t=[];for(let e of s)t.push("".concat(e[0],"=").concat(e[1]));return"".concat(n).concat(o,"?").concat(t.join("&")).concat(a)}}else{let{search:t}=i;if(t){const i=new RegExp("[?&]?".concat(e,"=[^&]*"),"g");return t=t.replace(i,"").replace(/^&/,"?"),"".concat(n).concat(o).concat(t).concat(a)}}return t}D.prototype._initPlugins=function(){for(var t=this._o.plugins,e=0,i=t.length;e<i;++e){var n=t[e];n.setPlayer(this),n.init&&n.init()}},D.prototype._trigger=function(t,e){var i=this._o,n=this._g,o=i.plugins,s=n._blockPlugin[t]||n._blockPlugin.all,a=0;if(s&&"function"==typeof s.recv&&1&(a|=s.recv(t,e)))return!1;for(var r=0,l=o.length;r<l&&!(2&(a|=o[r].recv(t,e)));++r);if(!(4&a)){var d=this["__"+t+"Handler"];d&&d.call(this,e)}8&a||this.__triggerOutside(t,e)},D.prototype.__triggerOutside=function(){var t=arguments,e=t[0];if(e){e=e.substr(0,1).toUpperCase()+e.substr(1);var i=this._o["on"+e];"function"==typeof i&&i.apply(this,t)}},D.prototype._setBlockPlugin=function(t,e){this._g._blockPlugin[t]=e},D.prototype._synPlayStatus=function(){var t,e=this,i=this._o,n=this._g;if(!x.inWechat||1*x._playtype>0)return n.hasCheckPlay=!0,void(e._o.autoPlay&&e.play());function o(t){console.log("synCallback",t),x.isFromTingPlayer&&(n.jsapiSrcId=t.item.srcId),e._initJsapiData({curTime:+t.currentTime,bufferedPercent:t.bufferedPercent,starTime:+new Date-1e3*+t.currentTime}),e._trigger("jsapi2Begin2Play",t);const o=e.jsApiData,s=!!t.status&&("loading"===t.status||"playing"===t.status);(1*i.isTingOpen!=1?!t.paused:s)?(e._onPlay(null,t),e._analogUpdateTime()):1*i.isTingOpen==1&&"paused"!==t.status||(e._onTimeupdate(null,o.curTime),e._onPause()),e._getMusicPlayerState()}function s(){t&&clearTimeout(t),!0!==n.hasCheckPlay&&(n.hasCheckPlay=!0,e._o.autoPlay&&e.play())}!function(t,e,i){x.synPlayStatusArr.push({_t:t,onSuccess:e,onError:i}),x.synPlayStatusId&&clearTimeout(x.synPlayStatusId);function n(t,e){for(;x.synPlayStatusArr.length>0;){var i=x.synPlayStatusArr.shift();i&&"function"==typeof i[t]&&i[t](e)}}x.synPlayStatusId=setTimeout((function(){t._jsapi_getMusicPlayerState({onSuccess:function(t){n("onSuccess",t)},onError:function(t){n("onError",t)}})}),0)}(e,(function(s){t&&clearTimeout(t);n.hasCheckPlay;n.hasCheckPlay=!0,e._surportType=3,x.surportType=3,s.playbackRate?J(s.playbackRate):J(s.playRate)&&J(s.playRate);if(console.log("_synPlayStatus mutexKey:"+n.mutexKey,s),s&&s.audioListState)try{s.audioListState=JSON.parse(s.audioListState),s.albumId=s.audioListState.albumId}catch(a){}if(i.albumId){if(1*i.isTingOpen==1&&s.item&&s.item.mpInfo&&s.item.mpInfo.albumId===i.albumId||s.albumId&&i.albumId===s.albumId){const t="waiting"===s.playState||"seeked"===s.playState||"seeking"===s.playState||"play"===s.playState||"playing"===s.status||"loading"===s.status;e._onAlbumSync({action:"updatePlayStatus",isPlay:t})}else e._onAlbumSync({action:"updatePlayStatus",isPlay:!1});o(s)}else if(s.src&&(i.src==s.src||s.src.indexOf(n.mutexKey)>=0)){if(s.srcId){if(s.srcId!=n.jsapiSrcId)return}else if(x.mutexPlayers[n.mutexKey].length>1&&x.mutexPlayers[n.mutexKey][0]!==e)return;o(s)}else if(s&&s.item&&(s.item.srcId&&n.jsapiSrcId===s.item.srcId||x.isFromTingPlayer&&s.item.mpInfo&&s.item.mpInfo.username===i.userName&&s.item.mpInfo.audioId===i.songId)){if(x.isFromTingPlayer&&s.item.mpInfo){const t="".concat(s.item.mpInfo.username,"_").concat(s.item.mpInfo.audioId);if(console.log("tingMutexKey, g.mutexPlayers",t,x.mutexPlayers),!x.mutexPlayers[t])return}"playing"===s.status&&o(s)}}),s),t=setTimeout((function(){s()}),i.syncTimeout||1e4)},D.prototype._fixAndroidSizeLimit=function(){if(!(1*x._playtype>0)&&x.isAndroid){var t=this._o;!t.fileSize||t.fileSize>300||u.gtVersion("6.3.28",!0)||(this._trigger("androidForceH5"),this._g._playtype=2)}},D.prototype._createAutoAndPlay=function(){var t=this;function e(){function e(){t._o.albumId&&t._o.playAudioId?t._h5Audio.src=t.getPlayAudioOpt().src:t._h5Audio.src=t._o.src}t._trigger("h5Begin2Play"),t._h5Audio=document.createElement("audio"),t._initH5Data(!0),t._H5bindEvent(!0),t._h5Audio.setAttribute("style","height:0;width:0;display:none"),t._h5Audio.setAttribute("autoplay",""),t._status=0,t._onLoading(),x.isAndroidLow?(e(),document.body.appendChild(t._h5Audio),t._h5Audio.load()):(document.body.appendChild(t._h5Audio),setTimeout((function(){e(),t._h5Audio.playbackRate=t._o.isAudio?x.playbackRate:1,t._h5Audio.play()}),0)),t._surportType=2}x.inWechat?this._stopJsapiPlay(!0,(function(){e()})):e()},D.prototype._destoryH5Audio=function(){this._h5Audio&&(-1!=this._status&&"function"==typeof this._h5Audio.pause&&this._h5Audio.pause(),document.body.removeChild(this._h5Audio),this._h5Audio=null,this._status=-1)},D.prototype._onLoading=function(t){this._status=4;try{E(this)}catch(e){}"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status),this._endCountTime()},D.prototype._onPlay=function(t={},e={}){this._status=1;try{E(this)}catch(i){}"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t,this._status,e),this._startCountTime()},D.prototype._onPause=function(t,e={}){this._status=2,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status,e),this._endCountTime()},D.prototype._onAlbumSync=function(t){"function"==typeof this._o.onAlbumSync&&this._o.onAlbumSync.call(this,t||{})},D.prototype.getAudioListState=function(t,e){const i=i=>{if(!!i.status&&("loading"===i.status||"playing"===i.status)&&this.setPlayAudioId(i.item?i.item.srcId:i.audioListState?i.audioListState.audioId:""),1*this._o.isTingOpen==1)i.playbackRate?J(i.playbackRate):i.playRate&&J(i.playRate),i.item&&e({[i.item.srcId]:{currentTime:+i.currentTime,duration:i.item.duration},albumId:t,item:i.item,audioId:i.item.srcId});else if(i&&i.audioListState){if("string"==typeof i.audioListState)try{i.audioListState=JSON.parse(i.audioListState)}catch(n){i.audioListState={}}i.playbackRate?J(i.playbackRate):i.playRate&&J(i.playRate),e(i.audioListState)}};this.isTingSupportType()&&1*this._o.isTingOpen==1?c.invoke("getTingAudioState",{sourceType:2},(t=>{t&&t.status&&"idle"===t.status?c.invoke("getTingAudioState",{sourceType:1},(t=>{i(t)})):i(t)})):c.invoke("getBackgroundAudioState",{albumId:t},(t=>{t.src&&(t.src=V(t.src,"t")),i(t)}))},D.prototype._onEnd=function(t,e={},i=!1){const n=x.autoplayAudioList[x.autoplayAudioList.length-1];if(this._status=3,"function"==typeof this._o.onStatusChange&&this._o.onStatusChange.call(this,t||{},this._status,e),this._endCountTime(),i?this.updatePlayedDuration(0):this.updatePlayedDuration(+e.currentTime),this._o.albumId&&1*this._o.isTingOpen!=1&&i&&n&&n.audioId===e.audioId){const{curIdx:t}=this.getAlbumCurAudio();if(t>-1){x.autoplayAudioList=this._o.audioList.slice(t+1,t+1+x.autoplayAudioListLen);const e=this._o.audioList[t+1],i={albumId:this._o.albumId+"",playAudioId:e.audioId,audioList:x.autoplayAudioList};c.invoke("setBackgroundAudioState",i)}}},D.prototype._onLoadedmetadata=function(t){"function"==typeof this._o.onLoadedmetadata&&this._o.onLoadedmetadata.call(this,t||{})},D.prototype._onUpdateSeekRange=function(t){this.surportSeekRange()&&(t=Math.max(t,0),t=Math.min(t,100),"function"==typeof this._o.onUpdateSeekRange&&this._o.onUpdateSeekRange.call(this,t))},D.prototype._onTimeupdate=function(t,e,i){"function"!=typeof this._o.onTimeupdate||i||this._o.onTimeupdate.call(this,t||{},e),e>0&&this._startCountTime()},D.prototype._onError=function(t,e){this._status=-1,"function"==typeof this._o.onError&&this._o.onError.call(this,t||{},e)},D.prototype._initH5Event=function(){var t=this,e=this._o,i=this._g;if(!t._g.hasInitH5Event){t._g.hasInitH5Event=!0;var n,o=i.h5Event;o.canplaythrough=function(e){t._h5Audio&&(x.debug&&console.log("h5 canplaythrough"),t._h5Data.firstCanplaythrough=!0,t._onPlay(e),t._onUpdateSeekRange(t._h5Data.downloadDuration||0))},o.play=function(e){t._h5Audio&&(x.debug&&console.log("h5 "+e.type),!0===t._h5Data.firstCanplaythrough&&(t._onPlay(e),t._onUpdateSeekRange(t._h5Data.downloadDuration||0)))},o.ended=function(e){t._h5Audio&&(x.debug&&console.log("h5 ended"),t._onUpdateSeekRange(t._h5Data.downloadDuration),t._onEnd(e))},o.pause=function(e){t._h5Audio&&(x.debug&&console.log("h5 pause"),!0!==t._o.allowPause||0==t._h5Audio.currentTime?t._onEnd(e):t._onPause(e))},o.waiting=function(e){t._h5Audio&&(x.debug&&console.log("h5 "+e.type),1!=t._status&&2!=t._status&&4!=t._status||t._onLoading(e))};o.seeking=function(e){t._h5Audio&&(x.debug&&console.log("h5 "+e.type),1!=t._status&&2!=t._status&&4!=t._status||t._onLoading(e),n=setTimeout((function(){x.debug&&console.log("seek loading Timeout excute"),n=null,t._trigger("seekNeed2Load")}),100))},o.seeked=function(e){t._h5Audio&&(x.debug&&console.log("h5 seeked"),1!=t._status&&2!=t._status&&4!=t._status||(t._onPlay(e),t._h5Audio.play()),n&&(clearTimeout(n),n=null,t._trigger("seekNotNeed2Load")))},o.error=function(e){var i=1*e.target.error.code||5;(i<1||i>5)&&(i=5),t._trigger("h5Error",{code:i}),t._onError(e,{type:1,code:i}),t._destoryH5Audio()},o.timeupdate=function(i){t._h5Audio&&((1==t._status||4==t._status)&&t._onUpdateSeekRange(t._getH5DownloadDuration()),1==t._status&&t._onTimeupdate(i,t._h5Audio.currentTime),void 0!==e.duration&&1*e.duration>0&&t._h5Audio.currentTime>=e.duration&&t._h5Stop())},o.loadedmetadata=function(e){t._h5Audio&&t._onLoadedmetadata(e)}}},D.prototype._H5bindEvent=function(t){this._o;var e=this._g,i={canplaythrough:"canplaythrough",play:"play",playing:"play",ended:"ended",pause:"pause",seeking:"seeking",waiting:"waiting",seeked:"seeked",error:"error"};try{for(var n in i)i.hasOwnProperty(n)&&this._h5Audio.removeEventListener(n,e.h5Event[i[n]]);this._h5Audio.removeEventListener("timeupdate",e.h5Event.timeupdate),this._h5Audio.removeEventListener("loadedmetadata",e.h5Event.loadedmetadata)}catch(o){}if(t){for(var n in i)i.hasOwnProperty(n)&&this._h5Audio.addEventListener(n,e.h5Event[i[n]],!1);"function"==typeof this._o.onTimeupdate&&this._h5Audio.addEventListener("timeupdate",e.h5Event.timeupdate,!1),"function"==typeof this._o.onLoadedmetadata&&this._h5Audio.addEventListener("loadedmetadata",e.h5Event.loadedmetadata,!1)}},D.prototype._initData=function(){var t=this._o;this._createMutexKey(),x.mutexPlayers[this._g.mutexKey]?x.mutexPlayers[this._g.mutexKey].push(this):x.mutexPlayers[this._g.mutexKey]=[this],x.mutexPlayers[this._g.jsapiSrcId]?x.mutexPlayers[this._g.jsapiSrcId].push(this):x.mutexPlayers[this._g.jsapiSrcId]=[this],t.jsapi2Src&&t.jsapi2Src!=t.src&&(x.mutexPlayers2[t.jsapi2Src]?x.mutexPlayers2[t.jsapi2Src].push(this):x.mutexPlayers2[t.jsapi2Src]=[this]),x.isFromTingPlayer&&(x.mutexPlayers[(window.user_name||window.cgiData.user_name)+"_"+t.songId]=[this]),console.log("mutexPlayers",x.mutexPlayers),this._initH5Event()},D.prototype._createMutexKey=function(){if(this._o.albumId)this._g.mutexKey=this._o.albumId,this._g.jsapiSrcId=x.wxtag+"_"+this._o.wxIndex;else{var t=this._o.mid||"";this._o.src?(this._g.mutexKey=this._o.src,this._g.jsapiSrcId=x.wxtag+"_"+this._o.wxIndex):this._o.listenId?(this._g.mutexKey=this._o.listenId+"_"+this._o.wxIndex,this._g.jsapiSrcId=this._g.mutexKey):(this._g.mutexKey=O(t)+"_"+this._o.wxIndex,this._g.jsapiSrcId=this._g.mutexKey)}console.log("➜ mutexKey",this._o.title,this._g.mutexKey,this._g.jsapiSrcId)},D.prototype._extend=function(t){for(var e in t)this._o[e]=t[e]},D.prototype._initH5Data=function(t){this._h5Data={firstCanplaythrough:!0!==t,downloadDuration:0,lastPlaytime:null}},D.prototype._initJsapiData=function(t){t=t||{},this.jsApiData&&(this.jsApiData.updateTimeoutId&&clearTimeout(this.jsApiData.updateTimeoutId),this.jsApiData.getStatusId&&clearTimeout(this.jsApiData.getStatusId)),this.jsApiData={getStatusId:null,getStatusTime:t.getStatusTime||2500,updateTimeoutId:null,seeking:!1,starTime:t.starTime||+new Date,curTime:t.curTime||0,bufferedPercent:t.bufferedPercent||0,duration:this._o.duration||t.duration||void 0,lastPlaytime:null,albumId:"",audioId:""}},D.prototype._getMusicPlayerState=function(){const t=this,e=t._o,i=t._g,n=t.jsApiData;n&&n.getStatusId&&clearTimeout(n.getStatusId),t._jsapi_getMusicPlayerState({onSuccess:function(o){if(o&&o.audioListState&&"string"==typeof o.audioListState)try{o.audioListState=JSON.parse(o.audioListState),o.albumId=o.audioListState.albumId}catch(s){o.audioListState={}}e.albumId&&(o.albumId&&o.albumId===e.albumId||1*e.isTingOpen==1&&o.item&&o.item.mpInfo&&o.item.mpInfo.albumId===e.albumId)||o.src==e.jsapi2Src||o.src==e.src||1*e.isTingOpen==1&&o&&o.item&&o.item.srcId&&i.jsapiSrcId===o.item.srcId?(n.curTime=+o.currentTime,n.starTime=+new Date-1e3*+o.currentTime,n.bufferedPercent=o.bufferedPercent,n.albumId=o.albumId||e.albumId||"",n.audioId=o.audioId||o.item&&o.item.srcId||"",1!=t._status&&2!=t._status&&4!=t._status||(n.getStatusId=setTimeout((function(){t._getMusicPlayerState()}),n.getStatusTime)),t._onUpdateSeekRange(n.bufferedPercent),o.playbackRate?J(o.playbackRate):o.playRate&&J(o.playRate),1==o.paused&&1==t._status?(x.debug&&console.log("_getMusicPlayerState force syn"),t._pauseJsapiPlay(!1)):0==o.paused&&2==t._status&&(x.debug&&console.log("_getMusicPlayerState force syn"),t._resumeJsapiPlay(!1)),"idle"===o.status&&(console.log("get idle > end?",+o.currentTime>=+o.duration),x.jsapiGlobalEvent.stop(o,t,+o.currentTime>=+o.duration))):x.jsapiGlobalEvent.stop(o,t,!0),t._o.onMusicPlayerInfo&&t._o.onMusicPlayerInfo(o)},onError:function(e){n.getStatusId=setTimeout((function(){t._getMusicPlayerState()}),n.getStatusTime)}})},D.prototype._analogUpdateTime=function(t){var e=this,i=e.jsApiData;if(i){if(i.updateTimeoutId&&clearTimeout(i.updateTimeoutId),1==e._status||2==e._status){if(1==e._status&&(i.curTime=1*((+new Date-i.starTime)/1e3).toFixed(2)),i.curTime>=i.duration)return e._stopJsapiPlay(!1),!0;e._onTimeupdate(null,i.curTime,t)}return i.updateTimeoutId=setTimeout((function(){e._analogUpdateTime()}),1e3),!1}},D.prototype._jsapi_getMusicPlayerState=function(t){var e=this._o;const i=i=>{if(console.log("getBackgroundAudioState log 1: ".concat(JSON.stringify(i||{}))),/:ok$/.test(i.err_msg)){if(i.paused=void 0!==i.paused?1*i.paused:+("paused"===i.status),i.currentTime?i.currentTime=(1*i.currentTime).toFixed(2):i.currentTime=0,i.buffered){let t=Math.floor(i.buffered/e.duration*100);t=Math.max(t,0),t=Math.min(t,100),i.bufferedPercent=t}else i.bufferedPercent=0;"function"==typeof t.onSuccess&&t.onSuccess(i)}else"function"==typeof t.onError&&t.onError(i)};this.isTingSupportType()&&1*e.isTingOpen==1?c.invoke("getTingAudioState",{sourceType:2},(t=>{t&&t.status&&"idle"===t.status?c.invoke("getTingAudioState",{sourceType:1},(t=>{i(t)})):i(t)})):c.invoke("getBackgroundAudioState",{},(t=>{t.src&&(t.src=V(t.src,"t")),i(t)}))},D.prototype._jsapi_musicPlay=function(t){if(this._h5Audio&&this._destoryH5Audio(),2!=x._playtype){var e=this,i=this._o;this.jsapiLog("jsapi_musicPlay"),c.invoke("musicPlay",{app_id:"a",title:i.title,singer:i.singer,epname:i.epname,coverImgUrl:i.coverImgUrl,dataUrl:i.src,lowbandUrl:i.src,webUrl:i.webUrl},(function(n){x.debug&&console.log("playlog:"+JSON.stringify(n||{})),n.err_msg.indexOf("ok")>=0?(e._trigger("jsapi1Begin2Play"),e._surportType=1,x.surportType=1,e._initJsapiData(),e._onPlay(),void 0!==i.duration&&1*i.duration>0&&e._analogUpdateTime(),e._onUpdateSeekRange(0),"function"==typeof t.onSuccess&&t.onSuccess(n)):"function"==typeof t.onError&&t.onError(n)}))}else"function"==typeof t.onError&&t.onError({})},D.prototype._jsapi_setBackgroundAudioState=function(t={}){this._h5Audio&&this._destoryH5Audio(),console.log("_playtype",x._playtype);let{onSuccess:e,onError:i,needStartMusicUI:n,playAudioId:o,playbackRate:s,startTime:a=0,isDoubleSpeed:r,listBase64:l,playRate:d}=t;if("function"!=typeof e&&(e=()=>{}),"function"!=typeof i&&(i=()=>{}),1*x._playtype>0){var p={err_code:1};return void i(p)}var h=this,m=h._o,g=h._g;let _,f;if(console.log("invoke set setBackgroundAudioState with param",m),this.jsapiLog("jsapi_setBackgroundAudioState"),s?J(s):d&&J(d),m.albumId){h.setPlayAudioId(o),h.setAlbumClientPlayMpAuidoId(""),m.audioList.forEach((t=>{t.audioId===o?(t.stopTime>=0&&t.stopTime<t.duration&&(t.startTime=t.stopTime),t.stopTime>=t.duration&&(t.startTime=0)):t.startTime=0,t.isaac&&(t.src=y.addParam(t.src,"voice_type",1,!0)),t.playbackRate=x.playbackRate}));let{curIdx:t,curAudio:e}=h.getAlbumCurAudio();x.autoplayAudioList=t>-1?m.audioList.slice(t,t+x.autoplayAudioListLen):[],e=e||{},_={albumId:m.albumId,playAudioId:o,audioList:x.autoplayAudioList},f={playSrcId:o,itemList:[{srcId:o,type:m.isAudio?3:1,title:e.title,cover:e.articleCoverCdnUrl1_1,author:window.cgiData.nick_name,duration:e.duration,startTime:e.startTime||0,dataUrl:e.jsapi2Src||e.src,webUrl:e.url,mpInfo:{username:m.userName||"",name:window.cgiData.nick_name,bizUin:window.biz?parseInt(window.atob(window.biz),10):0,audioId:e.songId,webUrl:e.url,albumId:m.albumId}}],playRate:m.isAudio?x.playbackRate:1,openPlayerUI:1*n>0,scene:1102}}else if(m.listenId&&(m.isClMusic||m.isClAudio))f=m.isClMusic?{playSrcId:g.jsapiSrcId,itemList:[{type:1,title:m.title,author:m.singer,srcId:g.jsapiSrcId,cover:m.coverImgUrl,listenId:m.listenId,duration:m.duration}],playRate:x.playbackRate,openPlayerUI:1*n>0,categoryPlaylistInfoBuffer:m.isAudio?"":x.mmlistenPlaylistInfoBuffer||""}:{playSrcId:g.jsapiSrcId,itemList:[{srcId:g.jsapiSrcId,title:m.title,finderInfo:m.finderInfo,author:m.author,cover:m.cover,listenId:m.listenId,duration:m.duration,type:4}],playRate:x.playbackRate,openPlayerUI:1*n>0,categoryDeleteAfterListen:!!m.isAudio&&!!l,categoryPlaylistInfoBuffer:m.isAudio?l||"":x.mmlistenPlaylistInfoBuffer||""},(u.isIOS&&u.compareHexVersion("18002C00")||u.isAndroid&&u.compareHexVersion("28002C00"))&&(f.scene=x.tingScene);else{_={protocol:m.protocal||"",src:function(){const t=window.clientversion;return t&&(t>"18000e00"&&t<="18000e2d"||t>"18000f00"&&t<="18000f24")?"".concat(m.jsapi2Src||m.src,"&t=").concat(Date.now()):m.jsapi2Src||m.src}(),lowbandUrl:m.jsapi2Src||m.src,title:m.title,epname:m.epname,singer:m.singer,srcId:g.jsapiSrcId,coverImgUrl:m.coverImgUrl,webUrl:m.webUrl,musicbar_url:m.musicbar_url||"",needStartMusicUI:1*n>0?1:0,playbackRate:m.isAudio?x.playbackRate:1,startTime:a};let t="";t=m.isAudio?m.cover?m.cover:m.articleCoverCdnUrl1_1?m.articleCoverCdnUrl1_1:m.coverImgUrl:m.coverImgUrl,f={playSrcId:g.jsapiSrcId,itemList:[{srcId:g.jsapiSrcId,listenId:m.listenId||"",type:m.isAudio?3:1,title:m.title.htmlDecode(),cover:t,author:m.isAudio?window.nickname||window.cgiData.nick_name:m.singer,duration:m.duration,startTime:0,dataUrl:m.jsapi2Src||m.src,webUrl:y.decodeUrl(window.msg_link),musicInfo:{appId:"wx5aa333606550dfd5",webUrl:m.detailUrl,mid:m.mid},mpInfo:{username:m.userName||"",name:window.nickname||window.cgiData.nick_name,bizUin:window.biz?parseInt(window.atob(window.biz),10):0,audioId:m.songId,webUrl:y.decodeUrl(window.msg_link)}}],listenId:m.listenId||"",playRate:m.isAudio?x.playbackRate:1,openPlayerUI:1*n>0,categoryPlaylistInfoBuffer:m.isAudio?l||"":x.mmlistenPlaylistInfoBuffer||"",categoryDeleteAfterListen:!!m.isAudio&&!!l},(u.isIOS&&u.compareHexVersion("18002C00")||u.isAndroid&&u.compareHexVersion("28002C00"))&&(f.scene=x.tingScene)}const v=t=>{if(console.log("setBackgroundAudioState log: ".concat(JSON.stringify(t||{}))),t.err_msg.indexOf("ok")>=0){const t=1*h._status;!n||1!==t&&2!==t&&4!==t?(e("waiting"),g.stateChangeCallback.play=function(t,n){0==t?e("play"):0!==t&&i({err_code:2,err_msg:n||""})},h.isTingSupportType()&&1*m.isTingOpen==1&&(g.stateChangeCallback.play(0),g.stateChangeCallback.play=null)):e()}else(t=t||{}).err_code=1,i(t)};console.log("setBackgroundAudioState params: setOpt",_),console.log("setTingAudioState params: tingOpt",f),console.log("_t.isTingSupportType()",h.isTingSupportType()),h.isTingSupportType()&&1*m.isTingOpen==1?c.invoke("setTingAudioState",f,(t=>{v(t)})):c.invoke("setBackgroundAudioState",_,(t=>{v(t)}))},D.prototype._jsapi_operateBackgroundAudio=function(t){var e=this,i=e._o,n=e._g,o=t.type,s=t.playRate,a=1*t.position||0;this.jsapiLog("jsapi_operateBackgroundAudio;param:"+JSON.stringify(t||{}));const r={operationType:o,currentTime:a},l={operationType:r.operationType,srcId:i.albumId?i.playAudioId:n.jsapiSrcId,listenId:i.listenId||"",seektime:a,playRate:s};"listenLater"===o&&(l.item=function(){if(i.albumId){const e=t.audio||{};return{srcId:i.playAudioId,type:i.isAudio?3:1,title:e.title,cover:e.articleCoverCdnUrl1_1,author:window.cgiData.nick_name,duration:e.duration,startTime:0,dataUrl:e.jsapi2Src||e.src,webUrl:e.url,mpInfo:{username:i.userName||"",name:window.cgiData.nick_name,bizUin:window.biz?parseInt(window.atob(window.biz),10):0,audioId:e.songId,webUrl:e.url,albumId:i.albumId}}}return i.listenId&&(i.isClMusic||i.isClAudio)?{srcId:n.jsapiSrcId,title:i.title,finderInfo:i.finderInfo,author:i.author,cover:i.cover,listenId:i.listenId,duration:i.duration,startTime:0,type:4}:{srcId:n.jsapiSrcId,type:i.isAudio?3:1,title:i.title,cover:i.isAudio&&i.articleCoverCdnUrl1_1?i.articleCoverCdnUrl1_1:i.coverImgUrl,author:i.isAudio?window.nickname||window.cgiData.nick_name:i.singer,duration:i.duration,startTime:0,dataUrl:i.jsapi2Src||i.src,webUrl:window.msg_link,musicInfo:{appId:"wx5aa333606550dfd5",webUrl:i.detailUrl,mid:i.mid},mpInfo:{username:i.userName||"",name:window.nickname||window.cgiData.nick_name,bizUin:window.biz?parseInt(window.atob(window.biz),10):0,audioId:i.songId,webUrl:window.msg_link}}}());const d=i=>{console.log("operateBackgroundAudio ".concat(o,", position: ").concat(a,", log: ").concat(JSON.stringify(i||{}))),e._analogUpdateTime(),-1===i.err_msg.indexOf("ok")?("function"==typeof t.onError&&t.onError(i),"seek"===o?(n.stateChangeCallback.seeking=null,n.stateChangeCallback.seeked=null):n.stateChangeCallback[o]=null):"function"==typeof t.onSuccess&&t.onSuccess(i)};console.log("operate tingParams",l),e.isTingSupportType()&&1*i.isTingOpen==1?c.invoke("operateTingAudio",l,(t=>{console.log("operateTingAudio log: params: ".concat(JSON.stringify(l||{}),", res: ").concat(JSON.stringify(t||{}))),d(t)})):c.invoke("operateBackgroundAudio",r,(t=>{d(t)})),"seek"==o?(n.stateChangeCallback.seeking=function(e,i){0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeking",a):0!=e&&"function"==typeof t.onError&&t.onError({err_msg:i||""})},n.stateChangeCallback.seeked=function(e,i){0==e&&"function"==typeof t.onSuccess?t.onSuccess("seeked",a):0!=e&&"function"==typeof t.onError&&t.onError({err_msg:i||""})}):n.stateChangeCallback[o]=function(e,i){0==e&&"function"==typeof t.onSuccess?t.onSuccess():0!=e&&"function"==typeof t.onError&&t.onError({err_msg:i||""})}},D.prototype._jsapiPlay=function(t={}){const e=this,i=this._o,n=this._g;console.log("supporttype",x.surportType);let{onError:o,onSuccess:s,needStartMusicUI:a,playAudioId:r,listBase64:l,playbackRate:d,startTime:u,isDoubleSpeed:c}=t;"function"!=typeof o&&(o=()=>{(window.weui||window).alert("播放出错，请稍后再试")}),"function"!=typeof s&&(s=()=>{}),1==x.surportType?a?o():this._jsapi_musicPlay({onError:function(t){e._h5Play({playAudioId:r})}}):this._jsapi_setBackgroundAudioState({playAudioId:r,needStartMusicUI:a,playbackRate:d,listBase64:l,startTime:u||n.hasPlayedDuration,isDoubleSpeed:c,onSuccess:function(t){console.log("----- ".concat(t," -----")),"waiting"===t?(e._trigger("jsapi2Begin2Play",t),e._initJsapiData(),e._surportType=3,x.surportType=3,e._onLoading()):"play"===t&&(e._initJsapiData(),e._onPlay(null,t),e._analogUpdateTime(!!c),e._getMusicPlayerState(),e._trigger("jsapi2PlaySuccess")),"function"==typeof s&&(s(),s=null,o=null)},onError:function(t){1*i.isTingOpen!=1&&(t&&1==t.err_code&&!a?e._jsapi_musicPlay({onError:function(t){e._h5Play({playAudioId:r})}}):(a||e._h5Play({playAudioId:r}),e._trigger("jsapi2Begin2PlayErr"))),"function"==typeof o&&(o(),o=null,s=null)}})},D.prototype._getJsapiDownloadSec=function(){this._getMusicPlayerState();var t=Math.floor(this._o.duration*this.jsApiData.bufferedPercent/100);return x.debug&&console.log("downloadSec:"+t),t},D.prototype._jsapiSeek=function(t){var e=this,i=this._g;this._o;var n,o,s=this.jsApiData,a=parseInt(t,10);this._o.duration&&a>=this._o.duration&&(a=this._o.duration-1),s.getStatusId&&clearTimeout(s.getStatusId),s.updateTimeoutId&&clearTimeout(s.updateTimeoutId),s.seekWaitId&&clearTimeout(s.seekWaitId),s.seeking=!0;x.seekingPosition=a,s.starTime=+new Date-1e3*x.seekingPosition,console.log("begin to seek to",a),this._jsapi_operateBackgroundAudio({type:"seek",position:a,onError:function(){e._trigger("seekErr"),x.debug&&console.log("seek callback fail"),s.seeking=!1,e._analogUpdateTime(),e._getMusicPlayerState()},onSuccess:function(t,r){console.log("jsapi seek res is ",t),"seeking"==t?(x.debug&&console.log("seeking callback success"),s.seeking=!0,i.stateChangeCallback.play=function(){x.debug&&console.log("seeked to play"),n&&(clearTimeout(n),n=null),s.seeking=!1,e._onPlay(),s.starTime=+new Date-1e3*x.seekingPosition,e._analogUpdateTime(),e._getMusicPlayerState()},o=setTimeout((function(){o=null,e._trigger("seekNeed2Load")}),100)):"seeked"==t&&(2!=e._status&&4!=e._status||(n=setTimeout((function(){x.debug&&console.log("setTimeout to play"),i.stateChangeCallback.play=null,s.seeking=!1,s.curTime=a,e._resumeJsapiPlay(!0)}),1e3)),o&&(clearTimeout(o),o=null,e._trigger("seekNotNeed2Load")))}}),e._getMusicPlayerState()},D.prototype._resumeJsapiPlay=function(t,e,i={}){var n=this;function o(t,e={}){var i=n.jsApiData;i.starTime=+new Date-1e3*i.curTime,n._onPlay(null,e),n._analogUpdateTime(),n._getMusicPlayerState(),"function"==typeof t&&t()}1==this._surportType?this._jsapiPlay():3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({type:1*n._o.isTingOpen==1&&u.isIOS?"resume":"play",onError:function(){n._stopJsapiPlay(!1,(function(){n.play()}))},onSuccess:function(){o(e,i)}}):o(e,i))},D.prototype._pauseJsapiPlay=function(t,e,i,n,o={}){var s=this;if(2==s._status)return a(e,o),void("function"==typeof i&&i());function a(t,e={}){var i=s.jsApiData;s._analogUpdateTime(),s._getMusicPlayerState(),i&&(i.updateTimeoutId=null),!0===t&&i&&i.getStatusId&&clearTimeout(i.getStatusId),1==s._status&&s._onPause(null,e)}1==this._surportType?this._stopJsapiPlay(t,i):3==this._surportType&&(t?this._jsapi_operateBackgroundAudio({type:"pause",onSuccess:function(){a(e,o),"function"==typeof i&&i()},onError:function(){s._stopJsapiPlay(!0,i)}}):(a(e,o),"function"==typeof i&&i()))},D.prototype._stopJsapiPlay=function(t,e,i,n){var o=this;function s(t,e){o._onTimeupdate(null,0),o._onUpdateSeekRange(0),o._onEnd(null,e,n),o._initJsapiData(),"function"==typeof t&&t()}o.jsApiData,t?1==o._surportType?function(t){c.invoke("musicPlay",{app_id:"a",title:"微信公众平台",singer:"微信公众平台",epname:"微信公众平台",coverImgUrl:"http://res.wx.qq.com/mpres/htmledition/images/favicon.ico",dataUrl:x.ev,lowbandUrl:x.ev,webUrl:"http://mp.weixin.qq.com/s?"},(function(e){"function"==typeof t&&t(e)}))}((function(t){s(e)})):o._jsapi_operateBackgroundAudio({type:"stop",onSuccess:function(){s(e,i)},onError:function(){s(e,i)}}):s(e,i)},D.prototype._getH5DownloadSec=function(){var t=Math.floor(this._o.duration*this._getH5DownloadDuration()/100);return x.debug&&console.log("h5 downloadSec:"+t),t},D.prototype._getH5DownloadDuration=function(){if(!this._h5Audio)return 0;if(this._h5Data.downloadDuration>=100)return 100;var t=this._h5Audio.buffered,e=t.end(t.length-1);return this._o.albumId&&this._o.playAudioId?this._h5Data.downloadDuration=parseInt(e/this.getPlayAudioOpt().duration*100,10):this._h5Data.downloadDuration=parseInt(e/this._o.duration*100,10),this._h5Data.downloadDuration},D.prototype._h5Play=function(t){0!==x.surportType&&(this.jsapiLog("h5Play"),this.setPlayAudioId(t.playAudioId),this._h5Audio?(this._h5Audio.ended||this._h5Audio.paused)&&(this._trigger("h5Begin2Play"),this._initH5Data(),this._onLoading(),this._H5bindEvent(!0),this._h5Audio.currentTime=0):this._createAutoAndPlay())},D.prototype._h5Resume=function(t){this._h5Audio&&(this._h5Audio.playbackRate=x.playbackRate,this._h5Audio.play(),"function"==typeof t&&t())},D.prototype._h5Stop=function(){this._h5Audio&&(this._onUpdateSeekRange(0),this._onEnd(),this._H5bindEvent(!1),this._h5Audio.pause(),this._h5Audio.currentTime=0,this._initH5Data())},D.prototype._h5Seek=function(t){if(this._h5Audio){this._h5Data;var e=parseInt(t,10);e=Math.max(e,0),e=Math.min(e,this._o.duration),x.debug&&console.log("h5 seek position:"+e),this._h5Audio.currentTime=e}},D.prototype._h5SetVolume=function(t){this._h5Audio&&t&&(t=Math.min(1,t),t=Math.max(0,t),this._h5Audio.volume=t)},D.prototype._startCountTime=function(){1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio&&this._h5Data&&null===this._h5Data.lastPlaytime&&(this._h5Data.lastPlaytime=this._h5Audio.currentTime):null===this.jsApiData.lastPlaytime&&(this.jsApiData.lastPlaytime=this.jsApiData.curTime)},D.prototype._endCountTime=function(){if(1!=this._surportType&&3!=this._surportType||!this.jsApiData){if(this._h5Audio&&this._h5Data){var t=this._h5Audio,e=this._h5Data;t.currentTime>0&&t.currentTime>e.lastPlaytime&&null!==e.lastPlaytime&&(this._g.totalPlayTime+=t.currentTime-e.lastPlaytime),e.lastPlaytime=null}}else{var i=this.jsApiData;i.curTime>0&&i.curTime>i.lastPlaytime&&null!==i.lastPlaytime&&(this._g.totalPlayTime+=i.curTime-i.lastPlaytime),i.lastPlaytime=null}},D.prototype._delMutexPlayers=function(){var t=this._o,e=this._g.mutexKey,i=x.mutexPlayers[e];if(i){for(var n=0,o=i.length;n<o;n++)if(i[n]===this){i.splice(n,1);break}if(0==i.length)try{delete x.mutexPlayers[e]}catch(a){}}if(t.jsapi2Src&&x.mutexPlayers2[t.jsapi2Src]){var s=x.mutexPlayers2[t.jsapi2Src];for(n=0,o=s.length;n<o;n++)if(s[n]===this){s.splice(n,1);break}if(0==s.length)try{delete x.mutexPlayers2[t.jsapi2Src]}catch(a){}}},D.prototype.resetPlayTotalTime=function(){this._g.totalPlayTime=0},D.prototype.getPlayTotalTime=function(){return this._endCountTime(),this._g.totalPlayTime},D.prototype.surportSeekRange=function(){return 1!=x._playtype&&(2==this._surportType||3==this._surportType)},D.prototype.setSrc=function(t){-1==t.indexOf("?")&&(t+="?"),t+=O(this._o.mid)+"_"+this._o.wxIndex,this._o.src=t,this._delMutexPlayers(),this._g.mutexKey=O(this._o.mid)+"_"+this._o.wxIndex,x.mutexPlayers[this._g.mutexKey]?x.mutexPlayers[this._g.mutexKey].push(this):x.mutexPlayers[this._g.mutexKey]=[this]},D.prototype.getSrc=function(){return this._o.src||""},D.prototype.setDuration=function(t){this._o.duration=t||0},D.prototype.getSurportType=function(){return this._surportType||0},D.prototype.getPlayStatus=function(){return this._status},D.prototype.getCurTime=function(){return 1!=this._surportType&&3!=this._surportType||!this.jsApiData?this._h5Audio?this._h5Audio.currentTime:0:this.jsApiData.curTime||0},D.prototype.getDuration=function(){return this._o.duration||void 0},D.prototype.pause=function(t,e,i,n={}){!0===i||this._o.allowPause?1==this._surportType||3==this._surportType?this._pauseJsapiPlay(!1!==t,!1,(function(){"function"==typeof e&&e()}),(function(){"function"==typeof e&&e()}),n):2==this._surportType&&this._h5Audio&&"function"==typeof this._h5Audio.pause&&(this._h5Audio.pause(),"function"==typeof e&&e()):this.stop(t,e)},D.prototype.stop=function(t,e,i,n){1!=this._surportType&&3!=this._surportType?(2==this._surportType&&this._h5Audio&&this._h5Stop(),"function"==typeof e&&e()):this._stopJsapiPlay(!1!==t,e,i,n)},D.prototype.destory=function(){this.stop(),this._h5Audio&&(document.body.removeChild(this._h5Audio),this._h5Audio=null),this._delMutexPlayers()},D.prototype.resume=function(t,e,i,n={}){(!0===i||2==this._status&&this._o.allowPause)&&(2==this._surportType&&this._h5Audio?this._h5Resume(e):x.inWechat&&this._resumeJsapiPlay(!1!==t,e,n))},D.prototype.onload=function(){this._onLoading()},D.prototype.jsapiLog=function(t,e){try{var i=this._o,n={type:i.type,src:i.src,mid:i.mid,protocal:i.protocal,webUrl:i.webUrl,musicbar_url:i.musicbar_url};!function(t,e){e=e||"info";var i="[musicplay]"+t+"[location:"+location.href+"]";_.log(i,e)}("["+JSON.stringify(n)+"]"+t,e)}catch(o){}},D.prototype.openStartMusicUI=function(t={}){let{onError:e,onSuccess:i,listBase64:n}=t;"function"!=typeof e&&(e=()=>{(window.weui||window).alert("播放出错，请稍后再试")}),"function"!=typeof i&&(i=()=>{}),u.isWechat&&(u.isIOS||u.isAndroid)&&u.gtVersion("7.0.5",!0)?this._jsapiPlay({listBase64:n,needStartMusicUI:!0,onError:()=>{e()},onSuccess:()=>{i()}}):e()},D.prototype.play=function(t={}){var e=this,i=this._g;const{playAudioId:n,listBase64:o,onSuccess:s}=t;if(e._o.src||e._o.albumId||e._o.listenId){if(2==e._status&&e._o.allowPause){if(e._o.src)return void e.resume(void 0,s);if(e._o.listenId)return void e.resume(void 0,s);if(e._o.playAudioId&&e._o.playAudioId===n)return void e.resume(void 0,s)}i.playTimeoutId&&clearTimeout(i.playTimeoutId),i.hasCheckPlay?x.inWechat?this._jsapiPlay({playAudioId:n,listBase64:o,onSuccess:()=>"function"==typeof s&&s()}):0!=x.surportType&&this._h5Play({playAudioId:n}):i.playTimeoutId=setTimeout((function(){e.play()}),1e3)}},D.prototype.seek=function(t){var e=this;if(this._g,1==e._status||2==e._status||4==e._status)return 3==this._surportType?(this._endCountTime(),void this._jsapiSeek(t)):2==this._surportType&&this._h5Audio?(this._endCountTime(),void this._h5Seek(t)):void 0},D.prototype.getBackgroundAudioState=function(t={}){const e=e=>{console.log("getBackgroundAudioState log 2: ".concat(JSON.stringify(e||{}))),/:ok$/.test(e.err_msg)?(e.paused=void 0!==e.paused?1*e.paused:+("paused"===e.status),"function"==typeof t.success&&t.success(e)):"function"==typeof t.error&&t.error(e)};this.isTingSupportType()&&1*this._o.isTingOpen==1?c.invoke("getTingAudioState",{sourceType:2},(t=>{t&&t.status&&"idle"===t.status?c.invoke("getTingAudioState",{sourceType:1},(t=>{e(t)})):e(t)})):c.invoke("getBackgroundAudioState",{},(t=>{t.src&&(t.src=V(t.src,"t")),e(t)}))},D.prototype.setOption=function(t){this._extend(t),t.duration&&this.jsApiData&&(this.jsApiData.duration=t.duration)},D.prototype.reverseList=function(t){this._o.audioList.reverse(),this.update(t)},D.prototype.update=function(t){if(1!==this._status&&4!==this._status)return;const e=this,i=e._o,{curIdx:n,curAudio:o}=e.getAlbumCurAudio();let s=i.playAudioId,a={};this._o.audioList.forEach((e=>{t&&s&&e.audioId===s?e.startTime=t:e.startTime=0})),n>-1?(x.autoplayAudioList=this._o.audioList.slice(n,n+x.autoplayAudioListLen),a=o.tingExtInfo):x.autoplayAudioList=[];const r={albumId:this._o.albumId+"",playAudioId:this._o.playAudioId||this.jsApiData.audioId,audioList:x.autoplayAudioList};e.isTingSupportType()&&1*i.isTingOpen==1?c.invoke("setTingAudioState",Object.assign({},r,{albumName:i.albumInfo.albumName,albumUrl:i.albumInfo.albumUrl,username:i.userName,extInfo:JSON.stringify(a),playbackRate:i.isAudio?x.playbackRate:1}),(t=>{})):c.invoke("setBackgroundAudioState",r,(t=>{}))},D.prototype.getPlayAudioOpt=function(t){if(!(t=t||this._o.playAudioId))return null;for(var e=0;e<this._o.audioList.length;e++)if(this._o.audioList[e].audioId===t)return this._o.audioList[e]},D.prototype.getPlayAudioId=function(){return this._o.playAudioId},D.prototype.setPlayAudioId=function(t){this._o.playAudioId=t},D.prototype.setListenId=function(t){this._o.listenId=t},D.prototype.getAlbumClientPlayMpAuidoId=function(){return this._o.albumClientPlayMpAuidoId},D.prototype.setAlbumClientPlayMpAuidoId=function(t){this._o.albumClientPlayMpAuidoId=t},D.prototype.doubleSpeed=function({succCallback:t,pcCallback:e}){const i=this,n=i._o.speedList;if(x.inWechat)i.getBackgroundAudioState({success(e){let{playbackRate:o,currentTime:s,playRate:a}=e;o=o||a;const r=n.findIndex((t=>t===+o)),l=n[(r+1)%n.length];i.isTingSupportType()&&1*i._o.isTingOpen==1?(J(l),i._jsapi_operateBackgroundAudio({type:"playRate",playRate:l,onSuccess(){t()},onError(){}})):i._jsapiPlay({isDoubleSpeed:!0,playbackRate:l,startTime:+s,onSuccess(){x.isAndroid&&i.seek(+s),t()}})}});else{const o=i._h5Audio.playbackRate,s=n.findIndex((t=>t===+o)),a=n[(s+1)%n.length];J(a),i._h5Audio.playbackRate=a,i._h5Audio.play(),e(),t()}},D.prototype.updatePlayedDuration=function(t){this._g.hasPlayedDuration=void 0===t?this.getCurTime():t},D.prototype.isTingSupportType=function(){const t=this._o.type;return 0===t||1===t||2===t||3===t||4===t||10===t||11===t},D.prototype.getCurVol=function(){return this._h5Audio?this._h5Audio.volume:0},D.prototype.getAlbumCurAudio=function(){const t=this,e=t._o;if(e.albumId&&e.audioList){const i=e.audioList.findIndex((e=>e.audioId===t.getPlayAudioId()));if(i>-1)return{curIdx:i,curAudio:e.audioList[i]}}return{curIdx:-1,curAudio:null}},D.prototype.listenLater=function({starVersion:t=!1,audio:e=null,errCallback:i=(()=>{}),succCallback:n=(()=>{}),notSupportCallback:o=(()=>{})}){const s=this;s._o.useNewListenLaterCgi?g({url:"/mp/listenplayer?action=add_to_playlist".concat(t?"&playlist_type=2":"","&__biz=").concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",dataType:"json",async:!0,data:{data:JSON.stringify({listen_id:s._o.listenId})},success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof n&&n():"function"==typeof i&&i()},error:()=>{"function"==typeof i&&i()}}):s.isTingSupportType()&&1*s._o.isTingOpen==1?s._jsapi_operateBackgroundAudio({audio:e,type:"listenLater",onError:i,onSuccess:n}):o()},D.prototype.cancelListenLater=function({errCallback:t=(()=>{}),succCallback:e=(()=>{})}){const i=this;i._o.listenId?g({url:"/mp/listenplayer?action=rm_from_playlist&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",dataType:"json",async:!0,data:{data:JSON.stringify({listen_id:i._o.listenId})},success:i=>{i&&i.base_resp&&0===i.base_resp.ret?"function"==typeof e&&e():"function"==typeof t&&t()},error:()=>{"function"==typeof t&&t()}}):"function"==typeof t&&t()};const z={init:function(t,e){return new D(t)},getQuery:W,getSurportType:function(){return x.surportType},getPlaybackRate:function(){return x.playbackRate},triggerUnloadPlaying:function(){for(var t in x.mutexPlayers)if(x.mutexPlayers.hasOwnProperty(t))for(var e=0,i=x.mutexPlayers[t].length;e<i;e++){var n=x.mutexPlayers[t][e];if(n&&(1==n._status&&(1==n._surportType||3==n._surportType))){n._trigger("unloadPlaying");break}}},isAndroid:x.isAndroid},X={m_pv:"28306_0",m_wx_pv:"28306_1",m_h5_pv:"28306_2",m_unload_wx_pv:"28306_3",v_pv:"28306_4",v_wx_pv:"28306_5",v_h5_pv:"28306_6",v_unload_wx_pv:"28306_7",force_h5:"28306_30",m_h5_err_total:"28306_31",m_h5_err_1:"28306_32",m_h5_err_2:"28306_33",m_h5_err_3:"28306_34",m_h5_err_4:"28306_35",m_h5_err_5:"28306_36",v_h5_err_total:"28306_37",v_h5_err_1:"28306_38",v_h5_err_2:"28306_39",v_h5_err_3:"28306_40",v_h5_err_4:"28306_41",v_h5_err_5:"28306_42",m_wx_pv_2:"28306_43",v_wx_pv_2:"28306_44",m_wx_pv_1:"28306_50",v_wx_pv_1:"28306_55",m_wx_err_1:"28306_58",m_wx_err_2:"28306_59",v_wx_err_1:"28306_60",v_wx_err_2:"28306_61",v_stoped_android:"59288_1",v_stoped_ios:"59288_0",v_paused_android:"59288_7",v_paused_ios:"59288_6",m_stoped_android:"59288_3",m_stoped_ios:"59288_2",m_paused_android:"59288_9",m_paused_ios:"59288_8",k_stoped_android:"59288_5",k_stoped_ios:"59288_4",k_paused_android:"59288_11",k_paused_ios:"59288_10",k_pv:"28306_66",k_wx_pv:"28306_67",k_h5_pv:"28306_69",k_unload_wx_pv:"28306_71",k_h5_err_total:"28306_72",k_h5_err_1:"28306_74",k_h5_err_2:"28306_75",k_h5_err_3:"28306_76",k_h5_err_4:"28306_77",k_h5_err_5:"28306_78",k_wx_pv_1:"28306_79",k_wx_pv_2:"28306_81",k_wx_err_1:"28306_83",k_wx_err_2:"28306_85",aac_pv:"28306_104",ios_aac_err_1:"28306_106",ios_aac_err_2:"28306_108",android_aac_err_1:"28306_110",android_aac_err_2:"28306_112",v_seek_err:"28306_114",android_aac_err_3:"28306_116",ios_aac_err_3:"28306_118",QMClient_pv:"62866_0",QMClient_play:"62866_1",QMClient_js_num:"62866_2",QMClient_js_suc:"62866_3",QMClient_js_err:"62866_5",QMClient_js_timeout:"62866_7",QMClient_js_network:"62866_9"},q={debug:location.href.indexOf("_qqclient=1")>0,config:{QMClient:{func:"Player",playerObj:null,jsLink:"https://imgcache.qq.com/music/h5/player/player.js?max_age=604800&v=1",jsLoadState:-1}},inQMClient:!1,initPlayerQueue:[]};function G(){for(let t=0,e=q.initPlayerQueue.length;t<e;t++)"function"==typeof q.initPlayerQueue[t]&&q.initPlayerQueue[t]();q.initPlayerQueue=[]}function Y(t,e){if(this.opt=t,this.opt2=e,this._g={_blockPlugin:{},playType:"-1"},"QMClient"==e.type&&q.inQMClient){let t=q.config[e.type];t.playerObj||(q.config[e.type].playerObj=new window[t.func]),this._g.playType=e.type,this.player=t.playerObj,this._initPlugins(),this._bindQMEvent()}}q.QMClientEvInit=function(){if(window.navigator.userAgent.indexOf("QQMusic/")>0||q.debug?q.inQMClient=!0:q.inQMClient=!1,!q.inQMClient||!window.msg_cdn_url||!window.msg_title)return;let t=window.location.href,e=z.getQuery("scene",t);e&&(t=t.replace("&scene="+e,"").replace("?scene="+e,"")),t=t.replace(/#rd$/,"").replace(/#wechat_redirect$/,""),-1==t.indexOf("?")&&(t+="?"),t+="&scene=112#wechat_redirect";let i=(window.msg_title||"").html(!1),n=(window.msg_desc||"").html(!1);var o;o=function(){M.client.invoke("ui","setActionBtn",{type:"icon",content:"share"},(function(){M.client.invoke("other","callShareWeb",{imgUrl:window.msg_cdn_url,link:t,title:i,desc:n})}))},window.WebViewJavascriptBridge?o():document.addEventListener("WebViewJavascriptBridgeReady",o)},function(){for(let t in q.config)"function"==typeof q[t+"EvInit"]&&q[t+"EvInit"]()}(),Y.prototype={_initPlugins:function(){this.opt.plugins||(this.opt.plugins=[]);let t=this.opt.plugins;for(let e=0,i=t.length;e<i;++e){let i=t[e];i.setPlayer(this),i.init&&i.init()}},_trigger:function(t,e){let i=this.opt,n=this._g,o=i.plugins,s=n._blockPlugin[t]||n._blockPlugin.all,a=0;if(s&&"function"==typeof s.recv&&(a|=s.recv(t,e),1&a))return!1;for(let r=0,l=o.length;r<l&&(a|=o[r].recv(t,e),!(2&a));++r);if(!(4&a)){let i=this["__"+t+"Handler"];i&&i.call(this,e)}8&a||this.__triggerOutside(t,e)},__triggerOutside:function(){let t=arguments,e=t[0];if(e){e=e.substr(0,1).toUpperCase()+e.substr(1);let i=this.opt["on"+e];"function"==typeof i&&i.apply(this,t)}},_setBlockPlugin:function(t,e){this._g._blockPlugin[t]=e},_bindQMEvent:function(){let t=this;this.player.on("play",(function(e){e&&e.song&&e.song.mid==t.opt.mid?(t._trigger("statusChange",1),t._trigger("QMClientPlay")):t._trigger("statusChange",3)})),this.player.on("pause",(function(e){e&&e.song&&e.song.mid==t.opt.mid&&t._trigger("statusChange",2)})),this.player.on("stop",(function(e){e&&e.song&&e.song.mid==t.opt.mid&&t._trigger("statusChange",3)}))},play:function(){"QMClient"==this._g.playType&&this.player.play(this.opt.mid)},pause:function(){this.player.pause()},stop:function(){this.player.stop()},getDuration:function(){return this.opt.duration?this.opt.duration:"QMClient"==this._g.playType&&this.player.duration||0},getCurTime:function(){return"QMClient"==this._g.playType&&this.player.currentTime||0},surportSeekRange:function(){return!1},getSrc:function(){return""},destory:function(){},seek:function(){},setDuration:function(){},setSrc:function(){}};const Q={create:function(t,e){0!=t.type&&1!=t.type||!q.inQMClient?"function"==typeof e.callback&&e.callback(new z.init(t)):(q.initPlayerQueue.push(function(t,e,i){let n=q.config[t].func;return o=t,s=n,a=e,r=i,function(){"function"==typeof window[s]?"function"==typeof r.callback&&r.callback(new Y(a,{type:o})):"function"==typeof r.callback&&r.callback(new z.init(a))};var o,s,a,r}("QMClient",t,e)),function(t){let e=q.config[t];if(1==e.jsLoadState)return;if(2==e.jsLoadState||3==e.jsLoadState)return void G();e.jsLoadState=1;let i=X[t+"_js_num"];i&&(i=i.split("_"),f.setSum(i[0],i[1],1));S({url:e.jsLink,timeout:1e4,type:"JS",callback:function(){e.jsLoadState,G();let i=X[t+"_js_suc"];i&&(i=i.split("_"),f.setSum(i[0],i[1],1))},onerror:function(i){e.jsLoadState=3,G();let n=X[t+"_js_err"],o=X[t+"_js_timeout"],s=X[t+"_js_network"];if(n&&o&&s)switch(n=n.split("_"),o=o.split("_"),s=s.split("_"),f.setSum(n[0],n[1],1),1*i){case 400:f.setSum(s[0],s[1],1);break;case 500:f.setSum(o[0],o[1],1)}}})}("QMClient"))},inQMClient:q.inQMClient},K={reportRespData:(t={})=>{const e=[""];e.push(1*t.type==1?1:2),e.push(t.songid||""),e.push(t.musicid||""),e.push(t.jumpurlkey||""),e.push(""),e.push(t.kugouParams||"");const i=encodeURIComponent(t.responseData||""),n=2e3,o=parseInt(i.length/n,10);for(let s=0;s<=o;s++){const t=i.substr(s*n,n);t&&e.push(t)}g({url:"/mp/webcommreport?action=report",type:"POST",data:{logid:18027,buffer:e.join(",")}})}},Z={imgroot:"https://imgcache.qq.com/music/photo/mid_album_90",imgroot2:"https://y.gtimg.cn/music/photo_new/T002R90x90M000#mid#.jpg",reportId:"28306",musicIcon:window.icon_qqmusic_source||"",cache:{},submiting:{}};function tt(t){let e=Math.max(t.time,0);if(e=Math.min(e,6e4),t.time>=0&&t.time<200?f.setSum(Z.reportId,24,1):t.time>=200&&t.time<500?f.setSum(Z.reportId,25,1):t.time>=500&&t.time<1e3?f.setSum(Z.reportId,26,1):t.time>=1e3&&t.time<2e3?f.setSum(Z.reportId,27,1):t.time>=2e3&&t.time<1e4?f.setSum(Z.reportId,28,1):t.time>=1e4&&f.setSum(Z.reportId,29,1),f.setAvg(Z.reportId,23,e),"error"==t.type){switch(1*t.code){case 1:f.setSum(Z.reportId,9,1);break;case 2:f.setSum(Z.reportId,10,1);break;case 3:f.setSum(Z.reportId,11,1);break;case 4:f.setSum(Z.reportId,12,1)}f.setSum(Z.reportId,19,1)}else if("success"==t.type){switch(1*t.code){case 1:f.setSum(Z.reportId,8,1);break;case 0:f.setSum(Z.reportId,17,1);break;case 2:f.setSum(Z.reportId,13,1);break;case 3:f.setSum(Z.reportId,14,1);break;case 4:f.setSum(Z.reportId,15,1);break;case 5:f.setSum(Z.reportId,16,1);break;case 6:f.setSum(Z.reportId,47,1);break;case 7:f.setSum(Z.reportId,120,1);break;case 8:f.setSum(Z.reportId,121,1)}f.setSum(Z.reportId,20,1)}}const et={initData:function(t,e){if(/^http(s)?:\/\//i.test(t.albumurl)){let e=[/^http(s)?:\/\/imgcache\.qq\.com([\/?].*)*$/i,/^http(s)?:\/\/y\.gtimg\.cn([\/?].*)*$/i],i=!1;for(let n,o=0;n=e[o++];)if(n.test(t.albumurl)){i=!0;break}i||(t.albumurl="")}else{let e=t.albumurl.split("/");try{e=e[e.length-1],e=e.split(".")[0]}catch(i){e=""}t.albumurl=e?Z.imgroot2.replace("#mid#",e):Z.imgroot+t.albumurl}return t.albumurl=t.albumurl.replace("mid_album_68","mid_album_90").replace("68x68","500x500"),t.musicIcon=Z.musicIcon,1*e.scene==0?t.type=0:1*e.scene==1?t.type=1:t.type=8,Q.inQMClient?(t.allowPause=!0,t.detailUrl="",t.pauseCss="qqmusic_playing_pause",t.webUrl=t.detailUrl):(t.allowPause=!1,t.pauseCss="",t.detailUrl=["http://i.y.qq.com/v8/playsong.html?referFrom=music.qq.com&songid=",t.musicid,"&songmid=",t.media_id,"&ADTAG=weixin_gzh#wechat_redirect"].join(""),t.webUrl=window.msg_link),t},getPlayUrl:function(t,e){let i=t,n=Z.cache[i.songId];if(!Q.inQMClient)return n&&"function"==typeof e.callback&&(n.canplay||!n.canplay&&!n.retry)?(n.in_cache=!0,void e.callback(n)):void(!0!==Z.submiting[i.songId]&&(Z.submiting[i.songId]=!0,n&&f.setSum(Z.reportId,122,1),function(t){f.setSum(Z.reportId,18,1);let e=+new Date,i="//mp.weixin.qq.com/mp/qqmusic?action=get_song_info&song_mid=".concat(t.mid,"&song_id=").concat(t.id);g({url:i,type:"GET",dataType:"json",success:function(i){let n=+new Date-e;if(200==i.http_code){setTimeout((()=>{K.reportRespData({type:1,songid:t.id,musicid:t.mid,responseData:i.resp_data||""})}),0);let e,s={};try{s=JSON.parse(i.resp_data)}catch(o){let e=1;return tt({type:"error",time:n,code:e}),"function"==typeof t.onError&&t.onError({errcode:e}),void _.info("qqmusic_checkCopyright_parsefail mid:"+t.mid+", repsponeData:"+i.resp_data)}if(void 0===s.ret||0!=s.ret||0!=s.sub_ret||0==s.songlist.length){let e=1;return tt({type:"error",time:n,code:e}),"function"==typeof t.onError&&t.onError({errcode:e}),void _.info("qqmusic_checkCopyright_dataerror mid:"+t.mid+", repsponeData:"+i.resp_data)}let a=s.songlist[0],r=a.song_play_url,l=a.song_play_time||0;if(a.playable)e=r?0:6;else if(a.try_playable)a.try_file_size>0&&a.try_30s_url?(e=8,r=a.try_30s_url,l=30):e=7;else switch(1*a.unplayable_code){case 1:e=1;break;case 2:e=2;break;case 3:e=3;break;case 4:e=4;break;default:e=5}tt({type:"success",time:n,code:e});let d=function(t){let e=!0,i=!1,n="";switch(1*t){case 0:e=!0;break;case 1:case 2:case 3:e=!1,n="因版权限制，音乐无法播放。";break;case 4:e=!1,n="当前区域因版权限制，音乐无法播放。";break;case 5:e=!1,i=!0,n="播放失败，请稍后再试。";break;case 6:case 7:e=!1,i=!0,n="系统错误，请稍后再试。";break;case 8:e=!0,n="该音乐为付费音乐，当前为你播放试听片段。";break;default:e=!1,n="系统错误，请稍后再试。"}return{canplay:e,msg:n,retry:i}}(1*e);t.onSuc({canplay:d.canplay,retry:d.retry,msg:d.msg,status:e,play_url:r||"",duration:l}),d.canplay||_.info("qqmusic_checkCopyright_cannotplay mid:"+t.mid+", repsponeData:"+i.resp_data)}else{let e=4;switch(i.http_code){case 200:break;case 400:e=2;break;case 500:e=3;break;default:e=i.ret||4}tt({type:"error",time:n,code:e}),"function"==typeof t.onError&&t.onError({errcode:e})}},error:function(){"function"==typeof t.onError&&t.onError({errcode:4})}})}({id:i.songId,mid:i.mid,onSuc:function(t){Z.submiting[i.songId]=!1,Z.cache[i.songId]&&!Z.cache[i.songId].canplay&&t.canplay&&f.setSum(Z.reportId,123,1),Z.cache[i.songId]=t,"function"==typeof e.callback&&e.callback(t)},onError:function(t){Z.submiting[i.songId]=!1,"function"==typeof e.callback&&(-3===t.errcode&&u.isWxWork?b():e.callback({canplay:!1,msg:-3===t.errcode?"请在微信客户端打开":"系统繁忙，请稍后再试。",status:-1,play_url:"",duration:0}))}})));e.callback({canplay:!0,play_url:"https://www.qq.com"})}};let it={reportId:"28306",musicIcon:window.icon_kugou_source||"",cache:{},submiting:{}};function nt(t){let e=Math.max(t.time,0);if(e=Math.min(e,1e4),e>=0&&e<500?f.setSum(it.reportId,98,1):e>=500&&e<1e3?f.setSum(it.reportId,99,1):e>=1e3&&e<2e3?f.setSum(it.reportId,100,1):e>=2e3&&e<5e3?f.setSum(it.reportId,101,1):e>=5e3&&e<=1e4&&f.setSum(it.reportId,102,1),"error"==t.type){switch(1*t.code){case 1:f.setSum(it.reportId,94,1);break;case 2:f.setSum(it.reportId,91,1);break;case 3:f.setSum(it.reportId,92,1);break;case 4:f.setSum(it.reportId,93,1)}f.setSum(it.reportId,88,1)}else if("success"==t.type){switch(1*t.code){case 1:f.setSum(it.reportId,95,1);break;case 0:f.setSum(it.reportId,97,1);break;case 1002:f.setSum(it.reportId,96,1);break;case 1001:f.setSum(it.reportId,103,1)}f.setSum(it.reportId,89,1)}}const ot={initData:function(t,e){let i=[/^http(s)?:\/\/singerimg\.kugou\.com([\/?].*)*$/i,/^http(s)?:\/\/imge\.kugou\.com([\/?].*)*$/i],n=!1;for(let o,s=0;o=i[s++];)if(o.test(t.albumurl)){n=!0;break}return n||(t.albumurl=""),t.detailUrl="https://m3ws.kugou.com/kgsong/"+t.jumpurlkey+".html?fromweixin=",t.webUrl=t.detailUrl,t.musicIcon=it.musicIcon,t.media_id=t.musicid,1*e.scene==0?t.type=5:1*e.scene==1?t.type=6:t.type=9,t},getPlayUrl:function(t,e){let i=t,n=i.otherid+(i.albumid||""),o=it.cache[n];o&&"function"==typeof e.callback?e.callback(o):!0!==it.submiting[n]&&(it.submiting[n]=!0,function(t){f.setSum(it.reportId,87,1);let e=+new Date,i="/mp/getkugousong?params=#params#",n=[{akey:t.akey,albumid:t.albumid||""}],o=encodeURIComponent(JSON.stringify(n));i=i.replace("#params#",o),g({url:i,type:"GET",dataType:"json",success:function(i){let n=+new Date-e;if(setTimeout((()=>{K.reportRespData({type:2,songid:t.songId,musicid:t.akey,jumpurlkey:t.jumpurlkey,responseData:JSON.stringify(i||{}),kugouParams:o})}),0),!i||void 0===i.errcode){let e=1;return nt({type:"error",time:n,code:e}),void("function"==typeof t.onError&&t.onError({errcode:e}))}let s=0,a="";0==i.errcode?i.data&&i.data[0]&&i.data[0].url?(s=0,a=i.data[0].url):s=1001:s=1==i.errcode?1:1002,nt({type:"success",time:n,code:s});let r=function(t){let e=!0,i="";switch(1*t){case 0:e=!0;break;case 1:e=!1,i="该歌曲版权已过期，无法播放。";break;default:e=!1,i="系统错误，请稍后再试。"}i&&(i+="错误码："+t);return{canplay:e,msg:i}}(s);t.onSuc({canplay:r.canplay,msg:r.msg,errcode:s,play_url:a})},error:function(){let i=2;nt({type:"error",time:+new Date-e,code:i}),"function"==typeof t.onError&&t.onError({errcode:i})}})}({jumpurlkey:i.jumpurlkey,songId:i.songId,akey:i.otherid,albumid:i.albumid||"",onSuc:function(t){it.submiting[n]=!1,it.cache[n]=t,"function"==typeof e.callback&&e.callback(t)},onError:function(t){it.submiting[n]=!1,"function"==typeof e.callback&&e.callback({canplay:!1,msg:"系统繁忙，请稍后再试。返回码：-1",status:-1,play_url:"",duration:0})}}))}},st={allComponent:[],hasInit:!1,reportId:"28306",musicSupport:z.getSurportType(),debug:location.href.indexOf("vconsole=1")>0||document.cookie&&document.cookie.indexOf("vconsole_open=1")>-1,reportData:{},posIndex:{},num:0,reportData2:{},adapter:{m:et,k:ot},needReport11982:!1,repotIntervalId:null,inWechat:u.isWechat&&!u.isWindowsWechat&&!u.isMacWechat,inPC:u.isWindows||u.isMac&&!u.isIOS,fastForwardSec:15,fastBackSec:15,pcFastForwardBackSec:5,pcCtrlVolGap:.05},at=(()=>{let t=null,e=null,i="";return n=>{null===t?(t=document.createElement("div"),t.innerHTML='<div role="alert">\n        <div class="weui-mask_transparent"></div>\n        <div class="weui-toast">\n            <i class="weui-icon-warn weui-icon_toast"></i>\n            <p class="weui-toast__content" style="font-size: 12px;">'.concat(n,"</p>\n        </div>\n      </div>")):n!==i&&(t.querySelector(".weui-toast__content").innerHTML=n),i=n,null!==e&&(clearTimeout(e),e=null),e=setTimeout((()=>{document.body.removeChild(t),e=null}),3e3),document.body.appendChild(t)}})();function rt(){st.hasInit||(ut(),function(){if(st.hasInit)return;Q.inQMClient&&ct("QMClient_pv",1)}(),function(){u.gtVersion("7.0.6")||p.on(window,"unload",(function(){let t=pt(),e=JSON.parse(t.report_list);for(let i=0;i<e.length;i++)g({type:"POST",url:"/mp/musicreport?#wechat_redirect",timeout:2e4,async:!0,data:e[i]})}));st.repotIntervalId&&clearInterval(st.repotIntervalId);st.repotIntervalId=setInterval((function(){ht()}),3e4)}(),st.hasInit=!0)}let lt=null;function dt(t){rt(),this._o={protocal:"",wxIndex:0,type:0,comment_id:"",src:"",jsapi2Src:"",mid:"",songId:"",otherid:"",albumid:"",jumpurlkey:"",autoPlay:!1,duration:0,needVioceMutex:!0,appPlay:!0,title:"",allowPause:!1,singer:"",epname:"",coverImgUrl:"",webUrl:[location.protocol,"//mp.weixin.qq.com/s?referFrom=#referFrom#&songid=#songId#&__biz=",window.biz,"&mid=",window.mid,"&idx=",window.idx,"&sn=",window.sn,"#wechat_redirect"].join(""),musicbar_url:"",playingCss:"",pauseCss:"",playCssDom:"",playArea:"",progress:"",detailUrl:"",detailArea:"",fileSize:0,playtimeDom:"",loadingDom:"",bufferDom:"",playdotDom:"",playpercent:"",seekRange:"",seekContainer:"",listBase64:"",isTingOpen:-1,isSupportListenLater:-1,isClMusic:!1,isClAudio:!1,onListenLaterSuccess:()=>{},onPlaySuccess:()=>{}},this._init(t),st.allComponent.push(this)}function ut(){window.reportMid=[],window.reportVoiceid=[];for(let t in X)if(X.hasOwnProperty(t)){let e=X[t].split("_");st.reportData2[t]={id:e[0],key:e[1],count:0}}}function ct(t,e){st.reportData2[t]&&(e=e||1,st.reportData2[t].count+=e,st.debug&&console.log("addpv:"+t+" count:"+st.reportData2[t].count))}function pt(){z.triggerUnloadPlaying(),ht();let e,i={};for(let t=0,o=st.allComponent.length;t<o;t++){let i=st.allComponent[t];i.player&&"function"==typeof i.player.getPlayTotalTime&&(st.reportData[i._o.type].play_last_time[i._g.posIndex]=parseInt(1e3*i.player.getPlayTotalTime())),"number"!=typeof i._status||1!==i._status&&4!==i._status||(e=i._o.songId)}e&&(i.current_musicid=e);let n=[];for(let o in st.reportData)n=n.concat(t.musicreport({data:st.reportData[o]}));i.report_list=JSON.stringify(n),ut();for(let t=0,o=st.allComponent.length;t<o;t++){let e=st.allComponent[t];e&&"function"==typeof e._initReportData&&e._initReportData(),e.player&&"function"==typeof e.player.resetPlayTotalTime&&e.player.resetPlayTotalTime()}return i}function ht(){for(let t in st.reportData2)if(st.reportData2.hasOwnProperty(t)){let e=st.reportData2[t];e.count>0&&(f.setSum(e.id,e.key,e.count),e.count=0)}}function mt(t){if(isNaN(t))return"00:00";t=Math.floor(t);let e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),n=t-3600*e-60*i;return 0!=e?(e<10&&(e="0"+e),e+=":"):e="",i<10&&(i="0"+i),n<10&&(n="0"+n),e+i+":"+n}function yt(t){if(isNaN(t))return"00:00";t=Math.floor(t);let e=Math.floor(t/3600);return e=0!=e?"00:":"",e+"00:00"}function gt(t){return new Promise((e=>{g({url:"/voice/getvoicestatus?mediaid=".concat(t),dataType:"json",timeout:3e3,success(t){t&&t.base_resp&&0===t.base_resp.ret?e(t):e()},error(){e()}})}))}"function"==typeof IntersectionObserver&&(lt=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&function(t){if(t.isReport)return;let e=$(t).parent().parent().get(0).host,i=$(t).data("album"),n=$(e).attr("voice_encode_fileid"),o=$(t).data("title");t.isReport=1,k({albumId:i,albumType:7,eventType:1,audioid:n,title:o})}(t.target)}))}))),dt.prototype._init=function(t){var e;this._extend(t),this._g={posIndex:void 0,tag:"",canDragBar:!1,barDraging:!1,canGoDetail:!0},5==this._o.type||6==this._o.type||9==this._o.type?this._g.tag="k":this._o.type>=2&&this._o.type<=4?this._g.tag="v":7==this._o.type?this._g.tag="a":0==this._o.type||1==this._o.type||8==this._o.type?this._g.tag="m":11===this._o.type&&(this._g.tag="cl"),this._initData(),this._initQQmusicLyric(),this._initReportData(),this.playtimeDomInnerHtml=null==(e=this._o.playtimeDom)?void 0:e.innerHTML,console.log("============ this._o.isTingOpen ============",this._o.isTingOpen),console.log("============ this._o.isSupportListenLater ============",this._o.isSupportListenLater),st.inWechat&&-1===this._o.isTingOpen?c.invoke("getTingAudioState",{},(t=>{console.log("getTingAudioState",t),/:ok$/.test(t.err_msg)?this._o.isTingOpen=1:-9999!==t.err_code&&-1===t.err_msg.indexOf("function_not_exist")||(this._o.isTingOpen=0),this._initPlayer()})):this._initPlayer()},dt.prototype._initData=function(){},dt.prototype._initQQmusicLyric=function(){let t=this._o;"m"==this._g.tag?t.webUrl=t.webUrl.replace("#songId#",t.songId||"").replace("#referFrom#","music.qq.com"):t.webUrl=t.webUrl.replace("#songId#","").replace("#referFrom#","")},dt.prototype._initReportData=function(){let e=this._o,i=this._g;"v"==i.tag?window.reportVoiceid.push(e.songId):"m"==i.tag&&window.reportMid.push(e.songId),void 0===st.reportData[e.type]&&(st.reportData[e.type]=t.getMusicReportData(e),st.posIndex[e.type]=0),void 0===i.posIndex&&(i.posIndex=st.posIndex[e.type]++);let n=st.reportData[e.type];n.musicid[i.posIndex]=e.songId,n.commentid[i.posIndex]=e.comment_id,n.hasended[i.posIndex]=0,n.mtitle[i.posIndex]=e.title,n.detail_click[i.posIndex]=0,n.duration2[i.posIndex]=parseInt(1e3*e.duration),n.errorcode[i.posIndex]=0,n.play_duration2[i.posIndex]=0,n.seek[i.posIndex]=0,n.seek_position[i.posIndex]=[],n.play_last_time[i.posIndex]=0,n.local_time[i.posIndex]=0,n.seek_loaded[i.posIndex]=[]},dt.prototype._initPlayer=function(e){if(!st.musicSupport)return;let i=this,n=this._o,o=this._g.tag;n.onStatusChange=this._statusChangeCallBack(),n.onTimeupdate=this._timeupdateCallBack(),n.onError=this._errorCallBack(),n.onUpdateSeekRange=this._onUpdateSeekRange(),n.onAndroidForceH5=function(){ct("force_h5",1)},n.onH5Begin2Play=function(){ct(o+"_pv",1),ct(o+"_h5_pv",1)},n.onH5Error=function(t,e){ct(o+"_h5_err_total",1),ct(o+"_h5_err_"+e.code,1),i._reportH5Error({type:1,code:e.code})},n.onJsapi1Begin2Play=function(t,e){ct(o+"_pv",1),ct(o+"_wx_pv",1),ct(o+"_wx_pv_1",1)},n.onJsapi2Begin2Play=function(t,e){ct(o+"_pv",1),ct(o+"_wx_pv",1),ct(o+"_wx_pv_2",1),n.jsapi2Src&&n.jsapi2Src!=n.src&&ct("aac_pv",1),n.musicPlayerOnJsapi2Begin2Play&&n.musicPlayerOnJsapi2Begin2Play(e)},n.onJsapi2PlaySuccess=function(t,e){n.musicPlayerOnJsapi2PlaySuccess&&n.musicPlayerOnJsapi2PlaySuccess(e)},n.onJsapi2Begin2PlayErr=function(e,i){if(ct(o+"_wx_err_1",1),n.jsapi2Src&&n.jsapi2Src!=n.src){let e="acc_start_error;type:#type#;uin:"+(window.user_uin||"")+";playurl:"+n.jsapi2Src+";pageurl:"+location.href;z.isAndroid?(t.logReport("",e.replace("#type#","android"),"ajax"),ct("android_aac_err_1",1)):(t.logReport("",e.replace("#type#","ios"),"ajax"),ct("ios_aac_err_1",1))}},n.onJsapi2PlayingErr=function(e,i){if(ct(o+"_wx_err_2",1),n.jsapi2Src&&n.jsapi2Src!=n.src){let e="acc_ing_error;type:#type#;uin:"+(window.user_uin||"")+";playurl:"+n.jsapi2Src+";pageurl:"+location.href;z.isAndroid?(t.logReport("",e.replace("#type#","android"),"ajax"),ct("android_aac_err_2",1)):(t.logReport("",e.replace("#type#","ios"),"ajax"),ct("ios_aac_err_2",1))}},n.onJsapi2PlayingStop=function(t,e){let i=o+"_stoped_";z.isAndroid?i+="android":i+="ios",ct(i,1)},n.onJsapi2PlayingPause=function(t,e){let i=o+"_paused_";z.isAndroid?i+="android":i+="ios",ct(i,1)},n.onSeekErr=function(e,i){if(ct(o+"_seek_err",1),n.jsapi2Src&&n.jsapi2Src!=n.src){let e="acc_seek_error;type:#type#;uin:"+(window.user_uin||"")+";playurl:"+n.jsapi2Src+";pageurl:"+location.href;z.isAndroid?(t.logReport("",e.replace("#type#","android"),"ajax"),ct("android_aac_err_3",1)):(t.logReport("",e.replace("#type#","ios"),"ajax"),ct("ios_aac_err_3",1))}},n.onUnloadPlaying=function(t,e){ct(o+"_unload_wx_pv",1)},n.onQMClientPlay=function(t){ct("QMClient_play",1)},n.onSeekNeed2Load=function(t){if(i.player&&i.player.surportSeekRange()&&n.playdotDom){let t=st.reportData[i._o.type],e=t.seek_position[i._g.posIndex].length;e>0&&(t.seek_loaded[i._g.posIndex][e-1]=1)}},n.onSeekNotNeed2Load=function(t){if(i.player&&i.player.surportSeekRange()&&n.playdotDom){let t=st.reportData[i._o.type],e=t.seek_position[i._g.posIndex].length;e>0&&(t.seek_loaded[i._g.posIndex][e-1]=0)}},i.observer=new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting&&(e.unobserve(t.target),i.report11899({Action:34}))}))}),{threshold:.5}),Q.create(this._o,{callback:function(t){i.player=t,i.afterCreatePlayer()}})},dt.prototype.afterCreatePlayer=function(){this._playEvent()},dt.prototype.isInSeekrang=function(t){let e=this._o.seekRange;if(!e)return!1;if(e===t)return!0;let i=e.getElementsByTagName("*");for(let n=0,o=i.length;n<o;n++)if(i[n]===t)return!0;return!1},dt.prototype._playEvent=function(n){var o;let s=0,a=this,r=this._o,l=this._g,d="";switch(1*r.type){case 0:s=1;break;case 1:s=13;break;case 8:s=14;break;case 2:s=3;break;case 3:s=6;break;case 4:s=7;break;case 5:s=10;break;case 6:s=15;break;case 7:s=11;break;case 9:s=12}d=(r.allowPause,r.playingCss);if(r.detailArea&&p.on(r.detailArea,"click",(function(t){var i,n;if(r.detailArea.classList.contains("js_wx_mpaudio_card_disabled"))return;if(n=t.target.getAttribute("id"),"[object String]"===Object.prototype.toString.call(n)&&["audio_fast_back","audio_double_speed","audio_fast_forward","audio_play_btn"].some((t=>-1!==n.indexOf(t))))return;if(l.barDraging||!l.canGoDetail)return;let o=t.target||t.srcElement;if(!(o&&a.isInSeekrang(o)||(null==(i=r.detailAreaClickHook)?void 0:i.call(r,o))))if("v"===l.tag){if(r.detailArea.classList.contains("pages_ban_msg_wrp"))return;if(st.reportData[r.type].detail_click[l.posIndex]=1,r.isTingOpen)a._playMusic(s,4,u.isWechat&&(u.isAndroid||u.isIOS));else{if(window.is_temp_url)return;if(u.isNewMpApp)return void(window.weui||window).alert("请在手机微信内操作");window.__second_open__?C(r.detailUrl):window.location.href=r.detailUrl}}else"m"===l.tag||"k"===l.tag?st.adapter[l.tag].getPlayUrl(r,{callback:function(t){t.canplay?(t.duration&&(r.duration=t.duration,a.player.setDuration(r.duration),st.reportData[r.type].duration2[l.posIndex]=parseInt(1e3*r.duration)),a.player.setSrc(t.play_url),8!=t.status||t.in_cache?a._playMusic(s,4,u.isWechat&&(u.isAndroid||u.isIOS)):new e({msg:"该音乐为付费音乐，当前为你播放试听片段",onClick:function(){a._playMusic(s,4,u.isWechat&&(u.isAndroid||u.isIOS))}})):t.msg&&new e({msg:t.msg})}}):"cl"===l.tag&&a._playMusic(s,4,u.isWechat&&(u.isAndroid||u.isIOS))})),r.albumDom){lt&&lt.observe(r.albumDom),p.on(r.albumDom,"click",(function(){let t=r.albumDom.getAttribute("data-link").replace("#wechat_redirect","&scene=173#wechat_redirect"),e=$(r.albumDom).data("album"),i=r.songId,n=$(r.albumDom).data("title");return k({albumId:e,albumType:7,eventType:2,audioid:i,title:n}),C(t),!1}),!0);const t=function(t){i.highlightEle(r.albumDom),t.stopPropagation()};p.on(r.albumDom,"touchstart",t),p.on(r.albumDom,"mousedown",t)}if(!st.musicSupport)return;p.on(r.playArea,"click",(function(){if(!r.playArea.classList.contains("js_play_disabled"))return console.log("click playArea",L.hasClass(r.playCssDom,d)),L.hasClass(r.playCssDom,d)?(r.allowPause?a.player.pause():a.player.stop(),t.report({type:s,comment_id:r.comment_id,voiceid:r.songId,action:5})):"v"===l.tag||"a"===l.tag||"cl"===l.tag?a._playMusic(s,4,!1,r.onPlaySuccess):st.adapter[l.tag].getPlayUrl(r,{callback:function(t){t.canplay&&t.play_url?(t.duration&&(r.duration=t.duration,a.player.setDuration(r.duration),st.reportData[r.type].duration2[l.posIndex]=parseInt(1e3*r.duration)),a.player.setSrc(t.play_url),1*t.status!=8||t.in_cache?a._playMusic(s,4):new e({msg:"该音乐为付费音乐，当前为你播放试听片段",onClick:function(){a._playMusic(s,4)}})):t.msg&&new e({msg:t.msg})}}),!1}));const c=function(t){t.stopPropagation()};p.on(r.playArea,"touchstart",c),p.on(r.playArea,"mousedown",c),r.listenLaterDom&&(null==(o=a.observer)||o.observe(r.listenLaterDom),p.on(r.listenLaterDom,"click",(t=>{var e,i;return!r.isSupportListenLater||r.listenLaterDom.classList.contains("js_listen_later_disabled")||window.is_temp_url?(window.is_temp_url&&window.weui.toast("预览状态下无法操作",{extClass:"weui-toast_text"}),t.preventDefault(),t.stopPropagation(),!1):(a.report11899({Action:35}),r.hasAddedListenLater?(null==(e=r.onCancelListenLaterStart)||e.call(r),a.player.cancelListenLater({succCallback(){var t;null==(t=r.onCancelListenLaterSuccess)||t.call(r)},errCallback(){var t;window.weui.alert("系统繁忙，请稍后重试"),null==(t=r.onCancelListenLaterError)||t.call(r)}})):(null==(i=r.onListenLaterStart)||i.call(r),a.player.listenLater({starVersion:r.starVersion,succCallback(){var t;null==(t=r.onListenLaterSuccess)||t.call(r)},errCallback(){var t;null==(t=r.onListenLaterError)||t.call(r),window.weui.alert("暂无法稍后听，请重试")},notSupportCallback(){var t;null==(t=r.onListenLaterError)||t.call(r),window.weui.alert("暂无法稍后听，请重试")}})),!1)})),p.on(r.listenLaterDom,"touchstart",c),p.on(r.listenLaterDom,"mousedown",c)),a._dragEvent(),a.a11y4PC()},dt.prototype.getSeekRangeOffsetLeft=function(){let t=0,e=this._o.seekRange,i=!1,n=window.__zoom||1;for(1!=n&&(i=!0);e&&e!=document.body;)t+=i?e.offsetLeft*n:e.offsetLeft,"page-content"==e.id&&(i=!1),e=e.offsetParent;return t},dt.prototype._dragEvent=function(){let t=this,e=this._o,i=this._g,n=e.seekRange;if(!n)return;let o=t.player.getDuration();i.seekData={zoom:window.__zoom||1,duration:o,startTime:0,dragTime:0,downX:0,moveX:0},p.on(n,"mousedown",(function(e){i.canDragBar&&(t._pointerDownHandler({x:e.pageX||e.clientX}),e.preventDefault(),e.stopPropagation())})),p.on(e.seekContainer,"mousemove",(function(e){i.canDragBar&&i.barDraging&&(t._pointerMoveHandler({x:e.pageX||e.clientX}),e.preventDefault(),e.stopPropagation())})),p.on(document.body,"mouseup",(function(e){if(i.canDragBar&&i.barDraging)return t._pointerUpHandler({x:e.pageX||e.clientX}),e.preventDefault(),e.stopPropagation(),!1})),p.on(n,"touchstart",(function(n){i.canDragBar&&(t._pointerDownHandler({x:n.changedTouches[0].clientX}),e.playpercentDesc&&e.playpercentDesc.setAttribute("aria-hidden","true"),e.playdotDom&&e.playdotDom.setAttribute("aria-live","assertive"),n.preventDefault(),n.stopPropagation())})),p.on(n,"touchmove",(function(e){i.canDragBar&&i.barDraging&&(t._pointerMoveHandler({x:e.changedTouches[0].clientX}),e.preventDefault(),e.stopPropagation())})),p.on(n,"touchend",(function(n){if(i.canDragBar&&i.barDraging)return t._pointerUpHandler({x:n.changedTouches[0].clientX}),e.playdotDom&&e.playdotDom.removeAttribute("aria-live"),setTimeout((function(){e.playpercentDesc&&e.playpercentDesc.removeAttribute("aria-hidden")}),100),n.preventDefault(),n.stopPropagation(),!1}))},dt.prototype._ctrlAreaEvt=function(){const t=this,e=this._o;e.fastBackBtn&&p.on(e.fastBackBtn,"click",(()=>{const e=t.player.getCurTime(),i=Math.max(+e-st.fastBackSec,0);t.player.seek(i),t.report11899({Action:33})})),e.fastForwardBtn&&p.on(e.fastForwardBtn,"click",(()=>{const e=t.player.getCurTime(),i=t.player.getDuration(),n=Math.min(+e+st.fastForwardSec,+i);t.player.seek(n),t.report11899({Action:32})})),e.doubleSpeedBtn&&p.on(e.doubleSpeedBtn,"click",(()=>{const i=z.getPlaybackRate();t.player.doubleSpeed({succCallback(){const n=z.getPlaybackRate();e.doubleSpeedBtn.innerHTML=1===n?"倍速":"".concat(n,"倍"),t.report11899({Action:21,FromPlaybackRate:i+"",ToPlaybackRate:n+""})},pcCallback(){const t=z.getPlaybackRate();e.doubleSpeedBtn.innerHTML=1===t?"倍速":"".concat(t,"倍")}})}))},dt.prototype._pointerDownHandler=function(t){let e=this._g;e.barDraging=!0,e.canGoDetail=!1,e.seekData.downX=t.x,e.seekData.startTime=this.player.getCurTime()},dt.prototype._pointerMoveHandler=function(t){let e=this._g.seekData;e.moveX=t.x;const i=this.getSeekRangeOffsetLeft();let n=(e.moveX-i)/e.zoom/this._o.seekRange.offsetWidth;n=Math.min(n,1),n=Math.max(n,0),e.dragTime=n*(e.duration||this._o.duration),e.dragTime!=e.startTime&&this._updateProgressBar(e.dragTime)},dt.prototype._pointerUpHandler=function(t){let e=this._g,i=e.seekData;i.dragTime||this._pointerMoveHandler({x:t.x}),e.barDraging=!1,this.player.seek(i.dragTime),st.reportData[this._o.type].seek[e.posIndex]=1,st.reportData[this._o.type].seek_position[e.posIndex].push(parseInt(1e3*i.startTime)+","+parseInt(1e3*i.dragTime));let n=st.reportData[this._o.type].seek_position[e.posIndex].length;st.reportData[this._o.type].seek_loaded[e.posIndex][n-1]=0,e.seekData.startTime=0,e.seekData.dragTime=0,e.seekData.downX=0,e.seekData.moveX=0,setTimeout((function(){e.canGoDetail=!0}),1e3)},dt.prototype._playMusic=function(e,i,n,o){const s=this,a=this._o,r=this._g,l=()=>{n?s.player.openStartMusicUI({listBase64:a.listBase64}):s.player.play({listBase64:a.listBase64,onSuccess:o}),st.reportData[a.type].hasended[r.posIndex]=1,0==st.reportData[a.type].local_time[r.posIndex]&&(st.reportData[a.type].local_time[r.posIndex]=parseInt(+new Date/1e3)),t.report({type:e,comment_id:a.comment_id,voiceid:a.songId,action:i}),u.gtVersion("7.0.6")&&!st.needReport11982&&(st.needReport11982=!0,w.addSpecificReport("music_data",pt),console.log("music play leave report added"))};"v"!==r.tag||a.listenId||0!=+a.duration?l():g({url:"/voice/getvoicestatus?mediaid=".concat(a.songId),dataType:"json",success(t){t&&t.base_resp&&0===t.base_resp.ret?(0!=+t.play_length&&s.player.setDuration(t.play_length/1e3),4===t.voice_verify_state?at("因违反相关法律法规，音频不可播放"):5===t.voice_verify_state?at("该音频已被发布者删除"):l()):window.weui.alert("系统繁忙，请稍后再试")},error(t){console.log(t),window.weui.alert("系统繁忙，请稍后再试")}})},dt.prototype._extend=function(t){for(let e in t)this._o[e]=t[e]},dt.prototype._onUpdateSeekRange=function(){let t=this._o,e=this._g;return function(i){this.surportSeekRange()&&t.bufferDom&&t.playdotDom?(e.canDragBar=!0,t.playdotDom.style.display="block",t.bufferDom.style.width=1*i+"%"):(e.canDragBar=!1,t.playdotDom&&(t.playdotDom.style.display="none"))}},dt.prototype._statusChangeCallBack=function(){let t=this;return function(e,i){t._status=i,t._updatePlayerCss(this,i),t._o.musicPlayerStatusChange&&t._o.musicPlayerStatusChange(i)}},dt.prototype._timeupdateCallBack=function(){let t=this,e=this._o,i=this._g;return function(n,o){t._updateProgress(o),0!=o&&(st.reportData[e.type].play_duration2[i.posIndex]=parseInt(1e3*o)),t._o.timeupdateCallBack&&t._o.timeupdateCallBack(o);const s=z.getPlaybackRate();e.doubleSpeedBtn&&(e.doubleSpeedBtn.innerHTML=1===s?"倍速":"".concat(s,"倍"))}},dt.prototype._errorCallBack=function(){let t=this,e=this._o,i=this._g;return function(n,o){st.reportData[e.type].errorcode[i.posIndex]=o.code,t._updatePlayerCss(this,3)}},dt.prototype._reportH5Error=function(t){if(("mp.weixin.qq.com"!=location.host||1!=t.type)&&!st.debug)return;let e=["code:",t.code,";type:",this._o.type,";url:",window.location.href];this.player&&e.push(";src:"+this.player.getSrc()),(new Image).src=["https://badjs.weixinbridge.com/badjs?level=4&id=112&msg=",encodeURIComponent(e.join("")),"&uin=",window.uin||"","&from=",this._o.type].join("")},dt.prototype._updatePlayerCss=function(t,e){st.debug&&console.log("status:"+e);let i=this,n=i._o,o=n.playCssDom;if(n.progress,2===e)L.removeClass(o,n.playingCss),n.pauseCss&&L.addClass(o,n.pauseCss),n.playdotDom&&(t.surportSeekRange()?(n.playdotDom.style.display="block",this._g.canDragBar=!0):(n.playdotDom.style.display="none",this._g.canDragBar=!1)),n.audioRealTimeDom&&(n.audioRealTimeDom.style.display="none"),n.audioDurationDom&&(n.audioDurationDom.style.display="block"),n.playArea&&n.playArea.setAttribute("aria-label","播放");else if(3===e)n.ctrlArea&&(n.ctrlArea.style.display="none"),L.removeClass(o,n.playingCss),n.pauseCss&&L.removeClass(o,n.pauseCss),n.playdotDom&&(n.playdotDom.style.display="none",this._g.canDragBar=!1),n.audioRealTimeDom&&(n.audioRealTimeDom.style.display="none"),n.audioDurationDom&&(n.audioDurationDom.style.display="block"),n.audioProgressBarDom&&(n.audioProgressBarDom.style.display="none"),this._updateProgress(0),n.playtimeDom&&(n.playtimeDom.innerHTML=n.playtimeDom.getAttribute("data-duration")||this.playtimeDomInnerHtml),n.playArea&&n.playArea.setAttribute("aria-label","播放");else if(1===e||4===e){const e=z.getPlaybackRate();n.doubleSpeedBtn&&(n.doubleSpeedBtn.innerHTML=1===e?"倍速":"".concat(e,"倍")),st.allComponent.forEach((t=>{t===i?(n.ctrlArea&&(n.ctrlArea.style.display=""),n.playArea&&n.playArea.setAttribute("aria-label","暂停")):(t._o.playArea&&t._o.playArea.setAttribute("aria-label","播放"),t._o.ctrlArea&&(t._o.ctrlArea.style.display="none"))})),n.allowPause?(L.removeClass(o,n.pauseCss),L.addClass(o,n.playingCss)):L.addClass(o,n.playingCss),n.playdotDom&&(t.surportSeekRange()?(n.playdotDom.style.display="block",this._g.canDragBar=!0):(n.playdotDom.style.display="none",this._g.canDragBar=!1)),n.audioDurationDom&&(n.audioDurationDom.style.display="none"),n.audioRealTimeDom&&(n.audioRealTimeDom.style.display="block"),n.audioProgressBarDom&&(n.audioProgressBarDom.style.display="block")}n.loadingDom&&(n.loadingDom.style.display=4==e?"block":"none")},dt.prototype._updateProgress=function(t){this._g.barDraging||this._updateProgressBar(t)},dt.prototype._updateProgressBar=function(t){let e=this._o,i=this.player.getDuration();if(!i)return;let n=this._countProgress(i,t);e.progress&&(e.progress.style.width=n),e.playtimeDom&&t>=0&&(e.playtimeDom.innerHTML=['<span style="position: relative; display: inline-block;">','<span style="opacity: 0; display: inline-block;" aria-hidden="true">'.concat(yt(t),"</span>"),'<span style="position: absolute; left: 0; top: 0;">'.concat(mt(t),"</span>"),"</span>",'<span style="position: relative; display: inline-block;">/</span>','<span style="position: relative; display: inline-block;">','<span style="opacity: 0; display: inline-block;" aria-hidden="true">'.concat(yt(i),"</span>"),'<span style="position: absolute; right: 0; top: 0;">'.concat(mt(i),"</span>"),"</span>"].join("")),e.playdotDom&&e.playpercent&&(e.playdotDom.style.left=n,e.playpercent.innerHTML=n)},dt.prototype._countProgress=function(t,e){return"".concat(Math.round(Math.min(e/t*100,100)),"%")},dt.prototype.destory=function(){this.player&&this.player.destory()},dt.prototype.setOption=function(t){t.duration&&(this._g.seekData.duration=t.duration),this._extend(t)},dt.prototype.setMusicPlayerOption=function(t){t.duration&&this._g&&this._g.seekData&&(this._g.seekData.duration=t.duration),this.player&&this.player.setOption(t)},dt.prototype.getBackgroundAudioState=function(t){return this.player.getBackgroundAudioState(t)},dt.prototype.report11899=function(t){const e=this._o,i=2===e.type?3:4===e.type?6:0;"[object Object]"!==Object.prototype.toString.call(t)&&(t={}),v.report(11899,Object.assign({},{Type:i,scene:1*window.scene,BizUin:window.biz||"",VoiceId:e.songId||"",Mid:window.parseInt(window.mid,10)||0,Idx:window.parseInt(window.idx,10)||0},t))},dt.prototype.a11y4PC=function(){if(!st.inPC)return;const t=this,e=t._o;e.playdotDom&&e.playdotDom.setAttribute("title",u.isMac?"按住option + 左右方向键可调":"按alt + 左右方向键可调"),!st.inWechat&&e.playArea&&e.playArea.setAttribute("title",u.isMac?"按住option + 上下方向键可调音量":"按alt + 上下方向键可调音量"),!st.inWechat&&e.playCssDom&&p.on(e.playCssDom,"keydown",(function(e){e.preventDefault();const i=e.keyCode||e.which,n=t.player.getCurVol();switch(i){case 38:t.player._h5SetVolume(n+st.pcCtrlVolGap);break;case 40:t.player._h5SetVolume(n-st.pcCtrlVolGap)}})),e.playCssDom&&p.on(e.playCssDom,"keyup",(e=>{e.preventDefault();const i=e.keyCode||e.which,n=t.player.getCurTime();switch(i){case 13:1===t.player.getPlayStatus()?t.player.pause():t.player.play();break;case 37:t.player.seek(n-st.pcFastForwardBackSec);break;case 39:t.player.seek(n+st.pcFastForwardBackSec)}}))};const _t={init:function(t){return new dt(t)},decodeStr:function(t){return t=(t||"").replace(/&#96;/g,"`").replace(/&#61;/g,"=").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},encodeStr:function(t){return t=(t||"").replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/=/g,"&#61;").replace(/`/g,"&#96;")},formatTime:mt,renderPlayer:function(t,e,i,n,o){st.num++,e.musicSupport=st.musicSupport,e.show_not_support=!1,st.musicSupport||1!=st.num||(e.show_not_support=!0);const s=()=>{let s=document.createElement("div");if(s.innerHTML=T.tmpl(t,e,!1),!0===n)i.appendChild(s.children[0]);else{let t=i.parentNode;if(!t)return;t.lastChild===i?t.appendChild(s.children[0]):t.insertBefore(s.children[0],i.nextSibling)}"function"==typeof o&&o()};e.errMsg="",void 0!==e.transState&&void 0!==e.voiceVerifyState?(0===e.transState?e.errMsg="音频转码中":2===e.transState?e.errMsg="音频转码失败":1===e.voiceVerifyState?e.errMsg="音频审核中":2===e.voiceVerifyState?e.errMsg="音频审核失败":4===e.voiceVerifyState?e.errMsg="此音频因违规无法查看":5===e.voiceVerifyState&&(e.errMsg="该音频已被发布者删除"),s()):"v"===e.voiceTag?g({url:"/voice/getvoicestatus?mediaid=".concat(e.voiceid),dataType:"json",success(t){t&&t.base_resp&&0===t.base_resp.ret&&(4===t.voice_verify_state?e.errMsg="此音频因违规无法查看":5===t.voice_verify_state&&(e.errMsg="该音频已被发布者删除")),s()},error(t){console.log(t),e.errMsg="系统繁忙，请稍后再试",s()}}):s()},getVoiceStatus:gt,rollStatus:function t(e,i){gt(e).then((n=>{0!==n.voice_trans_state&&1!==n.voice_verify_state||setTimeout((()=>{t(e,i)}),1e3),null==i||i(n)}))}},ft=new I("audio_panel");function vt(t,e=50){let i;return function(...n){i&&(clearTimeout(i),i=null),i=setTimeout((()=>t(...n)),e)}}function wt(t,e=1){const i=t/1e3;if(i<0)return 1===e?"0秒":"00:00";if(i<60)return 1===e?"".concat(parseInt(i,10),"秒"):"00:".concat(String(parseInt(i,10)).padStart(2,"0"));const n=i/60,o=parseInt(i%60,10);if(n>=60&&1===e){const t=parseInt(n/60,10),i=parseInt(n-60*t,10);return 0===i&&1===e?"".concat(t,"小时"):1===e?"".concat(t,"小时").concat(i,"分钟"):"".concat(String(t).padStart(2,"0"),":").concat(String(i).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))}return 1===e?"".concat(parseInt(n,10),"分钟"):"".concat(String(parseInt(n,10)).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))}function It(t){return-1!==[0,1,2,3,4,10,11].indexOf(t)}function St(){let t=1;const e=";".concat(document.cookie).split(";").map((t=>t.trim().split("="))).reduce(((t,[e,i])=>("mp-exp__audio-panel"===e&&(t=+i),t)),void 0);return void 0!==e&&(t=e),t}const bt=t=>(e,i,n)=>n.findIndex((i=>i[t]===e[t]))===i,Tt=(t,e=0)=>{var i,n,o,s,a,r,l,d,u,c,p,h,m,y,g,_;const f={username:(null==(i=null==t?void 0:t.author_info)?void 0:i.username)||"",name:(null==(n=null==t?void 0:t.author_info)?void 0:n.nickname)||"",bizUin:(null==(o=null==t?void 0:t.article_info)?void 0:o.bizuin)||"",webUrl:(null==(s=null==t?void 0:t.article_info)?void 0:s.url)||"",audioId:(null==(a=null==t?void 0:t.article_info)?void 0:a.audio_id)||""},v={appId:(null==(r=null==t?void 0:t.article_info)?void 0:r.biz_appid)||"",mid:"",url:(null==(l=null==t?void 0:t.article_info)?void 0:l.url)||""},w={nonceId:(null==(d=null==t?void 0:t.finder_info)?void 0:d.nonce_id)||"",tid:(null==(u=null==t?void 0:t.finder_info)?void 0:u.tid)||""};return{listenId:(null==t?void 0:t.listen_id)||"",type:null==t?void 0:t.type,startTime:e,duration:parseInt((null==t?void 0:t.duration)/1e3,10)||123,srcId:(null==t?void 0:t.listen_id)||"",title:(null==(c=null==t?void 0:t.article_info)?void 0:c.audio_title)||(null==t?void 0:t.title)||(null==(p=null==t?void 0:t.article_info)?void 0:p.title)||(null==(h=null==t?void 0:t.finder_info)?void 0:h.title)||"",webUrl:(null==(m=null==t?void 0:t.article_info)?void 0:m.url)||"",url:(null==(y=null==t?void 0:t.article_info)?void 0:y.url)||"",dataUrl:null==(g=null==t?void 0:t.article_info)?void 0:g.audio_url,audioUrl:null==(_=null==t?void 0:t.article_info)?void 0:_.audio_url,author:(null==t?void 0:t.author)||"",cover:(null==t?void 0:t.cover)||"",...(null==t?void 0:t.article_info)?{mpInfo:f}:{},...(null==t?void 0:t.article_info)?{musicInfo:v}:{},...(null==t?void 0:t.finder_info)?{finderInfo:w}:{}}},Lt=t=>{let e=t.getAttribute("name")||"";try{e=decodeURIComponent(e)}catch(n){}const i=_t.encodeStr(e).replace(/^\s/,"").replace(/\s$/,"");return{type:"MP-COMMON-CLAUDIO"===t.tagName?4:2,title:_t.decodeStr(i),listen_id:t.getAttribute("listen_id"),duration:"MP-COMMON-CLAUDIO"===t.tagName?1e3*t.getAttribute("duration"):1*t.getAttribute("play_length")||0,cover:(t.getAttribute("cover")||"").html(!1),author:t.getAttribute("author")||"",author_info:{head_img:"",type:2,nickname:t.getAttribute("author")||"",username:""},..."MP-COMMON-CLAUDIO"===t.tagName?{finder_info:{author:t.getAttribute("author")||"",nonce_id:t.getAttribute("nonce_id"),tid:t.getAttribute("tid"),title:_t.decodeStr(i),duration:"MP-COMMON-CLAUDIO"===t.tagName?1e3*t.getAttribute("duration"):1*t.getAttribute("play_length")||0}}:{article_info:{author:window.nickname,biz_username:window.user_name,bizuin:window.atob(window.biz||""),cover:window.cdn_url_1_1,create_time:window.create_time,head_img:window.hd_head_img,title:window.msg_title,url:window.msg_link}}}};let kt=null;function Ct(){return new Promise((t=>{null!==kt&&t(kt),u.isWechat||t(kt),c.invoke("operateStar",{opType:"getSwitch"},(e=>{kt=/:ok$/.test(e.err_msg)&&e.switch,t(kt)}))}))}Ct();const Pt=293511,xt=u.isIOS&&u.compareHexVersion("18003238")||u.isAndroid&&u.compareHexVersion("28003259"),At=u.isIOS&&u.compareHexVersion("18003238")||u.isAndroid&&u.compareHexVersion("28003258");var Dt=Object.defineProperty,Et=Object.getOwnPropertySymbols,Mt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable,Ot=(t,e,i)=>e in t?Dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Bt=(t,e)=>{for(var i in e||(e={}))Mt.call(e,i)&&Ot(t,i,e[i]);if(Et)for(var i of Et(e))Rt.call(e,i)&&Ot(t,i,e[i]);return t},jt=(t,e)=>{var i={};for(var n in t)Mt.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&Et)for(var n of Et(t))e.indexOf(n)<0&&Rt.call(t,n)&&(i[n]=t[n]);return i};const Ut=window.Vue.getCurrentInstance,Nt=window.Vue.unref,Ft=window.Vue.watch,Ht=window.Vue.onUnmounted,$t=window.Vue.onMounted,Wt=window.Vue.nextTick,Jt=window.Vue.isRef,Vt=window.Vue.defineComponent,zt=window.Vue.computed,Xt=window.Vue.toRefs,qt=window.Vue.ref,Gt=window.Vue.reactive,Yt=window.Vue.h;window.Vue.isProxy;const Qt="[vue-draggable-plus]: ";function Kt(t,e,i){return i>=0&&i<t.length&&t.splice(i,0,t.splice(e,1)[0]),t}function Zt(t,e){return Array.isArray(t)&&t.splice(e,1),t}function te(t,e,i){return Array.isArray(t)&&t.splice(e,0,i),t}function ee(t,e,i){const n=t.children[i];t.insertBefore(e,n)}function ie(t){t.parentNode&&t.parentNode.removeChild(t)}function ne(t,e=document){var i;let n=null;return n="function"==typeof(null==e?void 0:e.querySelector)?null==(i=null==e?void 0:e.querySelector)?void 0:i.call(e,t):document.querySelector(t),n||function(t){console.warn(Qt+t)}("Element not found: ".concat(t)),n}function oe(t,e){Object.keys(t).forEach((i=>{e(i,t[i])}))}const se=Object.assign;
/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ae(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function re(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(i),!0).forEach((function(e){de(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function le(t){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function de(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ue(){return ue=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ue.apply(this,arguments)}function ce(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],!(e.indexOf(i)>=0)&&(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function pe(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var he=pe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),me=pe(/Edge/i),ye=pe(/firefox/i),ge=pe(/safari/i)&&!pe(/chrome/i)&&!pe(/android/i),_e=pe(/iP(ad|od|hone)/i),fe=pe(/chrome/i)&&pe(/android/i),ve={capture:!1,passive:!1};function we(t,e,i){t.addEventListener(e,i,!he&&ve)}function Ie(t,e,i){t.removeEventListener(e,i,!he&&ve)}function Se(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(i){return!1}return!1}}function be(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Te(t,e,i,n){if(t){i=i||document;do{if(null!=e&&(">"===e[0]?t.parentNode===i&&Se(t,e):Se(t,e))||n&&t===i)return t;if(t===i)break}while(t=be(t))}return null}var Le,ke=/\s+/g;function Ce(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(ke," ").replace(" "+e+" "," ");t.className=(n+(i?" "+e:"")).replace(ke," ")}}function Pe(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];!(e in n)&&-1===e.indexOf("webkit")&&(e="-webkit-"+e),n[e]=i+("string"==typeof i?"":"px")}}function xe(t,e){var i="";if("string"==typeof t)i=t;else do{var n=Pe(t,"transform");n&&"none"!==n&&(i=n+" "+i)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function Ae(t,e,i){if(t){var n=t.getElementsByTagName(e),o=0,s=n.length;if(i)for(;o<s;o++)i(n[o],o);return n}return[]}function De(){return document.scrollingElement||document.documentElement}function Ee(t,e,i,n,o){if(t.getBoundingClientRect||t===window){var s,a,r,l,d,u,c;if(t!==window&&t.parentNode&&t!==De()?(a=(s=t.getBoundingClientRect()).top,r=s.left,l=s.bottom,d=s.right,u=s.height,c=s.width):(a=0,r=0,l=window.innerHeight,d=window.innerWidth,u=window.innerHeight,c=window.innerWidth),(e||i)&&t!==window&&(o=o||t.parentNode,!he))do{if(o&&o.getBoundingClientRect&&("none"!==Pe(o,"transform")||i&&"static"!==Pe(o,"position"))){var p=o.getBoundingClientRect();a-=p.top+parseInt(Pe(o,"border-top-width")),r-=p.left+parseInt(Pe(o,"border-left-width")),l=a+s.height,d=r+s.width;break}}while(o=o.parentNode);if(n&&t!==window){var h=xe(o||t),m=h&&h.a,y=h&&h.d;h&&(l=(a/=y)+(u/=y),d=(r/=m)+(c/=m))}return{top:a,left:r,bottom:l,right:d,width:c,height:u}}}function Me(t,e,i){for(var n=Ue(t,!0),o=Ee(t)[e];n;){if(!(o>=Ee(n)[i]))return n;if(n===De())break;n=Ue(n,!1)}return!1}function Re(t,e,i,n){for(var o=0,s=0,a=t.children;s<a.length;){if("none"!==a[s].style.display&&a[s]!==$i.ghost&&(n||a[s]!==$i.dragged)&&Te(a[s],i.draggable,t,!1)){if(o===e)return a[s];o++}s++}return null}function Oe(t,e){for(var i=t.lastElementChild;i&&(i===$i.ghost||"none"===Pe(i,"display")||e&&!Se(i,e));)i=i.previousElementSibling;return i||null}function Be(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"!==t.nodeName.toUpperCase()&&t!==$i.clone&&(!e||Se(t,e))&&i++;return i}function je(t){var e=0,i=0,n=De();if(t)do{var o=xe(t),s=o.a,a=o.d;e+=t.scrollLeft*s,i+=t.scrollTop*a}while(t!==n&&(t=t.parentNode));return[e,i]}function Ue(t,e){if(!t||!t.getBoundingClientRect)return De();var i=t,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=Pe(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return De();if(n||e)return i;n=!0}}}while(i=i.parentNode);return De()}function Ne(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function Fe(t,e){return function(){if(!Le){var i=arguments;1===i.length?t.call(this,i[0]):t.apply(this,i),Le=setTimeout((function(){Le=void 0}),e)}}}function He(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function $e(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function We(t,e,i){var n={};return Array.from(t.children).forEach((function(o){var s,a,r,l;if(Te(o,e.draggable,t,!1)&&!o.animated&&o!==i){var d=Ee(o);n.left=Math.min(null!==(s=n.left)&&void 0!==s?s:1/0,d.left),n.top=Math.min(null!==(a=n.top)&&void 0!==a?a:1/0,d.top),n.right=Math.max(null!==(r=n.right)&&void 0!==r?r:-1/0,d.right),n.bottom=Math.max(null!==(l=n.bottom)&&void 0!==l?l:-1/0,d.bottom)}})),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var Je="Sortable"+(new Date).getTime();function Ve(){var t,e=[];return{captureAnimationState:function(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(t){if("none"!==Pe(t,"display")&&t!==$i.ghost){e.push({target:t,rect:Ee(t)});var i=re({},e[e.length-1].rect);if(t.thisAnimationDuration){var n=xe(t,!0);n&&(i.top-=n.f,i.left-=n.e)}t.fromRect=i}}))},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var i in t)if(t.hasOwnProperty(i))for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[i][n])return Number(i);return-1}(e,{target:t}),1)},animateAll:function(i){var n=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof i&&i());var o=!1,s=0;e.forEach((function(t){var e=0,i=t.target,a=i.fromRect,r=Ee(i),l=i.prevFromRect,d=i.prevToRect,u=t.rect,c=xe(i,!0);c&&(r.top-=c.f,r.left-=c.e),i.toRect=r,i.thisAnimationDuration&&Ne(l,r)&&!Ne(a,r)&&(u.top-r.top)/(u.left-r.left)==(a.top-r.top)/(a.left-r.left)&&(e=function(t,e,i,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*n.animation}(u,l,d,n.options)),Ne(r,a)||(i.prevFromRect=a,i.prevToRect=r,e||(e=n.options.animation),n.animate(i,u,r,e)),e&&(o=!0,s=Math.max(s,e),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),e),i.thisAnimationDuration=e)})),clearTimeout(t),o?t=setTimeout((function(){"function"==typeof i&&i()}),s):"function"==typeof i&&i(),e=[]},animate:function(t,e,i,n){if(n){Pe(t,"transition",""),Pe(t,"transform","");var o=xe(this.el),s=o&&o.a,a=o&&o.d,r=(e.left-i.left)/(s||1),l=(e.top-i.top)/(a||1);t.animatingX=!!r,t.animatingY=!!l,Pe(t,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(t){return t.offsetWidth}(t),Pe(t,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),Pe(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout((function(){Pe(t,"transition",""),Pe(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1}),n)}}}}var ze=[],Xe={initializeByDefault:!0},qe={mount:function(t){for(var e in Xe)Xe.hasOwnProperty(e)&&!(e in t)&&(t[e]=Xe[e]);ze.forEach((function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")})),ze.push(t)},pluginEvent:function(t,e,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var o=t+"Global";ze.forEach((function(n){e[n.pluginName]&&(e[n.pluginName][o]&&e[n.pluginName][o](re({sortable:e},i)),e.options[n.pluginName]&&e[n.pluginName][t]&&e[n.pluginName][t](re({sortable:e},i)))}))},initializePlugins:function(t,e,i,n){for(var o in ze.forEach((function(n){var o=n.pluginName;if(t.options[o]||n.initializeByDefault){var s=new n(t,e,t.options);s.sortable=t,s.options=t.options,t[o]=s,ue(i,s.defaults)}})),t.options)if(t.options.hasOwnProperty(o)){var s=this.modifyOption(t,o,t.options[o]);void 0!==s&&(t.options[o]=s)}},getEventProperties:function(t,e){var i={};return ze.forEach((function(n){"function"==typeof n.eventProperties&&ue(i,n.eventProperties.call(e[n.pluginName],t))})),i},modifyOption:function(t,e,i){var n;return ze.forEach((function(o){t[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[e]&&(n=o.optionListeners[e].call(t[o.pluginName],i))})),n}};var Ge=["evt"],Ye=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.evt,o=ce(i,Ge);qe.pluginEvent.bind($i)(t,e,re({dragEl:Ke,parentEl:Ze,ghostEl:ti,rootEl:ei,nextEl:ii,lastDownEl:ni,cloneEl:oi,cloneHidden:si,dragStarted:fi,putSortable:ci,activeSortable:$i.active,originalEvent:n,oldIndex:ai,oldDraggableIndex:li,newIndex:ri,newDraggableIndex:di,hideGhostForTarget:Ui,unhideGhostForTarget:Ni,cloneNowHidden:function(){si=!0},cloneNowShown:function(){si=!1},dispatchSortableEvent:function(t){Qe({sortable:e,name:t,originalEvent:n})}},o))};function Qe(t){!function(t){var e=t.sortable,i=t.rootEl,n=t.name,o=t.targetEl,s=t.cloneEl,a=t.toEl,r=t.fromEl,l=t.oldIndex,d=t.newIndex,u=t.oldDraggableIndex,c=t.newDraggableIndex,p=t.originalEvent,h=t.putSortable,m=t.extraEventProperties;if(e=e||i&&i[Je]){var y,g=e.options,_="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||he||me?(y=document.createEvent("Event")).initEvent(n,!0,!0):y=new CustomEvent(n,{bubbles:!0,cancelable:!0}),y.to=a||i,y.from=r||i,y.item=o||i,y.clone=s,y.oldIndex=l,y.newIndex=d,y.oldDraggableIndex=u,y.newDraggableIndex=c,y.originalEvent=p,y.pullMode=h?h.lastPutMode:void 0;var f=re(re({},m),qe.getEventProperties(n,e));for(var v in f)y[v]=f[v];i&&i.dispatchEvent(y),g[_]&&g[_].call(e,y)}}(re({putSortable:ci,cloneEl:oi,targetEl:Ke,rootEl:ei,oldIndex:ai,oldDraggableIndex:li,newIndex:ri,newDraggableIndex:di},t))}var Ke,Ze,ti,ei,ii,ni,oi,si,ai,ri,li,di,ui,ci,pi,hi,mi,yi,gi,_i,fi,vi,wi,Ii,Si,bi=!1,Ti=!1,Li=[],ki=!1,Ci=!1,Pi=[],xi=!1,Ai=[],Di="undefined"!=typeof document,Ei=_e,Mi=me||he?"cssFloat":"float",Ri=Di&&!fe&&!_e&&"draggable"in document.createElement("div"),Oi=function(){if(Di){if(he)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),Bi=function(t,e){var i=Pe(t),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=Re(t,0,e),s=Re(t,1,e),a=o&&Pe(o),r=s&&Pe(s),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Ee(o).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Ee(s).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&"none"!==a.float){var u="left"===a.float?"left":"right";return!s||"both"!==r.clear&&r.clear!==u?"horizontal":"vertical"}return o&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||l>=n&&"none"===i[Mi]||s&&"none"===i[Mi]&&l+d>n)?"vertical":"horizontal"},ji=function(t){function e(t,i){return function(n,o,s,a){var r=n.options.group.name&&o.options.group.name&&n.options.group.name===o.options.group.name;if(null==t&&(i||r))return!0;if(null==t||!1===t)return!1;if(i&&"clone"===t)return t;if("function"==typeof t)return e(t(n,o,s,a),i)(n,o,s,a);var l=(i?n:o).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var i={},n=t.group;(!n||"object"!=le(n))&&(n={name:n}),i.name=n.name,i.checkPull=e(n.pull,!0),i.checkPut=e(n.put),i.revertClone=n.revertClone,t.group=i},Ui=function(){!Oi&&ti&&Pe(ti,"display","none")},Ni=function(){!Oi&&ti&&Pe(ti,"display","")};Di&&!fe&&document.addEventListener("click",(function(t){if(Ti)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Ti=!1,!1}),!0);var Fi=function(t){if(Ke){var e=function(t,e){var i;return Li.some((function(n){var o=n[Je].options.emptyInsertThreshold;if(o&&!Oe(n)){var s=Ee(n),a=t>=s.left-o&&t<=s.right+o,r=e>=s.top-o&&e<=s.bottom+o;if(a&&r)return i=n}})),i}((t=t.touches?t.touches[0]:t).clientX,t.clientY);if(e){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[Je]._onDragOver(i)}}},Hi=function(t){Ke&&Ke.parentNode[Je]._isOutsideThisEl(t.target)};function $i(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=ue({},e),t[Je]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Bi(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==$i.supportPointer&&"PointerEvent"in window&&!ge,emptyInsertThreshold:5};for(var n in qe.initializePlugins(this,t,i),i)!(n in e)&&(e[n]=i[n]);for(var o in ji(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Ri,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?we(t,"pointerdown",this._onTapStart):(we(t,"mousedown",this._onTapStart),we(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(we(t,"dragover",this),we(t,"dragenter",this)),Li.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ue(this,Ve())}function Wi(t,e,i,n,o,s,a,r){var l,d,u=t[Je],c=u.options.onMove;return!window.CustomEvent||he||me?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=i,l.draggedRect=n,l.related=o||e,l.relatedRect=s||Ee(e),l.willInsertAfter=r,l.originalEvent=a,t.dispatchEvent(l),c&&(d=c.call(u,l,a)),d}function Ji(t){t.draggable=!1}function Vi(){xi=!1}function zi(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,n=0;i--;)n+=e.charCodeAt(i);return n.toString(36)}function Xi(t){return setTimeout(t,0)}function qi(t){return clearTimeout(t)}$i.prototype={constructor:$i,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(vi=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,Ke):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,n=this.options,o=n.preventOnFilter,s=t.type,a=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,r=(a||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||r,d=n.filter;if(function(t){Ai.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var n=e[i];n.checked&&Ai.push(n)}}(i),!Ke&&!(/mousedown|pointerdown/.test(s)&&0!==t.button||n.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!ge||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=Te(r,n.draggable,i,!1))&&r.animated||ni===r)){if(ai=Be(r),li=Be(r,n.draggable),"function"==typeof d){if(d.call(this,t,r,this))return Qe({sortable:e,rootEl:l,name:"filter",targetEl:r,toEl:i,fromEl:i}),Ye("filter",e,{evt:t}),void(o&&t.cancelable&&t.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=Te(l,n.trim(),i,!1))return Qe({sortable:e,rootEl:n,name:"filter",targetEl:r,fromEl:i,toEl:i}),Ye("filter",e,{evt:t}),!0}))))return void(o&&t.cancelable&&t.preventDefault());n.handle&&!Te(l,n.handle,i,!1)||this._prepareDragStart(t,a,r)}}},_prepareDragStart:function(t,e,i){var n,o=this,s=o.el,a=o.options,r=s.ownerDocument;if(i&&!Ke&&i.parentNode===s){var l=Ee(i);if(ei=s,Ze=(Ke=i).parentNode,ii=Ke.nextSibling,ni=i,ui=a.group,$i.dragged=Ke,pi={target:Ke,clientX:(e||t).clientX,clientY:(e||t).clientY},gi=pi.clientX-l.left,_i=pi.clientY-l.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,Ke.style["will-change"]="all",n=function(){Ye("delayEnded",o,{evt:t}),$i.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!ye&&o.nativeDraggable&&(Ke.draggable=!0),o._triggerDragStart(t,e),Qe({sortable:o,name:"choose",originalEvent:t}),Ce(Ke,a.chosenClass,!0))},a.ignore.split(",").forEach((function(t){Ae(Ke,t.trim(),Ji)})),we(r,"dragover",Fi),we(r,"mousemove",Fi),we(r,"touchmove",Fi),we(r,"mouseup",o._onDrop),we(r,"touchend",o._onDrop),we(r,"touchcancel",o._onDrop),ye&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ke.draggable=!0),Ye("delayStart",this,{evt:t}),!a.delay||a.delayOnTouchOnly&&!e||this.nativeDraggable&&(me||he))n();else{if($i.eventCanceled)return void this._onDrop();we(r,"mouseup",o._disableDelayedDrag),we(r,"touchend",o._disableDelayedDrag),we(r,"touchcancel",o._disableDelayedDrag),we(r,"mousemove",o._delayedDragTouchMoveHandler),we(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&we(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(n,a.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ke&&Ji(Ke),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;Ie(t,"mouseup",this._disableDelayedDrag),Ie(t,"touchend",this._disableDelayedDrag),Ie(t,"touchcancel",this._disableDelayedDrag),Ie(t,"mousemove",this._delayedDragTouchMoveHandler),Ie(t,"touchmove",this._delayedDragTouchMoveHandler),Ie(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?we(document,"pointermove",this._onTouchMove):we(document,e?"touchmove":"mousemove",this._onTouchMove):(we(Ke,"dragend",this),we(ei,"dragstart",this._onDragStart));try{document.selection?Xi((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(i){}},_dragStarted:function(t,e){if(bi=!1,ei&&Ke){Ye("dragStarted",this,{evt:e}),this.nativeDraggable&&we(document,"dragover",Hi);var i=this.options;!t&&Ce(Ke,i.dragClass,!1),Ce(Ke,i.ghostClass,!0),$i.active=this,t&&this._appendGhost(),Qe({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(hi){this._lastX=hi.clientX,this._lastY=hi.clientY,Ui();for(var t=document.elementFromPoint(hi.clientX,hi.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(hi.clientX,hi.clientY))!==e;)e=t;if(Ke.parentNode[Je]._isOutsideThisEl(t),e)do{if(e[Je]){if(e[Je]._onDragOver({clientX:hi.clientX,clientY:hi.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);Ni()}},_onTouchMove:function(t){if(pi){var e=this.options,i=e.fallbackTolerance,n=e.fallbackOffset,o=t.touches?t.touches[0]:t,s=ti&&xe(ti,!0),a=ti&&s&&s.a,r=ti&&s&&s.d,l=Ei&&Si&&je(Si),d=(o.clientX-pi.clientX+n.x)/(a||1)+(l?l[0]-Pi[0]:0)/(a||1),u=(o.clientY-pi.clientY+n.y)/(r||1)+(l?l[1]-Pi[1]:0)/(r||1);if(!$i.active&&!bi){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(ti){s?(s.e+=d-(mi||0),s.f+=u-(yi||0)):s={a:1,b:0,c:0,d:1,e:d,f:u};var c="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");Pe(ti,"webkitTransform",c),Pe(ti,"mozTransform",c),Pe(ti,"msTransform",c),Pe(ti,"transform",c),mi=d,yi=u,hi=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!ti){var t=this.options.fallbackOnBody?document.body:ei,e=Ee(Ke,!0,Ei,!0,t),i=this.options;if(Ei){for(Si=t;"static"===Pe(Si,"position")&&"none"===Pe(Si,"transform")&&Si!==document;)Si=Si.parentNode;Si!==document.body&&Si!==document.documentElement?(Si===document&&(Si=De()),e.top+=Si.scrollTop,e.left+=Si.scrollLeft):Si=De(),Pi=je(Si)}Ce(ti=Ke.cloneNode(!0),i.ghostClass,!1),Ce(ti,i.fallbackClass,!0),Ce(ti,i.dragClass,!0),Pe(ti,"transition",""),Pe(ti,"transform",""),Pe(ti,"box-sizing","border-box"),Pe(ti,"margin",0),Pe(ti,"top",e.top),Pe(ti,"left",e.left),Pe(ti,"width",e.width),Pe(ti,"height",e.height),Pe(ti,"opacity","0.8"),Pe(ti,"position",Ei?"absolute":"fixed"),Pe(ti,"zIndex","100000"),Pe(ti,"pointerEvents","none"),$i.ghost=ti,t.appendChild(ti),Pe(ti,"transform-origin",gi/parseInt(ti.style.width)*100+"% "+_i/parseInt(ti.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,n=t.dataTransfer,o=i.options;Ye("dragStart",this,{evt:t}),$i.eventCanceled?this._onDrop():(Ye("setupClone",this),$i.eventCanceled||((oi=$e(Ke)).removeAttribute("id"),oi.draggable=!1,oi.style["will-change"]="",this._hideClone(),Ce(oi,this.options.chosenClass,!1),$i.clone=oi),i.cloneId=Xi((function(){Ye("clone",i),!$i.eventCanceled&&(i.options.removeCloneOnHide||ei.insertBefore(oi,Ke),i._hideClone(),Qe({sortable:i,name:"clone"}))})),!e&&Ce(Ke,o.dragClass,!0),e?(Ti=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Ie(document,"mouseup",i._onDrop),Ie(document,"touchend",i._onDrop),Ie(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(i,n,Ke)),we(document,"drop",i),Pe(Ke,"transform","translateZ(0)")),bi=!0,i._dragStartId=Xi(i._dragStarted.bind(i,e,t)),we(document,"selectstart",i),fi=!0,ge&&Pe(document.body,"user-select","none"))},_onDragOver:function(t){var e,i,n,o,s=this.el,a=t.target,r=this.options,l=r.group,d=$i.active,u=ui===l,c=r.sort,p=ci||d,h=this,m=!1;if(!xi){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),a=Te(a,r.draggable,s,!0),x("dragOver"),$i.eventCanceled)return m;if(Ke.contains(t.target)||a.animated&&a.animatingX&&a.animatingY||h._ignoreWhileAnimating===a)return D(!1);if(Ti=!1,d&&!r.disabled&&(u?c||(n=Ze!==ei):ci===this||(this.lastPutMode=ui.checkPull(this,d,Ke,t))&&l.checkPut(this,d,Ke,t))){if(o="vertical"===this._getDirection(t,a),e=Ee(Ke),x("dragOverValid"),$i.eventCanceled)return m;if(n)return Ze=ei,A(),this._hideClone(),x("revert"),$i.eventCanceled||(ii?ei.insertBefore(Ke,ii):ei.appendChild(Ke)),D(!0);var y=Oe(s,r.draggable);if(!y||function(t,e,i){var n=Ee(Oe(i.el,i.options.draggable)),o=We(i.el,i.options,ti),s=10;return e?t.clientX>o.right+s||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>o.bottom+s||t.clientX>n.right&&t.clientY>n.top}(t,o,this)&&!y.animated){if(y===Ke)return D(!1);if(y&&s===t.target&&(a=y),a&&(i=Ee(a)),!1!==Wi(ei,s,Ke,e,a,i,t,!!a))return A(),y&&y.nextSibling?s.insertBefore(Ke,y.nextSibling):s.appendChild(Ke),Ze=s,E(),D(!0)}else if(y&&function(t,e,i){var n=Ee(Re(i.el,0,i.options,!0)),o=We(i.el,i.options,ti),s=10;return e?t.clientX<o.left-s||t.clientY<n.top&&t.clientX<n.right:t.clientY<o.top-s||t.clientY<n.bottom&&t.clientX<n.left}(t,o,this)){var g=Re(s,0,r,!0);if(g===Ke)return D(!1);if(i=Ee(a=g),!1!==Wi(ei,s,Ke,e,a,i,t,!1))return A(),s.insertBefore(Ke,g),Ze=s,E(),D(!0)}else if(a.parentNode===s){i=Ee(a);var _,f,v,w=Ke.parentNode!==s,I=!function(t,e,i){var n=i?t.left:t.top,o=i?t.right:t.bottom,s=i?t.width:t.height,a=i?e.left:e.top,r=i?e.right:e.bottom,l=i?e.width:e.height;return n===a||o===r||n+s/2===a+l/2}(Ke.animated&&Ke.toRect||e,a.animated&&a.toRect||i,o),S=o?"top":"left",b=Me(a,"top","top")||Me(Ke,"top","top"),T=b?b.scrollTop:void 0;if(vi!==a&&(f=i[S],ki=!1,Ci=!I&&r.invertSwap||w),_=function(t,e,i,n,o,s,a,r){var l=n?t.clientY:t.clientX,d=n?i.height:i.width,u=n?i.top:i.left,c=n?i.bottom:i.right,p=!1;if(!a)if(r&&Ii<d*o){if(!ki&&(1===wi?l>u+d*s/2:l<c-d*s/2)&&(ki=!0),ki)p=!0;else if(1===wi?l<u+Ii:l>c-Ii)return-wi}else if(l>u+d*(1-o)/2&&l<c-d*(1-o)/2)return function(t){return Be(Ke)<Be(t)?1:-1}(e);return p=p||a,p&&(l<u+d*s/2||l>c-d*s/2)?l>u+d/2?1:-1:0}(t,a,i,o,I?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,Ci,vi===a),0!==_){var L=Be(Ke);do{L-=_,v=Ze.children[L]}while(v&&("none"===Pe(v,"display")||v===ti))}if(0===_||v===a)return D(!1);vi=a,wi=_;var k=a.nextElementSibling,C=!1,P=Wi(ei,s,Ke,e,a,i,t,C=1===_);if(!1!==P)return(1===P||-1===P)&&(C=1===P),xi=!0,setTimeout(Vi,30),A(),C&&!k?s.appendChild(Ke):a.parentNode.insertBefore(Ke,C?k:a),b&&He(b,0,T-b.scrollTop),Ze=Ke.parentNode,void 0!==f&&!Ci&&(Ii=Math.abs(f-Ee(a)[S])),E(),D(!0)}if(s.contains(Ke))return D(!1)}return!1}function x(r,l){Ye(r,h,re({evt:t,isOwner:u,axis:o?"vertical":"horizontal",revert:n,dragRect:e,targetRect:i,canSort:c,fromSortable:p,target:a,completed:D,onMove:function(i,n){return Wi(ei,s,Ke,e,i,Ee(i),t,n)},changed:E},l))}function A(){x("dragOverAnimationCapture"),h.captureAnimationState(),h!==p&&p.captureAnimationState()}function D(e){return x("dragOverCompleted",{insertion:e}),e&&(u?d._hideClone():d._showClone(h),h!==p&&(Ce(Ke,ci?ci.options.ghostClass:d.options.ghostClass,!1),Ce(Ke,r.ghostClass,!0)),ci!==h&&h!==$i.active?ci=h:h===$i.active&&ci&&(ci=null),p===h&&(h._ignoreWhileAnimating=a),h.animateAll((function(){x("dragOverAnimationComplete"),h._ignoreWhileAnimating=null})),h!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(a===Ke&&!Ke.animated||a===s&&!a.animated)&&(vi=null),!r.dragoverBubble&&!t.rootEl&&a!==document&&(Ke.parentNode[Je]._isOutsideThisEl(t.target),!e&&Fi(t)),!r.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),m=!0}function E(){ri=Be(Ke),di=Be(Ke,r.draggable),Qe({sortable:h,name:"change",toEl:s,newIndex:ri,newDraggableIndex:di,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Ie(document,"mousemove",this._onTouchMove),Ie(document,"touchmove",this._onTouchMove),Ie(document,"pointermove",this._onTouchMove),Ie(document,"dragover",Fi),Ie(document,"mousemove",Fi),Ie(document,"touchmove",Fi)},_offUpEvents:function(){var t=this.el.ownerDocument;Ie(t,"mouseup",this._onDrop),Ie(t,"touchend",this._onDrop),Ie(t,"pointerup",this._onDrop),Ie(t,"touchcancel",this._onDrop),Ie(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;ri=Be(Ke),di=Be(Ke,i.draggable),Ye("drop",this,{evt:t}),Ze=Ke&&Ke.parentNode,ri=Be(Ke),di=Be(Ke,i.draggable),$i.eventCanceled||(bi=!1,Ci=!1,ki=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),qi(this.cloneId),qi(this._dragStartId),this.nativeDraggable&&(Ie(document,"drop",this),Ie(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ge&&Pe(document.body,"user-select",""),Pe(Ke,"transform",""),t&&(fi&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),ti&&ti.parentNode&&ti.parentNode.removeChild(ti),(ei===Ze||ci&&"clone"!==ci.lastPutMode)&&oi&&oi.parentNode&&oi.parentNode.removeChild(oi),Ke&&(this.nativeDraggable&&Ie(Ke,"dragend",this),Ji(Ke),Ke.style["will-change"]="",fi&&!bi&&Ce(Ke,ci?ci.options.ghostClass:this.options.ghostClass,!1),Ce(Ke,this.options.chosenClass,!1),Qe({sortable:this,name:"unchoose",toEl:Ze,newIndex:null,newDraggableIndex:null,originalEvent:t}),ei!==Ze?(ri>=0&&(Qe({rootEl:Ze,name:"add",toEl:Ze,fromEl:ei,originalEvent:t}),Qe({sortable:this,name:"remove",toEl:Ze,originalEvent:t}),Qe({rootEl:Ze,name:"sort",toEl:Ze,fromEl:ei,originalEvent:t}),Qe({sortable:this,name:"sort",toEl:Ze,originalEvent:t})),ci&&ci.save()):ri!==ai&&ri>=0&&(Qe({sortable:this,name:"update",toEl:Ze,originalEvent:t}),Qe({sortable:this,name:"sort",toEl:Ze,originalEvent:t})),$i.active&&((null==ri||-1===ri)&&(ri=ai,di=li),Qe({sortable:this,name:"end",toEl:Ze,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){Ye("nulling",this),ei=Ke=Ze=ti=ii=oi=ni=si=pi=hi=fi=ri=di=ai=li=vi=wi=ci=ui=$i.dragged=$i.ghost=$i.clone=$i.active=null,Ai.forEach((function(t){t.checked=!0})),Ai.length=mi=yi=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":Ke&&(this._onDragOver(t),(e=t).dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault());break;case"selectstart":t.preventDefault()}var e},toArray:function(){for(var t,e=[],i=this.el.children,n=0,o=i.length,s=this.options;n<o;n++)Te(t=i[n],s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||zi(t));return e},sort:function(t,e){var i={},n=this.el;this.toArray().forEach((function(t,e){var o=n.children[e];Te(o,this.options.draggable,n,!1)&&(i[t]=o)}),this),e&&this.captureAnimationState(),t.forEach((function(t){i[t]&&(n.removeChild(i[t]),n.appendChild(i[t]))})),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return Te(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(void 0===e)return i[t];var n=qe.modifyOption(this,t,e);i[t]=void 0!==n?n:e,"group"===t&&ji(i)},destroy:function(){Ye("destroy",this);var t=this.el;t[Je]=null,Ie(t,"mousedown",this._onTapStart),Ie(t,"touchstart",this._onTapStart),Ie(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(Ie(t,"dragover",this),Ie(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Li.splice(Li.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!si){if(Ye("hideClone",this),$i.eventCanceled)return;Pe(oi,"display","none"),this.options.removeCloneOnHide&&oi.parentNode&&oi.parentNode.removeChild(oi),si=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(si){if(Ye("showClone",this),$i.eventCanceled)return;Ke.parentNode!=ei||this.options.group.revertClone?ii?ei.insertBefore(oi,ii):ei.appendChild(oi):ei.insertBefore(oi,Ke),this.options.group.revertClone&&this.animate(Ke,oi),Pe(oi,"display",""),si=!1}}else this._hideClone()}},Di&&we(document,"touchmove",(function(t){($i.active||bi)&&t.cancelable&&t.preventDefault()})),$i.utils={on:we,off:Ie,css:Pe,find:Ae,is:function(t,e){return!!Te(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},throttle:Fe,closest:Te,toggleClass:Ce,clone:$e,index:Be,nextTick:Xi,cancelNextTick:qi,detectDirection:Bi,getChild:Re},$i.get=function(t){return t[Je]},$i.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&($i.utils=re(re({},$i.utils),t.utils)),qe.mount(t)}))},$i.create=function(t,e){return new $i(t,e)},$i.version="1.15.2";var Gi,Yi,Qi,Ki,Zi,tn,en=[],nn=!1;function on(){en.forEach((function(t){clearInterval(t.pid)})),en=[]}function sn(){clearInterval(tn)}var an=Fe((function(t,e,i,n){if(e.scroll){var o,s=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,l=e.scrollSpeed,d=De(),u=!1;Yi!==i&&(Yi=i,on(),Gi=e.scroll,o=e.scrollFn,!0===Gi&&(Gi=Ue(i,!0)));var c=0,p=Gi;do{var h=p,m=Ee(h),y=m.top,g=m.bottom,_=m.left,f=m.right,v=m.width,w=m.height,I=void 0,S=void 0,b=h.scrollWidth,T=h.scrollHeight,L=Pe(h),k=h.scrollLeft,C=h.scrollTop;h===d?(I=v<b&&("auto"===L.overflowX||"scroll"===L.overflowX||"visible"===L.overflowX),S=w<T&&("auto"===L.overflowY||"scroll"===L.overflowY||"visible"===L.overflowY)):(I=v<b&&("auto"===L.overflowX||"scroll"===L.overflowX),S=w<T&&("auto"===L.overflowY||"scroll"===L.overflowY));var P=I&&(Math.abs(f-s)<=r&&k+v<b)-(Math.abs(_-s)<=r&&!!k),x=S&&(Math.abs(g-a)<=r&&C+w<T)-(Math.abs(y-a)<=r&&!!C);if(!en[c])for(var A=0;A<=c;A++)en[A]||(en[A]={});(en[c].vx!=P||en[c].vy!=x||en[c].el!==h)&&(en[c].el=h,en[c].vx=P,en[c].vy=x,clearInterval(en[c].pid),(0!=P||0!=x)&&(u=!0,en[c].pid=setInterval(function(){n&&0===this.layer&&$i.active._onTouchMove(Zi);var e=en[this.layer].vy?en[this.layer].vy*l:0,i=en[this.layer].vx?en[this.layer].vx*l:0;"function"==typeof o&&"continue"!==o.call($i.dragged.parentNode[Je],i,e,t,Zi,en[this.layer].el)||He(en[this.layer].el,i,e)}.bind({layer:c}),24))),c++}while(e.bubbleScroll&&p!==d&&(p=Ue(p,!1)));nn=u}}),30),rn=function(t){var e=t.originalEvent,i=t.putSortable,n=t.dragEl,o=t.activeSortable,s=t.dispatchSortableEvent,a=t.hideGhostForTarget,r=t.unhideGhostForTarget;if(e){var l=i||o;a();var d=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(d.clientX,d.clientY);r(),l&&!l.el.contains(u)&&(s("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function ln(){}function dn(){}function un(t){return null==t?t:JSON.parse(JSON.stringify(t))}ln.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=Re(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:rn},ue(ln,{pluginName:"revertOnSpill"}),dn.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable||this.sortable;i.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),i.animateAll()},drop:rn},ue(dn,{pluginName:"removeOnSpill"}),$i.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?we(document,"dragover",this._handleAutoScroll):this.options.supportPointer?we(document,"pointermove",this._handleFallbackAutoScroll):e.touches?we(document,"touchmove",this._handleFallbackAutoScroll):we(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;!this.options.dragOverBubble&&!e.rootEl&&this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?Ie(document,"dragover",this._handleAutoScroll):(Ie(document,"pointermove",this._handleFallbackAutoScroll),Ie(document,"touchmove",this._handleFallbackAutoScroll),Ie(document,"mousemove",this._handleFallbackAutoScroll)),sn(),on(),clearTimeout(Le),Le=void 0},nulling:function(){Zi=Yi=Gi=nn=tn=Qi=Ki=null,en.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var i=this,n=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,s=document.elementFromPoint(n,o);if(Zi=t,e||this.options.forceAutoScrollFallback||me||he||ge){an(t,this.options,s,e);var a=Ue(s,!0);nn&&(!tn||n!==Qi||o!==Ki)&&(tn&&sn(),tn=setInterval((function(){var s=Ue(document.elementFromPoint(n,o),!0);s!==a&&(a=s,on()),an(t,i.options,s,e)}),10),Qi=n,Ki=o)}else{if(!this.options.bubbleScroll||Ue(s,!0)===De())return void on();an(t,this.options,Ue(s,!1),!1)}}},ue(t,{pluginName:"scroll",initializeByDefault:!0})}),$i.mount(dn,ln);let cn=null,pn=null;function hn(t=null,e=null){cn=t,pn=e}const mn=Symbol("cloneElement");function yn(...t){var e,i;const n=null==(e=Ut())?void 0:e.proxy,o=t[0];let[,s,a]=t;Array.isArray(Nt(s))||(a=s,s=null);let r=null;const{immediate:l=!0,clone:d=un,customUpdate:u}=null!=(i=Nt(a))?i:{};const c={onUpdate:function(t){if(u)return void u(t);const{from:e,item:i,oldIndex:n,newIndex:o}=t;if(ie(i),ee(e,i,n),Jt(s)){const t=[...Nt(s)];s.value=Kt(t,n,o)}else Kt(Nt(s),n,o)},onStart:function(t){var e;const i=Nt(null==(e=Nt(s))?void 0:e[t.oldIndex]),n=d(i);hn(i,n),t.item[mn]=n},onAdd:function(t){const e=t.item[mn];if(!function(t){return void 0===t}(e)){if(ie(t.item),Jt(s)){const i=[...Nt(s)];return void(s.value=te(i,t.newDraggableIndex,e))}te(Nt(s),t.newDraggableIndex,e)}},onRemove:function(t){const{from:e,item:i,oldIndex:n,oldDraggableIndex:o,pullMode:a,clone:r}=t;if(ee(e,i,n),"clone"!==a)if(Jt(s)){const t=[...Nt(s)];s.value=Zt(t,o)}else Zt(Nt(s),o);else ie(r)},onEnd:function(){Wt((()=>{hn()}))}};function p(t){const e=Nt(o);return t||(t=function(t){return"string"==typeof t}(e)?ne(e,null==n?void 0:n.$el):e),t&&!function(t){return t instanceof HTMLElement}(t)&&(t=t.$el),t||function(t){console.error(Qt+t)}("Root element not found"),t}function h(){var t;const e=null!=(t=Nt(a))?t:{},i=jt(e,["immediate","clone"]);return oe(i,((t,e)=>{(function(t){return 111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97)})(t)&&(i[t]=(t,...i)=>(se(t,{data:cn,clonedData:pn}),e(t,...i)))})),function(t,e){const i=Bt({},t);return Object.keys(e).forEach((n=>{i[n]?i[n]=function(t,e,i=null){return function(...n){return t.apply(i,n),e.apply(i,n)}}(t[n],e[n]):i[n]=e[n]})),i}(null===s?{}:c,i)}const m=t=>{t=p(t),r&&y.destroy(),r=new $i(t,h())};Ft((()=>a),(()=>{r&&oe(h(),((t,e)=>{null==r||r.option(t,e)}))}),{deep:!0});const y={option:(t,e)=>null==r?void 0:r.option(t,e),destroy:()=>{null==r||r.destroy(),r=null},save:()=>null==r?void 0:r.save(),toArray:()=>null==r?void 0:r.toArray(),closest:(...t)=>null==r?void 0:r.closest(...t)};return function(t){Ut()?$t(t):Wt(t)}((()=>{l&&m()})),function(t){Ut()&&Ht(t)}(y.destroy),Bt({start:m,pause:()=>null==y?void 0:y.option("disabled",!0),resume:()=>null==y?void 0:y.option("disabled",!1)},y)}const gn=["update","start","add","remove","choose","unchoose","end","sort","filter","clone","move","change"],_n=Vt({name:"VueDraggable",model:{prop:"modelValue",event:"update:modelValue"},props:["clone","animation","ghostClass","group","sort","disabled","store","handle","draggable","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","chosenClass","dragClass","ignore","filter","preventOnFilter","easing","setData","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","emptyInsertThreshold","scroll","forceAutoScrollFallback","scrollSensitivity","scrollSpeed","bubbleScroll","modelValue","tag","target","customUpdate",...gn.map((t=>"on".concat(t.replace(/^\S/,(t=>t.toUpperCase())))))],emits:["update:modelValue",...gn],setup(t,{slots:e,emit:i,expose:n,attrs:o}){const s=gn.reduce(((t,e)=>(t["on".concat(e.replace(/^\S/,(t=>t.toUpperCase())))]=(...t)=>i(e,...t),t)),{}),a=zt((()=>{const e=Xt(t),i=jt(e,["modelValue"]),n=Object.entries(i).reduce(((t,[e,i])=>{const n=Nt(i);return void 0!==n&&(t[e]=n),t}),{});return Bt(Bt({},s),function(t){return Object.keys(t).reduce(((e,i)=>(void 0!==t[i]&&(e[function(t){return t.replace(/-(\w)/g,((t,e)=>e?e.toUpperCase():""))}(i)]=t[i]),e)),{})}(Bt(Bt({},o),n)))})),r=zt({get:()=>t.modelValue,set:t=>i("update:modelValue",t)}),l=qt(),d=Gt(yn(t.target||l,r,a));return n(d),()=>{var i;return Yt(t.tag||"div",{ref:l},null==(i=null==e?void 0:e.default)?void 0:i.call(e,d))}}});const fn=P({props:{show:{type:Boolean,default:!1},tipsWording:{type:String,default:""}},model:{prop:"show",event:"change"},methods:{display(){this.$emit("change",!0)},hide(){this.$emit("change",!1)}}},(function(){var t=this;return(0,t._self._c)("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"tips",attrs:{role:"alert"}},[t._v(t._s(t.tipsWording))])}),[],!1,null,"e2eb5158",null,null).exports;const vn=P({props:{showBorder:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!1},title:{type:String,default:""}},data:()=>({needTopBarMask:!1}),watch:{title:{handler(){setTimeout((()=>this.checkMask()))},immediate:!0}},methods:{checkMask(){const t=this.$refs.ghostWrp,e=this.$refs.ghostTitle;this.needTopBarMask=!(!t||!e)&&t.offsetWidth<e.offsetWidth}}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"audio-panel__header",class:{border:t.showBorder},on:{click:function(e){return t.$emit("click")}}},[e("div",{staticClass:"audio-panel__header-close"},[e("div",{staticClass:"icon-close",attrs:{"aria-role":"button","aria-label":"关闭"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("close")}}})]),e("transition",{attrs:{name:"fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showTitle&&t.title,expression:"showTitle && title"}],staticClass:"audio-panel__playing-bar-wrp",class:{mask:t.needTopBarMask}},[e("div",{staticClass:"audio-panel__playing-bar"},[e("span",[t._v(t._s(t.title))])])])]),e("div",{staticClass:"audio-panel__playing-bar-wrp ghost",attrs:{"aria-hidden":"true"}},[e("div",{ref:"ghostWrp",staticClass:"audio-panel__playing-bar"},[e("span",{ref:"ghostTitle"},[t._v(t._s(t.title))])])]),e("div",{staticClass:"fullscreen-icon-wrp",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("fullscreen")}}},[e("div",{staticClass:"fullscreen-icon"})])],1)}),[],!1,null,"249ec9a9",null,null).exports;const wn=P({inject:["version","supportSetShutdown"],filters:{durationNumFormatter:t=>wt(t,2)},props:{show:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!1},hasSetShutDown:{type:Boolean,default:!1},hasInList:{type:Boolean,default:!1},playRate:{type:Number,default:1},duration:{type:Number,default:0},currentTime:{type:Number,default:0},supportListenLater:{type:Boolean,default:!1}},data:()=>({moving:!1}),computed:{playRateWording(){return 1!==this.playRate&&"number"==typeof this.playRate?100*this.playRate%10==0?"".concat(this.playRate.toFixed(1),"倍"):"".concat(this.playRate.toFixed(2),"倍"):"倍速"},percent(){return Math.max(Math.min(1,this.currentTime?1e3*this.currentTime/this.duration:0),0)}},methods:{onTouchStart(t){var e,i;t.pageX<20||!this.$refs.progress||(this.moving=!0,this.__rect=this.$refs.progress.getBoundingClientRect(),this.__startCurrentTime=this.currentTime,this.__startX=t.pageX||(null==(i=null==(e=t.changedTouches)?void 0:e[0])?void 0:i.pageX)||0,this.__startPercent=this.getTouchPercent(this.__startX,this.__rect),this.__nowPlaying=this.info,this.$emit("seek"),document.addEventListener("touchmove",this.onTouchMove,{capture:!0}),document.addEventListener("touchend",this.onTouchEnd,{capture:!0}))},onTouchMove(t){var e,i;if(!this.moving||!this.__rect)return;const n=t.pageX||(null==(i=null==(e=t.changedTouches)?void 0:e[0])?void 0:i.pageX)||0,o=this.getTouchPercent(n,this.__rect)-this.__startPercent,s=this.__startCurrentTime+this.duration*o/1e3;return this.$emit("seeking",s),t.preventDefault(),t.stopPropagation(),!1},onTouchEnd(t){var e,i;if(!this.moving||!this.__rect)return;const n=t.pageX||(null==(i=null==(e=t.changedTouches)?void 0:e[0])?void 0:i.pageX)||0,o=this.getTouchPercent(n,this.__rect)-this.__startPercent,s=this.__startCurrentTime+this.duration*o/1e3;return this.$emit("seeked",s),this.moving=!1,document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd),t.preventDefault(),t.stopPropagation(),!1},getTouchPercent:(t,e)=>Math.max(0,Math.min(1,(t-e.left)/e.width))}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-item__operate-area"},[e("div",{staticClass:"card-item__progress-bar-wrp",style:"--percent: ".concat(100*t.percent,"%")},[e("div",{ref:"progress",staticClass:"card-item__progress-bar",class:t.moving?"active":"",attrs:{role:"progressbar"}}),e("div",{staticClass:"card-item__progress-active-area js_wx_tap_highlight_exclude",attrs:{"aria-hidden":"true"},on:{"!touchstart":function(e){return e.stopPropagation(),e.preventDefault(),t.onTouchStart.apply(null,arguments)}}}),e("div",{staticClass:"card-item__time-info",class:t.moving?"active":""},[e("span",{attrs:{role:"timer"}},[t._v(t._s(t._f("durationNumFormatter")(1e3*t.currentTime||0)))]),t.duration&&t.currentTime?e("span",{attrs:{role:"timer"}},[t._v("-"+t._s(t._f("durationNumFormatter")(t.duration-1e3*t.currentTime)))]):t.duration?e("span",{attrs:{role:"timer"}},[t._v("-"+t._s(t._f("durationNumFormatter")(t.duration)))]):t._e()])]),e("div",{staticClass:"card-item__btn-wrp"},[t.supportListenLater?e("div",{directives:[{name:"show",rawName:"v-show",value:t.supportSetShutdown,expression:"supportSetShutdown"}],staticClass:"card-item__btn-group shutdown-group left"},[e("div",{staticClass:"card-item__btn-set-shutdown js_wx_tap_highlight",class:t.hasSetShutDown?"icon-set-shutdown-done":"icon-set-shutdown",attrs:{role:"button",tabindex:"0","aria-haspopup":"true","aria-label":"设置定时关闭"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(e=>t.$emit("set-shutdown",e.target,"right")).apply(null,arguments)}}})]):e("div",{staticClass:"card-item__btn-group rate-group left"},[e("div",{staticClass:"card-item__btn-playback-rate js_wx_tap_highlight",attrs:{role:"button",tabindex:"0"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(()=>t.$emit("change-rate")).apply(null,arguments)}}},[t._v(t._s(t.playRateWording))])]),e("div",{staticClass:"card-item__btn-group playing-group"},[e("div",{staticClass:"card-item__btn-back-15s js_wx_tap_highlight icon-play-backward",attrs:{role:"button",tabindex:"0","aria-label":"后退15秒"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(()=>t.$emit("backward")).apply(null,arguments)}}}),e("div",{staticClass:"card-item__btn-play js_wx_tap_highlight_exclude",class:t.isPlaying?"icon-pause":"icon-play",attrs:{role:"button",tabindex:"0","aria-label":t.isPlaying?"暂停":"播放"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(()=>t.$emit("toggle-play")).apply(null,arguments)}}}),e("div",{staticClass:"card-item__btn-forward-30s js_wx_tap_highlight icon-play-forward",attrs:{role:"button",tabindex:"0","aria-label":"前进30秒"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(()=>t.$emit("forward")).apply(null,arguments)}}})]),t.supportListenLater?e("div",{staticClass:"card-item__btn-group listen-later-group right"},[e("div",{staticClass:"card-item__btn-listen-later js_wx_tap_highlight",class:t.hasInList?"icon-correct":"icon-listen-later",attrs:{role:"button",tabindex:"0","aria-label":t.hasInList?"取消加入待播列表":"加入待播列表"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("listen-later")}}})]):t.supportSetShutdown?e("div",{staticClass:"card-item__btn-group shutdown-group right"},[e("div",{staticClass:"card-item__btn-set-shutdown js_wx_tap_highlight",class:t.hasSetShutDown?"icon-set-shutdown-done":"icon-set-shutdown",attrs:{role:"button",tabindex:"0","aria-haspopup":"true","aria-label":"设置定时关闭"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),(e=>t.$emit("set-shutdown",e.target)).apply(null,arguments)}}})]):t._e()])])}),[],!1,null,"de6e99d8",null,null).exports;const In=P({name:"audio-list-item",filters:{durationFormatter:t=>wt(t),durationNumFormatter:t=>wt(t,2)},components:{Progress:wn},inject:["version","supportSetShutdown"],props:{playing:{type:Boolean,default:!1},info:{type:Object,required:"required"},isPlaying:{type:Boolean,default:!1},playRate:{type:Number,default:1},hasSetShutDown:{type:Boolean,default:!1},needFinishState:{type:Boolean,default:!0},needPlayingMask:{type:Boolean,default:!0},needProcessingState:{type:Boolean,default:!0},highlight:{type:Boolean,default:!0}}},(function(){var t,e=this,i=e._self._c;return i("div",{staticClass:"card-item__wrp",class:{"now-playing":e.playing,"gray-active":-1!==[2,3].indexOf(e.version),"none-active":1===e.version,js_wx_tap_highlight:e.highlight},on:{click:()=>e.$emit("click")}},[i("div",{staticClass:"card-item__info-area"},[i("div",{staticClass:"card-item__cover",class:1===e.version||2===e.version&&!e.playing?"small-cover":"",style:"background-image: url(".concat(e.info.listen_item&&e.info.listen_item.cover,")"),attrs:{role:"figure"}},[1===e.version?i("div",{directives:[{name:"show",rawName:"v-show",value:e.playing&&e.needPlayingMask,expression:"playing && needPlayingMask"}],staticClass:"playing",class:{pause:!e.isPlaying}},[i("div",{staticClass:"dot1"}),i("div",{staticClass:"dot2"}),i("div",{staticClass:"dot3"}),i("div",{staticClass:"dot4"})]):e._e()]),e.info.listen_item?i("div",{staticClass:"card-item__info"},[i("div",{staticClass:"card-item__title",class:{"bold-title":(2===e.version||3===e.version)&&e.playing,"small-title":1===e.version}},[e._v(e._s((null==(t=e.info.listen_item.article_info)?void 0:t.audio_title)||e.info.listen_item.title))]),i("div",{staticClass:"card-item__desc"},[e._e(),e.info.listen_item.finder_info?i("div",{staticClass:"finder-icon"}):e._e(),i("span",[e._v(e._s(e.info.listen_item.author)+" ")]),2===e.version&&2===e.info.listen_item.tts_model_type?i("span",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}]},[e._v("作者音色朗读 ")]):2===e.version&&2!==e.info.listen_item.type?i("span",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}]},[e._v("音频由作者上传")]):e._e(),e.info.listen_item.duration&&(2!==e.version&&3!==e.version||!e.playing)?[e.needProcessingState&&e.info.currentTime&&e.info.currentTime<parseInt(e.info.listen_item.duration/1e3,10)?i("span",[e._v("剩余"+e._s(e._f("durationFormatter")(e.info.listen_item.duration-1e3*e.info.currentTime)))]):i("span",[e._v(e._s(e._f("durationNumFormatter")(e.info.listen_item.duration)))])]:e._e(),e.info.currentTime&&e.info.currentTime<parseInt(e.info.listen_item.duration/1e3,10)||!e.info.finished||!e.needFinishState?e._e():i("span",[e._v(" 已播完")])],2)]):e._e()]),2!==e.version&&3!==e.version||!e.playing?e._e():i("Progress",e._g({attrs:{"play-rate":e.playRate,"is-playing":e.isPlaying,"current-time":e.info.currentTime,"has-set-shut-down":e.hasSetShutDown,duration:e.info.listen_item.duration}},e.$listeners))],1)}),[],!1,null,"4556e2b1",null,null).exports;const Sn=P({props:{options:{type:Array,required:"required"},activeKey:{type:[Number,String],default:""},wrpStyle:{type:[Object,String],default:""},show:{type:Boolean,default:!1}},model:{prop:"show",event:"change"},data(){return{activeIndex:this.options.findIndex((t=>t.key===this.activeKey))}},computed:{varsStyle(){return Object.keys(this.wrpStyle).filter((t=>0===t.indexOf("--transform"))).reduce(((t,e)=>({...t,[e]:this.wrpStyle[e]})),{})}},watch:{activeKey(t){this.activeIndex=this.options.findIndex((e=>e.key===t))},show(t){t&&this.$refs.items&&this.$refs.items[0]&&this.$refs.items[0].focus()}},methods:{onClick(t){this.activeIndex=t,this.$emit("select",this.options[t]),this.$emit("change",!1)}}},(function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"option-menu__wrp",style:t.varsStyle,attrs:{role:"dialog","aria-modal":"true",tabindex:"0","aria-hidden":t.show?"false":"true"},on:{click:function(e){return e.target!==e.currentTarget?null:t.$emit("change",!1)}}},[e("span",{staticStyle:{display:"none"},attrs:{id:"js_a11y_set_shutdown_label_before","aria-hidden":"true"}},[t._v("设置定时关闭: ")]),e("div",{staticClass:"option-menu",style:t.wrpStyle},t._l(t.options,(function(i,n){return e("div",{key:i.key,ref:"items",refInFor:!0,staticClass:"option-item",class:t.activeIndex===n?"active":"",attrs:{id:"js_a11y_set_shutdown_label_".concat(n),role:"button",tabindex:"0","aria-labelledby":"js_a11y_set_shutdown_label_before js_a11y_set_shutdown_label_".concat(n)},on:{click:function(e){return t.onClick(n)}}},[e("span",[t._v(t._s(i.value))]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.activeIndex===n,expression:"activeIndex === index"}],staticClass:"weui-icon-checked"})])})),0)])])}),[],!1,null,"ba14a226",null,null).exports,bn=0,Tn=1,Ln=2,kn={[bn]:[Tn],[Tn]:[Ln,bn],[Ln]:[bn,Tn]};const Cn=P({props:{title:{type:String,default:""},disable:{type:Boolean,default:!1},v:{type:Number,default:40}},data:()=>({anime:null,needAnime:!1,state:bn}),watch:{title:{handler(){setTimeout((()=>this.checkAnime()))},immediate:!0}},created(){c.on("menu:setfont",(()=>this.checkAnime()))},methods:{checkDisable(){return!!this.disable&&(this.anime=null,this.needAnime=!1,this.state=bn,!0)},checkState(t){var e;return this.needAnime&&(null==(e=kn[this.state])?void 0:e.indexOf(t))>-1},checkAnime(){if(this.checkDisable())return;this.needAnime=!1,this.anime&&(this.anime.finish(),this.anime=null);const t=this.$refs.ghost,e=this.$refs.wrp;t&&e&&(this.needAnime=t.clientWidth>e.clientWidth)},onAnimeFinished(){this.anime=null,this.state=bn},play(){var t;const e=Tn;if(this.checkDisable())return;if(!this.checkState(e))return;const i=this.$refs.container;if(!i)return;if(this.state===Ln)return this.state=e,void(null==(t=this.anime)||t.play());const n=this.$refs.text.getBoundingClientRect().width,o=n/this.v*1e3;this.anime=i.animate([{offset:0,transform:"translate3d(0, 0, 1.1px)"},{offset:1,transform:"translate3d(-".concat(n,"px, 0, 1.1px)")}],{easing:"linear",duration:o,delay:1e3}),this.anime.onfinish=()=>this.onAnimeFinished(),this.state=e},pause(){var t;const e=Ln;this.checkDisable()||this.checkState(e)&&(null==(t=this.anime)||t.pause(),this.state=e)},finish(){var t;const e=bn;this.checkDisable()||this.checkState(e)&&(null==(t=this.anime)||t.finish(),this.anime=null,this.state=e)}}},(function(){var t=this,e=t._self._c;return e("div",{ref:"wrp",staticClass:"wrp",class:{anime:t.needAnime,"anime-done":0===t.state}},[e("div",{ref:"container",staticClass:"container"},[e("span",{ref:"text"},[t._v(t._s(t.title)+t._s(t.needAnime?" ":""))]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.needAnime,expression:"needAnime"}],attrs:{"aria-hidden":"false"}},[t._v(t._s(t.title))]),e("span",{ref:"ghost",staticClass:"ghost",attrs:{"aria-hidden":"false"}},[t._v(t._s(t.title))])])])}),[],!1,null,"5fe682fa",null,null).exports;let Pn="";const xn=({listenId:t,onSuccess:e,onError:i,onComplete:n,scene:o=0})=>{f.setSum(Pt,11,1),g({url:"/mp/listenplayer?action=add_to_playlist&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",dataType:"json",async:!0,data:{data:JSON.stringify({listen_id:t,scene:o})},success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e(t):("function"==typeof i&&i(),f.setSum(Pt,14,1))},error:()=>{"function"==typeof i&&i(),f.setSum(Pt,14,1)},complete:()=>{"function"==typeof n&&n()}})},An=({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{f.setSum(Pt,39,1),g({url:"/mp/listenplayer?action=rm_from_playlist&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",dataType:"json",async:!0,data:{data:JSON.stringify({listen_id:t})},success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e():("function"==typeof i&&i(t),f.setSum(Pt,40,1))},error:()=>{"function"==typeof i&&i(),f.setSum(Pt,39,1)},complete:()=>{"function"==typeof n&&n()}})};let Dn=0;const En=P({name:"mp-audio-panel",filters:{durationFormatter:t=>wt(t),durationNumFormatter:t=>wt(t,2)},components:{Tips:fn,Progress:wn,Teleport:n,Intersect:o,OptionMenu:Sn,VueDraggable:_n,[In.name]:In,[s.name]:s,[a.name]:a,[r.name]:r,[l.name]:l},provide(){return{supportSetShutdown:At,supportDynamicPlayList:xt,version:this.$options.version||1}},data(){const t=h.os.pc?"20%":"".concat(screen.height/4-(screen.height-window.innerHeight),"px"),e=ft.get("play-rate")||1,i=[{key:"none",value:"不开启"},...[15,30,60,90].map((t=>({key:t,value:"".concat(t,"分钟")}))),{key:"whenEnd",value:"当前单集结束后"}];return{firstScreenDataReady:!1,firstScreenDataError:!1,isShow:!1,cardTitleAnime:!1,panelContentHeight:screen.height/4*3-70,isShowList:!1,isPlaying:!1,playLoading:!1,playingType:0,playingListenId:"",playingSrcId:"",startRoutePoint:{x:0,y:0},animeRoutePoints:[],isShowingListenLaterAnime:!1,loading:!1,hasMore:!0,listSessionBuffer:"",hasInList:!1,list:[],playInfo:{},selectInfo:{},base64:"",version:this.$options.version||1,lastPlayId:"",isOpened:!1,tipsShow:!1,tipsWording:"",shutdownType:"none",shutdownLeftTime:0,shutdownPanelShow:!1,shutdownPanelPosition:{top:"100vh",left:"100vw"},topAnimeAreaInfo:null,topAnimeAreaTop:"",showTopAnimeArea:!1,playingAreaHide:!1,dragMoving:!1,slideMoving:!1,needUpdate:!1,playChanging:!1,showPlayingBar:!1,disableTransition:!1,transitionDis:0,transitionGapByScroll:0,modalTop:t,playRate:e,shutdownOptions:i,supportSetShutdown:At,supportDynamicPlayList:xt}},computed:{animeCoverStyle(){return["left: ".concat(this.startRoutePoint.x,"px; top: ").concat(this.startRoutePoint.y,"px;"),this.isShowingListenLaterAnime?"visibility: visible;":"visibility: hidden;","background-image: url(".concat(this.playInfo.cover,")")].join(";")},playBtnIconClass(){const t=this.playingListenId===this.playInfo.listen_id,e=this.isPlaying&&t;return t&&this.playLoading?"weui-loading":e?"icon-pause":"icon-play"},playingInfo(){var t;return this.list.find((t=>t.listen_id===this.playingListenId))||{listen_id:null==(t=this.selectInfo)?void 0:t.listen_id,listen_item:this.selectInfo}},playingIndex(){return this.list.findIndex((t=>{var e;return t.listen_id===(this.playingListenId||(null==(e=this.selectInfo)?void 0:e.listen_id))}))},showProgress(){return this.selectInfo&&(this.selectInfo.listen_id!==this.playInfo.listen_id||this.playingListenId===this.selectInfo.listen_id||this.playingSrcId===this.selectInfo.src_id)}},watch:{list(t){-1!==(t||[]).findIndex((t=>t.listen_id===this.playInfo.listen_id))?this.hasInList=!0:this.hasInList=!1},playInfo:{handler(t){this.selectInfo={...t}},immediate:!0,deeply:!0},selectInfo(){this.$nextTick((()=>{setTimeout((()=>{this.checkCardTitleAnime(),this.startCardTitleAnime()}),50)}))}},created(){this.getFirstScreenData(),this.__debounceScroll=function(t,e){let i,n;return function(){const o=this,s=arguments,a=Date.now();i&&a<i+e?(clearTimeout(n),n=setTimeout((function(){i=a,t.apply(o,s)}),e)):(i=a,t.apply(o,s))}}(this.onScroll,300),c.invoke("getTingAudioState",{},(t=>{/:ok$/.test(t.err_msg)?Dn=1:-9999!==t.err_code&&-1===t.err_msg.indexOf("function_not_exist")||(Dn=0)}))},mounted(){var t,e,i;this.registerStatusObserver(),setTimeout((()=>this.checkCardTitleAnime())),c.on("menu:setfont",(()=>{const t=this.$refs.playWrp;if(!t)return;const{height:e}=t.getBoundingClientRect();this.panelContentHeight=e,this.checkCardTitleAnime()})),document.addEventListener("visibilitychange",this.onVisibilityChange);const n=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");n&&(null==(e=n.addEventListener)||e.call(n,"scroll",this.__debounceScroll));const o=document.querySelector(".audio-panel-modal .weui-half-screen-dialog__bd");null==(i=null==o?void 0:o.addEventListener)||i.call(o,"touchmove",(t=>{if(this.dragMoving)return t.preventDefault(),t.stopPropagation(),!1})),this.onDragScroll=(t,e,i,n,s)=>{o.scrollTop+=e,this.transitionGapByScroll+=e,this.transitionDis+=e}},beforeDestroy(){var t,e;this.stopCountdown(),document.removeEventListener("visibilitychange",this.onVisibilityChange);const i=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");i&&(null==(e=i.removeEventListener)||e.call(i,"scroll",this.__debounceScroll))},methods:{show(t=!1,e=!1){var i,n;try{this.selectInfo=this.playInfo||{},this.$refs.bottomModal.show(),this.checkCardTitleAnime(),this.__titleAnime&&(this.__titleAnime.cancel(),this.__titleAnime=void 0);const o=e||!this.isOpened||this.needUpdate;return this.needUpdate=!1,t||2!==this.version&&3!==this.version?(t||1===this.version)&&o&&this.getListData(!0):(null==(i=this.playInfo)?void 0:i.listen_id)?this.isPlaying&&(null==(n=this.playInfo)?void 0:n.listen_id)===this.playingListenId&&this.playingListenId?o&&this.getListData(!0):this.supportDynamicPlayList?(this.addToListenLater(this.playInfo,(()=>{o&&this.getListData(!0)}),1),this.play(this.playInfo),this.report({EventType:4})):this.addToListenLater(this.playInfo,(()=>{this.play(this.playInfo),o&&this.getListData(!0),this.report({EventType:4})}),1):this.__autoPlayWhenGetFirstScreenData=!0,this.report({EventType:2}),this.isOpened=!0,f.setSum(Pt,8,1),this.registerClientListUpdatedListener(),this.getStatus((t=>{t.playRate&&(this.playRate=+t.playRate,ft.set("play-rate",+t.playRate))})),!0}catch(o){return console.error("[audio panel] showPanelError ".concat(o.message,"\n"),o),!1}},hide(){this.$refs.bottomModal.hide(),this.__titleAnime&&(this.__titleAnime.cancel(),this.__titleAnime=void 0)},showList(){f.setSum(Pt,9,1),this.isShowList=!0,this.__titleAnime&&(this.__titleAnime.cancel(),this.__titleAnime=void 0),this.report({EventType:7})},hideList(){this.isShowList=!1,this.startCardTitleAnime()},changePlay(t,e=0,i=!1){var n,o,s,a,r,l;if(this.playingListenId===t.listen_id&&this.isPlaying)return this.pause(!1),void(i&&this.report({EventType:5,Pos:e}));if(this.playChanging=!0,this.__changePlayTimeout&&(clearTimeout(this.__changePlayTimeout),this.__changePlayTimeout=null),this.__changePlayTimeout=setTimeout((()=>{this.playChanging=!1}),500),this.playingAreaHide&&(2===this.version||3===this.version)){this.__afterTopAnimeAreaEnterTimeout&&(clearTimeout(this.__afterTopAnimeAreaEnterTimeout),this.__afterTopAnimeAreaEnterTimeout=null);const i=document.querySelector(".audio-list__item-slide-wrp.pos-".concat(e)),d=null==(o=null==(n=null==i?void 0:i.getBoundingClientRect)?void 0:n.call(i))?void 0:o.top,u=null==(l=null==(r=null==(a=null==(s=this.$refs.bottomModal)?void 0:s.getViewRef("contentAreaWrp"))?void 0:a.getBoundingClientRect)?void 0:r.call(a))?void 0:l.top;this.topAnimeAreaInfo=t,this.topAnimeAreaTop=d&&u&&d-u||"",this.showTopAnimeArea=!0}!i||this.playingListenId===t.listen_id&&this.list[0].listen_id===t.listen_id?this.play(t.listen_item):this.supportDynamicPlayList?(this.addToListenLater(t.listen_item,(()=>{}),1),this.play(t.listen_item)):this.addToListenLater(t.listen_item,(()=>this.play(t.listen_item)),1),this.selectInfo={...t.listen_item},i?this.report({EventType:4,Pos:e}):(f.setSum(Pt,10,1),this.report({EventType:11,Pos:e}))},toggleListenLater(){var t,e,i,n;if(this.hasInList)return this.hasInList=!1,this.removeFromListenLater((null==(t=this.playInfo)?void 0:t.listen_id)||""),c.invoke("vibrateShort",{style:"medium"}),this.report({EventType:12}),void f.setSum(Pt,19,1);this.isShowList||this.showListenLaterAnime();-1!==this.list.findIndex((t=>t.listen_id===this.playingListenId))&&this.playingListenId&&(null==(e=this.playInfo)?void 0:e.listen_id)&&this.playingListenId!==(null==(i=this.playInfo)?void 0:i.listen_id)?this.adjustToNextPlay({listen_item:this.playInfo,listen_id:null==(n=this.playInfo)?void 0:n.listen_id}):this.addToListenLater(this.playInfo),this.hasInList=!0,this.report({EventType:6})},togglePlay(){var t,e;(null==(t=this.playInfo)?void 0:t.listen_id)&&(this.isPlaying&&this.playingListenId===(null==(e=this.playInfo)?void 0:e.listen_id)?this.pause(!0):(this.hasInList||(this.isShowList||this.showListenLaterAnime(),c.invoke("vibrateShort",{style:"medium"})),this.supportDynamicPlayList?(this.addToListenLater(this.playInfo,(()=>{}),1),this.play(this.playInfo,!0)):this.addToListenLater(this.playInfo,(()=>this.play(this.playInfo,!0)),1)))},removeFinishedAudio(t){const e=t.results.filter((t=>{const e=this.list.find((e=>e.listen_id===t.listenId));if(!e)return;const i=e&&e.newAdded;return t.finished&&(t.currentTime>=95e-5*e.duration||0===t.currentTime)&&!i&&(!this.isPlaying||this.isPlaying&&t.listenId!==this.playingListenId)})).map((t=>t.listenId));this.batchRemoveFromListenLater(e)},startCountDown(){console.log("[audio panel] startCountDown",this.countdownInterval,this.countdownIntervalId,this.playingListenId),this.countdownInterval&&this.countdownIntervalId===this.playingListenId||(this.countdownInterval&&this.stopCountdown(),this.countdownIntervalId=this.playingListenId,this.__countdownResTime=0,this.countdownInterval=setInterval((()=>{this.__countdownResTime>=0?(this.__countdownResTime=0,this.getStatus((t=>{console.log("[audio panel] countdown",JSON.stringify(t)),t&&t.item&&t.item.listenId&&"playing"===t.status?this.list=[...this.list.map((e=>e.listen_id===t.item.listenId&&t.currentTime?(e.currentTime=+t.currentTime||0,{...e}):e))]:this.stopCountdown()}))):this.list=[...this.list.map((t=>t.listen_id!==this.playingListenId?t:("number"==typeof t.currentTime&&(t.currentTime+=1),{...t})))],this.__countdownResTime+=1}),1e3))},stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null,this.countdownIntervalId=void 0,this.__countdownResTime=0)},showTips(t,e=1500){t&&(this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsWording=t,this.tipsShow=!0,this.__tipsTimeout=setTimeout((()=>{this.tipsShow=!1,this.tipsWording=""}),e))},hideTips(){this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsShow=!1,this.tipsWording=""},callShutdownPanel(t){this.getStatus((e=>{let i=e.shutdown;if("string"==typeof e.shutdown&&e.shutdown)try{i=JSON.parse(e.shutdown)}catch(o){i=null}i?("afterMins"===i.shutdownType?this.shutdownType=i.time||0:this.shutdownType=i.shutdownType||"none",this.shutdownLeftTime=i.leftTime||0):(this.shutdownType="none",this.shutdownLeftTime=0);const n=null==t?void 0:t.getBoundingClientRect();this.shutdownPanelPosition={top:void 0,left:void 0,bottom:"".concat(window.innerHeight-(n.bottom+26),"px"),right:"".concat(window.innerWidth-n.left+4,"px"),"--transform-origin-top":"".concat(n.bottom-n.height/2,"px"),"--transform-origin-left":"".concat(n.left-4,"px")},this.shutdownPanelShow=!0}))},scrollToNowPlaying(){var t;const e=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp"),i=document.querySelector(".audio-list__item-slide-wrp.now-playing");i&&e&&e.scrollTo({top:i.offsetTop,behavior:"smooth"})},registerClientListUpdatedListener(){!this.__hasRegisterClientListUpdatedListener&&this.supportDynamicPlayList&&(this.__hasRegisterClientListUpdatedListener=!0,c.on("onTingPlayListRefresh",this.onTingPlayListRefresh))},addToListenLater(t,e,i=0){const n=t.listen_id||"",o=this.list.find((t=>t.listen_id===n)),s={newAdded:!0,currentTime:o&&o.currentTime,listen_id:n,listen_item:t};this.list=[s,...this.list].filter(((t,e,i)=>i.findIndex((e=>e.listen_id===t.listen_id))===e)),xn({scene:i,listenId:n,onSuccess:()=>{this.notifyAppListChange(),this.$emit("add-to-listen-later",n)},onComplete:()=>"function"==typeof e&&e()})},adjustToNextPlay(t,e=0,i=!1){if(!(null==t?void 0:t.listen_id))return;const n=this.list.findIndex((e=>e.listen_id===t.listen_id));this.list=n<=0?[...this.list.slice(0,1),t,...this.list.slice(1)]:[...this.list.slice(0,1),this.list[n],...this.list.slice(1,n),...this.list.slice(n+1)],(({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{f.setSum(Pt,37,1),g({url:"/mp/listenplayer?action=next_play&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",data:{listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e():("function"==typeof i&&i(),f.setSum(Pt,38,1))},onError:()=>{"function"==typeof i&&i(),f.setSum(Pt,38,1)},complete:()=>{"function"==typeof n&&n()}})})({listenId:t.listen_id||"",onSuccess:()=>this.notifyAppListChange()}),i&&this.report({EventType:23,Pos:e})},removeFromListenLater(t,e=0,i=!1){this.list=[...this.list].filter((e=>e.listen_id!==t)),An({listenId:t,onSuccess:()=>{this.notifyAppListChange(),this.$emit("remove-from-listen-later",t)}}),i&&this.report({EventType:24,Pos:e})},batchRemoveFromListenLater(t){this.list=[...this.list].filter((e=>-1===t.indexOf(e.listen_id))),u.isAndroid&&this.supportDynamicPlayList||t.forEach((t=>An({listenId:t,onSuccess:()=>this.notifyAppListChange()})))},getFirstScreenData(){this.firstScreenDataError=!1,(({onSuccess:t,onError:e,onComplete:i})=>{f.setSum(Pt,20,1),g({url:"/mp/tts?action=getttslistenitem&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"GET",dataType:"json",async:!0,success:i=>{i&&i.base_resp&&0===i.base_resp.ret&&i.tts_listenitem?"function"==typeof t&&t(i):("function"==typeof e&&e(i),f.setSum(Pt,21,1))},error:()=>{"function"==typeof e&&e(),f.setSum(Pt,21,1)},complete:()=>{"function"==typeof i&&i()}})})({onSuccess:t=>{var e;this.firstScreenDataReady=!0,this.firstScreenDataError=!1,this.playInfo={...t.tts_listenitem,tts_model_type:(null==(e=t.listen_item_ext)?void 0:e.tts_model_type)||1},this.base64=t.category_playlist_info_base64||"",this.$emit("list-base64-change",this.base64),!this.__autoPlayWhenGetFirstScreenData||2!==this.version&&3!==this.version||(this.supportDynamicPlayList?(this.addToListenLater(this.playInfo,(()=>{}),1),this.getListData(!0),this.report({EventType:4})):this.addToListenLater(this.playInfo,(()=>{this.play(this.playInfo),this.getListData(!0),this.report({EventType:4})}),1)),this.__autoPlayWhenGetFirstScreenData=!1,setTimeout((()=>this.checkCardTitleAnime()))},onError:()=>{this.firstScreenDataReady=!1,this.firstScreenDataError=!0}})},getListData(t=!1,e){if(console.log("[audio panel] getList start:",t,this.hasMore,this.loading),!t&&(!this.hasMore||this.loading))return void this.$refs.bottomModal.finishPullUpLoad();this.loading=!0;const i=Math.random().toString("16").slice(2);this.loadingClientId=i,(({buffer:t,onSuccess:e,onError:i,onComplete:n})=>{f.setSum(Pt,15,1),g({url:"/mp/listenplayer?action=get_playlist&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",data:{last_listen_id:t?Pn:"",session_buffer:t||"",count:20},async:!0,dataType:"json",success:t=>{if(t&&t.base_resp&&0===t.base_resp.ret){if("function"==typeof e&&e(t),t&&t.results&&t.results.length){const e=t.results[t.results.length-1];Pn=e&&e.listen_id||""}}else"function"==typeof i&&i(t),f.setSum(Pt,16,1)},error:()=>{"function"==typeof i&&i(),f.setSum(Pt,16,1)},complete:()=>{"function"==typeof n&&n()}})})({buffer:t?"":this.listSessionBuffer,onSuccess:n=>{if(i!==this.loadingClientId)return void(this.loading=!1);this.hasMore=n.has_more||!1,this.listSessionBuffer=n.session_buffer||"",this.base64=n.category_playlist_info_base64||"";const o=(n.results||[]).filter((t=>!!t.listen_id&&t.listen_item)).map((t=>{var e,i;return{...t,newAdded:!0,listen_item:{...t.listen_item,tts_model_type:(null==(i=null==(e=n.listen_item_ext)?void 0:e.find((e=>(null==e?void 0:e.listen_id)===t.listen_id)))?void 0:i.tts_model_type)||1}}}));if(t){const t=this.list||[];this.list=[...o.map((e=>({...t.find((t=>t.listen_id===e.listen_id))||{},...e})))].filter(bt("listen_id"))}else this.list=[...this.list,...o].filter(bt("listen_id"));this.getPlayFinishedState(o.map((t=>t.listen_id))),this.loading=!1,"function"==typeof e&&e(this.list),console.log("[audio panel] getList: ".concat(JSON.stringify(n.results||[])," isFirst:").concat(t)),_.info("[audio panel] getList: ".concat(JSON.stringify(n.results||[])," isFirst:").concat(t))},onError:()=>{i===this.loadingClientId?(this.loading=!1,this.hasMore=!1):this.loading=!1},onComplete:()=>{i===this.loadingClientId?this.$refs.bottomModal.finishPullUpLoad():this.loading=!1}})},report(t){var e;const i=(this.list||[]).find((t=>t.listen_id===this.playingListenId));try{const n={BizUin:window.biz,MsgId:+window.mid,Idx:+window.idx,ListenId:"".concat((null==i?void 0:i.listen_id)||""),ListenType:(null==(e=null==i?void 0:i.listen_item)?void 0:e.type)||0,Scene:1*window.source,SubScene:1*window.subscene,Pos:0,EventType:0,EventTime:parseInt(Date.now()/1e3,10),SessionId:"".concat(window.sessionid),EnterId:+window.enterid,ExpVersion:"".concat(this.version||0),PlayRate:parseInt(100*(this.playRate||1),10),ListenTime:parseInt(1e3*(+(null==i?void 0:i.currentTime)||0),10),ShutDownType:String(this.shutdownType)||"",ShutDownLeftTime:this.shutdownLeftTime||0,ListBase64:this.base64||"",TargetPos:0,...t};console.log("[audio panel] report data",n),v.report(32561,n)}catch(n){console.log("[audio panel] report error",n)}},play(t,e=!1,i=0,n=void 0){var o,s,a;const r=(t=>{var e,n,o,s,a,r,l,d,u,c,p,h,m,y,g;const _={username:(null==(e=null==t?void 0:t.author_info)?void 0:e.username)||"",name:(null==(n=null==t?void 0:t.author_info)?void 0:n.nickname)||"",bizUin:(null==(o=null==t?void 0:t.article_info)?void 0:o.bizuin)||"",webUrl:(null==(s=null==t?void 0:t.article_info)?void 0:s.url)||"",audioId:(null==(a=null==t?void 0:t.article_info)?void 0:a.audio_id)||""},f={appId:(null==(r=null==t?void 0:t.article_info)?void 0:r.biz_appid)||"",mid:"",webUrl:(null==(l=null==t?void 0:t.article_info)?void 0:l.url)||""},v={nonceId:(null==(d=null==t?void 0:t.finder_info)?void 0:d.nonce_id)||"",tid:(null==(u=null==t?void 0:t.finder_info)?void 0:u.tid)||""};return{listenId:(null==t?void 0:t.listen_id)||"",type:null==t?void 0:t.type,startTime:i,duration:parseInt((null==t?void 0:t.duration)/1e3,10)||123,srcId:(null==t?void 0:t.listen_id)||"",title:(null==(c=null==t?void 0:t.article_info)?void 0:c.audio_title)||(null==t?void 0:t.title)||(null==(p=null==t?void 0:t.article_info)?void 0:p.title)||(null==(h=null==t?void 0:t.finder_info)?void 0:h.title)||"",webUrl:(null==(m=null==t?void 0:t.article_info)?void 0:m.url)||"",dataUrl:null==(y=null==t?void 0:t.article_info)?void 0:y.audio_url,audioUrl:null==(g=null==t?void 0:t.article_info)?void 0:g.audio_url,author:(null==t?void 0:t.author)||"",cover:(null==t?void 0:t.cover)||"",...(null==t?void 0:t.article_info)?{mpInfo:_}:{},...(null==t?void 0:t.article_info)?{musicInfo:f}:{},...(null==t?void 0:t.finder_info)?{finderInfo:v}:{}}})(t);let l={openPlayerUI:!1,playMode:0,listenId:(null==t?void 0:t.listen_id)||"",itemList:[r],scene:n,playbackRate:this.playRate||1,categoryPlaylistInfoBuffer:this.base64||"",categoryDeleteAfterListen:!0};const d={protocol:"",src:function(){var e;const i=(null==(e=null==t?void 0:t.article_info)?void 0:e.audio_url)||"",n=window.clientversion;return n&&(n>"18000e00"&&n<="18000e2d"||n>"18000f00"&&n<="18000f24")?"".concat(i,"&t=").concat(Date.now()):i}(),lowbandUrl:(null==(o=null==t?void 0:t.article_info)?void 0:o.audio_url)||"",title:null==t?void 0:t.title,epname:"",singer:(null==t?void 0:t.author)||"",srcId:null==t?void 0:t.listen_id,coverImgUrl:(null==t?void 0:t.cover)||"",webUrl:(null==(s=null==t?void 0:t.article_info)?void 0:s.url)||"",musicbar_url:(null==(a=null==t?void 0:t.article_info)?void 0:a.url)||"",needStartMusicUI:0,playbackRate:this.playRate||1,startTime:i},u=It(null==t?void 0:t.type)&&1===Dn;let p=u?"setTingAudioState":"setBackgroundAudioState";u&&this.playingListenId&&this.playingListenId===r.listenId&&xt&&!this.isPlaying&&!this.playLoading&&(p="operateTingAudio",l={operationType:"resume",srcId:this.playingSrcId,listenId:r.listenId}),c.invoke(p,u?l:d,(e=>{console.log("[audio panel] play",p,u?l:d,e),_.info("[audio panel] play ".concat(p," opt:").concat(JSON.stringify(u?l:d)," res:").concat(JSON.stringify(e))),-1===e.err_msg.indexOf("ok")?(this.hide(),window.weui.alert("暂无法播放，请重试"),f.setSum(Pt,17,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("t1t read fail","res: ".concat(JSON.stringify(e)," | url: ").concat(location.href),{mid:"mmbizwap:t1t_read_fail",view:"wap_business"})):(this.isPlaying=!0,this.playingListenId=t.listen_id||"",this.playingSrcId=t.listen_id||"")})),e&&(f.setSum(Pt,12,1),this.report({EventType:4,ListBase64:this.base64||""}))},pause(t=!0){t&&(f.setSum(Pt,13,1),this.report({EventType:5}));const e={operationType:"pause",srcId:this.playingSrcId,listenId:this.playingListenId},i=It(this.playingType)&&1===Dn?"operateTingAudio":"operateBackgroundAudio";c.invoke(i,e,(t=>{console.log("[audio panel] ".concat(i,": params:"),e,"res:",t),-1!==t.err_msg.indexOf("ok")&&(this.isPlaying=!1)}))},setCurrentTime(t,e){const i=this.list.findIndex((t=>t.listen_id===this.playingListenId)),n=this.list[i].listen_item.duration/1e3,o=parseInt(Math.max(Math.min(t,n),0),10),s={operationType:"seek",srcId:this.playingSrcId||"",listenId:this.playingListenId||"",seektime:o},a={operationType:"seek",currentTime:o},r=It(this.list[i].listen_item.type)&&1===Dn,l=r?"operateTingAudio":"operateBackgroundAudio";c.invoke(l,r?s:a,(t=>{console.log("[audio panel] ".concat(l),r?s:a,t),"function"==typeof e&&e()}))},getStatus(t,e=!0){c.invoke(Dn?"getTingAudioState":"getBackgroundAudioState",{sourceType:1},(i=>{console.log("[audio panel] getStatus",Dn?"getTingAudioState":"getBackgroundAudioState",JSON.stringify(i)),i&&i.item&&i.item.listenId&&e&&this.onGetStatusChange(i),"function"==typeof t&&t(i)}))},registerStatusObserver(){["onTingAudioStateChanged","onBackgroundAudioStateChange"].forEach((t=>{c.on(t,(e=>{try{console.log("[audio panel] debug ".concat(t," ").concat(JSON.stringify(e)))}catch(i){}e&&e.item&&e.item.listenId&&this.onGetStatusChange(e)}))}))},getPlayFinishedState(t,e=!1){const i=(t||(this.list||[]).map((t=>t.listen_id))).filter((t=>t));i.length&&c.invoke("operateTingAudio",{operationType:"getFinishedState",listenIds:i},(t=>{if(_.info("[audio panel] getPlayFinishedState listenIds:".concat(JSON.stringify(i)," resp:").concat(JSON.stringify(t))),console.log("[audio panel] getPlayFinishedState",i,JSON.stringify(t)),t&&t.err_msg&&-1!==t.err_msg.indexOf(":ok")){let i=t.results||[];if((u.isAndroid||u.isHarmonyNextWechat)&&"string"==typeof t.results)try{i=JSON.parse(i||"[]")||[]}catch(n){i=[]}i.forEach((t=>{const e=this.list.findIndex((e=>t.listenId===e.listen_id));-1!==e&&this.$set(this.list[e],"currentTime",+t.currentTime)})),this.getStatus((()=>this.removeFinishedAudio({results:i})),!e)}}))},notifyAppListChange(){this.supportDynamicPlayList&&c.invoke("operateTingAudio",{operationType:"refreshPlayList",listenId:this.playingListenId||this.playInfo.listen_id||"",categoryPlaylistInfoBuffer:this.base64||""},(t=>{console.log("[audio panel] notify app refreshPlayList",t)}))},onShow(){this.isShow=!0,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!0},(t=>console.log("[audio panel] setForegroundState:true res:".concat(JSON.stringify(t)))))},onHide(){var t;this.isShow=!1,this.dragMoving=!1,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!1},(t=>console.log("[audio panel] setForegroundState:false res:".concat(JSON.stringify(t))))),this.$refs.bottomModal.scrollTo(0),this.report({EventType:3}),this.isShowList&&this.report({EventType:10}),null==(t=this.$refs.slideGroup)||t.reset()},onClickHideButton(){this.isShowList?(this.hideList(),this.report({EventType:9})):this.$refs.bottomModal.hide()},onScroll(){var t;const e=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");e&&(e.scrollTop>130?this.playingAreaHide=!0:this.playingAreaHide=!1)},onVisibilityChange(){const t="visible"===document.visibilityState;t&&this.isOpened&&this.getListData(!0),t&&this.list&&this.list.length&&this.isOpened&&this.getPlayFinishedState(),t&&this.getStatus((t=>{t.playRate&&(this.playRate=+t.playRate,ft.set("play-rate",+t.playRate))}))},onGetStatusChange(t){var e;console.log("[audio panel] onGetStatusChange",JSON.stringify(t)),-1!==[2,3,4].indexOf(t.item.type)&&(this.playingListenId=t.item.listenId,this.playingSrcId=t.item.srcId,this.playingType=t.item.type,"playing"===t.status?(this.isPlaying=!0,this.playLoading=!1,this.startCountDown(),this.list.some((e=>e.listen_id===t.item.listenId&&e.newAdded))&&(this.list=this.list.map((e=>e.listen_id===t.item.listenId?(e.newAdded=!1,e):e)))):"loading"===t.status?(this.isPlaying=!1,this.playLoading=!0,this.stopCountdown()):(this.playLoading=!1,this.isPlaying=!1,"idle"===t.status&&(this.playingListenId="",this.playingSrcId=""),this.stopCountdown()),t.duration&&this.playingInfo&&((null==(e=this.playingInfo.listen_item)?void 0:e.duration)&&this.playingInfo.listen_item.duration/1e3===t.duration||(this.list=this.list.map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)))),(this.lastPlayId!==t.item.listenId||1===this.list.length&&"playing"!==t.status)&&this.getPlayFinishedState([this.lastPlayId],!0),this.lastPlayId&&this.lastPlayId!==t.item.listenId&&this.onSwitchAudio(t.item.listenId,this.lastPlayId),this.lastPlayId=t.item.listenId)},onSwitchAudio(t,e){const i=this.list.find((e=>e.listen_id===t));i&&(this.selectInfo=i.listen_item),this.startCardTitleAnime()},onListScreenExpose(){this.report({EventType:8})},onPlayScreenExpose(){this.report({EventType:1}),this.showPlayingBar=!1},onPlayScreenLeave(){this.showPlayingBar=!0},onListItemExpose(t,e){},onListItemLeave(t,e){},onClickPlayingBar(){var t;const e=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");null==e||e.scrollTo({top:0,behavior:"smooth"})},onSeeking(t,e){this.stopCountdown(),this.$set(this.list[e],"currentTime",parseInt(t,10)),this.__hasReportSeeking||(this.__hasReportSeeking=!0,this.report({EventType:18}),f.setSum(Pt,28,1))},onSeeked(t,e){this.$set(this.list[e],"currentTime",parseInt(t,10)),this.setCurrentTime(t),this.startCountDown(),this.__hasReportSeeking=!1,this.report({EventType:19}),f.setSum(Pt,29,1)},onSetShutdown(t){const{key:e}=t||{};"number"==typeof e?c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:"afterMins",time:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown afterMins",t),/:ok$/.test(t.err_msg)&&this.showTips("将在".concat(e,"分钟后停止播放"))})):(c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown",e,t),/:ok$/.test(t.err_msg)&&("none"===e?this.hideTips():this.showTips("将在此音频播放结束时停止播放"))})),"none"===e&&f.setSum(Pt,31,1)),this.shutdownType=e,"number"==typeof e&&(this.shutdownLeftTime=e),this.report({EventType:17}),f.setSum(Pt,30,1)},onBackward(t,e){var i;const n=-1===e?this.list.findIndex((t=>{var e;return t.listen_id===(null==(e=this.playInfo)?void 0:e.listen_id)})):e,o=Math.max(((null==(i=this.list[n])?void 0:i.currentTime)||0)-t,0);this.$set(this.list[n],"currentTime",parseInt(o,10)),this.setCurrentTime(o),this.report({EventType:14}),f.setSum(Pt,25,1)},onForward(t,e){var i,n,o;const s=-1===e?this.list.findIndex((t=>{var e;return t.listen_id===(null==(e=this.playInfo)?void 0:e.listen_id)})):e,a=Math.min(((null==(i=this.list[s])?void 0:i.currentTime)||0)+t,((null==(o=null==(n=this.list[s])?void 0:n.listen_item)?void 0:o.duration)||1/0)/1e3);this.$set(this.list[s],"currentTime",parseInt(a,10)),this.setCurrentTime(a),this.report({EventType:15}),f.setSum(Pt,26,1)},onChangeRate(){const t=[1,1.25,1.5,.75],e=t.indexOf(this.playRate),i=t[(e+1)%t.length];this.playRate=i,c.invoke("operateTingAudio",{operationType:"playRate",srcId:this.playingSrcId||"",listenId:this.playingListenId||"",playRate:this.playRate},(t=>{console.log("[audio panel] setPlayRate",t),1!==this.playRate?this.showTips("已切换至".concat(this.playRate,"倍速播放")):this.hideTips()})),ft.set("play-rate",i),this.report({EventType:16}),f.setSum(Pt,27,1)},onClickRemoveFromList(t,e,i){return t.stopPropagation(),t.preventDefault(),this.removeFromListenLater(e,i,!0),!1},onTingPlayListRefresh(t){console.log("deanti onTingPlayListRefresh",t)},onSlideStart(){this.slideMoving=!0},onSlideEnd(){this.slideMoving=!1},onMoveChosen(){this.dragMoving=!0,document.addEventListener("touchmove",this.onDragMove,{capture:!0}),c.invoke("vibrateShort",{style:"medium"})},onMoveUnchoose(){this.dragMoving=!1},onMoveStart(t){this.dragMoving=!0,this.__dragStartY=t.originalEvent.pageY,this.transitionDis=0,this.transitionGapByScroll=0},onDragMove(t){const e=((t.touches&&t.touches[0]||{}).pageY||0)-this.__dragStartY;this.transitionDis=e+(u.isIOS?this.transitionGapByScroll:0),t.preventDefault()},onMoveDone(){this.dragMoving=!1,document.removeEventListener("touchmove",this.onDragMove)},onMoveUpdate(t){var e,i;this.dragMoving=!1,this.__disableTransitionTimeout&&(clearTimeout(this.__disableTransitionTimeout),this.__disableTransitionTimeout=null),this.disableTransition=!0,this.__disableTransitionTimeout=setTimeout((()=>{this.disableTransition=!1}),500),(null==(e=this.list[0])?void 0:e.listen_id)!==this.playingListenId&&this.playingListenId&&(null==(i=this.list[0])?void 0:i.listen_item)&&this.changePlay(this.list[0],0,!1),(({listenId:t,pos:e,onSuccess:i,onError:n,onComplete:o})=>{f.setSum(Pt,35,1),g({url:"/mp/listenplayer?action=move&listen_id=".concat(t,"&target_pos=").concat(e,"&__biz=").concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"POST",data:{listen_id:t,target_pos:e},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i():("function"==typeof n&&n(),f.setSum(Pt,36,1))},error:()=>{"function"==typeof n&&n(),f.setSum(Pt,36,1)},complete:()=>{"function"==typeof o&&o()}})})({listenId:t.data.listen_id||"",pos:t.newIndex,onSuccess:()=>this.notifyAppListChange()}),this.report({EventType:25,Pos:(null==t?void 0:t.oldIndex)||0,TargetPos:(null==t?void 0:t.newIndex)||0})},showTopAnime(){this.showTopAnimeArea=!0},afterTopAnimeAreaEnter(){this.__afterTopAnimeAreaEnterTimeout=setTimeout((()=>{this.showTopAnimeArea=!1}),0)},showListenLaterAnime(){},checkCardTitleAnime(){this.cardTitleAnime=!1},startCardTitleAnime(){if(!this.cardTitleAnime)return;const t=this.$refs.cardTitle;if(!t)return;if(this.__titleAnime)return;const e=t.children[0].getBoundingClientRect().width,i=e/40*1e3;this.__titleAnime=t.animate([{offset:0,transform:"translate3d(0, 0, 1.1px)"},{offset:1,transform:"translate3d(-".concat(e,"px, 0, 1.1px)")}],{easing:"linear",duration:i,delay:1e3}),this.__titleAnime.onfinish=()=>{this.__titleAnime=void 0}}}},(function(){var t,e,i,n,o,s,a,r,l,d,u,c=this,p=c._self._c;return p("div",{ref:"container"},[p("mp-bottom-modal",{ref:"bottomModal",attrs:{"close-btn-type":"fold","ext-class":"audio-panel-modal ".concat(c.slideMoving?"audio-panel-disable-touch-action":""),top:c.modalTop,"need-head-line":!1,"hide-when-sideslip":!c.dragMoving,"hide-when-scroll-down":!c.dragMoving,"header-type":1===c.version?"slide":"normal"},on:{show:c.onShow,hide:c.onHide,"click-slide-btn":c.hide,"show-after-animation":c.startCardTitleAnime,"hide-after-animation":c.hideList,"pullup-load":c.getListData}},[2===c.version||3===c.version?p("div",{staticClass:"modal-title",attrs:{slot:"title"},on:{click:c.scrollToNowPlaying},slot:"title"},[p("div",{staticClass:"title"},[c._v("播放列表")]),p("div",{directives:[{name:"show",rawName:"v-show",value:c.playingAreaHide&&c.playingListenId,expression:"playingAreaHide && playingListenId"}],staticClass:"desc"},[p("div",{staticClass:"playing",class:{pause:!c.isPlaying&&!c.playLoading},attrs:{role:"figure","aria-describedby":"播放中"}},[p("div",{staticClass:"dot1"}),p("div",{staticClass:"dot2"}),p("div",{staticClass:"dot3"}),p("div",{staticClass:"dot4"})]),p("span",[c._v(c._s(c.playingInfo&&c.playingInfo.listen_item&&c.playingInfo.listen_item.title))])])]):c._e(),p("div",{ref:"wrp",staticClass:"audio-panel__wrp",style:c.isShowList?"":"overflow: hidden;"},[c.firstScreenDataReady||c.firstScreenDataError?!c.firstScreenDataReady&&c.firstScreenDataError?p("div",{ref:"playWrp",staticClass:"audio-panel__screen error",on:{click:c.getFirstScreenData}},[p("div",{staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[c._v("加载失败，请点击重试")])])]):[1===c.version?p("div",{staticClass:"audio-panel__playing-bar-wrp"},[p("transition",{attrs:{name:"fade"}},[p("div",{directives:[{name:"show",rawName:"v-show",value:c.showPlayingBar&&(null==(t=c.playingInfo)?void 0:t.listen_item)&&(c.isPlaying||c.playLoading||c.playChanging),expression:"showPlayingBar && playingInfo?.listen_item && (isPlaying || playLoading || playChanging)"}],staticClass:"audio-panel__playing-bar",on:{click:c.onClickPlayingBar}},[p("span",[c._v("正在播放 : "+c._s((null==(n=null==(i=null==(e=c.playingInfo)?void 0:e.listen_item)?void 0:i.article_info)?void 0:n.audio_title)||(null==(s=null==(o=c.playingInfo)?void 0:o.listen_item)?void 0:s.title)))])])])],1):c._e(),p("Intersect",{attrs:{threshold:[0]},on:{enter:c.onPlayScreenExpose,leave:c.onPlayScreenLeave}},[1===c.version?p("div",{ref:"playWrp",staticClass:"audio-panel__screen info-screen",class:{"playing-mask":c.showProgress}},[p("div",{staticClass:"audio-panel__play-area",class:{"show-progress":c.showProgress}},[p("div",{ref:"playerCover",staticClass:"audio-panel__play-area__cover",style:"background-image: url(".concat(c.selectInfo&&c.selectInfo.cover,")")}),p("div",{staticClass:"audio-panel__play-area__right"},[p("div",{staticClass:"audio-panel__play-area__info"},[p("div",{staticClass:"info-title"},[c._v(c._s((null==(r=null==(a=c.selectInfo)?void 0:a.article_info)?void 0:r.audio_title)||c.selectInfo.title))]),p("div",{staticClass:"info-desc"},[p("span",{staticClass:"info-desc__author",attrs:{id:"info-desc__author"}},[c._v(c._s(c.selectInfo.author))]),c.showProgress?2===c.selectInfo.tts_model_type?p("span",{staticClass:"info-desc__duration"},[c._v("作者音色朗读")]):2!==c.selectInfo.type?p("span",{staticClass:"info-desc__duration"},[c._v("音频由作者上传")]):c._e():p("span",{directives:[{name:"show",rawName:"v-show",value:c.selectInfo.duration,expression:"selectInfo.duration"}],staticClass:"info-desc__duration",class:c.showProgress?"hidden":"",attrs:{id:"info-desc__duration","aria-hidden":c.showProgress?"true":"false"}},[c._v(c._s(c._f("durationFormatter")(c.selectInfo.duration)))])]),p("div",{directives:[{name:"show",rawName:"v-show",value:!c.showProgress&&(2!==c.selectInfo.type||2===c.selectInfo.tts_model_type),expression:"!showProgress && (selectInfo.type !== 2 || selectInfo.tts_model_type === 2)"}],staticClass:"info-desc"},[2===c.selectInfo.tts_model_type?p("span",[c._v("作者音色朗读")]):2!==c.selectInfo.type?p("span",[c._v("音频由作者上传")]):c._e()])]),c._e()])]),c._e(),p("transition-group",{staticClass:"audio-panel__operate-area-wrp",attrs:{name:"operate-fade"}},[c.showProgress?p("Progress",{key:"progress",attrs:{"play-rate":+c.playRate,"is-playing":c.isPlaying||c.playLoading,"current-time":(null==(l=c.playingInfo)?void 0:l.currentTime)||0,"has-set-shut-down":"none"!==c.shutdownType,duration:(null==(u=null==(d=c.playingInfo)?void 0:d.listen_item)?void 0:u.duration)||0},on:{"change-rate":function(t){return c.onChangeRate()},"set-shutdown":c.callShutdownPanel,forward:function(t){return c.onForward(30,c.playingIndex)},backward:function(t){return c.onBackward(15,c.playingIndex)},"toggle-play":function(t){return c.changePlay(c.playingInfo,c.playingIndex,!0)},seeked:t=>c.onSeeked(t,c.playingIndex),seeking:t=>c.onSeeking(t,c.playingIndex)}}):p("div",{key:"operate-btns",staticClass:"audio-panel__operate-area small"},[p("button",{staticClass:"operate-btn js_wx_tap_highlight",on:{click:c.togglePlay}},[p("i",{class:c.playBtnIconClass}),p("span",[c._v(c._s(c.isPlaying&&c.playingListenId===c.playInfo.listen_id?"暂停":"播放"))])]),p("button",{staticClass:"operate-btn",class:[c.hasInList?"has-in":"js_wx_tap_highlight"],on:{click:function(t){return c.toggleListenLater()}}},[p("i",{staticClass:"icon",class:[c.hasInList?"icon-correct":"icon-listen-later"]}),p("span",[c._v(c._s(c.hasInList?"已加入":"加入列表"))])])])],1)],1):c._e()]),p("Intersect",{attrs:{threshold:[0]},on:{enter:c.onListScreenExpose}},[p("div",{ref:"listScreen",staticClass:"audio-panel__screen list-screen",style:"--top-anime-top: ".concat(c.topAnimeAreaTop,"px; --top-anime-top-end: ").concat(-c.topAnimeAreaTop,"px;")},[p("div",{staticClass:"audio-panel__list-area",class:"version".concat(c.version),style:"--drag-ghost-transition-dis: ".concat(c.transitionDis,"px;")},[1===c.version?p("div",{ref:"listSubTitle",staticClass:"sub-title"},[c._v("播放列表")]):c._e(),p("mp-slide-view-group",{ref:"slideGroup"},[p("VueDraggable",{attrs:{delay:300,scroll:!0,"bubble-scroll":!1,"scroll-fn":c.onDragScroll,"touch-start-threshold":5,disabled:!c.supportDynamicPlayList&&!c.slideMoving,target:".audio-list-sort-wrp"},on:{end:c.onMoveDone,start:c.onMoveStart,update:c.onMoveUpdate,choose:c.onMoveChosen,unchoose:c.onMoveUnchoose},model:{value:c.list,callback:function(t){c.list=t},expression:"list"}},[p("transition-group",{staticClass:"audio-list-sort-wrp",attrs:{name:"audio-list"}},c._l(c.list,(function(t,e){return p("mp-slide-view",{key:"slide-item-".concat(t.listen_id),attrs:{disabled:!c.supportDynamicPlayList&&!c.dragMoving,"extra-class":["audio-list__item-slide-wrp","pos-".concat(e),c.playingListenId===t.listen_id?"now-playing":"",c.disableTransition?"disable-transition":""]},on:{end:c.onSlideEnd,start:c.onSlideStart},scopedSlots:c._u([{key:"btns",fn:function(){return[c.list.findIndex((e=>e.listen_id===t.listen_id))>=2?p("mp-slide-item",{directives:[{name:"show",rawName:"v-show",value:!c.dragMoving,expression:"!dragMoving"}],attrs:{"extra-class":"slide-item-primary","not-last":""},on:{click:function(i){return c.adjustToNextPlay(t,e,!0)}}},[c._v("下一个播放")]):c._e(),p("mp-slide-item",{directives:[{name:"show",rawName:"v-show",value:!c.dragMoving,expression:"!dragMoving"}],on:{click:i=>c.onClickRemoveFromList(i,t.listen_id,e)}},[c._v("删除")])]},proxy:!0}],null,!0)},[p("Intersect",{attrs:{threshold:[0]},on:{enter:t=>c.onListItemExpose(t,e),leave:t=>c.onListItemLeave(t,e)}},[p("audio-list-item",{key:"audio-".concat(t.listen_id),ref:"audioItem",refInFor:!0,attrs:{info:t,"play-rate":+c.playRate,"is-playing":c.isPlaying||c.playLoading,playing:c.playingListenId===t.listen_id,"has-set-shut-down":"none"!==c.shutdownType},on:{pause:function(t){return c.pause(!1)},"change-rate":function(t){return c.onChangeRate()},"set-shutdown":c.callShutdownPanel,forward:function(t){return c.onForward(30,e)},backward:function(t){return c.onBackward(15,e)},click:function(i){return c.changePlay(t,e,!0)},"toggle-play":function(i){return c.changePlay(t,e,!0)},seeked:t=>c.onSeeked(t,e),seeking:t=>c.onSeeking(t,e)}})],1)],1)})),1)],1)],1),p("div",{directives:[{name:"show",rawName:"v-show",value:!c.loading&&!c.hasMore&&0===c.list.length,expression:"!loading && !hasMore && list.length === 0"}],staticClass:"weui-loadmore weui-loadmore_line empty"},[p("span",{staticClass:"weui-loadmore__tips"},[c._v("暂无收听历史")])]),p("div",{directives:[{name:"show",rawName:"v-show",value:c.loading,expression:"loading"}],staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[p("i",{staticClass:"weui-loading"})])]),p("div",{directives:[{name:"show",rawName:"v-show",value:!c.loading&&!c.hasMore&&c.list.length,expression:"!loading && !hasMore && list.length"}],staticClass:"weui-loadmore weui-loadmore_line weui-loadmore_dot"},[p("span",{staticClass:"weui-loadmore__tips"})])],1)])])]:p("div",{ref:"playWrp",staticClass:"audio-panel__screen empty"},[p("div",{staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[p("i",{staticClass:"weui-loading"})])])]),p("div",{staticClass:"audio-panel__modal-bottom-mask",on:{touchstart:function(t){t.stopPropagation(),t.preventDefault()},touchmove:function(t){t.stopPropagation(),t.preventDefault()},touchend:function(t){t.stopPropagation(),t.preventDefault()}}})],2)]),p("div",{ref:"animeCover",staticClass:"anime-cover",style:c.animeCoverStyle,attrs:{"aria-hidden":"true"},on:{animationend:function(t){c.isShowingListenLaterAnime=!1}}}),p("Teleport",{attrs:{to:"body"}},[p("Tips",{attrs:{"tips-wording":c.tipsWording},model:{value:c.tipsShow,callback:function(t){c.tipsShow=t},expression:"tipsShow"}}),p("OptionMenu",{attrs:{"active-key":c.shutdownType,"wrp-style":c.shutdownPanelPosition,options:c.shutdownOptions},on:{select:c.onSetShutdown},model:{value:c.shutdownPanelShow,callback:function(t){c.shutdownPanelShow=t},expression:"shutdownPanelShow"}})],1)],1)}),[],!1,null,"f7e10856",null,null).exports;let Mn="";const Rn=({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{g({url:"/mp/listenplayerv2?action=add_to_playlist",type:"POST",data:{playlist_type:2,listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e(t):"function"==typeof i&&i(t)},error:()=>{"function"==typeof i&&i()},complete:()=>{"function"==typeof n&&n()}})},On=({listenId:t,pos:e,from:i,currentListenId:n,onSuccess:o,onError:s,onComplete:a})=>{g({url:"/mp/listenplayerv2?action=move",type:"POST",data:{playlist_type:"star"===i?2:4,listen_id:t,target_pos:e||0,to_playlist_type:2,current_play_listen_id:n||""},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof o&&o(t):"function"==typeof s&&s(t)},error:()=>{"function"==typeof s&&s()},complete:()=>{"function"==typeof a&&a()}})},Bn=({listenId:t,pos:e,onSuccess:i,onError:n,onComplete:o})=>{if(document.cookie.indexOf("mp-exp__dont-jump-play")>-1)return"function"==typeof o&&o(),void("function"==typeof i&&i({}));g({url:"/mp/listenplayerv2?action=finish",type:"POST",data:{listen_id:t,pos:e||0,playlist_type:4},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i(t):"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})};let jn=0;const Un=P({name:"mp-audio-panel",filters:{durationFormatter:t=>wt(t),durationNumFormatter:t=>wt(t,2)},components:{Tips:fn,Header:vn,Progress:wn,Teleport:n,Intersect:o,OptionMenu:Sn,TextMarquee:Cn,VueDraggable:_n,[In.name]:In,[s.name]:s,[a.name]:a,[r.name]:r,[l.name]:l},provide(){return{supportSetShutdown:At,supportDynamicPlayList:xt,version:this.$options.version||1}},data(){const t=h.os.pc?"20%":"".concat(screen.height/10*3-(screen.height-window.innerHeight),"px"),e=ft.get("play-rate")||1;return{starVersion:!0,modalTop:t,shutdownOptions:[{key:"none",value:"不开启"},...[15,30,60,90].map((t=>({key:t,value:"".concat(t,"分钟")}))),{key:"whenEnd",value:"当前单集结束后"}],version:this.$options.version||1,firstScreenDataReady:!1,firstScreenDataError:!1,isShow:!1,isPlaying:!1,playLoading:!1,playingType:0,playingListenId:"",playingSrcId:"",hasInList:!1,removedItems:[],cardList:[],playInfo:{},base64:"",lastPlayId:"",isOpened:!1,tipsShow:!1,tipsWording:"",shutdownType:"none",shutdownLeftTime:0,shutdownPanelShow:!1,shutdownPanelPosition:{top:"100vh",left:"100vw"},dragMoving:!1,slideMoving:!1,needUpdate:!1,playChanging:!1,showPlayingBar:!1,disableTransition:!1,transitionDis:0,transitionGapByScroll:0,playRate:e,showList:[],undoneList:[],undoneListBuffer:"",undoneListError:!1,undoneListHasNext:!0,getUndoneListLoading:!1,hasStar:!1,needDoCombine:!1,doingCombine:!1,fromType:"tts",tempStorePlayInfo:null,showBackWrp:!1,tempStorePlayItem:null,showBorder:!1,supportSetShutdown:At,supportDynamicPlayList:xt}},computed:{playBtnIconClass(){const t=this.playingListenId===this.playInfo.listen_id,e=this.isPlaying&&t;return t&&this.playLoading?"weui-loading":e?"icon-pause":"icon-play"},playingInfo(){var t,e;const i={listen_id:null==(t=this.playInfo)?void 0:t.listen_id,listen_item:this.playInfo,currentTime:this.playInfo.currentTime};return this.undoneList.find((t=>t.listen_id===this.playingListenId))||(this.playingListenId===i.listen_id?i:null)||(this.playingListenId===(null==(e=this.tempStorePlayItem)?void 0:e.listen_id)?this.tempStorePlayItem:null)||this.cardList.find((t=>t.listen_id===this.playingListenId))||this.removedItems.find((t=>t.listen_id===this.playingListenId))||i},playingListenItem(){var t;return(null==(t=this.playingInfo)?void 0:t.listen_item)||{}},showProgress:()=>!0,showTitle(){var t,e;return(null==(e=null==(t=this.playingListenItem)?void 0:t.article_info)?void 0:e.audio_title)||this.playingListenItem.title},tempInfoHasInList(){return this.tempStorePlayInfo&&this.undoneList.findIndex((t=>t.listen_id===this.tempStorePlayInfo.listenId))>-1},showBackWrpComputed(){return this.showBackWrp&&!(!this.undoneList.length&&this.getUndoneListLoading)&&!this.tempInfoHasInList}},watch:{undoneList(t){-1!==(t||[]).findIndex((t=>t.listen_id===this.playInfo.listen_id))?this.hasInList=!0:this.hasInList=!1},showBackWrpComputed(t){t&&this.onBackWrpExpose()}},created(){window.addEventListener("star",this.handleStar),window.addEventListener("cancel-star",this.handleStar),this.getFirstScreenData(),this.doCombineList=vt(this.doCombineListRaw,1e3),c.invoke("getTingAudioState",{sourceType:1},(t=>{/:ok$/.test(t.err_msg)?jn=1:-9999!==t.err_code&&-1===t.err_msg.indexOf("function_not_exist")||(jn=0),this.getStatus()}))},mounted(){this.registerStatusObserver(),document.addEventListener("visibilitychange",this.onVisibilityChange);const t=document.querySelector(".audio-panel-modal .weui-half-screen-dialog__bd");t.addEventListener("touchmove",(t=>{if(this.dragMoving)return t.preventDefault(),t.stopPropagation(),!1})),this.onDragScroll=(e,i,n,o,s)=>{t.scrollTop+=i,this.transitionGapByScroll+=i,this.transitionDis+=i},this.updateCardList()},beforeDestroy(){this.stopCountdown(),document.removeEventListener("visibilitychange",this.onVisibilityChange),window.removeEventListener("star",this.handleStar),window.removeEventListener("cancel-star",this.handleStar)},methods:{show(t){var e,i;try{if(!this.firstScreenDataReady)return this.$refs.bottomModal.show(),this.__firstScreenDataReadyCallback=()=>this.show(t),!0;const n=t||this.playInfo,o={listen_id:null==n?void 0:n.listen_id,listen_item:n};return this.getUndoneList(!1).then((()=>{~this.undoneList.findIndex((t=>t.listen_id===o.listen_id))&&this.playingListenId===o.listen_id&&On({from:"star",listenId:o.listen_id,...this.playingListenId?{currentListenId:this.playingListenId}:{},onSuccess:()=>this.doCombineList(this.playingListenId)})})),this.$refs.bottomModal.show(),this.isPlaying&&(null==n?void 0:n.listen_id)===this.playingListenId&&this.playingListenId||(this.playingListenId&&this.playingListenId!==(null==n?void 0:n.listen_id)?this.getStatus((t=>{this.tempStorePlayInfo=t.item;const e=this.getTempListenItem(this.tempStorePlayInfo);this.tempStorePlayItem={listen_id:e.listen_id,listen_item:e},this.showBackWrp=!0,this.setPlay(o,"tts",!1,"show"),this.doCombineList()})):(this.showBackWrp=!1,this.setPlay(o,"tts"),this.doCombineList())),this.isOpened=!0,this.registerClientListUpdatedListener(),this.getStatus(),this.report({EventType:2,ListenId:(null==(e=this.playInfo)?void 0:e.listen_id)||"",ListenType:(null==(i=this.playInfo)?void 0:i.type)||0}),f.setSum(Pt,8,1),!0}catch(n){return console.error("[audio panel] showError",n),_.error("[audio panel] showError: ".concat(n.message)),!1}},hide(){this.$refs.bottomModal.hide(),this.__titleAnime&&(this.__titleAnime.cancel(),this.__titleAnime=void 0)},updateCardList(){this.cardList=[...document.querySelectorAll("mp-common-mpaudio,mp-common-claudio")].map(Lt).filter((t=>t.listen_id)).map((t=>({listen_id:t.listen_id,listen_item:t})))},removeFinishedAudio(t){const e=t.results.filter((t=>{const e=this.undoneList.find((e=>e.listen_id===t.listenId));if(e)return t.finished&&(t.currentTime>=95e-5*e.duration||0===t.currentTime)&&(!this.isPlaying||this.isPlaying&&t.listenId!==this.playingListenId)})).map((t=>t.listenId));this.batchRemoveFromListenLater(e)},startCountDown(){this.countdownInterval&&this.countdownIntervalId===this.playingListenId||(this.countdownInterval&&this.stopCountdown(),this.countdownIntervalId=this.playingListenId,this.__countdownResTime=0,this.countdownInterval=setInterval((()=>{this.__countdownResTime>=0&&(this.__countdownResTime=0,this.getStatus((t=>{t&&t.item&&t.item.listenId&&"playing"===t.status?this.updateCurrentTime(t.item.listenId,+t.currentTime):this.stopCountdown()}))),this.__countdownResTime+=1}),1e3))},stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null,this.countdownIntervalId=void 0,this.__countdownResTime=0)},showTips(t,e=1500){t&&(this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsWording=t,this.tipsShow=!0,this.__tipsTimeout=setTimeout((()=>{this.tipsShow=!1,this.tipsWording=""}),e))},hideTips(){this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsShow=!1,this.tipsWording=""},callShutdownPanel(t){this.getStatus((()=>{const e=null==t?void 0:t.getBoundingClientRect();this.shutdownPanelPosition={top:void 0,left:void 0,bottom:"".concat(window.innerHeight-(e.bottom+26),"px"),right:"".concat(window.innerWidth-e.left+4,"px"),"--transform-origin-top":"".concat(e.bottom-e.height/2,"px"),"--transform-origin-left":"".concat(e.left-4,"px")},this.shutdownPanelShow=!0}))},registerClientListUpdatedListener(){!this.__hasRegisterClientListUpdatedListener&&this.supportDynamicPlayList&&(this.__hasRegisterClientListUpdatedListener=!0,c.on("onTingPlayListRefresh",this.onTingPlayListRefresh))},updateCurrentTime(t,e){var i,n,o;(null==(i=this.playInfo)?void 0:i.listen_id)===t&&e&&this.$set(this.playInfo,"currentTime",+e||0),(null==(n=this.tempStorePlayItem)?void 0:n.listen_id)&&(null==(o=this.tempStorePlayItem)?void 0:o.listen_id)===t&&e&&this.$set(this.tempStorePlayItem,"currentTime",+e||0),["undoneList","removedItems","showList","cardList"].forEach((i=>{this[i]&&(this[i]=[...this[i].map((i=>i&&i.listen_id===t&&e?(i.currentTime=+e||0,{...i}):i))].filter((t=>null==t?void 0:t.listen_item)))}))},batchRemoveFromListenLater(t){Promise.all(t.map((t=>new Promise((e=>Bn({listenId:t,onComplete:()=>e()})))))).then((()=>{this.undoneList=this.undoneList.filter((e=>-1===t.indexOf(e.listen_id))),this.showList=this.showList.filter((e=>-1===t.indexOf(e.listen_id))),this.isOpened&&this.doCombineList()}))},getFirstScreenData(){this.firstScreenDataError=!1,(({onSuccess:t,onError:e,onComplete:i})=>{f.setSum(Pt,20,1),g({url:"/mp/tts?action=getttslistenitem&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"GET",dataType:"json",async:!0,success:i=>{i&&i.base_resp&&0===i.base_resp.ret&&i.tts_listenitem?"function"==typeof t&&t(i):("function"==typeof e&&e(i),f.setSum(Pt,21,1))},error:()=>{"function"==typeof e&&e(),f.setSum(Pt,21,1)},complete:()=>{"function"==typeof i&&i()}})})({onSuccess:t=>{var e;this.firstScreenDataReady=!0,this.firstScreenDataError=!1,this.playInfo={...t.tts_listenitem,tts_model_type:(null==(e=t.listen_item_ext)?void 0:e.tts_model_type)||1},this.base64=t.merge_playlist_info_base64||"",this.$emit("list-base64-change",this.base64),"function"==typeof this.__firstScreenDataReadyCallback&&(this.__firstScreenDataReadyCallback(),this.__firstScreenDataReadyCallback=void 0)},onError:()=>{this.firstScreenDataReady=!1,this.firstScreenDataError=!0,"function"==typeof this.__firstScreenDataReadyCallback&&(this.__firstScreenDataReadyCallback(),this.__firstScreenDataReadyCallback=void 0)}})},report(t){var e,i;const n=[...this.undoneList||[],{listen_id:null==(e=this.playInfo)?void 0:e.listen_id,listen_item:this.playInfo}].find((t=>t.listen_id===this.playingListenId));try{const e={BizUin:window.biz,MsgId:+window.mid,Idx:+window.idx,ListenId:"".concat((null==n?void 0:n.listen_id)||""),ListenType:(null==(i=null==n?void 0:n.listen_item)?void 0:i.type)||0,Scene:1*window.source,SubScene:1*window.subscene,Pos:0,EventType:0,EventTime:parseInt(Date.now()/1e3,10),SessionId:"".concat(window.sessionid),EnterId:+window.enterid,ExpVersion:"5",PlayRate:parseInt(100*(this.playRate||1),10),ListenTime:parseInt(1e3*(+(null==n?void 0:n.currentTime)||0),10),ShutDownType:String(this.shutdownType)||"",ShutDownLeftTime:this.shutdownLeftTime||0,ListBase64:this.base64||"",TargetPos:0,...t};console.log("[audio panel] report data",e),v.report(34644,e)}catch(o){console.log("[audio panel] report error",o)}},play(t,e=!1,i=0,n=!1,o=void 0){var s,a,r;const l=Tt(t,i);let d={openPlayerUI:n,playMode:0,listenId:(null==t?void 0:t.listen_id)||"",itemList:[l],scene:o,playbackRate:this.playRate||1,categoryPlaylistInfoBuffer:this.base64||"",categoryDeleteAfterListen:!0};const u={protocol:"",src:function(){var e;const i=(null==(e=null==t?void 0:t.article_info)?void 0:e.audio_url)||"",n=window.clientversion;return n&&(n>"18000e00"&&n<="18000e2d"||n>"18000f00"&&n<="18000f24")?"".concat(i,"&t=").concat(Date.now()):i}(),lowbandUrl:(null==(s=null==t?void 0:t.article_info)?void 0:s.audio_url)||"",title:null==t?void 0:t.title,epname:"",singer:(null==t?void 0:t.author)||"",srcId:null==t?void 0:t.listen_id,coverImgUrl:(null==t?void 0:t.cover)||"",webUrl:(null==(a=null==t?void 0:t.article_info)?void 0:a.url)||"",musicbar_url:(null==(r=null==t?void 0:t.article_info)?void 0:r.url)||"",needStartMusicUI:0,playbackRate:this.playRate||1,startTime:i},p=It(null==t?void 0:t.type)&&1===jn;let h=p?"setTingAudioState":"setBackgroundAudioState";p&&!n&&this.playingListenId&&this.playingListenId===l.listenId&&xt&&!this.isPlaying&&!this.playLoading&&(h="operateTingAudio",d={operationType:"resume",srcId:this.playingSrcId,listenId:this.playingListenId}),c.invoke(h,p?d:u,(e=>{console.log("[audio panel] play",h,p?d:u,e),_.info("[audio panel] play ".concat(h," opt:").concat(JSON.stringify(p?d:u)," res:").concat(JSON.stringify(e))),-1===e.err_msg.indexOf("ok")?(this.hide(),window.weui.alert("暂无法播放，请重试"),f.setSum(Pt,17,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("t1t read fail","res: ".concat(JSON.stringify(e)," | url: ").concat(location.href),{mid:"mmbizwap:t1t_read_fail",view:"wap_business"})):(this.isPlaying=!0,this.playingListenId=t.listen_id||"",this.playingSrcId=t.listen_id||"",this.startCardTitleAnime(),this.getStatus((()=>{}),!1))}))},pause(t=!0){const e={operationType:"pause",srcId:this.playingSrcId,listenId:this.playingListenId},i=It(this.playingType)&&1===jn?"operateTingAudio":"operateBackgroundAudio";c.invoke(i,e,(t=>{console.log("[audio panel] ".concat(i,": params:"),e,"res:",t),-1!==t.err_msg.indexOf("ok")&&(this.isPlaying=!1)})),this.pauseCardTitleAnime()},setCurrentTime(t,e){var i;const n=this.undoneList.findIndex((t=>t.listen_id===this.playingListenId)),o=((null==(i=this.undoneList)?void 0:i[n])||this.playingInfo).listen_item.duration/1e3,s=parseInt(Math.max(Math.min(t,o),0),10),a={operationType:"seek",srcId:this.playingSrcId||"",seektime:s,listenId:this.playingListenId||""},r="operateTingAudio";c.invoke(r,a,(t=>{console.log("[audio panel] ".concat(r),a,t),"function"==typeof e&&e()}))},getStatus(t,e=!0){c.invoke(jn?"getTingAudioState":"getBackgroundAudioState",{sourceType:1},(i=>{console.log("[audio panel] getStatus",jn?"getTingAudioState":"getBackgroundAudioState",i);let n=i.shutdown;if("string"==typeof i.shutdown&&i.shutdown)try{n=JSON.parse(i.shutdown)}catch(o){n=null}n?("afterMins"===n.shutdownType?this.shutdownType=n.time||0:this.shutdownType=n.shutdownType||"none",this.shutdownLeftTime=n.leftTime||0):(this.shutdownType="none",this.shutdownLeftTime=0),i&&i.item&&i.item.listenId&&e&&this.onGetStatusChange(i),"function"==typeof t&&t(i)}))},registerStatusObserver(){["onTingAudioStateChanged","onBackgroundAudioStateChange"].forEach((t=>{c.on(t,(t=>{t&&t.item&&t.item.listenId&&this.onGetStatusChange(t)}))}))},getPlayFinishedState(t,e=!1,i=!0){const n=(t||(this.undoneList||[]).map((t=>t.listen_id))).filter((t=>t))||[];n.length&&c.invoke("operateTingAudio",{operationType:"getFinishedState",listenIds:n},(t=>{if(t&&t.err_msg&&-1!==t.err_msg.indexOf(":ok")){let n=t.results||[];if(u.isAndroid&&"string"==typeof t.results)try{n=JSON.parse(n||"[]")||[]}catch(o){n=[]}n.forEach((t=>{this.updateCurrentTime(t.listenId,+t.currentTime);const e=this.undoneList.findIndex((e=>t.listenId===e.listen_id));-1!==e&&this.$set(this.undoneList[e],"finished",t.finished)})),i&&this.getStatus((()=>this.removeFinishedAudio({results:n})),!e)}console.log("[audio panel] getPlayFinishedState",n,t)}))},notifyAppListChange(){this.supportDynamicPlayList&&this.isOpened&&c.invoke("operateTingAudio",{operationType:"refreshPlayList",listenId:this.playingListenId||this.playInfo.listen_id||"",categoryPlaylistInfoBuffer:this.base64||""},(t=>{console.log("[audio panel] notify app refreshPlayList",t)}))},onShow(){this.isShow=!0,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!0},(t=>console.log("[audio panel] setForegroundState:true res:".concat(JSON.stringify(t)))))},onHide(){var t;this.isShow=!1,this.dragMoving=!1,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!1},(t=>console.log("[audio panel] setForegroundState:false res:".concat(JSON.stringify(t))))),this.finishCardTitleAnime(),this.$refs.bottomModal.scrollTo(0),this.report({EventType:3}),null==(t=this.$refs.slideGroup)||t.reset()},onVisibilityChange(){const t="visible"===document.visibilityState;t&&this.undoneList&&this.undoneList.length&&this.isOpened&&this.getUndoneList(!1),t?(this.getStatus(),c.invoke("operateTingAudio",{operationType:"setForegroundState",isForeground:this.isShow,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>console.log("[audio panel] setForegroundState:true res:".concat(JSON.stringify(t))))),this.isShow&&this.startCardTitleAnime()):this.finishCardTitleAnime()},onGetStatusChange(t){var e,i;if(-1===[2,3,4].indexOf(t.item.type))return;const n=t.status;this.playingListenId=t.item.listenId,this.playingSrcId=t.item.srcId,this.playingType=t.item.type,"playing"===n?(this.isPlaying=!0,this.playLoading=!1,this.startCountDown()):"loading"===n?(this.isPlaying=!1,this.playLoading=!0,this.stopCountdown()):(this.playLoading=!1,this.isPlaying=!1,"idle"===n&&(this.playingListenId="",this.playingSrcId=""),this.stopCountdown()),t.duration&&this.playingInfo&&((null==(e=this.playingInfo.listen_item)?void 0:e.duration)&&this.playingInfo.listen_item.duration/1e3===t.duration||(["undoneList","removedItems","showList","cardList"].forEach((e=>{this[e]&&(this[e]=this[e].map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)).filter((t=>null==t?void 0:t.listen_item)))})),this.playInfo.listen_id===t.item.listenId&&this.$set(this.playInfo,"duration",1e3*t.duration),(null==(i=this.tempStorePlayItem)?void 0:i.listen_item)&&this.tempStorePlayItem.listen_id===t.item.listenId&&this.$set(this.tempStorePlayItem.listen_item,"duration",1e3*t.duration))),t&&t.playRate&&t.playRate!==this.playRate&&(this.playRate=+t.playRate,ft.set("playRate",+t.playRate)),(this.lastPlayId!==t.item.listenId||1===this.undoneList.length&&"playing"!==t.status)&&this.getPlayFinishedState([this.lastPlayId],!0),this.lastPlayId&&this.lastPlayId!==t.item.listenId&&this.onSwitchAudio(t.item.listenId,this.lastPlayId),this.lastPlayId=t.item.listenId},onSwitchAudio(t,e){t===this.playInfo.listen_id?this.fromType="tts":this.fromType="star",this.__onClickSwitching?(this.finishCardTitleAnime(),setTimeout((()=>this.startCardTitleAnime()),16)):this.showList=this.undoneList.filter((e=>e.listen_id!==t)),this.__onClickSwitching=!1},onListScreenExpose(){},onBackWrpExpose(){var t;this.report({EventType:21,ListenId:(null==(t=this.tempStorePlayInfo)?void 0:t.listenId)||""})},onPlayScreenExpose(){this.showBorder=!1},onPlayScreenLeave(){this.showBorder=!0},onProgressExpose(){this.showPlayingBar=!1},onProgressLeave(){this.showPlayingBar=!0},onListItemExpose(t,e){},onListItemLeave(t,e){},onClickPlayingBar(){var t,e;const i=null==(e=null==(t=this.$refs.bottomModal)?void 0:t.getScrollEle)?void 0:e.call(t);null==i||i.scrollTo({top:0,behavior:"smooth"})},onClickListenItem(t){this.setPlay(t,"star",!1,"list",(()=>{const e=this.undoneList.some((t=>t.listen_id===this.playingListenId));this.__onClickSwitching=!0,this.showList=[...e?[this.playingInfo]:[],...this.undoneList].filter((e=>e.listen_id!==t.listen_id)).filter(bt("listen_id"))}))},onSeeking(t){this.stopCountdown(),this.updateCurrentTime(this.playingListenId,parseInt(t,10)),this.__hasReportSeeking||(this.__hasReportSeeking=!0,this.report({EventType:18}),f.setSum(Pt,28,1))},onSeeked(t){this.updateCurrentTime(this.playingListenId,parseInt(t,10)),this.setCurrentTime(t),this.startCountDown(),this.__hasReportSeeking=!1,this.report({EventType:19}),f.setSum(Pt,29,1)},onSetShutdown(t){const{key:e}=t||{};"number"==typeof e?c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:"afterMins",time:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown afterMins",t),/:ok$/.test(t.err_msg)&&this.showTips("将在".concat(e,"分钟后停止播放"))})):(c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown",e,t),/:ok$/.test(t.err_msg)&&("none"===e?this.hideTips():this.showTips("将在此音频播放结束时停止播放"))})),"none"===e&&f.setSum(Pt,31,1)),this.shutdownType=e,"number"==typeof e&&(this.shutdownLeftTime=e),this.report({EventType:17}),f.setSum(Pt,30,1)},onBackward(t){var e;const i=Math.max(((null==(e=this.playingInfo)?void 0:e.currentTime)||0)-t,0);this.updateCurrentTime(this.playingListenId,parseInt(i,10)),this.setCurrentTime(i),this.report({EventType:14}),f.setSum(Pt,25,1)},onForward(t){var e,i;const n=Math.min(((null==(e=this.playingInfo)?void 0:e.currentTime)||0)+t,((null==(i=this.playingInfo)?void 0:i.duration)||1/0)/1e3);this.updateCurrentTime(this.playingListenId,parseInt(n,10)),this.setCurrentTime(n),this.report({EventType:15}),f.setSum(Pt,26,1)},onChangeRate(){const t=[1,1.25,1.5,.75],e=t.indexOf(this.playRate),i=t[(e+1)%t.length];this.playRate=i,c.invoke("operateTingAudio",{operationType:"playRate",srcId:this.playingSrcId||"",playRate:this.playRate,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setPlayRate",t),1!==this.playRate?this.showTips("已切换至".concat(this.playRate,"倍速播放")):this.hideTips()})),ft.set("play-rate",i),this.report({EventType:16}),f.setSum(Pt,27,1)},onTingPlayListRefresh(t){console.log("[audio panel] onTingPlayListRefresh",t)},onSlideStart(){this.slideMoving=!0},onSlideEnd(){this.slideMoving=!1},onStar(){this.hasStar=!0,Rn({listenId:this.playInfo.listen_id,onSuccess:()=>this.doCombineList()})},onMoveChosen(){this.dragMoving=!0,document.addEventListener("touchmove",this.onDragMove,{capture:!0}),c.invoke("vibrateShort",{style:"medium"})},onMoveUnchoose(){this.dragMoving=!1},onMoveStart(t){this.dragMoving=!0,this.__dragStartY=t.originalEvent.pageY,this.transitionDis=0,this.transitionGapByScroll=0},onDragMove(t){const e=((t.touches&&t.touches[0]||{}).pageY||0)-this.__dragStartY;this.transitionDis=e+(u.isIOS?this.transitionGapByScroll:0),t.preventDefault()},onMoveDone(){this.dragMoving=!1,document.removeEventListener("touchmove",this.onDragMove)},onMoveUpdate(t){this.dragMoving=!1,this.__disableTransitionTimeout&&(clearTimeout(this.__disableTransitionTimeout),this.__disableTransitionTimeout=null),this.disableTransition=!0,this.__disableTransitionTimeout=setTimeout((()=>{this.disableTransition=!1}),500),On({from:"star",listenId:t.data.listen_id||"",pos:this.undoneList.some((t=>t.listen_id===this.playingListenId))?t.newIndex+1:t.newIndex,onSuccess:()=>this.doCombineList(this.playingListenId)});const e=this.undoneList.findIndex((t=>t.listen_id===this.playingListenId)),i=t.oldIndex+(e>=0&&e<=t.oldIndex?1:0),n=t.newIndex+(e>=0&&e<=t.newIndex?1:0),o={...this.undoneList[i]||{}};let s=[...this.undoneList.slice(0,i),...this.undoneList.slice(i+1)];this.undoneList=[...s.slice(0,n),o,...s.slice(n)],this.report({EventType:25,Pos:i,TargetPos:n,ListenId:t.data.listen_id})},startCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.play()},pauseCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.pause()},finishCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.finish()},async onPullupLoad(){this.undoneListHasNext&&await this.getUndoneList(),setTimeout((()=>this.$refs.bottomModal.finishPullUpLoad()))},getUndoneList(t=!0){return new Promise((e=>{this.getUndoneListLoading||!this.undoneListHasNext&&t?e():(t||(this.undoneListHasNext=!0),this.getUndoneListLoading=!0,(({listenId:t,buffer:e,onSuccess:i,onError:n,onComplete:o})=>{g({url:"/mp/listenplayerv2?action=get_playlist",type:"POST",data:{listen_id:t||"",last_listen_id:e?Mn:"",count:20,playlist_type:2,session_buffer:e||""},async:!0,dataType:"json",success:t=>{if(t&&t.base_resp&&0===t.base_resp.ret){if("function"==typeof i&&i(t),t&&t.results&&t.results.length){const e=t.results[t.results.length-1];Mn=e&&e.listen_id||""}}else"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})})({listenId:this.playInfo.listen_id||"",buffer:t?this.undoneListBuffer:"",onSuccess:i=>{var n,o,s;const a=null==(o=null==(n=i.results)?void 0:n.filter((t=>null==t?void 0:t.listen_item)))?void 0:o.map((t=>{var e,n;return{...t,listen_item:{...t.listen_item,tts_model_type:(null==(n=null==(e=i.listen_item_ext)?void 0:e.find((e=>(null==e?void 0:e.listen_id)===t.listen_id)))?void 0:n.tts_model_type)||1}}}));if(t)this.undoneList=[...this.undoneList,...a].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id"));else{this.undoneList=[...a].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id"));const t=null==(s=i.listen_item_ext)?void 0:s.find((t=>{var e;return(null==t?void 0:t.listen_id)===(null==(e=this.playInfo)?void 0:e.listen_id)}));t&&(this.hasStar=1===t.star)}this.showList=this.undoneList.filter((t=>(null==t?void 0:t.listen_id)!==this.playingListenId)),this.undoneListHasNext=i.has_more,this.base64=i.merge_playlist_info_base64||"",this.undoneListBuffer=i.session_buffer||"",this.getPlayFinishedState(a.map((t=>t.listen_id)),!0,!1),this.getUndoneListLoading=!1,e()},onError:()=>{this.undoneListError=!0,this.getUndoneListLoading=!1,e()}}))}))},doCombineListRaw(t){"hidden"!==document.visibilityState&&(this.doingCombine?this.needDoCombine=!0:(this.doingCombine=!0,this.needDoCombine=!1,(({listenId:t,pos:e,onSuccess:i,onError:n,onComplete:o})=>{g({url:"/mp/listenplayerv2?action=refresh",type:"POST",data:{listen_id:t||"",target_pos:e||0,playlist_type:3},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i(t):"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})})({listenId:t||this.playInfo.listen_id,pos:0,onSuccess:()=>{this.doingCombine=!1,this.notifyAppListChange(),this.needDoCombine&&this.doCombineList()},onError:()=>{this.doingCombine=!1}})))},setPlay(t,e="star",i=!1,n,o){var s;if(!(null==t?void 0:t.listen_id))return;if(this.isPlaying&&this.playingListenId===(null==t?void 0:t.listen_id))return this.pause(!0),void this.report({EventType:5});const a=this.undoneList.find((e=>e.listen_id===t.listen_id));("tts"!==e||a)&&(On({from:"tts"===e?a?"star":"done":e,listenId:t.listen_id,...this.playingListenId?{currentListenId:this.playingListenId}:{},onSuccess:()=>this.doCombineList(this.playingListenId)}),"function"==typeof o?o():this.undoneList=[{...t},...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id"))),this.fromType=e,this.play(t.listen_item,!0),i||this.report({EventType:4,ListenId:(null==t?void 0:t.listen_id)||"",ListenType:(null==(s=null==t?void 0:t.listen_item)?void 0:s.type)||0,ListBase64:this.base64||""}),"show"!==n&&(this.showBackWrp=!1)},setPlayNextNew(t,e="star"){var i,n;const o={...t};this.playingListenId&&this.playingListenId===(null==(n=null==(i=this.undoneList)?void 0:i[0])?void 0:n.listen_id)?(this.undoneList=[this.undoneList[0],o,...this.undoneList.slice(1)||[]].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),On({from:e,listenId:t.listen_id,pos:1,onSuccess:()=>this.doCombineList(this.playingListenId)})):(this.undoneList=[o,...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),On({from:e,listenId:t.listen_id,pos:0,onSuccess:()=>this.doCombineList(this.playingListenId)})),this.report({EventType:23,ListenId:t.listen_id})},setPlayDone(t){Bn({listenId:t}),this.undoneList=this.undoneList.filter((e=>e.listen_id!==t)),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId))},getStarStatus(){(({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{g({url:"/mp/listenplayerv2?action=check_star",type:"POST",data:{listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e(t):"function"==typeof i&&i(t)},error:()=>{"function"==typeof i&&i()},complete:()=>{"function"==typeof n&&n()}})})({listenId:this.playInfo.listen_id,onSuccess:t=>this.hasStar=t.star})},setStar(t){t.listen_id===this.playInfo.listen_id&&c.invoke("operateStar",{opType:"addStar"},(()=>{this.hasStar=!0,window.dispatchEvent(new CustomEvent("star",{detail:{from:"frontend"}}))})),Rn({listenId:t.listen_id,onSuccess:()=>this.doCombineList(this.playingListenId)}),this.hasStar=!0,this.undoneList=[t,...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),this.report({EventType:6})},cancelStar(t,e=!1){t.listen_id===this.playInfo.listen_id&&c.invoke("operateStar",{opType:"cancelStar"},(()=>{this.hasStar=!1,window.dispatchEvent(new CustomEvent("cancel-star",{detail:{from:"frontend"}}))})),(({listenId:t,from:e,onSuccess:i,onError:n,onComplete:o})=>{g({url:"/mp/listenplayerv2?action=rm_from_playlist",type:"POST",data:{playlist_type:"star"===e?2:4,listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i(t):"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})})({listenId:t.listen_id,from:"star",onSuccess:()=>this.doCombineList(this.playingListenId)}),this.hasStar=!1,this.undoneList=this.undoneList.filter((e=>e.listen_id!==t.listen_id)),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),this.removedItems=[t,...this.removedItems].filter(bt("listen_id")),e?this.report({EventType:24,ListenId:t.listen_id}):this.report({EventType:12})},handleClickFullscreen(){this.play(this.playingInfo.listen_item,!0,0,!0),this.hide()},handleStar(t){"star"===t.type?this.hasStar=!0:"cancel-star"===t.type&&(this.hasStar=!1)},onClickStar(t){this.hasStar?this.cancelStar(t):this.setStar(t)},onClickBack(){const t=this.tempStorePlayInfo,e=this.getTempListenItem(t),i=this.undoneList.findIndex((t=>t.listen_id===this.tempStorePlayInfo.listenId))>-1;this.setPlay({listen_id:this.tempStorePlayInfo.listenId,listen_item:e},i?"star":"tts",!0),this.showBackWrp=!1,this.report({EventType:22,ListenId:this.tempStorePlayInfo.listenId})},getTempListenItem:t=>t?{...t,listen_id:t.listenId,url:t.webUrl||"",...t.mpInfo?{author_info:{username:t.mpInfo.username,nickname:t.mpInfo.name},article_info:{bizuin:t.mpInfo.bizUin,url:t.webUrl,audio_id:t.mpInfo.audioId,audio_url:t.dataUrl}}:{}}:{}}},(function(){var t,e,i,n,o,s,a,r,l,d,u,c,p=this,h=p._self._c;return h("div",{ref:"container"},[h("mp-bottom-modal",{ref:"bottomModal",attrs:{"close-btn-type":"fold","ext-class":"audio-panel-modal audio-panel-modal-for-star ".concat(p.slideMoving?"audio-panel-disable-touch-action":""),top:p.modalTop,"need-head-line":!1,"hide-when-sideslip":!p.dragMoving,"hide-when-scroll-down":!p.dragMoving,"header-type":"slide"},on:{show:p.onShow,hide:p.onHide,"click-slide-btn":p.hide,"pullup-load":p.onPullupLoad,"show-after-animation":p.startCardTitleAnime}},[h("div",{ref:"wrp",staticClass:"audio-panel__wrp"},[p.firstScreenDataReady||p.firstScreenDataError?!p.firstScreenDataReady&&p.firstScreenDataError?h("div",{ref:"playWrp",staticClass:"audio-panel__screen error",on:{click:p.getFirstScreenData}},[h("div",{staticClass:"weui-loadmore"},[h("div",{staticClass:"weui-loadmore__tips"},[p._v("加载失败，请点击重试")])])]):[1===p.version?h("div",{staticClass:"audio-panel__playing-bar-wrp"},[h("transition",{attrs:{name:"fade"}},[h("div",{directives:[{name:"show",rawName:"v-show",value:p.showPlayingBar&&(null==(t=p.playingInfo)?void 0:t.listen_item)&&(p.isPlaying||p.playLoading||p.playChanging),expression:"showPlayingBar && playingInfo?.listen_item && (isPlaying || playLoading || playChanging)"}],staticClass:"audio-panel__playing-bar",on:{click:p.onClickPlayingBar}},[h("span",[p._v("正在播放 : "+p._s((null==(n=null==(i=null==(e=p.playingInfo)?void 0:e.listen_item)?void 0:i.article_info)?void 0:n.audio_title)||(null==(s=null==(o=p.playingInfo)?void 0:o.listen_item)?void 0:s.title)))])])])],1):p._e(),h("Intersect",{attrs:{threshold:[0]},on:{enter:p.onPlayScreenExpose,leave:p.onPlayScreenLeave}},[h("div",{ref:"playWrp",staticClass:"audio-panel__screen info-screen"},[h("div",{staticClass:"audio-panel__play-area",class:{"show-progress":p.showProgress}},[h("div",{ref:"playerCover",staticClass:"audio-panel__play-area__cover",style:"background-image: url(".concat(p.playingListenItem&&p.playingListenItem.cover,")")}),h("div",{staticClass:"audio-panel__play-area__right"},[h("div",{staticClass:"audio-panel__play-area__info"},[h("div",{staticClass:"info-title__wrp"},[h("TextMarquee",{ref:"cardTitle",staticClass:"anime-title",attrs:{title:p.showTitle}}),h("span",{directives:[{name:"show",rawName:"v-show",value:p.playInfo.listen_id===p.playingListenId,expression:"playInfo.listen_id === playingListenId"}],staticClass:"star-wrp",on:{click:function(t){return p.onClickStar(p.playingInfo)}}},[h("i",{class:p.hasStar?"icon-star-fill":"icon-star"})])],1),h("div",{staticClass:"info-desc"},[p.playingListenItem.finder_info?h("div",{staticClass:"finder-icon"}):p._e(),h("span",{staticClass:"info-desc__author",attrs:{id:"info-desc__author"}},[p._v(p._s(p.playingListenItem.author))]),p.playingListenItem.finder_info?p._e():[2===p.playingListenItem.tts_model_type?h("span",[p._v("作者音色朗读")]):2!==p.playingListenItem.type?h("span",{staticClass:"info-desc__duration"},[p._v("音频由作者上传")]):p._e()]],2)])])]),h("Intersect",{attrs:{threshold:[.5]},on:{enter:p.onProgressExpose,leave:p.onProgressLeave}},[h("div",{staticClass:"audio-panel__operate-area-wrp"},[h("Progress",{key:"progress",attrs:{"play-rate":+p.playRate,"is-playing":p.isPlaying||p.playLoading,"current-time":Math.min((null==(a=p.playingInfo)?void 0:a.currentTime)||0,(null==(l=null==(r=p.playingInfo)?void 0:r.listen_item)?void 0:l.duration)||0),"has-set-shut-down":"none"!==p.shutdownType,duration:(null==(u=null==(d=p.playingInfo)?void 0:d.listen_item)?void 0:u.duration)||0},on:{"change-rate":function(t){return p.onChangeRate()},"set-shutdown":p.callShutdownPanel,forward:function(t){return p.onForward(30,0)},backward:function(t){return p.onBackward(15,0)},"toggle-play":function(t){return p.setPlay(p.playingInfo,p.fromType)},seeked:t=>p.onSeeked(t,0),seeking:t=>p.onSeeking(t,0)}})],1)])],1)]),h("Intersect",{attrs:{threshold:[0]},on:{enter:p.onListScreenExpose}},[h("div",{ref:"listScreen",staticClass:"audio-panel__screen list-screen"},[h("transition",{attrs:{name:"collapse"}},[p.showBackWrpComputed?h("div",{staticClass:"back-wrp",on:{click:p.onClickBack}},[h("i",{staticClass:"icon-back"}),h("span",{staticClass:"back-wrp__title"},[p._v("上次播放")]),h("span",[p._v(p._s((null==(c=p.tempStorePlayInfo)?void 0:c.title)||""))])]):p._e()]),h("div",{staticClass:"audio-panel__list-area",style:"--drag-ghost-transition-dis: ".concat(p.transitionDis,"px;")},[h("div",{ref:"listSubTitle",staticClass:"sub-title"},[p._v("播放列表")]),h("div",{ref:"listSubTitle",staticClass:"sub-desc"},[p._v(p._s(p.undoneList.length?"内容来源于星标":"添加到星标的内容将在这里"))]),h("mp-slide-view-group",{ref:"slideGroup"},[h("VueDraggable",{attrs:{delay:300,scroll:!0,"bubble-scroll":!1,"scroll-fn":p.onDragScroll,"touch-start-threshold":5,disabled:!p.supportDynamicPlayList&&!p.slideMoving,target:".audio-list-sort-wrp"},on:{end:p.onMoveDone,start:p.onMoveStart,update:p.onMoveUpdate,choose:p.onMoveChosen,unchoose:p.onMoveUnchoose},model:{value:p.showList,callback:function(t){p.showList=t},expression:"showList"}},[h("transition-group",{staticClass:"audio-list-sort-wrp",attrs:{name:"audio-list"}},p._l(p.showList,(function(t,e){return h("mp-slide-view",{key:"slide-item-".concat(t.listen_id),attrs:{disabled:!p.supportDynamicPlayList&&!p.dragMoving,"extra-class":["audio-list__item-slide-wrp","pos-".concat(e),p.playingListenId===t.listen_id?"now-playing":"",p.disableTransition?"disable-transition":""]},on:{end:p.onSlideEnd,start:p.onSlideStart},scopedSlots:p._u([{key:"btns",fn:function(){return[h("mp-slide-item",{attrs:{"not-last":e>=1},on:{click:function(e){return p.cancelStar(t)}}},[p._v("删除")]),e>=1?h("mp-slide-item",{directives:[{name:"show",rawName:"v-show",value:!p.dragMoving,expression:"!dragMoving"}],attrs:{"extra-class":"slide-item-warn"},on:{click:e=>p.setPlayNextNew(t,"star")}},[p._v("下一个播放")]):p._e()]},proxy:!0}],null,!0)},[h("Intersect",{attrs:{threshold:[0]},on:{enter:t=>p.onListItemExpose(t,e),leave:t=>p.onListItemLeave(t,e)}},[h("audio-list-item",{key:"audio-".concat(t.listen_id),ref:"audioItem",refInFor:!0,attrs:{info:t,version:p.version,"play-rate":+p.playRate,"need-finish-state":!1,"is-playing":p.isPlaying||p.playLoading,playing:p.playingListenId===t.listen_id,"has-set-shut-down":"none"!==p.shutdownType},on:{pause:function(t){return p.pause(!1)},"change-rate":function(t){return p.onChangeRate()},"set-shutdown":p.callShutdownPanel,forward:function(t){return p.onForward(30,e)},backward:function(t){return p.onBackward(15,e)},click:function(e){return p.onClickListenItem(t)},seeked:t=>p.onSeeked(t,e),seeking:t=>p.onSeeking(t,e)}})],1)],1)})),1)],1)],1),h("div",{directives:[{name:"show",rawName:"v-show",value:!p.getUndoneListLoading&&!p.undoneListHasNext&&!p.undoneList.length,expression:"!getUndoneListLoading && !undoneListHasNext && !undoneList.length"}],staticClass:"weui-loadmore empty"},[h("span",{staticClass:"weui-loadmore__tips"},[p._v("暂无星标内容,")]),h("span",{staticClass:"weui-loadmore__tips"},[p._v("加入的星标内容将在这里")])]),h("div",{directives:[{name:"show",rawName:"v-show",value:p.getUndoneListLoading,expression:"getUndoneListLoading"}],staticClass:"weui-loadmore"},[h("div",{staticClass:"weui-loadmore__tips"},[h("i",{staticClass:"weui-loading"})])]),h("div",{directives:[{name:"show",rawName:"v-show",value:!p.getUndoneListLoading&&!p.undoneListHasNext&&p.undoneList.length,expression:"!getUndoneListLoading && !undoneListHasNext && undoneList.length"}],staticClass:"weui-loadmore weui-loadmore_line weui-loadmore_dot"},[h("span",{staticClass:"weui-loadmore__tips"})])],1)],1)])]:h("div",{ref:"playWrp",staticClass:"audio-panel__screen empty"},[h("div",{staticClass:"weui-loadmore"},[h("div",{staticClass:"weui-loadmore__tips"},[h("i",{staticClass:"weui-loading"})])])]),h("div",{staticClass:"audio-panel__modal-bottom-mask",on:{touchstart:function(t){t.stopPropagation(),t.preventDefault()},touchmove:function(t){t.stopPropagation(),t.preventDefault()},touchend:function(t){t.stopPropagation(),t.preventDefault()}}})],2)]),h("Teleport",{attrs:{to:"body"}},[h("Tips",{attrs:{"tips-wording":p.tipsWording},model:{value:p.tipsShow,callback:function(t){p.tipsShow=t},expression:"tipsShow"}}),h("OptionMenu",{attrs:{"active-key":p.shutdownType,"wrp-style":p.shutdownPanelPosition,options:p.shutdownOptions},on:{select:p.onSetShutdown},model:{value:p.shutdownPanelShow,callback:function(t){p.shutdownPanelShow=t},expression:"shutdownPanelShow"}})],1)],1)}),[],!1,null,"03413efa",null,null).exports;let Nn="";const Fn=({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{g({url:"/mp/listenplayer?action=add_to_playlist",type:"POST",data:{playlist_type:2,listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e(t):"function"==typeof i&&i(t)},error:()=>{"function"==typeof i&&i()},complete:()=>{"function"==typeof n&&n()}})},Hn=({listenId:t,from:e,onSuccess:i,onError:n,onComplete:o})=>{g({url:"/mp/listenplayer?action=rm_from_playlist",type:"POST",data:{playlist_type:"star"===e?2:4,listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i(t):"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})},$n=({listenId:t,pos:e,from:i,currentListenId:n,onSuccess:o,onError:s,onComplete:a})=>{g({url:"/mp/listenplayer?action=move",type:"POST",data:{playlist_type:"star"===i?2:4,listen_id:t,target_pos:e||0,to_playlist_type:2,current_play_listen_id:n||""},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof o&&o(t):"function"==typeof s&&s(t)},error:()=>{"function"==typeof s&&s()},complete:()=>{"function"==typeof a&&a()}})},Wn=({listenId:t,pos:e,onSuccess:i,onError:n,onComplete:o})=>{"function"==typeof o&&o()};let Jn=0;const Vn=P({name:"mp-audio-panel",filters:{durationFormatter:t=>wt(t),durationNumFormatter:t=>wt(t,2)},components:{Tips:fn,Header:vn,Progress:wn,Teleport:n,Intersect:o,OptionMenu:Sn,TextMarquee:Cn,VueDraggable:_n,[In.name]:In,[s.name]:s,[a.name]:a,[r.name]:r,[l.name]:l},provide(){return{supportSetShutdown:At,supportDynamicPlayList:xt,version:this.$options.version||1}},data(){const t=h.os.pc?"20%":"".concat(screen.height/10*3-(screen.height-window.innerHeight),"px"),e=ft.get("play-rate")||1;return{starVersion:!0,modalTop:t,shutdownOptions:[{key:"none",value:"不开启"},...[15,30,60,90].map((t=>({key:t,value:"".concat(t,"分钟")}))),{key:"whenEnd",value:"当前单集结束后"}],version:this.$options.version||1,firstScreenDataReady:!1,firstScreenDataError:!1,isShow:!1,isPlaying:!1,playLoading:!1,playingType:0,playingListenId:"",playingSrcId:"",hasInList:!1,removedItems:[],cardList:[],playInfo:{},base64:"",lastPlayId:"",isOpened:!1,tipsShow:!1,tipsWording:"",shutdownType:"none",shutdownLeftTime:0,shutdownPanelShow:!1,shutdownPanelPosition:{top:"100vh",left:"100vw"},dragMoving:!1,slideMoving:!1,needUpdate:!1,playChanging:!1,showPlayingBar:!1,disableTransition:!1,transitionDis:0,transitionGapByScroll:0,playRate:e,showList:[],undoneList:[],undoneListBuffer:"",undoneListError:!1,undoneListHasNext:!0,getUndoneListLoading:!1,hasStar:!1,needDoCombine:!1,doingCombine:!1,fromType:"tts",tempStorePlayInfo:null,showBackWrp:!1,tempStorePlayItem:null,showBorder:!1,supportSetShutdown:At,supportDynamicPlayList:xt}},computed:{playBtnIconClass(){const t=this.playingListenId===this.playInfo.listen_id,e=this.isPlaying&&t;return t&&this.playLoading?"weui-loading":e?"icon-pause":"icon-play"},playingInfo(){var t,e;const i={listen_id:null==(t=this.playInfo)?void 0:t.listen_id,listen_item:this.playInfo,currentTime:this.playInfo.currentTime};return this.undoneList.find((t=>t.listen_id===this.playingListenId))||(this.playingListenId===i.listen_id?i:null)||(this.playingListenId===(null==(e=this.tempStorePlayItem)?void 0:e.listen_id)?this.tempStorePlayItem:null)||this.cardList.find((t=>t.listen_id===this.playingListenId))||this.removedItems.find((t=>t.listen_id===this.playingListenId))||i},playingListenItem(){var t;return(null==(t=this.playingInfo)?void 0:t.listen_item)||{}},showProgress:()=>!0,showTitle(){var t,e;return(null==(e=null==(t=this.playingListenItem)?void 0:t.article_info)?void 0:e.audio_title)||this.playingListenItem.title},playingListenItemHasInList(){return this.undoneList.findIndex((t=>t.listen_id===this.playingListenId))>-1},tempInfoHasInList(){return this.tempStorePlayInfo&&this.undoneList.findIndex((t=>t.listen_id===this.tempStorePlayInfo.listenId))>-1}},watch:{undoneList(t){-1!==(t||[]).findIndex((t=>t.listen_id===this.playInfo.listen_id))?this.hasInList=!0:this.hasInList=!1}},created(){this.getFirstScreenData(),this.doCombineList=vt(this.doCombineListRaw,1e3),c.invoke("getTingAudioState",{},(t=>{/:ok$/.test(t.err_msg)?Jn=1:-9999!==t.err_code&&-1===t.err_msg.indexOf("function_not_exist")||(Jn=0),this.getStatus((t=>{t.playRate&&(this.playRate=+t.playRate,ft.set("play-rate",+t.playRate))}))}))},mounted(){var t;this.registerStatusObserver(),document.addEventListener("visibilitychange",this.onVisibilityChange);const e=document.querySelector(".audio-panel-modal .weui-half-screen-dialog__bd"),i=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");i&&i.addEventListener("scroll",this.onScroll),e.addEventListener("touchmove",(t=>{if(this.dragMoving)return t.preventDefault(),t.stopPropagation(),!1})),this.onDragScroll=(t,i,n,o,s)=>{e.scrollTop+=i,this.transitionGapByScroll+=i,this.transitionDis+=i},this.updateCardList()},beforeDestroy(){this.stopCountdown(),document.removeEventListener("visibilitychange",this.onVisibilityChange)},methods:{show(t){try{if(!this.firstScreenDataReady)return this.$refs.bottomModal.show(),this.__firstScreenDataReadyCallback=()=>this.show(t),!0;const e=t||this.playInfo,i={listen_id:null==e?void 0:e.listen_id,listen_item:e};return this.getUndoneList(!1).then((()=>{~this.undoneList.findIndex((t=>t.listen_id===i.listen_id))&&this.playingListenId===i.listen_id&&(this.undoneList=[{...i},...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),$n({from:"star",listenId:i.listen_id,...this.playingListenId?{currentListenId:this.playingListenId}:{},onSuccess:()=>this.doCombineList(this.playingListenId)}))})),this.$refs.bottomModal.show(),this.isPlaying&&(null==e?void 0:e.listen_id)===this.playingListenId&&this.playingListenId||(this.playingListenId&&this.playingListenId!==(null==e?void 0:e.listen_id)?this.getStatus((t=>{this.tempStorePlayInfo=t.item;const e=this.getTempListenItem(this.tempStorePlayInfo);this.tempStorePlayItem={listen_id:e.listen_id,listen_item:e},this.showBackWrp=!0,this.setPlay(i,"tts","show"),this.doCombineList()})):(this.showBackWrp=!1,this.setPlay(i,"tts"),this.doCombineList())),this.isOpened=!0,this.registerClientListUpdatedListener(),this.getStatus((t=>{t.playRate&&(this.playRate=+t.playRate,ft.set("play-rate",+t.playRate))})),this.report({EventType:2}),f.setSum(Pt,8,1),!0}catch(e){return console.error("[audio panel] showError",e),_.error("[audio panel] showError: ".concat(e.message)),!1}},hide(){this.$refs.bottomModal.hide(),this.__titleAnime&&(this.__titleAnime.cancel(),this.__titleAnime=void 0)},updateCardList(){this.cardList=[...document.querySelectorAll("mp-common-mpaudio,mp-common-claudio")].map(Lt).filter((t=>t.listen_id)).map((t=>({listen_id:t.listen_id,listen_item:t})))},removeFinishedAudio(t){const e=t.results.filter((t=>{const e=this.undoneList.find((e=>e.listen_id===t.listenId));if(e)return t.finished&&(t.currentTime>=95e-5*e.duration||0===t.currentTime)&&(!this.isPlaying||this.isPlaying&&t.listenId!==this.playingListenId)})).map((t=>t.listenId));this.batchRemoveFromListenLater(e)},startCountDown(){this.countdownInterval&&this.countdownIntervalId===this.playingListenId||(this.countdownInterval&&this.stopCountdown(),this.countdownIntervalId=this.playingListenId,this.__countdownResTime=0,this.countdownInterval=setInterval((()=>{this.__countdownResTime>=0&&(this.__countdownResTime=0,this.getStatus((t=>{t&&t.item&&t.item.listenId&&"playing"===t.status?this.updateCurrentTime(t.item.listenId,+t.currentTime):this.stopCountdown()}))),this.__countdownResTime+=1}),1e3))},stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null,this.countdownIntervalId=void 0,this.__countdownResTime=0)},showTips(t,e=1500){t&&(this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsWording=t,this.tipsShow=!0,this.__tipsTimeout=setTimeout((()=>{this.tipsShow=!1,this.tipsWording=""}),e))},hideTips(){this.__tipsTimeout&&(clearTimeout(this.__tipsTimeout),this.__tipsTimeout=null),this.tipsShow=!1,this.tipsWording=""},callShutdownPanel(t,e="left"){this.getStatus((i=>{let n=i.shutdown;if("string"==typeof i.shutdown&&i.shutdown)try{n=JSON.parse(i.shutdown)}catch(s){n=null}n?("afterMins"===n.shutdownType?this.shutdownType=n.time||0:this.shutdownType=n.shutdownType||"none",this.shutdownLeftTime=n.leftTime||0):(this.shutdownType="none",this.shutdownLeftTime=0);const o=null==t?void 0:t.getBoundingClientRect();this.shutdownPanelPosition="right"===e?{top:void 0,right:void 0,bottom:"".concat(window.innerHeight-(o.bottom+26),"px"),left:"".concat(o.right+8,"px"),"--transform-origin-top":"".concat(o.bottom-o.height/2,"px"),"--transform-origin-left":"".concat(o.right+8,"px")}:{top:void 0,left:void 0,bottom:"".concat(window.innerHeight-(o.bottom+26),"px"),right:"".concat(window.innerWidth-o.left+4,"px"),"--transform-origin-top":"".concat(o.bottom-o.height/2,"px"),"--transform-origin-left":"".concat(o.left-4,"px")},this.shutdownPanelShow=!0}))},registerClientListUpdatedListener(){!this.__hasRegisterClientListUpdatedListener&&this.supportDynamicPlayList&&(this.__hasRegisterClientListUpdatedListener=!0,c.on("onTingPlayListRefresh",this.onTingPlayListRefresh))},updateCurrentTime(t,e){var i,n,o;(null==(i=this.playInfo)?void 0:i.listen_id)===t&&e&&this.$set(this.playInfo,"currentTime",+e||0),(null==(n=this.tempStorePlayItem)?void 0:n.listen_id)&&(null==(o=this.tempStorePlayItem)?void 0:o.listen_id)===t&&e&&this.$set(this.tempStorePlayItem,"currentTime",+e||0),this.undoneList=[...this.undoneList.map((i=>i&&i.listen_id===t&&e?(i.currentTime=+e||0,{...i}):i))].filter((t=>null==t?void 0:t.listen_item)),this.removedItems=[...this.removedItems.map((i=>i&&i.listen_id===t&&e?(i.currentTime=+e||0,{...i}):i))].filter((t=>null==t?void 0:t.listen_item)),this.showList=[...this.showList.map((i=>i&&i.listen_id===t&&e?(i.currentTime=+e||0,{...i}):i))].filter((t=>null==t?void 0:t.listen_item)),this.cardList=[...this.cardList.map((i=>i&&i.listen_id===t&&e?(i.currentTime=+e||0,{...i}):i))].filter((t=>null==t?void 0:t.listen_item))},batchRemoveFromListenLater(t){Promise.all(t.map((t=>new Promise((e=>Wn({listenId:t,onComplete:()=>e()})))))).then((()=>{this.undoneList=this.undoneList.filter((e=>-1===t.indexOf(e.listen_id))),this.showList=this.showList.filter((e=>-1===t.indexOf(e.listen_id))),this.isOpened&&this.doCombineList()}))},async getFirstScreenData(){this.firstScreenDataError=!1,(({onSuccess:t,onError:e,onComplete:i})=>{f.setSum(Pt,20,1),g({url:"/mp/tts?action=getttslistenitem&__biz=".concat(window.biz,"&appmsgid=").concat(window.mid,"&idx=").concat(window.idx),type:"GET",dataType:"json",async:!0,success:i=>{i&&i.base_resp&&0===i.base_resp.ret&&i.tts_listenitem?"function"==typeof t&&t(i):("function"==typeof e&&e(i),f.setSum(Pt,21,1))},error:()=>{"function"==typeof e&&e(),f.setSum(Pt,21,1)},complete:()=>{"function"==typeof i&&i()}})})({onSuccess:t=>{var e;this.firstScreenDataReady=!0,this.firstScreenDataError=!1,this.playInfo={...t.tts_listenitem,tts_model_type:(null==(e=t.listen_item_ext)?void 0:e.tts_model_type)||1},this.hasStar=t.star,this.base64=t.merge_playlist_info_base64||"",this.$emit("list-base64-change",this.base64),"function"==typeof this.__firstScreenDataReadyCallback&&(this.__firstScreenDataReadyCallback(),this.__firstScreenDataReadyCallback=void 0)},onError:()=>{this.firstScreenDataReady=!1,this.firstScreenDataError=!0,"function"==typeof this.__firstScreenDataReadyCallback&&(this.__firstScreenDataReadyCallback(),this.__firstScreenDataReadyCallback=void 0)}})},report(t){var e;const i=this.playingInfo;try{const n={BizUin:window.biz,MsgId:+window.mid,Idx:+window.idx,ListenId:"".concat((null==i?void 0:i.listen_id)||""),ListenType:(null==(e=null==i?void 0:i.listen_item)?void 0:e.type)||0,Scene:1*window.source,SubScene:1*window.subscene,Pos:0,EventType:0,EventTime:parseInt(Date.now()/1e3,10),SessionId:"".concat(window.sessionid),EnterId:+window.enterid,ExpVersion:"".concat(this.version||0),PlayRate:parseInt(100*(this.playRate||1),10),ListenTime:parseInt(1e3*(+(null==i?void 0:i.currentTime)||0),10),ShutDownType:String(this.shutdownType)||"",ShutDownLeftTime:this.shutdownLeftTime||0,ListBase64:this.base64||"",TargetPos:0,...t};console.log("[audio panel] report data",n),v.report(32561,n)}catch(n){console.log("[audio panel] report error",n)}},play(t,e=!1,i=0,n=!1,o=void 0){var s,a,r;const l=Tt(t,i);let d={openPlayerUI:n,playMode:0,listenId:(null==t?void 0:t.listen_id)||"",itemList:[l],scene:o,playbackRate:this.playRate||1,categoryPlaylistInfoBuffer:this.base64||"",categoryDeleteAfterListen:!0};const u={protocol:"",src:function(){var e;const i=(null==(e=null==t?void 0:t.article_info)?void 0:e.audio_url)||"",n=window.clientversion;return n&&(n>"18000e00"&&n<="18000e2d"||n>"18000f00"&&n<="18000f24")?"".concat(i,"&t=").concat(Date.now()):i}(),lowbandUrl:(null==(s=null==t?void 0:t.article_info)?void 0:s.audio_url)||"",title:null==t?void 0:t.title,epname:"",singer:(null==t?void 0:t.author)||"",srcId:null==t?void 0:t.listen_id,coverImgUrl:(null==t?void 0:t.cover)||"",webUrl:(null==(a=null==t?void 0:t.article_info)?void 0:a.url)||"",musicbar_url:(null==(r=null==t?void 0:t.article_info)?void 0:r.url)||"",needStartMusicUI:0,playbackRate:this.playRate||1,startTime:i},p=It(null==t?void 0:t.type)&&1===Jn;let h=p?"setTingAudioState":"setBackgroundAudioState";p&&!n&&this.playingListenId&&this.playingListenId===l.listenId&&xt&&!this.isPlaying&&!this.playLoading&&(h="operateTingAudio",d={operationType:"resume",srcId:this.playingSrcId,listenId:this.playingListenId}),c.invoke(h,p?d:u,(e=>{console.log("[audio panel] play",h,p?d:u,e),_.info("[audio panel] play ".concat(h," opt:").concat(JSON.stringify(p?d:u)," res:").concat(JSON.stringify(e))),-1===e.err_msg.indexOf("ok")?(this.hide(),window.weui.alert("暂无法播放，请重试"),f.setSum(Pt,17,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("t1t read fail","res: ".concat(JSON.stringify(e)," | url: ").concat(location.href),{mid:"mmbizwap:t1t_read_fail",view:"wap_business"})):(this.isPlaying=!0,this.playingListenId=t.listen_id||"",this.playingSrcId=t.listen_id||"",this.startCardTitleAnime())})),e&&(f.setSum(Pt,12,1),this.report({EventType:4,ListBase64:this.base64||""}))},pause(t=!0){t&&(f.setSum(Pt,13,1),this.report({EventType:5}));const e={operationType:"pause",srcId:this.playingSrcId,listenId:this.playingListenId},i=It(this.playingType)&&1===Jn?"operateTingAudio":"operateBackgroundAudio";c.invoke(i,e,(t=>{console.log("[audio panel] ".concat(i,": params:"),e,"res:",t),-1!==t.err_msg.indexOf("ok")&&(this.isPlaying=!1)})),this.pauseCardTitleAnime()},setCurrentTime(t,e){var i;const n=this.undoneList.findIndex((t=>t.listen_id===this.playingListenId)),o=((null==(i=this.undoneList)?void 0:i[n])||this.playingInfo).listen_item.duration/1e3,s=parseInt(Math.max(Math.min(t,o),0),10),a={operationType:"seek",srcId:this.playingSrcId||"",seektime:s,listenId:this.playingListenId||""},r="operateTingAudio";c.invoke(r,a,(t=>{console.log("[audio panel] ".concat(r),a,t),"function"==typeof e&&e()}))},getStatus(t,e=!0){c.invoke(Jn?"getTingAudioState":"getBackgroundAudioState",{sourceType:1},(i=>{console.log("[audio panel] getStatus",Jn?"getTingAudioState":"getBackgroundAudioState",i),i&&i.item&&i.item.listenId&&e&&this.onGetStatusChange(i),"function"==typeof t&&t(i)}))},registerStatusObserver(){["onTingAudioStateChanged","onBackgroundAudioStateChange"].forEach((t=>{c.on(t,(t=>{t&&t.item&&t.item.listenId&&this.onGetStatusChange(t)}))}))},getPlayFinishedState(t,e=!1){const i=(t||(this.undoneList||[]).map((t=>t.listen_id))).filter((t=>t))||[];i.length&&c.invoke("operateTingAudio",{operationType:"getFinishedState",listenIds:i},(t=>{if(t&&t.err_msg&&-1!==t.err_msg.indexOf(":ok")){let i=t.results||[];if(u.isAndroid&&"string"==typeof t.results)try{i=JSON.parse(i||"[]")||[]}catch(n){i=[]}i.forEach((t=>{this.updateCurrentTime(t.listenId,+t.currentTime);const e=this.undoneList.findIndex((e=>t.listenId===e.listen_id));-1!==e&&this.$set(this.undoneList[e],"finished",t.finished)})),this.getStatus((()=>this.removeFinishedAudio({results:i})),!e)}console.log("[audio panel] getPlayFinishedState",i,t)}))},notifyAppListChange(){this.supportDynamicPlayList&&this.isOpened&&c.invoke("operateTingAudio",{operationType:"refreshPlayList",listenId:this.playingListenId||this.playInfo.listen_id||"",categoryPlaylistInfoBuffer:this.base64||""},(t=>{console.log("[audio panel] notify app refreshPlayList",t)}))},onShow(){this.isShow=!0,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!0},(t=>console.log("[audio panel] setForegroundState:true res:".concat(JSON.stringify(t)))))},onHide(){var t;this.isShow=!1,this.dragMoving=!1,c.invoke("operateTingAudio",{operationType:"setForegroundState",listenId:this.playingListenId||this.playInfo.listen_id||"",isForeground:!1},(t=>console.log("[audio panel] setForegroundState:false res:".concat(JSON.stringify(t))))),this.finishCardTitleAnime(),this.$refs.bottomModal.scrollTo(0),this.report({EventType:3}),null==(t=this.$refs.slideGroup)||t.reset()},onVisibilityChange(){const t="visible"===document.visibilityState;t&&this.undoneList&&this.undoneList.length&&this.isOpened&&this.getPlayFinishedState(),t?(this.getStatus((t=>{t.playRate&&(this.playRate=+t.playRate,ft.set("play-rate",+t.playRate))})),c.invoke("operateTingAudio",{operationType:"setForegroundState",isForeground:this.isShow,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>console.log("[audio panel] setForegroundState:true res:".concat(JSON.stringify(t))))),this.isShow&&this.startCardTitleAnime()):this.finishCardTitleAnime()},onGetStatusChange(t){var e,i;-1!==[2,3,4].indexOf(t.item.type)&&(this.playingListenId=t.item.listenId,this.playingSrcId=t.item.srcId,this.playingType=t.item.type,"playing"===t.status?(this.isPlaying=!0,this.playLoading=!1,this.startCountDown()):"loading"===t.status?(this.isPlaying=!1,this.playLoading=!0,this.stopCountdown()):(this.playLoading=!1,this.isPlaying=!1,"idle"===t.status&&(this.playingListenId="",this.playingSrcId=""),this.stopCountdown()),t.duration&&this.playingInfo&&((null==(e=this.playingInfo.listen_item)?void 0:e.duration)&&this.playingInfo.listen_item.duration/1e3===t.duration||(this.undoneList=this.undoneList.map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)).filter((t=>null==t?void 0:t.listen_item)),this.removedItems=this.removedItems.map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)).filter((t=>null==t?void 0:t.listen_item)),this.showList=this.showList.map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)).filter((t=>null==t?void 0:t.listen_item)),this.cardList=this.cardList.map((e=>e.listen_item&&e.listen_id===t.item.listenId?(e.listen_item.duration=1e3*t.duration,e):e)).filter((t=>null==t?void 0:t.listen_item)),this.playInfo.listen_id===t.item.listenId&&this.$set(this.playInfo,"duration",1e3*t.duration),(null==(i=this.tempStorePlayItem)?void 0:i.listen_item)&&this.tempStorePlayItem.listen_id===t.item.listenId&&this.$set(this.tempStorePlayItem.listen_item,"duration",1e3*t.duration))),(this.lastPlayId!==t.item.listenId||1===this.undoneList.length&&"playing"!==t.status)&&this.getPlayFinishedState([this.lastPlayId],!0),this.lastPlayId&&this.lastPlayId!==t.item.listenId&&this.onSwitchAudio(t.item.listenId,this.lastPlayId),this.lastPlayId=t.item.listenId)},onSwitchAudio(t,e){t===this.playInfo.listen_id?this.fromType="tts":this.fromType="star",this.__onClickSwitching?(this.finishCardTitleAnime(),setTimeout((()=>this.startCardTitleAnime()))):this.showList=this.undoneList.filter((e=>e.listen_id!==t)),this.__onClickSwitching=!1,this.getPlayFinishedState([e],!0)},onListScreenExpose(){this.report({EventType:8})},onPlayScreenExpose(){this.showBorder=!1,this.report({EventType:1})},onPlayScreenLeave(){this.showBorder=!0},onProgressExpose(){},onProgressLeave(){},onListItemExpose(t,e){},onListItemLeave(t,e){},onScroll(){var t;const e=null==(t=this.$refs.bottomModal)?void 0:t.getViewRef("contentAreaWrp");e&&(e.scrollTop>=285?this.showPlayingBar=!0:this.showPlayingBar=!1)},onClickPlayingBar(){var t,e;const i=null==(e=null==(t=this.$refs.bottomModal)?void 0:t.getScrollEle)?void 0:e.call(t);null==i||i.scrollTo({top:0,behavior:"smooth"})},onClickListenItem(t){this.setPlay(t,"star","list")},onSeeking(t){this.stopCountdown(),this.updateCurrentTime(this.playingListenId,parseInt(t,10)),this.__hasReportSeeking||(this.__hasReportSeeking=!0,this.report({EventType:18}),f.setSum(Pt,28,1))},onSeeked(t){this.updateCurrentTime(this.playingListenId,parseInt(t,10)),this.setCurrentTime(t),this.startCountDown(),this.__hasReportSeeking=!1,this.report({EventType:19}),f.setSum(Pt,29,1)},onSetShutdown(t){const{key:e}=t||{};"number"==typeof e?c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:"afterMins",time:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown afterMins",t),/:ok$/.test(t.err_msg)&&this.showTips("将在".concat(e,"分钟后停止播放"))})):(c.invoke("operateTingAudio",{operationType:"setShutdown",shutdownType:e,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setShutdown",e,t),/:ok$/.test(t.err_msg)&&("none"===e?this.hideTips():this.showTips("将在此音频播放结束时停止播放"))})),"none"===e&&f.setSum(Pt,31,1)),this.shutdownType=e,"number"==typeof e&&(this.shutdownLeftTime=e),this.report({EventType:17}),f.setSum(Pt,30,1)},onBackward(t){var e;const i=Math.max(((null==(e=this.playingInfo)?void 0:e.currentTime)||0)-t,0);this.updateCurrentTime(this.playingListenId,parseInt(i,10)),this.setCurrentTime(i),this.report({EventType:14}),f.setSum(Pt,25,1)},onForward(t){var e,i;const n=Math.min(((null==(e=this.playingInfo)?void 0:e.currentTime)||0)+t,((null==(i=this.playingInfo)?void 0:i.duration)||1/0)/1e3);this.updateCurrentTime(this.playingListenId,parseInt(n,10)),this.setCurrentTime(n),this.report({EventType:15}),f.setSum(Pt,26,1)},onChangeRate(){const t=[1,1.25,1.5,.75],e=t.indexOf(this.playRate),i=t[(e+1)%t.length];this.playRate=i,c.invoke("operateTingAudio",{operationType:"playRate",srcId:this.playingSrcId||"",playRate:this.playRate,listenId:this.playingListenId||this.playInfo.listen_id||""},(t=>{console.log("[audio panel] setPlayRate",t),1!==this.playRate?this.showTips("已切换至".concat(this.playRate,"倍速播放")):this.hideTips()})),ft.set("play-rate",i),this.report({EventType:16}),f.setSum(Pt,27,1)},onTingPlayListRefresh(t){console.log("[audio panel] onTingPlayListRefresh",t)},onSlideStart(){this.slideMoving=!0},onSlideEnd(){this.slideMoving=!1},onStar(){this.hasStar=!0,Fn({listenId:this.playInfo.listen_id,onSuccess:()=>this.doCombineList()})},onMoveChosen(){this.dragMoving=!0,document.addEventListener("touchmove",this.onDragMove,{capture:!0}),c.invoke("vibrateShort",{style:"medium"})},onMoveUnchoose(){this.dragMoving=!1},onMoveStart(t){this.dragMoving=!0,this.__dragStartY=t.originalEvent.pageY,this.transitionDis=0,this.transitionGapByScroll=0},onDragMove(t){const e=((t.touches&&t.touches[0]||{}).pageY||0)-this.__dragStartY;this.transitionDis=e+(u.isIOS?this.transitionGapByScroll:0),t.preventDefault()},onMoveDone(){this.dragMoving=!1,document.removeEventListener("touchmove",this.onDragMove)},onMoveUpdate(t){var e,i;this.dragMoving=!1,this.__disableTransitionTimeout&&(clearTimeout(this.__disableTransitionTimeout),this.__disableTransitionTimeout=null),this.disableTransition=!0,this.__disableTransitionTimeout=setTimeout((()=>{this.disableTransition=!1}),500),(null==(e=this.undoneList[0])?void 0:e.listen_id)!==this.playingListenId&&this.playingListenId&&(null==(i=this.undoneList[0])?void 0:i.listen_item)&&this.play(this.undoneList[0].listen_item,!1),$n({from:"star",listenId:t.data.listen_id||"",pos:t.newIndex,...this.playingListenId?{currentListenId:this.playingListenId}:{},onSuccess:()=>this.notifyAppListChange()})},startCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.play()},pauseCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.pause()},finishCardTitleAnime(){var t;null==(t=this.$refs.cardTitle)||t.finish()},async onPullupLoad(){this.undoneListHasNext&&await this.getUndoneList(),this.$refs.bottomModal.finishPullUpLoad()},getUndoneList(t=!0){return new Promise((e=>{this.getUndoneListLoading||!this.undoneListHasNext&&t?e():(this.getUndoneListLoading=!0,(({buffer:t,onSuccess:e,onError:i,onComplete:n})=>{g({url:"/mp/listenplayer?action=get_playlist",type:"POST",data:{last_listen_id:t?Nn:"",count:20,playlist_type:2,session_buffer:t||""},async:!0,dataType:"json",success:t=>{if(t&&t.base_resp&&0===t.base_resp.ret){if("function"==typeof e&&e(t),t&&t.results&&t.results.length){const e=t.results[t.results.length-1];Nn=e&&e.listen_id||""}}else"function"==typeof i&&i(t)},error:()=>{"function"==typeof i&&i()},complete:()=>{"function"==typeof n&&n()}})})({buffer:t?this.undoneListBuffer:"",onSuccess:i=>{var n,o;const s=null==(o=null==(n=i.results)?void 0:n.filter((t=>null==t?void 0:t.listen_item)))?void 0:o.map((t=>{var e,n;return{...t,listen_item:{...t.listen_item,tts_model_type:(null==(n=null==(e=i.listen_item_ext)?void 0:e.find((e=>(null==e?void 0:e.listen_id)===t.listen_id)))?void 0:n.tts_model_type)||1}}}));this.undoneList=t?[...this.undoneList,...s].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")):[...s].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>(null==t?void 0:t.listen_id)!==this.playingListenId)),this.undoneListHasNext=i.has_more,this.base64=i.merge_playlist_info_base64||"",this.undoneListBuffer=i.session_buffer||"",this.getPlayFinishedState(s.map((t=>t.listen_id)),!0),this.getUndoneListLoading=!1,e()},onError:()=>{this.undoneListError=!0,this.getUndoneListLoading=!1,this.undoneListHasNext=!1,e()}}))}))},doCombineListRaw(t){"hidden"!==document.visibilityState&&(this.doingCombine?this.needDoCombine=!0:(this.doingCombine=!0,this.needDoCombine=!1,(({listenId:t,pos:e,onSuccess:i,onError:n,onComplete:o})=>{g({url:"/mp/listenplayer?action=refresh",type:"POST",data:{data:JSON.stringify({listen_id:t||"",target_pos:e||0})},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof i&&i(t):"function"==typeof n&&n(t)},error:()=>{"function"==typeof n&&n()},complete:()=>{"function"==typeof o&&o()}})})({listenId:t||this.playInfo.listen_id,pos:0,onSuccess:()=>{this.doingCombine=!1,this.notifyAppListChange(),this.needDoCombine&&this.doCombineList()},onError:()=>{this.doingCombine=!1}})))},setPlay(t,e="star",i,n){if(!(null==t?void 0:t.listen_id))return;if(this.isPlaying&&this.playingListenId===(null==t?void 0:t.listen_id))return void this.pause(!0);const o=this.undoneList.find((e=>e.listen_id===t.listen_id));("tts"!==e||o)&&($n({from:"tts"===e?o?"star":"done":e,listenId:t.listen_id,...this.playingListenId?{currentListenId:this.playingListenId}:{},onSuccess:()=>this.notifyAppListChange()}),"function"==typeof n?n():this.undoneList=[{...t},...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id"))),this.fromType=e,this.play(t.listen_item,!0),"show"!==i&&(this.showBackWrp=!1)},setPlayNextNew(t,e="star"){var i,n;const o={...t};this.playingListenId&&this.playingListenId===(null==(n=null==(i=this.undoneList)?void 0:i[0])?void 0:n.listen_id)?(this.undoneList=[this.undoneList[0],o,...this.undoneList.slice(1)||[]].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),$n({from:e,listenId:t.listen_id,pos:1,onSuccess:()=>this.doCombineList(this.playingListenId)})):(this.undoneList=[o,...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),$n({from:e,listenId:t.listen_id,pos:0,onSuccess:()=>this.doCombineList(this.playingListenId)}))},setPlayDone(t){Wn({listenId:t}),this.undoneList=this.undoneList.filter((e=>e.listen_id!==t)),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId))},toggleListenLater(t){var e;(null==(e=this.tempStorePlayItem)?void 0:e.listen_id)===t.listen_id&&(this.showBackWrp=!1);if(~this.undoneList.findIndex((e=>e.listen_id===t.listen_id)))return Hn({listenId:t.listen_id,from:"star",onSuccess:()=>this.doCombineList(this.playingListenId)}),this.undoneList=this.undoneList.filter((e=>e.listen_id!==t.listen_id)),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),this.removedItems=[t,...this.removedItems].filter(bt("listen_id")),c.invoke("vibrateShort",{style:"medium"}),this.report({EventType:12}),void f.setSum(Pt,19,1);Fn({listenId:t.listen_id,onSuccess:()=>this.doCombineList(this.playingListenId)}),c.invoke("vibrateShort",{style:"medium"}),this.undoneList=[t,...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),this.report({EventType:6})},getStarStatus(){(({listenId:t,onSuccess:e,onError:i,onComplete:n})=>{g({url:"/mp/listenplayerv2?action=check_star",type:"POST",data:{listen_id:t},async:!0,dataType:"json",success:t=>{t&&t.base_resp&&0===t.base_resp.ret?"function"==typeof e&&e(t):"function"==typeof i&&i(t)},error:()=>{"function"==typeof i&&i()},complete:()=>{"function"==typeof n&&n()}})})({listenId:this.playInfo.listen_id,onSuccess:t=>this.hasStar=t.star})},setStar(t,e){t.listen_id===this.playInfo.listen_id?c.invoke("operateStar",{opType:"addStar"},(()=>{this.hasStar=!0,this.getUndoneList(!1).then((()=>this.doCombineList())),"function"==typeof e&&e()})):(Fn({listenId:t.listen_id,onSuccess:()=>this.doCombineList()}),this.hasStar=!0,this.undoneList=[t,...this.undoneList].filter((t=>null==t?void 0:t.listen_item)).filter(bt("listen_id")))},cancelStar(t){this.undoneList=this.undoneList.filter((e=>e.listen_id!==t.listen_id)),this.showList=this.undoneList.filter((t=>t.listen_id!==this.playingListenId)),this.playInfo&&t.listen_id===this.playInfo.listen_id&&(this.hasStar=!1),Hn({listenId:t.listen_id,from:"star",onSuccess:()=>this.doCombineList()})},handleClickFullscreen(){this.play(this.playingInfo.listen_item,!0,0,!0),this.hide()},onClickStar(t){this.setStar(t)},onClickBack(){const t=this.tempStorePlayInfo,e=this.getTempListenItem(t);c.invoke("vibrateShort",{style:"medium"});const i=this.undoneList.findIndex((t=>t.listen_id===this.tempStorePlayInfo.listenId))>-1;this.setPlay({listen_id:this.tempStorePlayInfo.listenId,listen_item:e},i?"star":"tts"),this.showBackWrp=!1},getTempListenItem:t=>t?{...t,listen_id:t.listenId,url:t.webUrl||"",...t.mpInfo?{author_info:{username:t.mpInfo.username,nickname:t.mpInfo.name},article_info:{bizuin:t.mpInfo.bizUin,url:t.webUrl,audio_id:t.mpInfo.audioId,audio_url:t.dataUrl}}:{}}:{}}},(function(){var t,e,i,n,o,s,a,r,l,d,u,c=this,p=c._self._c;return p("div",{ref:"container"},[p("mp-bottom-modal",{ref:"bottomModal",attrs:{"close-btn-type":"fold","ext-class":"audio-panel-modal middle audio-panel-modal-for-star ".concat(c.slideMoving?"audio-panel-disable-touch-action":""),top:c.modalTop,"need-head-line":!1,"hide-when-sideslip":!c.dragMoving,"hide-when-scroll-down":!c.dragMoving,"header-type":"slide"},on:{show:c.onShow,hide:c.onHide,"click-slide-btn":c.hide,"show-after-animation":c.startCardTitleAnime,"pullup-load":c.onPullupLoad}},[p("div",{ref:"wrp",staticClass:"audio-panel__wrp"},[c.firstScreenDataReady||c.firstScreenDataError?!c.firstScreenDataReady&&c.firstScreenDataError?p("div",{ref:"playWrp",staticClass:"audio-panel__screen error",on:{click:c.getFirstScreenData}},[p("div",{staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[c._v("加载失败，请点击重试")])])]):[1===c.version?p("div",{staticClass:"audio-panel__playing-bar-wrp"},[p("transition",{attrs:{name:"fade"}},[p("div",{directives:[{name:"show",rawName:"v-show",value:c.showPlayingBar&&(null==(t=c.playingInfo)?void 0:t.listen_item)&&(c.isPlaying||c.playLoading||c.playChanging),expression:"showPlayingBar && playingInfo?.listen_item && (isPlaying || playLoading || playChanging)"}],staticClass:"audio-panel__playing-bar",on:{click:c.onClickPlayingBar}},[p("span",[c._v("正在播放 : "+c._s((null==(n=null==(i=null==(e=c.playingInfo)?void 0:e.listen_item)?void 0:i.article_info)?void 0:n.audio_title)||(null==(s=null==(o=c.playingInfo)?void 0:o.listen_item)?void 0:s.title)))])])])],1):c._e(),p("Intersect",{attrs:{threshold:[0]},on:{enter:c.onPlayScreenExpose,leave:c.onPlayScreenLeave}},[p("div",{ref:"playWrp",staticClass:"audio-panel__screen info-screen"},[p("div",{staticClass:"audio-panel__play-area",class:{"show-progress":c.showProgress}},[p("div",{ref:"playerCover",staticClass:"audio-panel__play-area__cover",style:"background-image: url(".concat(c.playingListenItem&&c.playingListenItem.cover,")")},[p("div",{staticClass:"add-list-under-cover",attrs:{role:"button","aria-label":c.playingListenItemHasInList?"取消加入播放列表":"加入播放列表"},on:{click:function(t){return c.toggleListenLater(c.playingInfo)}}},[p("i",{class:c.playingListenItemHasInList?"icon-correct":"icon-listen-later"}),p("span",[c._v(c._s(c.playingListenItemHasInList?"已加入":"加列表"))])])]),p("div",{staticClass:"audio-panel__play-area__right"},[p("div",{staticClass:"audio-panel__play-area__info"},[p("TextMarquee",{ref:"cardTitle",staticClass:"info-title__wrp",attrs:{title:c.showTitle}}),p("div",{staticClass:"info-desc"},[p("span",{staticClass:"info-desc__author",attrs:{id:"info-desc__author"}},[c._v(c._s(c.playingListenItem.author))]),2===c.playingListenItem.tts_model_type?p("span",[c._v("作者音色朗读")]):2!==c.playingListenItem.type?p("span",{staticClass:"info-desc__duration"},[c._v("音频由作者上传")]):c._e(),c._e()])],1)])]),p("Intersect",{attrs:{threshold:[.5]},on:{enter:c.onProgressExpose,leave:c.onProgressLeave}},[p("div",{staticClass:"audio-panel__operate-area-wrp"},[p("Progress",{key:"progress",attrs:{"play-rate":+c.playRate,"has-in-list":c.playingListenItemHasInList,"is-playing":c.isPlaying||c.playLoading,"has-set-shut-down":"none"!==c.shutdownType,duration:(null==(r=null==(a=c.playingInfo)?void 0:a.listen_item)?void 0:r.duration)||0,"current-time":Math.min((null==(l=c.playingInfo)?void 0:l.currentTime)||0,(null==(u=null==(d=c.playingInfo)?void 0:d.listen_item)?void 0:u.duration)||0)},on:{"change-rate":function(t){return c.onChangeRate()},"set-shutdown":c.callShutdownPanel,forward:function(t){return c.onForward(30,0)},backward:function(t){return c.onBackward(15,0)},"toggle-play":function(t){return c.setPlay(c.playingInfo,c.fromType)},seeked:t=>c.onSeeked(t,0),seeking:t=>c.onSeeking(t,0)}})],1)])],1)]),p("Intersect",{attrs:{threshold:[0]},on:{enter:c.onListScreenExpose}},[p("div",{ref:"listScreen",staticClass:"audio-panel__screen list-screen"},[p("transition",{attrs:{name:"fade"}},[!c.showBackWrp||!c.undoneList.length&&c.getUndoneListLoading||c.tempInfoHasInList?c._e():p("div",{staticClass:"back-wrp"},[p("div",{staticClass:"sub-title"},[c._v("上次播放")]),p("div",{staticClass:"back-content"},[p("audio-list-item",{attrs:{info:c.tempStorePlayItem,version:1,"need-finish-state":!1,highlight:!1},on:{click:function(t){return c.onClickBack()}}}),p("span",{staticClass:"star-wrp js_wx_tap_highlight",attrs:{role:"button","aria-label":c.tempInfoHasInList?"取消加入播放列表":"加入播放列表"}},[p("i",{class:c.tempInfoHasInList?"icon-correct":"icon-listen-later"}),p("div",{staticClass:"hot-area",on:{click:function(t){return t.stopPropagation(),c.toggleListenLater(c.tempStorePlayItem)}}})]),p("span",{staticClass:"star-wrp js_wx_tap_highlight",attrs:{role:"button","aria-label":"播放"},on:{click:c.onClickBack}},[p("i",{staticClass:"icon-play"})])],1)])]),p("div",{staticClass:"audio-panel__list-area",style:"--drag-ghost-transition-dis: ".concat(c.transitionDis,"px;")},[p("div",{ref:"listSubTitle",staticClass:"sub-title"},[c._v("播放列表")]),p("mp-slide-view-group",{ref:"slideGroup"},[p("VueDraggable",{attrs:{delay:300,scroll:!0,"bubble-scroll":!1,"scroll-fn":c.onDragScroll,"touch-start-threshold":5,disabled:!c.supportDynamicPlayList&&!c.slideMoving,target:".audio-list-sort-wrp"},on:{end:c.onMoveDone,start:c.onMoveStart,update:c.onMoveUpdate,choose:c.onMoveChosen,unchoose:c.onMoveUnchoose},model:{value:c.undoneList,callback:function(t){c.undoneList=t},expression:"undoneList"}},[p("transition-group",{staticClass:"audio-list-sort-wrp",attrs:{name:"audio-list"}},c._l(c.undoneList,(function(t,e){return p("mp-slide-view",{key:"slide-item-".concat(t.listen_id),attrs:{disabled:!c.supportDynamicPlayList&&!c.dragMoving,"extra-class":["audio-list__item-slide-wrp","pos-".concat(e),c.playingListenId===t.listen_id?"now-playing":"",c.disableTransition?"disable-transition":""]},on:{end:c.onSlideEnd,start:c.onSlideStart},scopedSlots:c._u([{key:"btns",fn:function(){return[p("mp-slide-item",{attrs:{"not-last":e>=1},on:{click:function(e){return c.cancelStar(t)}}},[c._v("删除")]),e>=1?p("mp-slide-item",{directives:[{name:"show",rawName:"v-show",value:!c.dragMoving,expression:"!dragMoving"}],attrs:{"extra-class":"slide-item-warn"},on:{click:e=>c.setPlayNextNew(t,"star")}},[c._v("下一个播放")]):c._e()]},proxy:!0}],null,!0)},[p("Intersect",{attrs:{threshold:[0]},on:{enter:t=>c.onListItemExpose(t,e),leave:t=>c.onListItemLeave(t,e)}},[p("audio-list-item",{key:"audio-".concat(t.listen_id),ref:"audioItem",refInFor:!0,attrs:{info:t,version:c.version,"play-rate":+c.playRate,"need-finish-state":!1,"is-playing":c.isPlaying||c.playLoading,playing:c.playingListenId===t.listen_id,"has-set-shut-down":"none"!==c.shutdownType},on:{pause:function(t){return c.pause(!1)},"change-rate":function(t){return c.onChangeRate()},"set-shutdown":c.callShutdownPanel,forward:function(t){return c.onForward(30,e)},backward:function(t){return c.onBackward(15,e)},click:function(e){return c.onClickListenItem(t)},seeked:t=>c.onSeeked(t,e),seeking:t=>c.onSeeking(t,e)}})],1)],1)})),1)],1)],1),p("div",{directives:[{name:"show",rawName:"v-show",value:!c.getUndoneListLoading&&!c.undoneListHasNext&&!c.undoneList.length,expression:"!getUndoneListLoading && !undoneListHasNext && !undoneList.length"}],staticClass:"weui-loadmore empty"},[p("span",{staticClass:"weui-loadmore__tips"},[c._v("暂无内容")])]),p("div",{directives:[{name:"show",rawName:"v-show",value:c.getUndoneListLoading,expression:"getUndoneListLoading"}],staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[p("i",{staticClass:"weui-loading"})])]),p("div",{directives:[{name:"show",rawName:"v-show",value:!c.getUndoneListLoading&&!c.undoneListHasNext&&c.undoneList.length,expression:"!getUndoneListLoading && !undoneListHasNext && undoneList.length"}],staticClass:"weui-loadmore weui-loadmore_line weui-loadmore_dot"},[p("span",{staticClass:"weui-loadmore__tips"})])],1)],1)])]:p("div",{ref:"playWrp",staticClass:"audio-panel__screen empty"},[p("div",{staticClass:"weui-loadmore"},[p("div",{staticClass:"weui-loadmore__tips"},[p("i",{staticClass:"weui-loading"})])])]),p("div",{staticClass:"audio-panel__modal-bottom-mask",on:{touchstart:function(t){t.stopPropagation(),t.preventDefault()},touchmove:function(t){t.stopPropagation(),t.preventDefault()},touchend:function(t){t.stopPropagation(),t.preventDefault()}}})],2)]),p("Teleport",{attrs:{to:"body"}},[p("Tips",{attrs:{"tips-wording":c.tipsWording},model:{value:c.tipsShow,callback:function(t){c.tipsShow=t},expression:"tipsShow"}}),p("OptionMenu",{attrs:{"active-key":c.shutdownType,"wrp-style":c.shutdownPanelPosition,options:c.shutdownOptions},on:{select:c.onSetShutdown},model:{value:c.shutdownPanelShow,callback:function(t){c.shutdownPanelShow=t},expression:"shutdownPanelShow"}})],1)],1)}),[],!1,null,"10db8b31",null,null).exports,zn=window.Vue,Xn=async()=>!0,qn=m("listenplayer_tmp"),Gn=m("listenplayer_star"),Yn=async()=>await Ct()&&Gn,Qn=async()=>await Yn()?(f.setSum(Pt,46,1).send(),Un):qn?(f.setSum(Pt,45,1).send(),Vn):(f.setSum(Pt,44,1).send(),En);async function Kn(t="#audio_panel_area",e=1){if(await Xn())return void f.setSum(Pt,48,1).send();const i=new zn({store:d,version:e,...await Qn()}).$mount(t);return i.$on("add-to-listen-later",(t=>Zn(t,1))),i.$on("remove-from-listen-later",(t=>Zn(t,0))),i.$on("list-base64-change",(t=>{window.musicList&&Object.keys(window.musicList).forEach((e=>{const i=window.musicList[e];i.listBase64=t,i.player&&(i.player._o.listBase64=t)}))})),i}function Zn(t,e){const i=document.querySelector('mp-common-claudio[listen_id="'.concat(t,'"]')),n=document.querySelector('mp-common-mpaudio[listen_id="'.concat(t,'"]'));i&&i.setAttribute("has-added-listen-later",e),n&&n.setAttribute("has-added-listen-later",e),window.musicList&&Object.keys(window.musicList).forEach((i=>{const n=window.musicList[i];n.listenId===t&&n.player&&(n.player._o.hasAddedListenLater=e)}))}export{_t as V,xn as a,Ct as b,St as g,Kn as i,ot as k,qn as m,et as q,Xn as r,Yn as s};
