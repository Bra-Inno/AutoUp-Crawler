import{m as mmVersion,A,f as invoke,D as Device,a}from"./private_share.mg5xph6v1a0c9c7e.js";let reportLogs=[],reportExtraLogs=[],sendUrl="/mp/jsmonitor?#wechat_redirect",monitor={};function ObjWithoutProperty(e,t){if(null===e)return{};let o={},n=Object.keys(e);for(let r=0;r<n.length;r++){let i=n[r];t.indexOf(i)>=0||(o[i]=e[i])}return o}function formatDataToString(e){let t=[];for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.push(o+"="+encodeURIComponent(e[o]));return t.join("&")}monitor._reportOptions={idkey:{}},monitor.getReportData=function(e){e=e||{};let t,o=monitor._reportOptions.idkey||{},n=null,r={};try{for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&reportLogs.push(n+"_"+o[n])}catch(i){return!1}if(0===reportLogs.length)return!1;reportExtraLogs.length&&(r.lc=reportExtraLogs.length,reportExtraLogs.forEach(((e,t)=>{r["log".concat(t)]=e})));try{let e=monitor._reportOptions;if(null!=e)for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}catch(i){r={}}return r.idkey=reportLogs.join(";"),r.t=Math.random(),!1!==e.remove&&(reportLogs=[],reportExtraLogs=[],monitor._reportOptions={idkey:{}}),r},monitor.setLogs=function(e){let t=e.id,o=e.key,n=e.value,r=e.log,i=ObjWithoutProperty(e,["id","key","value","log"]),a=monitor._reportOptions.idkey||{},s=t+"_"+o;a[s]?a[s]+=n:a[s]=n,monitor._reportOptions.idkey=a,r&&reportExtraLogs.push(r);try{if(null!=i)for(let e in i)Object.prototype.hasOwnProperty.call(i,e)&&(monitor._reportOptions[e]=i[e])}catch(c){console.log(c)}return monitor},monitor.setAvg=function(e,t,o){let n=monitor._reportOptions.idkey||{},r=e+"_"+t,i=e+"_"+(t-1);return n[r]?n[r]+=o:n[r]=o,n[i]?n[i]+=1:n[i]=1,monitor._reportOptions.idkey=n,monitor},monitor.setSum=function(e,t,o=1){let n=monitor._reportOptions.idkey,r=e+"_"+t;return n[r]?n[r]+=o:n[r]=o,monitor._reportOptions.idkey=n,monitor},monitor.send=function(e,t,o){!1!==e&&(e=!0);let n=monitor.getReportData();o=o||"",n&&(t&&t instanceof Function?t({url:o+sendUrl,type:"POST",mayAbort:!0,data:n,async:e,timeout:2e3}):(new Image).src=o+"/mp/jsmonitor?"+formatDataToString(n)+"#wechat_redirect")},"undefined"!=typeof window&&window.__monitor?monitor=window.__monitor:"undefined"!=typeof window&&(window.__monitor=monitor);const monitor$1=monitor;let logList=[];const log$1=e=>{logList.push(e)},printLog=()=>{for(let e=0,t=logList.length;e<t;++e)console.log("[RespType]".concat(logList[e]))},isArray=e=>"[object Array]"===Object.prototype.toString.call(e),getValueType=e=>isArray(e)?"array":typeof e,parseRtDesc=(e,t)=>{let o="mix",n=!1,r=t;if(t){const e="_R",o=t.indexOf(e),i=t.length-e.length;n=-1!==o&&o===i,r=n?t.substring(0,i):t}return"string"==typeof e?o=e:isArray(e)?o="array":"object"==typeof e&&(o="object"),{key:r,type:o,isRequired:n}},checkForArrayRtDesc=(e,t)=>{if(!isArray(e))return!1;for(let o=0,n=e.length;o<n;++o){const n=e[o];let r,i=0,a=0===t.length;for(;r=t[i++];)if(checkForRtDesc(n,r)){a=!0;break}if(!a)return!1}return!0},checkForStringRtDesc=(e,t)=>{const o=getValueType(e),n=parseRtDesc(t),r=n.type===o;return r||log$1("miss match type : ".concat(o," !== ").concat(n.type)),r},checkForObjectRtDesc=(e,t)=>{if("object"!=typeof e||isArray(e))return log$1("must be object"),!1;const o=e;let n=e;for(const r in t)if(t.hasOwnProperty(r)){const e=t[r],i=parseRtDesc(e,r),{key:a}=i;n=o[a];const s=getValueType(n);if(i.isRequired&&void 0===n)return log$1("is required @key=".concat(a)),!1;if(void 0!==n){if(s!==i.type&&"mix"!==i.type)return log$1("miss match type : ".concat(s," !== ").concat(i.type," @key=").concat(a)),!1;if(("array"===s||"object"===s)&&"mix"!==i.type&&!checkForRtDesc(n,e))return!1}}return!0},checkForRtDesc=(e,t)=>isArray(t)?checkForArrayRtDesc(e,t):"object"==typeof t?checkForObjectRtDesc(e,t):"string"==typeof t&&checkForStringRtDesc(e,t),check=(json,rtDescs)=>{if("string"==typeof json)try{json=eval("(".concat(json,")"))}catch(e){return log$1("parse json error"),!1}if("object"!=typeof json)return log$1("must be object"),!1;let rtDesc;isArray(rtDescs)||(rtDescs=[rtDescs]);let i=0;for(;rtDesc=rtDescs[i++];)if(checkForRtDesc(json,rtDesc))return!0;return!1},RespTypes={check(e,t){logList=[];try{const o=check(e,t);return o||printLog(),o}catch(o){return logList.push("[rtException]".concat(o.toString())),printLog(),!1}},getMsg:()=>logList.join(";")},IS_AUTHOR_SCENE=[305,306],innerVersion=(mmVersion.getInner()||"").toUpperCase();let biz=null;function getBiz(e=!1){return new Promise(((t,o)=>{e||null===biz?mmVersion.isIOS&&innerVersion<"18003C2A"||mmVersion.isAndroid&&innerVersion<"28003D3C"?o("Not support"):A.invoke("handleMPPageAction",{action:"getBiz",needCheckBiz:e},(n=>{console.log("getBiz with needCheckBiz ".concat(e," res: ").concat(JSON.stringify(n))),n&&n.err_msg&&n.err_msg.indexOf("ok")>-1?(biz=n.biz,t(n.biz)):o("Failed to get biz")})):t(biz)}))}function isAuthorScene(e=window.source){return IS_AUTHOR_SCENE.indexOf(1*e)>-1}function getIsAuthor(e,t=window.biz,o=window.source,n=!1){if(!isAuthorScene(o))return e(!1);getBiz(n).then((o=>{e(o&&o===t)})).catch((()=>{e(!1)}))}function parseUrl(e){const t=e.length;let o=e.indexOf("?"),n=e.indexOf("#");n=-1==n?t:n,o=-1==o?n:o;return{host:e.substring(0,o),query_str:e.substring(o+1,n),hash:e.substring(n+1)}}function join(e,t,o){const n=parseUrl(e);let{query_str:r}=n;const i=[];if("object"==typeof t)for(const a in t)t.hasOwnProperty(a)&&i.push("".concat(a,"=").concat(o?t[a]:encodeURIComponent(t[a])));else i.push(o?t:encodeURIComponent(t));return i.length>0&&(r+=(""!==r?"&":"")+i.join("&")),n.host+(""!==r?"?".concat(r):"")+(""!==n.hash?"#".concat(n.hash):"")}function addParam(e,t,o,n){const r=(e=e||location.href).indexOf("&"),i=e.length,a=e.replace(/^[\w\d]+:[/\\]+/g,"").split("").reverse();Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){let o;if(null==this)throw new TypeError('"this" is null or not defined');const n=Object(this),r=n.length>>>0;if(0===r)return-1;let i=t||0;if(Math.abs(i)===1/0&&(i=0),i>=r)return-1;for(o=Math.max(i>=0?i:r-Math.abs(i),0);o<r;){if(o in n&&n[o]===e)return o;o++}return-1});const s=i-1-a.indexOf("/");-1!==r&&-1==e.indexOf("?")&&r>s&&(e=e.replace("&","?"));const c=new RegExp("([\\?&]".concat(t,"=)[^&#]*"));if(!e.match(c)){const n=parseUrl(e),r=n.hash?"#"+n.hash:"",i=(e=e.replace(r,"")).indexOf("?");return-1==i?"".concat(e,"?").concat(t,"=").concat(o).concat(r):i==e.length-1?"".concat(e+t,"=").concat(o).concat(r):"".concat(e,"&").concat(t,"=").concat(o).concat(r)}return!0===n?e.replace(c,"$1".concat(o)):e}function addWxfrom(e,t){return addParam(e,"wxfrom",(1===window.service_type?1e4:0)+Number(t),!0)}function removeParam(e,t){const{protocol:o,host:n,pathname:r,search:i,hash:a}=new URL(e),s=new URLSearchParams(i);s.delete(t);const c=s.toString();return new URL("".concat(o,"//").concat(n).concat(r).concat(c?"?".concat(decodeURIComponent(c)):"").concat(a)).toString()}function getQuery(e,t){const o=t||window.location.search,n=new RegExp("(^|&)".concat(e,"=([^&]*)(&|$)")),r=o.substring(o.indexOf("?")+1).match(n);return null!==r?r[2]:""}function encodeBase64(e){try{return window.btoa(e)}catch(t){return""}}function decodeBase64(e){try{return window.atob(e)}catch(t){return""}}function joinUrl$1(e){const t={};return void 0!==window.uin&&(t.uin=window.uin),void 0!==window.key&&(t.key=window.key),void 0!==window.pass_ticket&&(t.pass_ticket=window.pass_ticket),void 0!==window.wxtoken&&(t.wxtoken=window.wxtoken),void 0!==window.devicetype&&(t.devicetype=window.devicetype),void 0!==window.clientversion&&(t.clientversion=window.clientversion||mmVersion.getInner()),t.version=t.clientversion,window.biz&&(t.__biz=window.biz),getQuery("enterid")&&(t.enterid=getQuery("enterid")),void 0!==window.appmsg_token?t.appmsg_token=window.appmsg_token:e.indexOf("advertisement_report")>-1&&((new Image).src="".concat(location.protocol,"//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_13_1&r=").concat(Math.random())),t.x5=-1!==navigator.userAgent.indexOf("TBS/")?"1":"0",t.f="json",join(e,t)}function joinUserArticleRole(e,t,o,n=window.biz,r=window.source,i=!1){t?o(e):getIsAuthor((t=>{o(addParam(e,"user_article_role",t?1:0,!0))}),n,r,i)}function getA8keyQuery(e,t){return new Promise((o=>{window.__second_open_wait_a8key__&&window.__second_open_wait_a8key_task__?window.__second_open_wait_a8key_task__.push((()=>{o(getQuery(e,t))})):o(getQuery(e,t))}))}function addHash(e,t,o=!1){return o?"".concat(e.split("#")[0]).concat(t):"".concat(e).concat(-1===e.indexOf("#")?"#":"").concat(t)}function decodeUrl(e){let t=e;for(;-1!==t.indexOf("&amp;");)t=t.htmlDecode();return t}getBiz().then((e=>{console.log("getBiz false result: ".concat(e))})).catch((()=>{console.error("Failed to get biz")}));const m={parseUrl:parseUrl,join:join,addParam:addParam,addWxfrom:addWxfrom,addHash:addHash,getQuery:getQuery,getA8keyQuery:getA8keyQuery,encodeBase64:encodeBase64,decodeBase64:decodeBase64,joinUrl:joinUrl$1,joinUserArticleRole:joinUserArticleRole,removeParam:removeParam,decodeUrl:decodeUrl};function log(e,t){if("log"===e)e="info",t="[WechatFe]".concat(t);else{const e="__wap__".concat(window.__second_open__?" (sec)":"");t="".concat(e," ").concat(t," location:[").concat(location.href,"]")}t+=(new Error).stack,mmVersion.isMpapp?invoke("WNNativeCallbackLog",t):mmVersion.isWechat&&(mmVersion.isAndroid?console.warn("[system]","[MicroMsg.JsApiLog][".concat(e,"] jslog : ").concat(t)):mmVersion.isIOS?A.invoke("writeLog",{level:e,msg:t}):A.invoke("log",{level:e,msg:t}))}const d={info(...e){log("info",e.join(" "))},warn(...e){log("warn",e.join(" "))},error(...e){log("error",e.join(" "))},debug(...e){log("debug",e.join(" "))},log(...e){log("info",e.join(" "))}},html=(e,t)=>{if(!e)return"";let o,n=e;o=t?["&","&amp;","¥","&yen;","<","&lt;",">","&gt;"," ","&nbsp;",'"',"&quot;","'","&#39;","`","&#96;"]:["&#96;","`","&#39;","'","&quot;",'"',"&nbsp;"," ","&gt;",">","&lt;","<","&yen;","¥","&amp;","&","&#60;","<","&#62;",">"];for(let r=0;r<o.length;r+=2)n=n.replace(new RegExp(o[r],"g"),o[r+1]);return n},htmlLite=(e,t)=>{if(!e)return"";let o,n=e;o=t?["&","&amp;","<","&lt;",">","&gt;",'"',"&quot;","'","&#39;","`","&#96;"]:["&#96;","`","&#39;","'","&quot;",'"',"&gt;",">","&lt;","<","&amp;","&"];for(let r=0;r<o.length;r+=2)n=n.replace(new RegExp(o[r],"g"),o[r+1]);return n},htmlEncode=e=>html(e,!0),htmlDecode=e=>html(e,!1),htmlEncodeLite=e=>htmlLite(e,!0),htmlDecodeLite=e=>htmlLite(e,!1),getIpWoridng=e=>{let t="";return 156===parseInt(e.countryId,10)?t=e.provinceName:e.countryId&&(t=e.countryName),t};String.prototype.html=function(e){return html(this.toString(),e)},String.prototype.htmlEncode=function(){return htmlEncode(this.toString())},String.prototype.htmlDecode=function(){return htmlDecode(this.toString())},String.prototype.htmlLite=function(e){return htmlLite(this.toString(),e)},String.prototype.htmlEncodeLite=function(){return htmlEncodeLite(this.toString())},String.prototype.htmlDecodeLite=function(){return htmlDecodeLite(this.toString())};const html$1={htmlEncode:htmlEncode,htmlDecode:htmlDecode,htmlEncodeLite:htmlEncodeLite,htmlDecodeLite:htmlDecodeLite,getIpWoridng:getIpWoridng};var _a;const METHOD_ENUM={GET:0,POST:1},__moon_report=window.__moon_report||(()=>{}),MOON_AJAX_SUCCESS_OFFSET=3,MOON_AJAX_NETWORK_OFFSET=4,MOON_AJAX_ERROR_OFFSET=5,MOON_AJAX_TIMEOUT_OFFSET=6,MOON_AJAX_COMPLETE_OFFSET=7,LENGTH_LIMIT=4096;let doc,isAcrossOrigin=!1;try{doc=null===(_a=window.top)||void 0===_a?void 0:_a.window.document}catch(e){isAcrossOrigin=!0}function networkStartLog(e){var t,o,n;if(console.log("[system]","< [request ".concat(e.requestType,"]"),e.method,e),null===(t=window.vConsole)||void 0===t?void 0:t.network)try{return null===(n=(o=window.vConsole.network).add)||void 0===n?void 0:n.call(o,Object.assign({},e,{startTime:Date.now(),endTime:Date.now(),status:0,readyState:2,response:""}))}catch(r){}return Object.assign({},e,{id:"__system_log__"})}function networkEndLog(e){var t,o,n;if(console.log("[system]","> [response ".concat(e.requestType,"]"),e.response,e),(null===(t=window.vConsole)||void 0===t?void 0:t.network)&&"__system_log__"!==e.id)try{return null===(n=(o=window.vConsole.network).update)||void 0===n?void 0:n.call(o,e.id,Object.assign({},e,{readyState:4}))}catch(r){}}function reqType(e,t){return e.url.indexOf(t)>-1&&-1===e.url.indexOf("action=")&&(!e.data||!e.data.action)}function reportRtError(e,t,o,n){let r="";const i="rt"===e?"rtCheckError":"Ajax Length Limit";if(null==n?void 0:n.length){const e=1e3,t=n.length,o=Math.ceil(t/e);r=["&lc=".concat(o)];for(let a=0;a<o;++a)r.push("&log".concat(a,"=")+"[".concat(i,"][").concat(a,"]").concat(encodeURIComponent(n.substring(a*e,a*e+e))));r=r.join("")}const a="idkey=".concat(t,"_").concat(o,"_1").concat(r,"&r=").concat(Math.random()),s=new XMLHttpRequest;s.open("POST","".concat(location.protocol,"//").concat(location.host,"/mp/jsmonitor?"),!0),s.setRequestHeader("cache-control","no-cache"),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(a),"ajaxLen"===e&&monitor$1.setLogs({id:t,key:o,value:1,log:r})}function reportRt(e,t,o){reportRtError("rt",e,t,o)}function reportAjaxLength(e,t,o){reportRtError("ajaxLen",e,t,o)}function setCurrentMpInfo(e){const t=mmVersion.isIOS&&mmVersion.gtVersion("7.0.10",!0)||mmVersion.isAndroid&&mmVersion.gtVersion("7.0.12",!0),o=mmVersion.isIOS&&mmVersion.gtVersion("8.0.46",!0)||mmVersion.isAndroid&&mmVersion.gtVersion("8.0.46",!0);A.invoke("currentMpInfo",{userName:window.user_name,brandName:t&&""===window.nickname?"未命名账号":window.title,title:window.msg_title||"",brandIcon:window.hd_head_img.replace(/\/0$/,"/132"),itemShowType:window.item_show_type,isPaySubscribe:window.isPaySubscribe,topBarStyle:t?1:0,topBarShowed:e,disableShowFinderLiveTopBar:!e&&o?1:0,brandServiceType:void 0===window.service_type?0:window.service_type+1},(()=>{}))}function findAjaxScopeByConfig(e,t){const o=t[(new URL(e,location.href).pathname||"").slice(1)];if(o)return d.log("ajax transfer config: ",JSON.stringify(t)),o}function getAjaxScope(e){if("1"!==m.getQuery("no_transfer",location.href)&&mmVersion.isWechat&&!mmVersion.isInMiniProgram&&!mmVersion.isWxWork&&!mmVersion.isMpapp&&!isAcrossOrigin&&window.__ajaxTransferConfig&&"object"==typeof window.__ajaxTransferConfig&&(mmVersion.isIOS&&mmVersion.compareHexVersion("1800282F")||mmVersion.isAndroid&&mmVersion.compareHexVersion("28002234")||mmVersion.isWindowsWechat&&mmVersion.cpVersion("3.9.5",1,!0,"windows")||mmVersion.isMacWechat&&mmVersion.cpVersion("3.8.4",1,!0,"mac")||mmVersion.isHarmonyWechat&&mmVersion.compareHexVersion("0xf3100b00")&&!mmVersion.compareHexVersion("0xf3100c00")||mmVersion.compareHexVersion("0xf3800b00")))try{return findAjaxScopeByConfig(e,window.__ajaxTransferConfig)}catch(t){}}function setXhrHeader(e,t,o){o.contentType?e.setRequestHeader("Content-Type",o.contentType):"POST"===t&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.noXRequestedWidthHeader||e.setRequestHeader("X-Requested-With","XMLHttpRequest")}function Ajax(obj){obj.usePb&&(obj.type="POST",obj.data={data:JSON.stringify(obj.data)});const ajaxScope=getAjaxScope(obj.url),type=(obj.type||"GET").toUpperCase();let timer,_url;_url=obj.notJoinUrl?obj.url:m.joinUrl(obj.url),m.joinUserArticleRole(_url,!!obj.notJoinUrl,(url=>{"html"===obj.f&&(url=url.replace("&f=json",""));let data=null,beginTs;if(obj.data instanceof Blob)data=obj.data;else if("object"==typeof obj.data){const e=obj.data,t=[];for(const o in e)e.hasOwnProperty(o)&&t.push("".concat(o,"=").concat(encodeURIComponent(e[o])));data=t.join("&")}else data="string"==typeof obj.data?obj.data:null;const beforeReq=()=>{reqType(obj,"/mp/getappmsgext")&&(window.startGetAppmsgExtTime=Date.now(),d.log("start get appmsgext, url: ",obj.url)),reqType(obj,"/mp/getappmsgad")&&(window.startGetAppmsgAdTime=Date.now(),d.log("start get appmsgad, url: ",obj.url)),beginTs=Date.now()},beforeResp=e=>{if(reqType(obj,"/mp/getappmsgext")&&(window.receiveGetAppmsgExt="".concat(e.status,"|").concat(Date.now()),d.log("receive appmsgext response, status: ".concat(e.status))),reqType(obj,"/mp/getappmsgad")&&(window.receiveGetAppmsgAd="".concat(e.status,"|").concat(Date.now()),d.log("receive appmsgad response, status: ".concat(e.status))),Math.random()<.001&&window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs)try{const t=ajaxScope?"transfer":"xhr",o=250,n=Date.now()-beginTs,r=Math.floor(n/o)*o,i=new URL(obj.url,location.href).pathname||"";window.WX_BJ_REPORT.BadJs.report("".concat(t,"_perf:").concat(i),JSON.stringify({status:e.status,time:"[".concat(r,"-").concat(r+o,")")}),{mid:"mmbizwap:ajaxtransfer",view:"wap_business"})}catch(t){}},handleRespSucc=xhr=>{var _a;try{const{responseText:responseText}=xhr;let resp=responseText;if("json"===obj.dataType)try{JSON&&JSON.parse?resp=JSON.parse(resp):(resp=eval("(".concat(resp,")")),monitor$1.setSum(523105,127,1).send());const{rtId:rtId}=obj,rtKey=obj.rtKey||0,{rtDesc:rtDesc}=obj;if(rtId&&rtDesc&&RespTypes&&!RespTypes.check(resp,rtDesc)&&reportRt(+rtId,+rtKey,"".concat(RespTypes.getMsg(),"[detail]").concat(responseText,";").concat(obj.url)),resp&&resp.base_resp&&0!==(null===(_a=resp.base_resp)||void 0===_a?void 0:_a.ret)&&void 0!==window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&Math.random()<.001){let e=url;-1!==url.indexOf("?")&&(e=url.substring(0,url.indexOf("?")),m.getQuery("action",url)&&(e="".concat(e,"?action=").concat(m.getQuery("action",url)))),("/mp/getappmsgext"!==e&&"/mp/getappmsgad"!==e||void 0!==resp.base_resp.ret)&&window.WX_BJ_REPORT.BadJs.report(e,"ret=".concat(resp.base_resp.ret),{mid:window.PAGE_MID,view:"wap_retcode"})}}catch(e){return void(obj.error&&obj.error(xhr,{type:1,error:e,status:xhr.status}))}obj.success&&obj.success(resp)}catch(e){throw __moon_report({offset:MOON_AJAX_SUCCESS_OFFSET,e:e}),e}},handleRespErr=(t,o)=>{try{obj.error&&obj.error(t,{type:2,error:o,status:t.status})}catch(e){throw __moon_report({offset:MOON_AJAX_ERROR_OFFSET,e:e}),e}},handleRespComplete=()=>{clearTimeout(timer);try{obj.complete&&obj.complete()}catch(e){throw __moon_report({offset:MOON_AJAX_COMPLETE_OFFSET,e:e}),e}obj.complete=null},handleReqTimeout=t=>{void 0!==obj.timeout&&(timer=setTimeout((()=>{t.abort();try{obj.complete&&obj.complete()}catch(e){throw __moon_report({offset:MOON_AJAX_COMPLETE_OFFSET,e:e}),e}obj.complete=null,__moon_report({offset:MOON_AJAX_TIMEOUT_OFFSET,log:"ajax_timeout_error: ".concat(url),e:""})}),obj.timeout))},retryXhrFn=(e,t,o)=>{const n=new XMLHttpRequest;try{n._noVConsole=!0}catch(r){}n.open(type,url),n.onreadystatechange=()=>{if(!t&&(3===n.readyState&&obj.received&&obj.received(n),4===n.readyState)){beforeResp(n);const t=n.status;t>=200&&t<400?handleRespSucc(n):(handleRespErr(n,e),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("req_failure",JSON.stringify({retryXhrStatus:t,transferRes:e}),{mid:"mmbizwap:ajaxtransfer",view:"wap_business"})),o.status=t,o.endTime=Date.now(),o.response=n.responseText,handleRespComplete(),networkEndLog(o)}},setXhrHeader(n,type,obj),n.send(data)};if(ajaxScope&&!obj.pureHttp){const e={"User-Agent":navigator.userAgent,Cookie:(window.__test_env__?"uniproxy_route=1; ":"")+document.cookie,Referer:location.href};obj.contentType?e["Content-Type"]=obj.contentType:"POST"===type&&(e["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),obj.noXRequestedWidthHeader||(e["X-Requested-With"]="XMLHttpRequest");const t=new URL(url,location.href).href,o=METHOD_ENUM[type]||0,n=Device.os.pc?{url:t,req_json:data||"",scope:ajaxScope,webcgi_method:o,webcgi_header:Object.keys(e).map((t=>Device.os.Mac?{[t]:e[t]}:{key:t,value:e[t]})),cgi_type:1}:{reqUrl:t,reqBody:data,scope:ajaxScope,method:o,header:e},r=networkStartLog({method:type,url:url,postData:obj.data||{},requestHeader:e,requestType:"transfer"});let i=!1;return handleReqTimeout({abort:()=>{i=!0,r.endTime=Date.now(),r.response="timeout",networkEndLog(r)}}),Device.os.pc&&monitor$1.setSum(115849,69,1),A.invoke(Device.os.pc?"H5ExtTransfer":"webTransfer",n,(o=>{var a,s,c,p,l,d;if(i)return;let m=400,u="";if(Device.os.pc)try{const e=0===o.base_resp.ret&&0===o.jsapi_resp.ret&&o.err_msg.indexOf(":ok")>-1,t=o.jsapi_resp.resp_json;m=e&&t?200:400,u=o.jsapi_resp.resp_json}catch(g){console.error(g)}else m=o&&1*o.errCode==0&&"string"==typeof o.result&&o.result?200:400,u=o.result;if(m>=200&&m<400?(obj.received&&obj.received(null),beforeResp({status:m}),handleRespSucc({status:m,responseText:u}),r.status=m,r.endTime=Date.now(),r.response=u,handleRespComplete(),networkEndLog(r)):window.__second_open__?A.invoke("request",{url:t,method:type,data:data,header:e},(e=>{if(i)return;const n=e.statusCode;obj.received&&obj.received(null),beforeResp({status:n}),e.err_msg.indexOf(":ok")>-1&&n>=200&&n<400?handleRespSucc({status:n,responseText:e.data}):(retryXhrFn(o,i,r),handleRespErr({status:n},o),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("req_failure_sec_open",JSON.stringify({retryReqJsapiRes:e,transferRes:o,url:t}),{mid:"mmbizwap:ajaxtransfer",view:"wap_business"})),r.status=n,r.endTime=Date.now(),r.response=e.data,handleRespComplete(),networkEndLog(r)})):retryXhrFn(o,i,r),Device.os.pc){o.err_msg.includes(":ok")||null===(s=null===(a=window.WX_BJ_REPORT)||void 0===a?void 0:a.BadJs)||void 0===s||s.report("pc transfer res no ok: ".concat(o.err_msg),n.url||"",{mid:window.PAGE_MID,_info:"".concat(JSON.stringify(n)," || ").concat(JSON.stringify(o))});try{(o.jsapi_resp.resp_json&&0!==JSON.parse(o.jsapi_resp.resp_json).base_resp.ret&&190001!==JSON.parse(o.jsapi_resp.resp_json).base_resp.ret||0!==o.base_resp.ret||0!==o.jsapi_resp.ret)&&(null===(p=null===(c=window.WX_BJ_REPORT)||void 0===c?void 0:c.BadJs)||void 0===p||p.report("pc transfer res invalid ret",n.url||"",{mid:window.PAGE_MID,_info:"".concat(JSON.stringify(n)," || ").concat(JSON.stringify(o))}))}catch(g){}}else try{0!==o.errCode&&(null===(d=null===(l=window.WX_BJ_REPORT)||void 0===l?void 0:l.BadJs)||void 0===d||d.report("mobile transfer res invalid ret",n.url||"",{mid:window.PAGE_MID,_info:"".concat(JSON.stringify(n)," || ").concat(JSON.stringify(o))}))}catch(g){}})),void beforeReq()}const xhr=new XMLHttpRequest,mayAbort=!!obj.mayAbort,async=void 0===obj.async||obj.async,_onreadystatechange=xhr.onreadystatechange;xhr.open(type,url,async),xhr.onreadystatechange=()=>{if("function"==typeof _onreadystatechange&&_onreadystatechange.apply(xhr),3===xhr.readyState&&obj.received&&obj.received(xhr),4===xhr.readyState){beforeResp(xhr),xhr.onreadystatechange=null;const{status:e}=xhr;if(e>=200&&e<400)handleRespSucc(xhr);else if(handleRespErr(xhr,"status error"),e||!mayAbort){const t=window.__ajaxtest||"0";__moon_report({offset:MOON_AJAX_NETWORK_OFFSET,log:"ajax_network_error[".concat(e,"][").concat(t,"]: ").concat(url,";host:").concat(location.host),e:""})}handleRespComplete()}},setXhrHeader(xhr,type,obj),handleReqTimeout(xhr);try{xhr.send(data);try{url&&url.length>LENGTH_LIMIT&&reportAjaxLength(27613,17,"ajax get limit[length: ".concat(url.length,"]").concat(url.substring(0,1024))),data&&!(data instanceof Blob)&&data.length>LENGTH_LIMIT&&reportAjaxLength(27613,18,"ajax post limit[length: ".concat(data.length,"]").concat(data.substring(0,1024))),data&&data instanceof Blob&&data.size>LENGTH_LIMIT&&reportAjaxLength(27613,18,"ajax post limit[length: ".concat(data.size,"]blob"))}catch(e){}}catch(e){obj.error&&obj.error(xhr,{type:3,error:e,status:0})}beforeReq()}))}function AjaxWx(t){t.url+=-1===t.url.indexOf("?")?"?fasttmplajax=1":"&fasttmplajax=1",getAjaxScope(t.url)?Ajax(t):(t.usePb&&(t.type="POST",t.data={data:JSON.stringify(t.data)}),/^(http:\/\/|https:\/\/|\/\/)/.test(t.url)?/^\/\//.test(t.url)&&(t.url="https:".concat(t.url)):t.url="https://mp.weixin.qq.com/".concat(t.url.replace(/^\//,"")),"html"===t.f||-1!==t.url.indexOf("?f=json")&&-1!==t.url.indexOf("&f=json")||(t.url+="&f=json"),t.notJoinUrl||"html"===t.f||(t.url=m.joinUrl(t.url)),m.joinUserArticleRole(t.url,!!t.notJoinUrl,(o=>{t.url=o;let n=null;if("object"==typeof t.data){const e=t.data,o=[];for(const t in e)e.hasOwnProperty(t)&&o.push("".concat(t,"=").concat(encodeURIComponent(e[t])));n=o.join("&")}else n="string"==typeof t.data?t.data:null;const r={Cookie:document.cookie,referer:location.href},i=networkStartLog({method:t.type||"GET",url:t.url,postData:t.data||{},requestHeader:r,requestType:"jsapi"});let a=1;const s=(t,o)=>A.invoke("request",{url:t.url,method:t.type,data:o,header:r},(n=>{var r;if(n.err_msg.indexOf(":ok")>-1){reqType(t,"/mp/getappmsgext")&&(window.receiveGetAppmsgExt="".concat(n.statusCode,"|").concat(Date.now())),reqType(t,"/mp/getappmsgad")&&(window.receiveGetAppmsgAd="".concat(n.statusCode,"|").concat(Date.now())),1===a&&t.received&&t.received(null);let c={};if(n.data)try{if(c="json"===t.dataType?JSON.parse(n.data):n.data,c&&c.base_resp&&0!==(null===(r=c.base_resp)||void 0===r?void 0:r.ret)&&void 0!==window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&Math.random()<.001){let e=t.url;-1!==t.url.indexOf("?")&&(e=t.url.substring(0,t.url.indexOf("?")),m.getQuery("action",t.url)&&(e="".concat(e,"?action=").concat(m.getQuery("action",t.url)))),("/mp/getappmsgext"!==e&&"/mp/getappmsgad"!==e||void 0!==c.base_resp.ret)&&window.WX_BJ_REPORT.BadJs.report(e,"ret=".concat(c.base_resp.ret),{mid:window.PAGE_MID,view:"wap_retcode"})}}catch(e){return console.error(e),t.error&&t.error(null,{type:1,error:e,status:n.statusCode}),t.complete&&t.complete(),i.endTime=Date.now(),i.response=n,void networkEndLog(i)}let p={};try{p=JSON.parse(n.data)}catch(e){}if(p&&p.base_resp&&-3===p.base_resp.ret&&a<2&&(mmVersion.isIOS||mmVersion.isAndroid&&mmVersion.getInner()>"27000600")){const e=a++;A.invoke("updatePageAuth",{},(n=>{if(console.log("[skeleton] updatePageAuth",n),monitor$1.setSum(112287,3,1),n&&n.err_msg&&n.err_msg.indexOf(":ok")>-1){window.top.pass_ticket=encodeURIComponent(m.getQuery("pass_ticket",n.fullUrl).html(!1).replace(/\s/g,"+")),t.pass_ticket&&(t.pass_ticket=window.top.pass_ticket),console.warn("[skeleton] updatePageAuth resetTopbar");const i=mmVersion.isIOS&&mmVersion.gtVersion("7.0.10",!0),a=!!window.is_login;if("0"===window.top.item_show_type&&i){setCurrentMpInfo((document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop||0)>40&&!a)}try{t.url=m.addParam(t.url,"retry",e,!0)}catch(r){console.error(r)}s(t,o),monitor$1.setSum(112287,4,1)}else t.success&&t.success(c),t.complete&&t.complete(),mmVersion.isIOS?monitor$1.setSum(112287,35,1):monitor$1.setSum(112287,36,1),i.status=200,i.endTime=Date.now(),i.response=c,networkEndLog(i)}))}else t.success&&t.success(c),t.complete&&t.complete(),i.status=200,i.endTime=Date.now(),i.response=c,networkEndLog(i)}else if(n.err_msg.indexOf("no permission")>-1||!mmVersion.isOnlyWechat)Ajax(t),n.err_msg.indexOf("no permission")>-1&&(console.warn("[JSAPI Request] No permission"),monitor$1.setSum(112287,31,1)),i.status=302,i.endTime=Date.now(),i.response=n,networkEndLog(i);else{t.error&&t.error(null,{type:3,error:n,status:0}),t.complete&&t.complete(),monitor$1.setSum(112287,32,1);const e=.001;if(Math.random()<e){const e="request: ".concat(JSON.stringify(t.type)," ").concat(JSON.stringify(t.url)," ;;;; cookie: ").concat(JSON.stringify(document.cookie)," ;;;; data: ").concat(JSON.stringify(o)," ;;;; resp: ").concat(JSON.stringify(n));window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("ajax_wx_request_error",e,{mid:"mmbizwap:Monitor"})}i.status=400,i.endTime=Date.now(),i.response=n,networkEndLog(i)}}));reqType(t,"/mp/getappmsgext")&&(window.startGetAppmsgExtTime=Date.now()),reqType(t,"/mp/getappmsgad")&&(window.startGetAppmsgAdTime=Date.now()),s(t,n)})))}function AjaxMpapp(t){const o=t.url.match(/^http(s?):\/\/([^\/]+)/);if(!mmVersion.isNewMpApp||o&&o[2]&&"mp.weixin.qq.com"!==o[2])return void Ajax(t);let n="";if("object"==typeof t.data){const e=t.data,o=[];for(const t in e)e.hasOwnProperty(t)&&o.push("".concat(t,"=").concat(encodeURIComponent(e[t])));n=o.join("&")}else n="string"==typeof t.data?t.data:"";let r=new URL(t.url,location.href).href;"GET"===t.type&&"object"==typeof t.data&&(r=m.join(r,t.data)),"html"===t.f||-1!==r.indexOf("?f=json")&&-1!==r.indexOf("&f=json")||(r+="&f=json"),t.notJoinUrl||"html"===t.f||(r=m.joinUrl(r)),m.joinUserArticleRole(r,!!t.notJoinUrl,(o=>{const r={Cookie:document.cookie,referer:location.href},i=networkStartLog({method:t.type||"GET",url:o,postData:t.data||{},requestHeader:r,requestType:"waproute"}),a={url:o,body:n,header:Object.keys(r).map((e=>({key:e,value:r[e]}))),method:t.type||"GET",timeout:t.timeout||5e3};A.invoke("wapRoute",a,(o=>{if(0===o.code)try{if("json"===t.dataType){const e=JSON.parse(o.content);"function"==typeof t.success&&t.success(e),i.response=e}else"function"==typeof t.success&&t.success(o.content),i.response=o.content;i.status=200,i.endTime=Date.now()}catch(e){"function"==typeof t.error&&t.error(null,{type:1,error:e,status:0}),i.endTime=Date.now(),i.response=o}else{"function"==typeof t.error&&t.error(null,{type:3,error:o,status:0}),i.status=400,i.endTime=Date.now(),i.response=o;const e="request: ".concat(JSON.stringify(a.method)," ").concat(JSON.stringify(a.url)," ;;;; cookie: ").concat(JSON.stringify(document.cookie)," ;;;; data: ").concat(n," ;;;; resp: ").concat(JSON.stringify(o)," ;;;; timegap: ").concat(i.endTime-i.startTime);window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("ajax_mpapp_request_error",e,{mid:"mmbizwap:Monitor"})}"function"==typeof t.complete&&t.complete(),networkEndLog(i)}))}))}const ajax=e=>{if(!window.__second_open_wait_a8key__||!window.__second_open_wait_a8key_task__)return mmVersion.isNewMpApp?AjaxMpapp(e):!mmVersion.isWxWork&&(window.__second_open__||!isAcrossOrigin&&top.window.__second_open__)&&window.__is_page_auth_return__&&!e.pureHttp?AjaxWx(e):Ajax(e);window.__second_open_wait_a8key_task__.push((()=>{ajax(e)}))},isx5=-1!==navigator.userAgent.indexOf("TBS/");let getDataFunc=[],reportData=[],specificData={};function joinUrl(e){const t={};return void 0!==window.uin&&(t.uin=window.uin),void 0!==window.key&&(t.key=window.key),void 0!==window.pass_ticket&&(t.pass_ticket=window.pass_ticket),void 0!==window.wxtoken&&(t.wxtoken=window.wxtoken),void 0!==window.devicetype&&(t.devicetype=window.devicetype),void 0!==window.clientversion&&(t.clientversion=window.clientversion),void 0!==window.appmsg_token?t.appmsg_token=window.appmsg_token:e.indexOf("advertisement_report")>-1&&((new Image).src="".concat(location.protocol,"//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_13_1&r=").concat(Math.random())),t.x5=isx5?"1":"0",t.f="json",m.join(e,t)}function isObj(e){return e&&"object"==typeof e}function assign(e,t){if(isObj(e)&&isObj(t))for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}function assembleReportData(e){const t=[];t.push({content:"[LeaveReport] specificData keys: ".concat(Object.keys(specificData)),timestamp:Date.now()}),d.log("[LeaveReport] specificData keys: ".concat(Object.keys(specificData))),console.log("[LeaveReport] specificData keys: ".concat(Object.keys(specificData)));const o={};for(const r in specificData){o[r]||(o[r]={});for(let i=0;i<specificData[r].length;i++){const a=specificData[r][i];if("function"==typeof a)try{assign(o[r],a(e))}catch(n){t.push({content:"[LeaveReport] specificData exec error: ".concat(a.toString().substring(0,50)),timestamp:Date.now()}),d.error("[LeaveReport] specificData exec error: ".concat(a.toString().substring(0,50))),console.error("[LeaveReport] specificData exec error: ".concat(a.toString().substring(0,50)))}else isObj(a)&&assign(o[r],a)}}t.push({content:"[LeaveReport] reportData.length: ".concat(reportData.length),timestamp:Date.now()}),d.log("[LeaveReport] reportData.length: ".concat(reportData.length)),console.log("[LeaveReport] reportData.length: ".concat(reportData.length)),t.push({content:"[LeaveReport] getDataFunc.length: ".concat(getDataFunc.length),timestamp:Date.now()}),d.log("[LeaveReport] getDataFunc.length: ".concat(getDataFunc.length)),console.log("[LeaveReport] getDataFunc.length: ".concat(getDataFunc.length));for(let r=0;r<getDataFunc.length;r++)try{const t=getDataFunc[r](e);isObj(t)&&reportData.push(t)}catch(n){t.push({content:"[LeaveReport] getDataFunc exec error: ".concat(getDataFunc[r].toString().substring(0,50)),timestamp:Date.now()}),d.error("[LeaveReport] getDataFunc exec error: ".concat(getDataFunc[r].toString().substring(0,50))),console.error("[LeaveReport] getDataFunc exec error: ".concat(getDataFunc[r].toString().substring(0,50)))}for(let r=0;r<reportData.length;r++)reportData[r].reportUrl&&(reportData[r].reportUrl=joinUrl(reportData[r].reportUrl));return o.data={requestList:reportData},t.push({content:"[LeaveReport] final reportData.length: ".concat(reportData.length,", data=").concat(JSON.stringify(reportData)),timestamp:Date.now()}),d.log("[LeaveReport] final reportData.length: ".concat(reportData.length)),console.log("[LeaveReport] final reportData.length: ".concat(reportData.length)),o.info=t,o}function addReport(e){"function"==typeof e?getDataFunc.push(e):isObj(e)&&reportData.push(e)}function addSpecificReport(e,t){specificData[e]||(specificData[e]=[]),specificData[e].push(t)}function reportNow(e){const t=assembleReportData(!0);A.invoke("handleMPPageAction",{action:"reportByLeaveForMPGateway",reportData:t},(o=>{if(o&&o.err_msg&&-1!==o.err_msg.indexOf(":ok"))getDataFunc=[],reportData=[],specificData={},"function"==typeof e&&e(o);else{getDataFunc=[],reportData=[];let o=t.data.requestList.length;t.data.requestList.forEach((t=>{t.reportUrl&&ajax({type:t.method||"GET",url:t.reportUrl,data:t.reportData,async:!1,success(t){--o<0&&"function"==typeof e&&e({err_msg:"handleMPPageAction:ok",fallback:!0,resp:t})},error(t,n){--o<0&&"function"==typeof e&&e({err_msg:"handleMPPageAction:fail",fallback:!0,err:n})}})}))}}))}const leaveReport={reportNow:reportNow,addReport:addReport,addSpecificReport:addSpecificReport},leaveReport$1=(()=>{let t={},o=!1;try{t=top.window.document}catch(e){o=!0}return!o&&top.window.__leaveReport?top.window.__leaveReport:window.__leaveReport?window.__leaveReport:(A.on("reportOnLeaveForMP",(()=>assembleReportData(!1))),window.__leaveReport=leaveReport)})(),getReportJson=function(e,t){const o=JSON.parse(JSON.stringify(t));return o.log_id=Number(e),o.TimeStamp=Math.round(Date.now()/1e3),console.log("[comm_report] reportjson: ",o),JSON.stringify(o)},getSuccessHandler=(e,t,o)=>n=>{n&&0!==n.err_code&&console.warn("[comm_report] report ".concat(e," fail: "),n.err_msg,t),"function"==typeof o.success&&o.success(n)},getErrorHandler=(e,t,o)=>(n,r)=>{console.error("[comm_report] report ".concat(e," error: "),r,t),"function"==typeof o.error&&o.error(n,r)};let batchReportDataArr=[];const blackLogId=[25587,18832,28208,25574,29139,10945],BATCH_SIZE=4,BATCH_TIME=1e3,getRepeatedReportJson=function(){if(!batchReportDataArr||!batchReportDataArr.length)return!1;const e={count:0};return e.count=batchReportDataArr.length,batchReportDataArr.forEach(((t,o)=>{e["reportjson".concat(o)]=t})),batchReportDataArr=[],console.log("[reportData]: ",e),e};let timeOutId;function batchReport(){if(!batchReportDataArr||!batchReportDataArr.length)return;const e=getRepeatedReportJson();e&&ajax({type:"POST",dataType:"json",url:"/mp/wapcommreport?action=batch_report",data:e,success:e=>{e&&e.err_code&&console.warn("[comm_report] batch report fail: ",e.err_msg,batchReportDataArr)},error:(e,t)=>{console.error("[comm_report] batch report error: ",t,batchReportDataArr)}})}function batchReportThrottle(e,t){const o=getReportJson(e,t);o&&(batchReportDataArr.push(o),batchReportDataArr.length>=BATCH_SIZE?batchReport():timeOutId||(timeOutId=setTimeout((()=>{batchReport(),clearTimeout(timeOutId),timeOutId=null}),BATCH_TIME)))}leaveReport$1.addReport((()=>{const e=getRepeatedReportJson();if(!e)return!1;let t=[];for(const[o,n]of Object.entries(e))t.push("".concat(o,"=").concat(encodeURIComponent(n)));return{reportUrl:"https://mp.weixin.qq.com/mp/wapcommreport?action=batch_report",reportData:t.join("&"),method:"POST"}}));const commReport={report(e,t,o){const n=o||{};n.realTime||blackLogId.includes(e)?ajax({type:"POST",dataType:"json",url:"/mp/wapcommreport",data:{reportjson:getReportJson(e,t)},async:n.async,success:getSuccessHandler(e,t,n),error:getErrorHandler(e,t,n)}):batchReportThrottle(e,t)},leaveReport(e,t){leaveReport$1.addReport((()=>{const o="function"==typeof t?t():t;return!!o&&{reportUrl:"https://mp.weixin.qq.com/mp/wapcommreport",reportData:"reportjson=".concat(encodeURIComponent(getReportJson(e,o))),method:"POST"}}))},reportByBeacon(e,t){try{if(Device.os.android||Device.os.ios)leaveReport$1.addReport((()=>{const o="function"==typeof t?t():t;return!!o&&{reportUrl:"https://mp.weixin.qq.com/mp/wapcommreport",reportData:"reportjson=".concat(encodeURIComponent(getReportJson(e,o))),method:"POST"}}));else{const o="function"==typeof t?t():t;if(!o)return!1;const n="/mp/wapcommreport",r=encodeURIComponent(getReportJson(e,o));console.log("reportByBeacon",JSON.stringify(r)),m.joinUserArticleRole(m.joinUrl(n),!1,(e=>{navigator.sendBeacon(e,"reportjson=".concat(r))}))}}catch(o){console.log(o)}}},prefix="__WXLS__",localStorage=window.localStorage||{getItem(){},setItem(){},removeItem(){},key(){},clear(){var e,t;null===(t=null===(e=window.localStorage)||void 0===e?void 0:e.clear)||void 0===t||t.call(e)},length:0},evictionPolicies={noeviction:e=>e,"allkeys-random"(e,t){let o=Object.keys(e),n=0;for(;n<t;){const t=o.length,r=o[Math.floor(Math.random()*t)];n+=JSON.stringify(e[r]).length,delete e[r],o=Object.keys(e)}return e},"volatile-ttl"(e,t){let o=Object.keys(e);o=o.sort(((t,o)=>{const n=e[t],r=e[o];return n.exp<r.exp?-1:n.exp>r.exp?1:0}));let n=0;for(let r=0;r<o.length&&!(n>=t);r++){const t=o[r];n+=JSON.stringify(e[t]).length,delete e[t]}return e},"clear-all":()=>(localStorage.clear(),{})};function formatLogMsg(e){return"[WXLS] ".concat(e)}class LS{constructor(e,t,o){if(this.logger=()=>{},!e)throw"require function name.";this.evictionPolicy="noeviction",this.key=e,"function"==typeof o&&(this.logger=(e,t)=>o(formatLogMsg(e),t)),t&&-1!==Object.keys(evictionPolicies).indexOf(t)&&(this.evictionPolicy=t),this.init()}static getItem(e){return e=prefix+e,localStorage.getItem(e)}static setItem(t,o,n){var r,i;t=prefix+t;let a=3;for(;a--;)try{localStorage.getItem(t)&&localStorage.removeItem(t),localStorage.setItem(t,o),"function"==typeof n&&n("setItem success: LSlen:".concat(null===(r=null===window||void 0===window?void 0:window.localStorage)||void 0===r?void 0:r.length," key:").concat(t," val:").concat(o),"success");break}catch(e){"function"==typeof n&&n("setItem error: LSlen:".concat(null===(i=null===window||void 0===window?void 0:window.localStorage)||void 0===i?void 0:i.length," error:").concat(e," key:").concat(t," val:").concat(o),"error"),LS.clear()}}static clear(){let e,t;for(e=localStorage.length-1;e>=0;e--)t=localStorage.key(e),0==t.indexOf(prefix)&&localStorage.removeItem(t)}static getSupportEvicationPolicy(){return Object.keys(evictionPolicies)}init(){var e,t;this.check(),1e3*Math.random()<1&&(null===(e=this.logger)||void 0===e||e.call(this,"LSlen: ".concat((null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t.length)||localStorage.length),"report"))}getData(){let t=LS.getItem(this.key)||"{}";try{t=JSON.parse(t)}catch(e){this.logger("getData error: ".concat(e),"error"),localStorage.removeItem(prefix+this.key),t={}}return t}check(e){const t=this.getData(),o={},n=+new Date;let r,i;for(r in t)i=t[r],+i.exp>n&&(o[r]=i);if(this.logger("check info: isReturn:".concat(e," data:").concat(JSON.stringify(o)),"info"),e)return o;LS.setItem(this.key,JSON.stringify(o),this.logger)}set(t,o,n){var r,i;const a=this.check(!0);a[t]={val:o,exp:n||+new Date};try{localStorage.getItem(prefix+this.key)&&localStorage.removeItem(prefix+this.key),localStorage.setItem(prefix+this.key,JSON.stringify(a)),this.logger("first set success: LSlen:".concat(null===(r=null===window||void 0===window?void 0:window.localStorage)||void 0===r?void 0:r.length," key:").concat(prefix+this.key," data:").concat(JSON.stringify(a)),"success")}catch(e){this.logger("first set error: LSlen:".concat(null===(i=null===window||void 0===window?void 0:window.localStorage)||void 0===i?void 0:i.length," error:").concat(e," key:").concat(prefix+this.key," data:").concat(JSON.stringify(a)," k:").concat(t," v:").concat(o," exp:").concat(n),"error"),localStorage.clear(),LS.setItem(this.key,JSON.stringify({[t]:{val:o,exp:n||+new Date}}),this.logger)}}get(e){let t=this.getData();return t=t[e],t&&t.val||null}remove(e){const t=this.getData();t[e]&&delete t[e],LS.setItem(this.key,JSON.stringify(t),this.logger)}}let timer=null,jsmonitorReport={setSum:function(e,t,o){throw new Error("Function not implemented.")},setAvg:function(e,t,o){throw new Error("Function not implemented.")},setLogs:function(e){throw new Error("Function not implemented.")},send:function(e){throw new Error("Function not implemented.")}};function reportInterval(e,t){timer=window.setTimeout((function(){e(),reportInterval(e,t)}),t)}window.__monitor_unload_has_done__=!1,jsmonitorReport.setSum=function(e,t,o){return monitor$1.setSum(e,t,o),jsmonitorReport},jsmonitorReport.setAvg=function(e,t,o){return monitor$1.setAvg(e,t,o),jsmonitorReport},jsmonitorReport.setLogs=function(e){return monitor$1.setLogs(e),jsmonitorReport},jsmonitorReport.send=function(e){return!1!==e&&(e=!0),monitor$1.send(e,ajax),jsmonitorReport},reportInterval((function(){jsmonitorReport.send()}),1e3),window.addEventListener("unload",(function(){window.__monitor_report_has_done__||(window.__ajaxtest="2",timer&&(window.clearTimeout(timer),timer=null),jsmonitorReport.send(!1),window.__monitor_unload_has_done__=!0)}),!1),window.__jsmonitorReport?jsmonitorReport=window.__jsmonitorReport:window.__jsmonitorReport=jsmonitorReport;const jsmonitorReport$1=jsmonitorReport;try{void 0===parent.window.hasListenMpPageAction&&(parent.window.hasListenMpPageAction=!1),void 0===parent.window.hasListenStateChange&&(parent.window.hasListenStateChange=!1)}catch(error){}const mpPageActionCb=[],stateChangeCb=[],HistoryLS=new LS("history4secondopen"),HistoryKey="from";let hasListenPopstateForSecOpenReload=!1,webComptStatus={status:"loading"};const webComptInitCb=[];let directionHandlerId=0;const directionChangeHandlersMap={};function isNativePage(){return"1"===m.getQuery("isNativePage")||"2"===m.getQuery("isNativePage")}function debounce(e,t=50){let o;return function(...n){const r=this;o||(o=setTimeout((()=>{o=null,e.apply(r,n)}),t))}}function checkIntersect(e,t){return!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}const utils={isNativePage:isNativePage,isNewNativePage:()=>"2"===m.getQuery("isNativePage"),isOldNativePage:()=>"1"===m.getQuery("isNativePage"),__useWcSlPlayer:!1,isWcSlPage:()=>utils.__useWcSlPlayer,getPlayerType:()=>utils.isWcSlPage()?3:isNativePage()?2:1,getParam(e){if(!e)return null;let t=location.href.match(new RegExp("(\\?|&)".concat(e,"=([^&]+)")));return t?t[2]:null},insertAfter(e,t){const o=t.parentNode;o.lastChild===t?o.appendChild(e):o.insertBefore(e,t.nextSibling)},getInnerHeight:()=>window.getInnerHeight&&window.getInnerHeight()||window.innerHeight||document.documentElement.clientHeight,getInnerWidth:()=>window.innerWidth||document.documentElement.clientWidth,getScrollTop:()=>document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,getDocumentHeight:()=>document.body.scrollHeight,getElementActualTop(e){return e.getBoundingClientRect().top+this.getScrollTop()},getElementTop:e=>e.getBoundingClientRect().top,getElementHeight:e=>e.getBoundingClientRect().height,getOrientation(){var e,t;return null!==(t=null===(e=window.screen.orientation)||void 0===e?void 0:e.angle)&&void 0!==t?t:window.orientation},getDirection:(e=utils.getOrientation())=>(mmVersion.isIPad?[90,270]:[0,180]).indexOf(e)>-1?"vertical":"horizontal",listenDirectionChange(e){var t,o;return(null===(o=null===(t=window.screen)||void 0===t?void 0:t.orientation)||void 0===o?void 0:o.addEventListener)?(directionChangeHandlersMap[directionHandlerId]=t=>{null==e||e(utils.getDirection(t.target.angle),t.target.angle)},window.screen.orientation.addEventListener("change",directionChangeHandlersMap[directionHandlerId])):(directionChangeHandlersMap[directionHandlerId]=()=>{const t=utils.getOrientation();null==e||e(utils.getDirection(t),t)},window.addEventListener("orientationchange",directionChangeHandlersMap[directionHandlerId])),directionHandlerId++},unlistenDirectionChange(e){var t,o;(null===(o=null===(t=window.screen)||void 0===t?void 0:t.orientation)||void 0===o?void 0:o.removeEventListener)?window.screen.orientation.removeEventListener("change",directionChangeHandlersMap[e]):window.removeEventListener("orientationchange",directionChangeHandlersMap[e]),delete directionChangeHandlersMap[e]},isScrollEnd(e){return this.getScrollTop()+this.getInnerHeight()+e>=this.getDocumentHeight()},listenStateChange(e={}){stateChangeCb.push(e.cb);try{if(parent.window.hasListenStateChange)return}catch(error){}A.on("activity:state_change",(e=>{stateChangeCb.forEach((t=>{t(e)}))}));try{parent.window.hasListenStateChange=!0}catch(error){}},listenMpPageAction(e){mpPageActionCb.push(e);try{if(parent.window.hasListenMpPageAction)return}catch(error){}A.on("onMPPageAction",(e=>{mpPageActionCb.forEach((t=>{t(e)}))}));try{parent.window.hasListenMpPageAction=!0}catch(error){}},getIosMainVersion(){let e=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);return e&&e[1]&&parseInt(e[1].split("_")[0],10)},report120081(e,t){jsmonitorReport$1.setSum(120081,e,t),jsmonitorReport$1.send()},loadNewPageKeepingHistoryStackIfSecOpen(e){window.__second_open__&&"string"==typeof e&&/^https?:\/\/mp.weixin.qq.com\//.test(e)&&HistoryLS.set(HistoryKey,location.href,Date.now()+1e4),location.href="".concat(e.replace(/#.*$/,""),"#wechat_redirect")},initNewPageHistoryStackFromSecOpen(){const t=HistoryLS.get(HistoryKey);if(t&&"string"==typeof t&&/^https?:\/\/mp.weixin.qq.com\//.test(t)&&(HistoryLS.remove(HistoryKey),history&&history.replaceState&&history.pushState)){const o=location.href;try{history.replaceState({__mock_secopen_history_stack_reload__:1},"",t),history.pushState({__mock_secopen_history_stack_reload__:1},"",o)}catch(e){console.error("[initNewPageHistoryStackFromSecOpen]",e)}}hasListenPopstateForSecOpenReload||(hasListenPopstateForSecOpenReload=!0,window.addEventListener("popstate",(e=>{e.state&&1===e.state.__mock_secopen_history_stack_reload__&&location.reload()})))},initWebCompt(e,t){const o=()=>{for(;webComptInitCb.length;){webComptInitCb.shift()(webComptStatus)}};if(mmVersion.isWechat&&!mmVersion.isInMiniProgram&&(Device.os.iphone&&Device.os.getNumVersion()>=10.3&&(mmVersion.gtVersion("7.0.14",1)&&Device.os.getNumVersion()<15||mmVersion.gtVersion("8.0.7"))||Device.os.android&&mmVersion.gtVersion("7.0.15",1)&&Device.os.getNumVersion()>=5))document.addEventListener("WeixinOpenTagsReady",(()=>{webComptStatus={status:"ready"},o()})),document.addEventListener("WeixinOpenTagsError",(e=>{webComptStatus={status:"error",error:e&&e.detail&&e.detail.errMsg},o()})),A.invoke("handleMPPageAction",{action:"wxConfig",appid:"wxmpfakeid",webComptList:e,url:location.href},(n=>{console.log("wx config web compt result",e,n),d.info("wx config web compt result",e,JSON.stringify(n)),n&&n.err_msg&&-1===n.err_msg.indexOf(":ok")&&(webComptStatus={status:"error",error:n.err_msg},o()),"function"==typeof t&&t(n)}));else{const n={err_msg:"handleMPPageAction:fail_webcompt unsupported"};console.log("wx config web compt result",e,n),d.info("wx config web compt result",e,JSON.stringify(n)),webComptStatus={status:"error",error:n.err_msg},o(),"function"==typeof t&&t(n)}},initWebComptForWcSlVideoSharePage(){const e=e=>{-1!==e.err_msg.indexOf(":ok")?utils.initNewPageHistoryStackFromSecOpen():(window.__failConfigWxOpen=!0,d.info("failed to config wxopen: res not ok"),jsmonitorReport$1.setSum(221515,Device.os.iphone?7:8,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&e&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:CfgError",(window.__second_open__?"secopen:":"h5:")+JSON.stringify(e)))};if(mmVersion.isAndroid){const t=mmVersion.getInner();t>"27001037"&&t<"27001060"||t>="27001100"?utils.initWebCompt(["wxOpen"],e):mmVersion.gtVersion("7.0.15",1)?(window.__failConfigWxOpen=!0,d.info("failed to config wxopen: android version check failed (gt 7.0.15)")):(window.__failConfigWxOpen=!0,d.info("failed to config wxopen: android version check failed"))}else mmVersion.isIOS?mmVersion.gtVersion("7.0.15",1)?utils.initWebCompt(["wxOpen"],e):(window.__failConfigWxOpen=!0,d.info("failed to config wxopen: ios version check failed")):window.__failConfigWxOpen=!0},getWebComptStatus:e=>"function"!=typeof e?webComptStatus:("loading"===webComptStatus.status?webComptInitCb.push(e):e(webComptStatus),!0),supportImmersiveMode:mmVersion.isWechat&&!mmVersion.isInMiniProgram&&(mmVersion.isIOS&&mmVersion.gtVersion("8.0.9",1)||mmVersion.isAndroid&&mmVersion.gtVersion("8.0.9",1)),debounce:debounce,bindDebounceScrollEvent(e,t=window,o=50,n=!1){const r=debounce(e,o);a.on(t,"scroll","",r,n)},checkIntersect:checkIntersect,clickRange(e){const t=window.getSelection(),o=t.rangeCount&&t.getRangeAt(0);if(!o||o.collapsed||!o.intersectsNode(e.target))return!1;const n=o.getClientRects(),r=parseFloat(getComputedStyle(e.target).lineHeight,10),i=e.target.getBoundingClientRect();for(let a in n)if(n.hasOwnProperty(a)){const t=n[a],o=r?(r-t.height)/2:0;if(t.width&&checkIntersect(t,i)&&e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top-o&&e.clientY<=t.bottom+o)return!0}},once:e=>function(...t){if(e){let o=e.apply(this,t);return e=null,o}},getRealHeightOfIOSNativePanel(e,t){mmVersion.isIOS?A.invoke("handleDeviceInfo",{action:"getUIParams"},(o=>{let n=e;o.isShowBottomBar&&(n-=o.bottomBarHeight),n=Math.max(n,0),"function"==typeof t&&t(n)})):"function"==typeof t&&t(e)}};export{Ajax as A,LS as L,ajax as a,addHash as b,commReport as c,d,addWxfrom as e,addParam as f,getIsAuthor as g,getQuery as h,html$1 as i,jsmonitorReport$1 as j,getBiz as k,leaveReport$1 as l,m,isAuthorScene as n,removeParam as r,utils as u};
