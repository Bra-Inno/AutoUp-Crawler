import{V as t,B as e,a as i,b as s,g as o,aj as a,ao as r,E as n,Z as l,h,aq as d,ar as c,as as u,ay as p,az as _,K as m,O as g,a6 as f,aA as v,W as y}from"./topic.mg5xph6vf09b6144.js";import{L as w,a as S,j as b,d as T,m as k,e as P,u as C,c as I,l as x}from"./comm_utils.mg5xph6v4fda8a3d.js";import{p as E}from"./page_utils.mg5xph6vb076ad9f.js";import{e as O}from"./advance.mg5xph6v53ea4027.js";import{n as R}from"./_plugin-vue2_normalizer.mg5xph6vfc2fb13f.js";import{m as A,A as M,D as B}from"./private_share.mg5xph6v1a0c9c7e.js";import{W as D}from"./appmsgext.mg5xph6v82836ebd.js";import{s as L}from"./safe_area_insets.mg5xph6v7f72fb96.js";import{a as F}from"./page_utils.mg5xph6v15e313ed.js";import{_ as V}from"./loadscript.mg5xph6v2014a786.js";import{E as N}from"./event_bus.mg5xph6vf7643e49.js";const W={install(t){const e=(t,{value:e})=>{"img"===t.tagName.toLowerCase()&&"string"==typeof e&&(e.canHevc()?O(t,e):t.src=e)};t.directive("wxpic-src",{inserted:e,update:e})}};window.Vue.use(W);const j=new w("ajax_load_js"),U={jsLoadState:{},winCacheKey:"__loadExternalJsStates__",lsTimeout:1728e5,customerParam:"wxv",callbackQueue:[]};function H(t){const e=t.win||window;let i=!0;try{e.eval(t.funcStr),i=!0}catch(s){i=!1}return i?(function(t){const e=G(t.url,t.version),i=t.win||window;i[U.winCacheKey]||(i[U.winCacheKey]={});i[U.winCacheKey][e]||(i[U.winCacheKey][e]={});i[U.winCacheKey][e].state=!0}({url:t.url,version:t.version,win:e}),t.useCache&&function(t,e,i){const o={version:e,func:i,time:+new Date},a=X(t);try{j.set(a,JSON.stringify(o),Date.now()+864e5)}catch(s){}}(t.url,t.version,t.funcStr),!0):(Q({url:t.url,version:t.version,win:e}),J(t.url),!1)}function z(t){for(let e=0,i=U.callbackQueue.length;e<i;e++){const i=U.callbackQueue[e],{options:s}=i,{win:o}=s,a=G(s.url,s.version);"suc"==t.type?(t.funcStr&&!q(o,a)&&H({win:o,funcStr:t.funcStr,useCache:!1,url:s.url,version:s.version}),i.onSuccess({code:t.code,queueIndex:e})):i.onError({code:t.code,queueIndex:e})}U.callbackQueue=[]}function J(t){const e=X(t);j.remove(e)}function q(t,e){var i,s;return!0===(null===(s=null===(i=(t=t||window)[U.winCacheKey])||void 0===i?void 0:i[e])||void 0===s?void 0:s.state)}function Q(t){var e;const i=G(t.url,t.version),s=t.win||window;if(null===(e=s[U.winCacheKey])||void 0===e?void 0:e[i])try{delete s[U.winCacheKey][i]}catch(o){}}function X(t){return encodeURIComponent(t)}function G(t,e){return"".concat(encodeURIComponent(t),"_").concat(e)||""}const Y={ClearCache:function(t){Q(t),J(t.url)},Load:function(t){const e=G(t.url,t.version);let i=function(){},s=function(){};if("function"==typeof t.onSuccess&&(i=t.onSuccess),"function"==typeof t.onError&&(s=t.onError),q(t.win,e))return void i({code:1,queueIndex:0});if(t.useCache){const s=function(t,e){const i=X(t),s=j.get(i);if(!s)return null;let o;try{o=JSON.parse(s)}catch(n){}if(!o)return;const a=+new Date,r=1*o.time;if(a-r>U.lsTimeout||o.version!=e||!o.func)return J(t),null;return o.func}(t.url,t.version);if(s&&H({win:t.win,funcStr:s,useCache:!1,url:t.url,version:t.version}),q(t.win,e))return void i({code:2,queueIndex:0})}if(U.callbackQueue.push({options:t,onSuccess:i,onError:s}),void 0===U.jsLoadState[e]&&(U.jsLoadState[e]=-1),-1!=U.jsLoadState[e])return;let{url:o}=t;-1==o.indexOf("?")?o+="?".concat(U.customerParam,"=").concat(t.version):o+="&".concat(U.customerParam,"=").concat(t.version),function(t){U.jsLoadState[t.key]=1,S({url:t.url,notJoinUrl:!0,timeout:1e4,type:"GET",dataType:"text",noXRequestedWidthHeader:!0,success(e){if(1==U.jsLoadState[t.key]){U.jsLoadState[t.key]=-1;let i=!0;i=!!e&&H({win:null,funcStr:e,useCache:!0,url:t.originUrl,version:t.version}),z(i?{code:3,type:"suc",funcStr:e}:{code:51,type:"err"})}},error(){1==U.jsLoadState[t.key]&&(U.jsLoadState[t.key]=-1,z({code:52,type:"err"}))},complete(){1==U.jsLoadState[t.key]&&(U.jsLoadState[t.key]=-1,z({code:53,type:"err"}))}})}({originUrl:t.url,version:t.version,url:o,key:e})}},K={customerParam:"wxv",jsUrl:"//vm.gtimg.cn/tencentvideo/txp/js/iframe/api.js?",jsVersion:"v1"};function Z(t){let e=function(){},i=function(){};if("function"==typeof t.onSuccess&&(i=t.onSuccess),"function"==typeof t.onError&&(e=t.onError),window.cgiData.is_teenager||window.is_teenager){const e=document.createElement("div");e.classList.add("wrp_pop_tips"),e.classList.add("wx_video_msg_primary");const s=document.createElement("div");s.classList.add("wx_video_msg_primary_inner");const o=document.createElement("p");o.classList.add("wx_video_msg_primary_text"),o.innerText="未成年人模式下暂不支持观看视频",s.appendChild(o),e.appendChild(s);return document.getElementById(t.containerId).appendChild(e),void i({player:null})}Y.Load({url:K.jsUrl,version:K.jsVersion,useCache:!0,win:t.win,onSuccess:function(s){2!=s.code&&3!=s.code||0!=s.queueIndex||(b.setSum("64728","111",1),b.setSum("64728","112",1));const o=t.win||window;let a=!0;if(o.Txp&&"function"==typeof o.Txp.Player?(a=!0,0==s.queueIndex&&(2==s.code?b.setSum("64728","116",1):3==s.code&&b.setSum("64728","117",1))):(a=!1,0==s.queueIndex&&(2==s.code?b.setSum("64728","114",1):3==s.code&&b.setSum("64728","115",1))),a){const e=tt({win:o,options:t});i({player:e})}else Y.ClearCache({win:o,version:K.jsVersion,url:K.jsUrl}),e()},onError:function(e){0==e.queueIndex&&(b.setSum("64728","111",1),b.setSum("64728","118",1),51==e.code?b.setSum("64728","119",1):52==e.code?b.setSum("64728","120",1):53==e.code&&b.setSum("64728","121",1)),function(t){let e=function(){},i=function(){};"function"==typeof t.onSuccess&&(i=t.onSuccess);"function"==typeof t.onError&&(e=t.onError);let s=K.jsUrl;-1==s.indexOf("?")?s+="?"+K.customerParam+"="+K.jsVersion:s+="&"+K.customerParam+"="+K.jsVersion;V({win:t.win,url:s,timeout:1e4,type:"JS",callback:function(){b.setSum("64728","122",1);const s=t.win||window;if(s.Txp&&"function"==typeof s.Txp.Player){b.setSum("64728","124",1);const e=tt({win:t.win,options:t});i({player:e})}else b.setSum("64728","123",1),e()},onerror:function(t){switch(b.setSum("64728","122",1),1*t){case 400:K.jsLoadState=4,b.setSum("64728","125",1);break;case 500:K.jsLoadState=5,b.setSum("64728","126",1);break;default:K.jsLoadState=6,b.setSum("64728","127",1)}e()}})}(t)}})}function tt(t){const e=t.win||window,i=t.options;return new e.Txp.Player({containerId:i.containerId,vid:i.vid,width:i.width,height:i.height,autoplay:!0===i.autoplay,allowFullScreen:!0===i.allowFullScreen,chid:17})}const et={createTxVideo:Z,createGlobalFunc:function(){"function"!=typeof window.__createTxVideo&&(window.__createTxVideo=function(t){Z(t)})}};function it(t){let e="/mp/immersive_player?action=get_player_data_v2&is_public_related_video=".concat(window.cgiData.related_video_source%10);Object.keys(t).forEach((i=>{"onSuccess"!==i&&"onError"!==i&&void 0!==t[i]&&(e+="&"+i+"="+encodeURIComponent(t[i]))})),D({url:e,dataType:"json",timeout:3e4,type:"GET",scope:"mmbiz_video",success(e){var i;if(console.info("[沉浸式播放器数据响应请求]: ",e),T.info("[Player] success get immersive data"),0===(null==(i=null==e?void 0:e.base_resp)?void 0:i.ret)?"function"==typeof t.onSuccess&&t.onSuccess(e):"function"==typeof t.onError&&t.onError(e),e)try{T.info("[Player] success get immersive data, immersive data is: ".concat(JSON.stringify(e)))}catch(s){}else T.info("[Player] success get immersive data, immersive data is empty")},error(e){"function"==typeof t.onError&&t.onError(e)},complete(e){"function"==typeof t.onComplete&&t.onComplete(e)}})}function st(t){const e=Date.now(),i="/mp/immersive_player?action=op&type=".concat(t.type||0,"&__biz=").concat(t.biz||"","&mid=").concat(t.mid||"","&idx=").concat(t.idx||"","&vid=").concat(t.vid||"","&appmsgid=").concat(t.mid||"","&passparam=").concat(window.passparam||"","&reuqest_id=").concat(e,"&sessionid=").concat(window.sessionid||0,"&enterid=").concat(window.enterid||0);D({url:i,dataType:"json",timeout:3e4,scope:"mmbiz_video",data:{is_temp_url:window.is_temp_url||0,scene:window.source||window.scene||0,subscene:window.subscene||0,appmsg_like_type:window.appmsg_like_type||0,item_show_type:window.real_item_show_type||0,client_version:window.clientversion||"",comment:t.comment?t.comment:"",prompted:1,style:t.styleType,passparam:window.passparam||"",request_id:e,device_type:window.devicetype||"",exptype:window.exptype||"",expsessionid:window.expsessionid||"",sessionid:window.sessionid||""},type:"POST",success(e){var i;console.log("operate immersive player data",t,e),0===(null==(i=null==e?void 0:e.base_resp)?void 0:i.ret)?"function"==typeof t.onSuccess&&t.onSuccess(e):"function"==typeof t.onError&&t.onError()},error(){"function"==typeof t.onError&&t.onError()},complete(){"function"==typeof t.onComplete&&t.onComplete()}})}function ot(t){return t.map((t=>(t.related_tag_video.mid=k.getQuery("mid",t.related_tag_video.url),t.related_tag_video.__biz=k.getQuery("__biz",t.related_tag_video.url),t.related_tag_video.idx=k.getQuery("idx",t.related_tag_video.url),t.related_tag_video.sn=k.getQuery("sn",t.related_tag_video.url),t.video_page_info.nick_name=t.video_page_info.source_nickname,t.related_tag_video.user_name=t.related_tag_video.srcUserName,t.related_tag_video.hd_head_img=t.related_tag_video.head_img_url,t.related_tag_video.desc=t.related_tag_video.digest,t.video_page_info.src_bizuin=t.video_page_info.hit_bizuin,t)))}window.Vue.use(t);const at=()=>new t.Store({state:{moreVideoList:[],hasReadVideoList:[],pageSize:20,offset:0,isListEnd:!1,currentReqData:{}},mutations:{setMoreVideoList(t,e){t.moreVideoList=e},setIsListEnd(t,e){t.isListEnd=e},setOffset(t,e){t.offset=e}},actions:{markRead({commit:t,state:e},i){e.hasReadVideoList.push({related_tag_video:{vid:i}});t("setMoreVideoList",e.moreVideoList.filter((t=>t.related_tag_video.vid!==i||(e.hasReadVideoList.push(t),!1))))},getMoreVideoList:({commit:t,state:e},i)=>new Promise(((s,o)=>{Object.assign(e.currentReqData,{related_video_num:e.pageSize},i?{__biz:i.__biz,mid:i.mid,idx:i.idx,vid:i.vid,title:i.title}:{}),it({...e.currentReqData,onSuccess(i){const o=ot(i.item_list||[]);t("setMoreVideoList",o),t("setOffset",e.offset+e.pageSize),s(o)},onError(e){console.log("getMoreVideoList error",e),t("setIsListEnd",!0),t("setMoreVideoList",[]),o(e)}})})),suppleMoreVideoList:({commit:t,state:e},i)=>new Promise(((s,o)=>{Object.assign(e.currentReqData,{related_video_num:e.pageSize},i?{__biz:i.biz||i.__biz,mid:i.mid,idx:i.idx,vid:i.vid,title:i.title,item_show_type:i.item_show_type}:{}),it({...e.currentReqData,onSuccess(i){const o=ot((i.item_list||[]).filter((t=>-1===[...e.moreVideoList,...e.hasReadVideoList].findIndex((e=>e.related_tag_video.vid===t.related_tag_video.vid))))),a=[...e.moreVideoList,...o];t("setMoreVideoList",a),s(a)},onError(e){console.log("suppleMoreVideoList error",e),t("setIsListEnd",!0),o(e)}})}))}});const rt=R({name:"mp-more-video-bottom-modal",filters:{formatTime(t){let e=0,i=0,s=0;return t=Math.floor(t),e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),s=t-3600*e-60*i,0!==e?(e<10&&(e="0"+e),e+=":"):e="",i<10&&(i="0"+i),s<10&&(s="0"+s),e+i+":"+s},formatReadNum:t=>E.formatReadNum(t)||0},data:()=>({endLine:!0}),components:{[e.name]:e},computed:{...i(["moreVideoList"]),showList(){const t=this.moreVideoList.slice();return t.forEach((t=>{t.related_tag_video.cover=P(t.related_tag_video.cover,11)})),t}},methods:{...s(["getMoreVideoList"]),...o(["setOffset"]),show(){this.$refs.bottomModal.show()},hide(){this.$refs.bottomModal.hide()},scrollTo(t){this.$refs.bottomModal.scrollTo(t)},showLoading(){this.$refs.bottomModal.showLoading()},hideLoading(){this.$refs.bottomModal.hideLoading()},reset(){this.endLine=!1,this.$refs.bottomModal.finishPullUpLoad(),this.setOffset(0)},onLoadTailListData(){this.$refs.bottomModal.showPullUpLoading(),this.getMoreVideoList().then((()=>{this.$refs.bottomModal.hidePullUpLoading(),this.$refs.bottomModal.finishPullUpLoad()})).catch((()=>{this.endLine=!0,this.$refs.bottomModal.hidePullUpLoading()}))},onVideoClick(t,e){setTimeout((()=>{this.$emit("switch-video",t)}),150),this.$emit("more-video-item-click",{EventType:2,...this.genVideoReportData(t,e)})},onItemExpose(t,e){this.$emit("more-video-item-expose",{EventType:1,...this.genVideoReportData(t,e)})},genVideoReportData:(t,e)=>({WatchMoreSet:2,RecVid:t.related_tag_video.vid,RecBizUin:Number(atob(t.related_tag_video.__biz))||0,RecMsgId:Number(t.related_tag_video.mid)||0,RecItemIdx:Number(t.related_tag_video.idx)||0,RecSeq:e+1||0})}},(function(){var t=this,e=t._self._c;return e("mp-bottom-modal",{ref:"bottomModal",attrs:{"hide-when-scroll-down":"",top:"33%","ext-class":"player_relate_video_dialog weui-half-screen-dialog_fold"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("观看更多")]},proxy:!0}])},[e("ul",{staticClass:"player_relate_video_list",attrs:{id:"js_player_relate_video_list"}},t._l(t.showList,(function(i,s){return e("li",{directives:[{name:"expose",rawName:"v-expose",value:()=>t.onItemExpose(i,s),expression:"() => onItemExpose(video, index)"}],key:s,staticClass:"player_relate_video_item weui-flex js_wx_tap_highlight wx_tap_link wx_tap_cell",on:{click:function(e){return t.onVideoClick(i,s)}}},[e("span",{staticClass:"player_relate_video_hd"},[e("span",{staticClass:"player_relate_video_thumb"},[e("img",{directives:[{name:"wxpic-src",rawName:"v-wxpic-src",value:i.related_tag_video.cover,expression:"video.related_tag_video.cover"}],staticClass:"player_relate_video_thumb_img"})]),e("em",{staticClass:"player_relate_video_length"},[t._v(" "+t._s(t._f("formatTime")(i.related_tag_video.duration))+" ")])]),e("span",{staticClass:"player_relate_video_bd weui-flex__item"},[e("strong",{staticClass:"player_relate_video_title"},[t._v(t._s(i.related_tag_video.title))]),e("span",{staticClass:"weui-flex player_relate_video_desc"},[e("span",{staticClass:"player_relate_video_desc_meta player_relate_video_nickname"},[t._v(" "+t._s(i.related_tag_video.srcDisplayName)+" ")]),e("span",{staticClass:"player_relate_video_num"},[t._v(" 播放 "+t._s(t._f("formatReadNum")(i.related_tag_video.read_num))+" ")])])])])})),0),e("div",{directives:[{name:"show",rawName:"v-show",value:t.endLine,expression:"endLine"}],staticClass:"weui-loadmore weui-loadmore_default weui-loadmore_line weui-loadmore_dot player_video_list_end_line"},[e("span",{staticClass:"weui-loadmore__tips"})])])}),[],!1,null,null,null,null).exports;let nt=100;const lt=new WeakMap;function ht(t){const e=lt.get(t);return e||(lt.set(t,++nt),nt)}const dt=-1,ct=1,ut=0,pt=1,_t=2,mt=0,gt=1;const ft=R({name:"mp-infinity-list-item",props:{item:{type:Object,require:!0},index:{type:Number,require:!0},relatedIdx:{type:Number,require:!0},loadingStatus:{type:Number,require:!0},pageHeight:{type:Number,require:!0},isEnd:{type:Boolean,require:!0}}},(function(){var t=this;return(0,t._self._c)("div",{staticClass:"infinity-list__page",style:{height:t.pageHeight?"".concat(t.pageHeight,"px"):"auto",position:"absolute",top:t.pageHeight*t.index+"px"},attrs:{"data-key":t.item&&t.item.key||t.index,"infinity-idx":t.index}},[void 0!==t.item?t._t("main",null,{item:t.item.data,index:t.index}):1===t.relatedIdx&&t.loadingStatus&&!t.isEnd?t._t("loading"):1===t.relatedIdx?t._t("end"):-1===t.relatedIdx?t._t("head"):t._e()],2)}),[],!1,null,null,null,null).exports;const vt=R({name:"mp-infinity-list",components:{[ft.name]:ft},props:{list:{type:Array,default:()=>[]},disabledScroll:{type:Boolean,default:!1},onlyOne:{type:Boolean,default:!1},pageHeight:{type:Number},loadingHeight:{type:Number,default:150},offsetThreshold:{type:Number,default:50},moveThreshold:{type:Number,default:10},transformDuration:{type:Number,default:270},curPage:{type:Number},containerClass:{type:String},isEnd:{type:Boolean,default:!1},disabledRefresh:{type:Boolean,default:!1},keepFirstAlive:{type:Boolean,default:!1},fade:{type:Boolean,default:!1}},model:{prop:"curPage",event:"change"},data:()=>({containerStyle:null,offset:0,startPoint:null,endPoint:null,startOffset:0,displacement:0,loading:ut,scrolling:!1}),created(){this.initPageHeight(this.pageHeight),this.__actuallyPage=this.curPage},computed:{headBoundaryIndex(){let t=-1;for(let e=this.curPage-1;e>=0;e--)if(this.showList[e].loading){t=e;break}return t},headBoundaryOffset(){return-(this.headBoundaryIndex+1)*this.pageHeight},headLoadingOffset(){return this.disabledRefresh?this.headBoundaryOffset:this.headBoundaryOffset+this.loadingHeight},tailBoundaryIndex(){let t=this.showList.length;for(let e=this.curPage+1;e<this.showList.length;e++)if(this.showList[e].loading){t=e;break}return t},tailBoundaryOffset(){return-(this.tailBoundaryIndex-1)*this.pageHeight},tailLoadingOffset(){return this.tailBoundaryOffset-this.loadingHeight},infinityIdx(){return this.onlyOne?[0]:this.keepFirstAlive&&this.curPage>1?[-this.curPage,-1,0,1]:[-1,0,1]},cannotScroll(){return this.onlyOne||this.disabledScroll||!this.list.length},direction(){return this.displacement<0?dt:ct},showList(){const t=t=>1/(2.5*t/this.pageHeight+1),e=this.list&&this.list.map(((e,i)=>(e.key||(e.key=ht(e)),this.fade&&(e.opacity=t(Math.abs(this.offset+i*this.pageHeight))),e)));return this.onlyOne?e.slice(0,1):e},containerPaddingTop(){return this.onlyOne?"0px":"".concat(this.curPage*this.pageHeight,"px")}},watch:{pageHeight(t,e){t!==e&&this.initPageHeight(t)},onlyOne(){this.containerStyle={transition:""},this.initPageHeight(this.pageHeight)},curPage(t){this.__actuallyPage=t,this.offset=-t*this.pageHeight},tailBoundaryOffset(t){this.loading===_t&&this.offset>t&&(this.loading=ut,this.scrolling||(this.showList[this.curPage+1]?this.scrollToPage({page:this.curPage+1}):this.scrollToPage({page:this.curPage})))},headBoundaryOffset(t){this.loading===pt&&this.offset<t&&(this.loading=ut,this.scrolling||(this.showList[this.curPage-1]?this.scrollToPage({page:this.curPage-1}):this.scrollToPage({page:this.curPage})))}},methods:{initPageHeight(t){this.offset=-this.curPage*t,this.startOffset=this.offset},onTouchStart(t){if(this.cannotScroll)return;this.__startTouchTimestamp=Date.now(),this.containerStyle={transition:""};const e=this.$refs.transitionGroup.$el.getBoundingClientRect().y;this.__startTouch=!0,this.startPoint=t.touches[0],this.startOffset=this.offset=e},onTouchMove(t){if(this.cannotScroll||!this.__startTouch)return;this.endPoint=t.touches[0];const e=this.endPoint.clientY-this.startPoint.clientY;Math.abs(e)<this.moveThreshold||(this.offset=this.offset+this.endPoint.clientY-this.startPoint.clientY,this.disabledRefresh&&this.offset>this.headBoundaryOffset?this.offset=-this.headBoundaryOffset:(this.offset>this.headBoundaryOffset?(this.offset=Math.min(this.headLoadingOffset,this.offset),this.loading=pt):this.offset<this.tailBoundaryOffset?(this.loading=_t,this.offset=Math.max(this.tailLoadingOffset,this.offset)):this.loading=ut,this.startPoint=this.endPoint,this.displacement=this.offset-this.startOffset))},onTouchEnd(){if(this.cannotScroll||this.offset===this.startOffset||!this.__startTouch)return;this.__startTouch=!1;if((Date.now()-this.__startTouchTimestamp<=250&&Math.abs(this.displacement)>this.offsetThreshold||Math.abs(this.displacement)>this.pageHeight/2)&&(this.direction===dt&&this.__actuallyPage-this.curPage<1?this.__actuallyPage++:this.direction===ct&&this.__actuallyPage-this.curPage>-1&&this.__actuallyPage--),this.displacement=0,this.loading){if(this.isEnd&&this.loading===_t)this.scrollToPage({page:this.curPage});else if(this.scrollToPage({page:this.__actuallyPage}),!this.showList[this.__actuallyPage]&&!this.__hasEmitLoading){const t=(t=this.__actuallyPage)=>{this.scrollToPage({page:t}),this.loading=ut,this.__hasEmitLoading=!1};this.$emit("load-data",{loadingStatus:this.loading,headBoundaryIndex:this.headBoundaryIndex,tailBoundaryIndex:this.tailBoundaryIndex},t),this.__hasEmitLoading=!0}}else this.scrollToPage({page:this.__actuallyPage}),this.__hasEmitLoading=!1},enter(t,e){const i=this.showList.find((e=>String(e.key)===t.getAttribute("data-key")));this.$emit("page-enter",i,t.getAttribute("data-key")),e()},beforeLeave(t){const e=this.showList.find((e=>String(e.key)===t.getAttribute("data-key")));this.$emit("page-before-destory",e,parseInt(t.getAttribute("infinity-idx"),10),t.getAttribute("data-key"))},scrollToPage({page:t,type:e=mt}){if(!this.disabledScroll)if(clearTimeout(this.scrollTimer),this.containerStyle={transition:"transform ".concat(this.transformDuration,"ms")},this.offset=-t*this.pageHeight,this.offset>this.headBoundaryOffset?(this.offset=Math.min(this.headLoadingOffset,this.offset),this.loading=pt):this.offset<this.tailBoundaryOffset?(this.loading=_t,this.offset=Math.max(this.tailLoadingOffset,this.offset)):this.loading=ut,this.startOffset=this.offset,this.loading){if(!this.__hasEmitLoading){const t=(t=this.__actuallyPage)=>{this.__hasEmitLoading=!1,this.loading=ut,this.scrollToPage({page:t,type:e})};this.$emit("load-data",{loadingStatus:this.loading,headBoundaryIndex:this.headBoundaryIndex,tailBoundaryIndex:this.tailBoundaryIndex},t),this.__hasEmitLoading=!0}}else this.__hasEmitLoading&&(this.__hasEmitLoading=!1,this.$emit("load-data-cancel")),this.__actuallyPage=t,this.scrolling=!0,this.$emit("start-scroll-page",{prePage:this.curPage,curPage:t,offsetPage:t-this.curPage,type:e}),this.scrollTimer=setTimeout((()=>{t===this.curPage||this.onlyOne||(this.$emit("change",t),this.$emit("finish-scroll-page",{prePage:this.curPage,curPage:t,offsetPage:t-this.curPage,type:e})),this.containerStyle={transition:""},this.scrolling=!1}),this.transformDuration)}}},(function(){var t=this,e=t._self._c;return t.list&&t.list.length?e("div",{staticClass:"infinity-list__wrapper",style:{height:t.pageHeight?"".concat(t.pageHeight,"px"):"auto",overflow:t.cannotScroll?"":"scroll"},on:{touchstart:t.onTouchStart,touchmove:t.onTouchMove,touchend:t.onTouchEnd}},[e("transition-group",{ref:"transitionGroup",class:t.containerClass,style:{...t.containerStyle,transform:t.offset?"translate3d(0, ".concat(t.offset,"px, 0)"):"",height:t.pageHeight?"".concat(t.pageHeight*this.showList.length,"px"):"auto",overflow:"visible"},attrs:{tag:"div",appear:"",name:"destory"},on:{enter:t.enter,"before-leave":t.beforeLeave}},t._l(t.infinityIdx,(function(i){return e("mp-infinity-list-item",{key:t.showList[t.curPage+i]&&t.showList[t.curPage+i].key||i,style:{opacity:t.showList[t.curPage+i]&&t.showList[t.curPage+i].opacity||1},attrs:{item:t.showList[t.curPage+i],index:t.curPage+i,"related-idx":i,"loading-status":t.loading,"page-height":t.pageHeight,"is-end":t.isEnd},scopedSlots:t._u([{key:"main",fn:function({item:e,index:i}){return[t._t("main",null,{item:e,index:i})]}},{key:"loading",fn:function(){return[t._t("loading")]},proxy:!0},{key:"end",fn:function(){return[t._t("end")]},proxy:!0}],null,!0)})})),1)],1):t._e()}),[],!1,null,null,null,null).exports,yt=window.Vue.extend({data:()=>({controller:null}),methods:{initContext(t){this.controller=t,"function"==typeof this.initPlugin&&this.initPlugin()},setBlockEvt(t){this.controller.setBlockPlugin(t,this)},setUnblockEvt(t){this.controller.setBlockPlugin(t,null)},recv(...t){const e=this[t[0]+"Handler"];if("function"==typeof e){const i=e.apply(this,t);return null==i?yt.CONTINUE:i}return yt.CONTINUE}}});function wt(t){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Tt(t,e,i){return e&&bt(t.prototype,e),i&&bt(t,i),t}function kt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ct(t,e){return(Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function It(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function xt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],s=!0,o=!1,a=void 0;try{for(var r,n=t[Symbol.iterator]();!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(l){o=!0,a=l}finally{try{s||null==n.return||n.return()}finally{if(o)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Et(t,e){return t(e={exports:{}},e.exports),e.exports}yt.TYPE_INNER=0,yt.TYPE_COVER=1,yt.TYPE_CONTROL=2,yt.TYPE_PROFILE=3,yt.CONTINUE=0,yt.BLOCK_ALL_LOGIC=1,yt.BLOCK_REST_PLUGINS=2,yt.BLOCK_INNER_LOGIC=4,yt.BLOCK_TRIGGER_OUT=8,"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i+=1){var s=arguments[i];if(null!=s)for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e},writable:!0,configurable:!0});var Ot,Rt,At=function(t){return null!=t},Mt={object:!0,function:!0,undefined:!0},Bt=function(t){if(!function(t){return!!At(t)&&hasOwnProperty.call(Mt,typeof t)}(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(e){return!1}},Dt=/^\s*class[\s{/}]/,Lt=Function.prototype.toString,Ft=function(t){return!!function(t){if("function"!=typeof t)return!1;if(!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length)return!1;if("function"!=typeof t.call)return!1;if("function"!=typeof t.apply)return!1}catch(e){return!1}return!Bt(t)}(t)&&!Dt.test(Lt.call(t))},Vt=function(t){return null!=t},Nt=Object.keys,Wt=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}()?Object.keys:function(t){return Nt(Vt(t)?Object(t):t)},jt=Math.max,Ut="function"==typeof(Rt=Object.assign)&&(Rt(Ot={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),Ot.foo+Ot.bar+Ot.trzy==="razdwatrzy")?Object.assign:function(t,e){var i,s,o,a=jt(arguments.length,2);for(t=Object(function(t){if(!Vt(t))throw new TypeError("Cannot use null or undefined");return t}(t)),o=function(s){try{t[s]=e[s]}catch(o){i||(i=o)}},s=1;s<a;++s)Wt(e=arguments[s]).forEach(o);if(void 0!==i)throw i;return t},Ht=Array.prototype.forEach,zt=Object.create,$t=function(t){var e=zt(null);return Ht.call(arguments,(function(t){Vt(t)&&function(t,e){var i;for(i in t)e[i]=t[i]}(Object(t),e)})),e},Jt="razdwatrzy",qt=String.prototype.indexOf,Qt="function"==typeof Jt.contains&&!0===Jt.contains("dwa")&&!1===Jt.contains("foo")?String.prototype.contains:function(t){return qt.call(this,t,arguments[1])>-1},Xt=Et((function(t){var e=t.exports=function(t,e){var i,s,o,a,r;return arguments.length<2||"string"!=typeof t?(a=e,e=t,t=null):a=arguments[2],At(t)?(i=Qt.call(t,"c"),s=Qt.call(t,"e"),o=Qt.call(t,"w")):(i=o=!0,s=!1),r={value:e,configurable:i,enumerable:s,writable:o},a?Ut($t(a),r):r};e.gs=function(t,e,i){var s,o,a,r;return"string"!=typeof t?(a=i,i=e,e=t,t=null):a=arguments[3],At(e)?Ft(e)?At(i)?Ft(i)||(a=i,i=void 0):i=void 0:(a=e,e=i=void 0):e=void 0,At(t)?(s=Qt.call(t,"c"),o=Qt.call(t,"e")):(s=!0,o=!1),r={get:e,set:i,configurable:s,enumerable:o},a?Ut($t(a),r):r}})),Gt=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t},Yt=Et((function(t,e){var i,s,o,a,r,n,l,h=Function.prototype.apply,d=Function.prototype.call,c=Object.create,u=Object.defineProperty,p=Object.defineProperties,_=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};s=function(t,e){var s,a;return Gt(e),a=this,i.call(this,t,s=function(){o.call(a,t,s),h.call(e,this,arguments)}),s.__eeOnceListener__=e,this},a=function(t){var e,i,s,o,a;if(_.call(this,"__ee__")&&(o=this.__ee__[t]))if("object"==typeof o){for(i=arguments.length,a=new Array(i-1),e=1;e<i;++e)a[e-1]=arguments[e];for(o=o.slice(),e=0;s=o[e];++e)h.call(s,this,a)}else switch(arguments.length){case 1:d.call(o,this);break;case 2:d.call(o,this,arguments[1]);break;case 3:d.call(o,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),e=1;e<i;++e)a[e-1]=arguments[e];h.call(o,this,a)}},r={on:i=function(t,e){var i;return Gt(e),_.call(this,"__ee__")?i=this.__ee__:(i=m.value=c(null),u(this,"__ee__",m),m.value=null),i[t]?"object"==typeof i[t]?i[t].push(e):i[t]=[i[t],e]:i[t]=e,this},once:s,off:o=function(t,e){var i,s,o,a;if(Gt(e),!_.call(this,"__ee__"))return this;if(!(i=this.__ee__)[t])return this;if("object"==typeof(s=i[t]))for(a=0;o=s[a];++a)o!==e&&o.__eeOnceListener__!==e||(2===s.length?i[t]=s[a?0:1]:s.splice(a,1));else s!==e&&s.__eeOnceListener__!==e||delete i[t];return this},emit:a},n={on:Xt(i),once:Xt(s),off:Xt(o),emit:Xt(a)},l=p({},n),t.exports=e=function(t){return null==t?c(l):p(Object(t),n)},e.methods=r}));function Kt(t,e,i){this.now=0,this.afternow=0,this.delta=0,this.fps=t||10,this.interval=parseInt(1e3/t,10),this.callback=e||"",this.timecount=0,this.running=!1,this.timemode=i||"auto",this.index=Date.now(),"timeout"!==this.timemode&&(this.timemode="auto"),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}Yt.methods,Kt.prototype={setCallBack:function(t){t&&(this.callback=t)},start:function(t){t&&(this.callback=t),this.running||(this.running=!0,this.afternow=Date.now(),this._timeupdate())},stop:function(){this.running&&(this.running=!1),window.requestAnimationFrame?window.cancelAnimationFrame(this.timecount):clearTimeout(this.timecount),this.timecount=0},isRunning:function(){return this.running},_timeupdate:function(){window.requestAnimationFrame&&"timeout"!==this.timemode?this._rafMode():this._timeoutMode()},_rafMode:function(){var t=this;this.timecount=requestAnimationFrame((function(){t._timeupdate()})),this.now=Date.now(),this.delta=this.now-this.afternow,this.delta>=this.interval&&this.callback&&(this.afternow=this.now-this.delta%this.interval,this.callback((this.delta/this.interval).toFixed(2)))},_timeoutMode:function(){this.timecount=setTimeout(this._timeupdate,this.interval),this.callback()}};var Zt=function(t,e,i){return new Kt(t,e,i)};var te=function(t){var e=[],i=0,s=[];return{get:function(){return e.length?e.shift():i<200?(i+=1,new t):null},save:function(t){t&&e.push(t)},getLength:function(){return e.length},getAll:function(){return s}}},ee={hasClass:function(t,e){return t&&t.className&&t.className.indexOf(e)>-1},addClass:function(t,e){if(!this.hasClass(t,e)&&t)if(t.className&&0!==t.className.length){var i=t.className.split(" ");i.push(e),t.className=i.join(" ")}else t.className=e},removeClass:function(t,e){if(this.hasClass(t,e)){var i=t.className.split(" "),s=i.indexOf(e);i.splice(s,1),t.className=i.join(" ")}},css:function(t,e,i){if(t&&e){if(void 0===i&&"string"==typeof e)return;if(void 0===i&&"object"===wt(e)){var s=e;for(var o in s)s.hasOwnProperty(o)&&(/width|height|left|right|top|bottom/.test(o)&&"number"==typeof s[o]&&(s[o]="".concat(s[o],"px")),t.style[o]=s[o])}else if("string"==typeof e&&("string"==typeof i||"number"==typeof i)){var a=i;/width|height|left|right|top|bottom/i.test(e)&&"number"==typeof i&&(a="".concat(i,"px")),t.style[e]=a}}}};function ie(t){return"string"!=typeof t?t:t.replace(/\?.+/g,"")}var se=function(t){var e=1,i=function t(i,s,o){var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.onload=function(){s()},a.onerror=function(){e>=3?o():(e+=1,a.parentNode.removeChild(a),t("".concat(ie(i),"?v=").concat(parseInt(1e10*Math.random())),s,o))},a.href=i,document.head.appendChild(a)};return new Promise((function(e,s){(function(){for(var e=document.querySelectorAll('link[rel="stylesheet"]'),i=function(t){var e=t,i=e.indexOf("?");i>0&&(e=e.slice(0,i));var s=e.lastIndexOf("/");return s>0&&(e=e.slice(s+1,e.length)),e},s=i(t),o=null,a=e.length,r=0;r<a;r+=1)if((o=e[r])&&o.href&&i(o.href)===s)return!0;return!1})()?e():i(t,e,s)}))},oe=function(){function t(){St(this,t),this.domlist=[],this.lastDom={}}return Tt(t,[{key:"handleDom",value:function(t){for(var e=this.domlist.length-1;e>=0;e-=1)t&&t(this.domlist[e])&&this.domlist.splice(e,1)}},{key:"checkLast",value:function(t){var e=this;Object.keys(this.lastDom).forEach((function(i){t(e.lastDom[i],i)}))}},{key:"push",value:function(t,e){this.domlist.push(t),this.lastDom[e]=t}}]),t}();var ae=function(){function t(e){St(this,t),this.list={scroll:{show:{},cache:{}}},this.enablePosition=!!e,this.enablePosition&&(this.list.top={show:{},cache:{}},this.list.bottom={show:{},cache:{}})}return Tt(t,[{key:"addList",value:function(t){if(s=t,"function"==typeof Array.isArray?Array.isArray(s):"[object Array]"===Object.prototype.toString.call(s))for(var e=0,i=t.length;e<i;e+=1)this.addBarrage(t[e]);else this.addBarrage(t);var s}},{key:"addBarrage",value:function(t){if("[object Object]"===Object.prototype.toString.call(t)&&(t.html||t.content)){var e=t.position||1;this.enablePosition||(e=1),this.add(t,e)}}},{key:"getList",value:function(t){var e;switch(t){case 1:default:e=this.list.scroll;break;case 5:e=this.list.top;break;case 6:e=this.list.bottom}return e}},{key:"add",value:function(t,e){var i,s=this.getList(e);i=t.mustShow?s.show:s.cache,t.index?(i[t.index]||(i[t.index]=[]),i[t.index].push(t)):(i.priority||(i.priority=[]),i.priority.push(t))}},{key:"get",value:function(t,e){var i=this.getList(e);return i.show.priority&&i.show.priority.length?i.show.priority.shift():i.show[t]&&i.show[t].length?i.show[t].shift():i.cache[t]&&i.cache[t].length?i.cache[t].shift():i.cache.priority&&i.cache.priority.length?i.cache.priority.shift():null}},{key:"reset",value:function(){this.list.scroll.show={},this.list.scroll.cache={},this.enablePosition&&(this.list.top.show={},this.list.top.cache={},this.list.bottom.show={},this.list.bottom.cache={})}},{key:"clear",value:function(){this.list.scroll.cache={},this.enablePosition&&(this.list.top.cache={},this.list.bottom.cache={})}}]),t}(),re={fps:60,speed:2,rate:1,top:!1,bottom:!1,star:!1,gift:!1,lineHeight:36,enableSetArea:!1,userNum:5,interval:30,cssUrl:"",fontSize:"xs",opacity:1,enableColor:!0,enablePosition:!1,enableEgg:!1,autoFont:!0,loop:!1,marginBottom:0,enableMouseEvent:!1};function ne(t,e){var i={xxs:15,xs:19,s:21,m:23,l:25,xl:27,xxl:31};return(t<=1024?{xxs:12,xs:14,s:16,m:18,l:20,xl:22,xxl:26}:t>1024&&t<=1240?{xxs:13,xs:17,s:19,m:21,l:23,xl:25,xxl:29}:t>1240&&t<=1600?i:t>1600&&t<=1920?{xxs:17,xs:21,s:23,m:25,l:27,xl:29,xxl:33}:t>1920?{xxs:25,xs:29,s:31,m:33,l:35,xl:37,xxl:41}:i)[e]}var le,he=function(){function t(e){St(this,t),Yt(this);var i,s,o={};Object.assign(o,re,e),o.cssUrl&&this._loadStyle(o.cssUrl),this._initDataset(o),this._write(o.wrapper),this._windowResize(),this.Timer=Zt(o.fps),this.Timer.setCallBack(this.Animation.bind(this)),this._clickHandler&&(i=this._clickHandler.bind(this)),this._menuHandler&&(s=this._menuHandler.bind(this)),this.Factory=function(t,e,i,s){var o=e||null,a=i||null,r=!!s,n=function(){function t(){St(this,t),this._left=0,this._top=0,this._bottom=0,this._dom=null,this._animate=null,this._trail=-1,this._width=0,this.el=null,this.elText=null,this.fontSize=0,this.height=0,this.enableColor=!0,this.currentColor="",this.id=null,this.originContent="",this.isSys=!1,this.count=0,this.isStar=!1}return Tt(t,[{key:"render",value:function(t,e,i){var s;this.el||(this.write(),this.addClickEvent()),t.html?(this.el.innerHTML=t.html,s=t.html.length||0):(this.el.innerText=t.content,s=t.content.length||0),t.contentLength||(t.contentLength=s),this._width=parseFloat(getComputedStyle(this.el).width),this.font(e,i),t.gradienColor?this.gradienColor(t.gradienColor):this.color(t.color||"#ffffff"),t.id?this.id=t.id:this.id=null,t.originContent?this.originContent=t.originContent:this.originContent="",this.isSys=!!t.isSys,this.isStar=!!t.isStar,this.count=0,this.isStar?ee.addClass(this.el,"txp_barrage_item_speaker"):ee.removeClass(this.el,"txp_barrage_item_speaker"),t.isself?ee.addClass(this.el,"txp_barrage_item_self"):ee.removeClass(this.el,"txp_barrage_item_self")}},{key:"font",value:function(t,e){t?this.fontSize!==+t&&(this.fontSize=t,this.height=Math.ceil(1.5*t),this.el.style.fontSize="".concat(t,"px"),this.el.style.lineHeight="".concat(this.height-6,"px"),this.el.style.height="".concat(this.height,"px")):e&&this.height!==+e&&(this.height=e,this.el.style.height="".concat(this.height,"px"),this.el.style.lineHeight="".concat(this.height,"px"),this.el.style.padding=0)}},{key:"color",value:function(t){t&&(this.disableColor(),ee.css(this.el,"color",t))}},{key:"gradienColor",value:function(t){t?t[1]!==t[0]?(ee.css(this.el,"color",t[1]),ee.css(this.el,"background-image","linear-gradient(to right,".concat(t[0]," 0,").concat(t[1]," 100%)")),ee.css(this.el,"-webkit-text-fill-color","transparent"),ee.css(this.el,"background-repeat","repeat"),ee.css(this.el,"-webkit-background-clip","text"),ee.css(this.el,"text-shadow","none")):this.color(t[1]):this.disableColor()}},{key:"disableColor",value:function(){ee.css(this.el,"background-image",""),ee.css(this.el,"-webkit-text-fill-color",""),ee.css(this.el,"background-repeat",""),ee.css(this.el,"-webkit-background-clip",""),ee.css(this.el,"text-shadow","")}},{key:"addClickEvent",value:function(){var t=this;o&&this.el.addEventListener("click",(function(){o(t)})),a&&this.el.addEventListener("contextmenu",(function(e){t.isSys||(e.stopPropagation(),e.preventDefault(),a({danmuItem:t,x:e.clientX,y:e.clientY}))}))}},{key:"left",get:function(){return this._left}},{key:"trail",get:function(){return this._trail},set:function(t){this._trail=t>0?t:-1}},{key:"width",get:function(){return this._width}}]),t}(),l=function(e){function i(){var t;return St(this,i),(t=It(this,Pt(i).call(this))).isHove=!1,t}return kt(i,e),Tt(i,[{key:"write",value:function(){var e=this,i=document.createElement("div");i.innerHTML='<txpdiv aria-hidden="true" class="txp_barrage_item">\n    <txpdiv class="txp_text"></txpdiv>\n</txpdiv>',this.el=i.firstChild,t.appendChild(this.el);var s=xt(this.el.getElementsByClassName("txp_text"),1)[0];this.elText=s,r&&(this.el.addEventListener("mouseenter",(function(){e.isSys||e.isStar||(ee.addClass(e.el,"txp_barrage_item_hover"),e.isHove=!0)})),this.el.addEventListener("mouseleave",(function(){e.isSys||e.isStar||(ee.removeClass(e.el,"txp_barrage_item_hover"),e.isHove=!1)})))}},{key:"move",value:function(t,e){t+this.width+50<0||t>window.innerWidth?this.el.setAttribute("aria-hidden",!0):this.el.removeAttribute("aria-hidden"),this.isStar&&t<3&&t>-10&&this.count<120?this.count+=1:(this._left=t,e>=0&&e!==this._top&&(this._top=e),this.el.style.transform="translate3D(".concat(this._left,"px, ").concat(this._top,"px, 1px)"),"number"!=typeof window.top.__fontScaleBackForAndroid__||1===window.top.__fontScaleBackForAndroid__||this.el.getAttribute("mp-original-font-size")||(this.el.style.transform+=" scale3d(".concat(window.top.__fontScaleBackForAndroid__,", ").concat(window.top.__fontScaleBackForAndroid__,", 1)")))}}]),i}(n),h=function(t){function e(){var t;return St(this,e),(t=It(this,Pt(e).call(this))).class="txp_animate",t.hide="txp_none",t.available=!0,t.isHover=!1,t.paused=!1,t}return kt(e,t),Tt(e,[{key:"pauseAnimate",value:function(t){t&&(this.paused=!0),ee.css(this.el,"opacity",1),ee.css(this.el,"animation-play-state","paused"),ee.css(this.el,"-webkit-animation-play-state","paused")}},{key:"resumeAnimate",value:function(t){t&&(this.paused=!1),ee.css(this.el,"opacity",""),ee.css(this.el,"animation-play-state","running"),ee.css(this.el,"-webkit-animation-play-state","running")}},{key:"removeAnimate",value:function(){var t=this;this.el&&(ee.removeClass(this.el,this.class),ee.addClass(this.el,this.hide)),setTimeout((function(){t.available=!0}),100)}},{key:"startAnimate",value:function(){this.available=!1,ee.addClass(this.el,this.class),ee.removeClass(this.el,this.hide)}},{key:"setBottom",value:function(t){t>=0&&t!==this._bottom&&(this._bottom=t),this.el.style.bottom="".concat(this._bottom,"px"),this.startAnimate()}},{key:"setTop",value:function(t){t>=0&&t!==this._top&&(this._top=t),this.el.style.top="".concat(this._top,"px"),this.startAnimate()}},{key:"addEvent",value:function(){var t=this;this.el.addEventListener("animationend",(function(){t.removeAnimate()})),this.el.addEventListener("mouseenter",(function(){ee.addClass(t.el,"txp_barrage_item_hover"),t.pauseAnimate(),t.isHover=!0})),this.el.addEventListener("mouseleave",(function(){ee.removeClass(t.el,"txp_barrage_item_hover"),t.paused||t.resumeAnimate(),t.isHover=!1}))}}]),e}(n),d=function(e){function i(){return St(this,i),It(this,Pt(i).apply(this,arguments))}return kt(i,e),Tt(i,[{key:"write",value:function(){var e=document.createElement("div");e.innerHTML='<txpdiv aria-hidden="true" class="txp_barrage_item_top">\n    <txpdiv class="txp_text"></txpdiv>\n</txpdiv>',this.el=e.firstChild,t.appendChild(this.el);var i=xt(this.el.getElementsByClassName("txp_text"),1)[0];this.elText=i,this.addEvent()}}]),i}(h),c=function(e){function i(){return St(this,i),It(this,Pt(i).apply(this,arguments))}return kt(i,e),Tt(i,[{key:"write",value:function(){var e=document.createElement("div");e.innerHTML='<txpdiv aria-hidden="true" class="txp_barrage_item_bottom">\n    <txpdiv class="txp_text"></txpdiv>\n</txpdiv>',this.el=e.firstChild,t.appendChild(this.el);var i=xt(this.el.getElementsByClassName("txp_text"),1)[0];this.elText=i,this.addEvent()}}]),i}(h);return{baseBarrage:n,scrollBarrage:l,TopBarrage:d,BottomBarrage:c}}(this.dataset.$container,i,s,this.dataset.enableMouseEvent),this.BarragePool=te(this.Factory.scrollBarrage),this.active=new oe,this.list=new ae(this.dataset.enablePosition)}return Tt(t,[{key:"_loadStyle",value:function(t){var e=this;se(t).then((function(){e.updateSize()}))}},{key:"_initDataset",value:function(t){this.dataset={currentBlock:0,index:0,interval:t.interval,width:"",height:"",speed:t.speed,rate:t.rate,realSpeed:{0:t.speed*t.rate*1.2,1:t.speed*t.rate*1},keyMap:{},lineHeight:t.lineHeight,state:3,timerState:3,fps:t.fps,count:0,fontSetting:t.fontSize,fontSize:t.autoFont?ne(window.innerWidth,t.fontSize):0,opacity:t.opacity,userNum:t.userNum,maxNum:0,actualNum:0,enableColor:t.enableColor,enableScroll:!0,enableTop:!0,enableBottom:!0,enableStar:!0,enablePosition:t.enablePosition,enableEgg:t.enableEgg,autoFont:t.autoFont,loop:t.loop,marginBottom:t.marginBottom,enableMouseEvent:t.enableMouseEvent}}},{key:"_write",value:function(t){var e=document.createElement("div");e.innerHTML='<txpdiv class="txp_barrage txp_barrage_external" style="position:absolute;top:0;left:0;width:100%;height:100%;overflow: hidden;">\n        <style type="text/css">\n            .txp_barrage{\n                top: 0px;\n                right:0px;\n                bottom: 0px;\n                left: 0px;\n                /* height: 50%;\n                width:50%; */\n                position: absolute;\n                margin: auto;\n            }\n            .txp_barrage .txp_barrage_avatar,.txp_barrage .txp_barrage_emoji{\n                height: 100%;\n                width:unset;\n            }\n            .txp_barrage .txp_barrage_avatar{\n                margin-right:unset; \n            }\n            .txp_barrage .txp_barrage_item .txp_text{\n                height: 100%;\n                background: inherit;\n                -webkit-text-fill-color: inherit;\n                padding: 0 10px;\n            }\n            .txp_barrage .txp_barrage_item_bubble{\n                border-radius:  9999px;\n            }\n            .txp_barrage_item_bubble_front{\n                display: inline-block;\n                position: relative;\n                height: 100%;\n                vertical-align: unset;\n            }\n            .txp_barrage_item_bubble_front .txp_barrage_vipicon{\n                right: 0;\n                bottom: 0;\n                top:unset;\n                left: unset;\n                height: 40%;\n            }\n            .txp_barrage .txp_svg_icon_like{\n                height: 60%;\n                width:unset;\n                vertical-align: unset;\n            }\n            .txp_barrage .txp_barrage_badge{\n                height: 100%;\n                background: unset;\n                -webkit-text-fill-color: white;\n                color: white;\n            }\n            .txp_barrage .txp_barrage_badge .txp_icon_text{\n                -webkit-text-fill-color: white;\n            }\n            .txp_barrage .txp_barrage_item_hover {\n                background: rgba(0,0,0,0.7) !important;\n                color:white !important;\n                border-radius: 99999px;\n                z-index: 1;\n                -webkit-text-fill-color:unset !important;\n            }\n            .txp_barrage .txp_barrage_item_speaker {\n                background-image: linear-gradient(to right,rgba(255,92,56,0.9) 0,rgba(253,177,41,0.9) 100%)!important;\n                color:white !important;\n                border-radius: 99999px;\n                z-index: 1;\n                -webkit-text-fill-color:unset !important;\n                text-shadow: unset !important;\n                stroke: unset !important;           \n\n            }\n            .txp_barrage .txp_barrage_item_speaker .txp_barrage_item_wrapper{\n                background: unset !important;\n            }\n            .txp_barrage .txp_barrage_itxp_barrage_item_speakertem_star .txp_text{\n                background: unset !important;\n            }\n\n            .txp_barrage .txp_barrage_item {\n                padding: 4px 20px 4px 10px; white-space: nowrap !important;         \n            }\n            .txp_barrage .txp_barrage_item_wrapper{\n                background: inherit;\n                -webkit-text-fill-color: inherit;\n            }\n            \n\n            .txp_barrage .txp_barrage_item_hover .txp_barrage_item_wrapper{\n                background: unset !important;\n            }\n            .txp_barrage .txp_barrage_item_hover .txp_text{\n                background: unset !important;\n            }\n            .txp_barrage .txp_barrage_badge{\n                background: inherit;\n                -webkit-text-fill-color: inherit;\n            }\n            .txp_barrage .txp_icon_text{\n                background: inherit;\n                -webkit-text-fill-color: inherit;\n            }\n            .txp_barrage .txp_barrage_item_self{\n                /* background: unset !important; */\n                border: 1px solid white;\n                border-radius: 99999px;\n    \n            }\n            .txp_barrage .like{\n                -webkit-text-fill-color: red;\n            }\n    </style>\n    <svg class="txp_svg_sprite" display="none" version="1.1" xmlns="http://www.w3.org/2000/svg">\n        <symbol id="txp_svg_icon_like" viewBox="0 0 20 20">\n            <path d="M18.4 8.5l-2 9.4c-0.2 0.6-0.2 1.1-0.6 1.3 -0.4 0.3-1 0.2-1.9 0.2 -2.9 0-10.4 0-10.4 0l0-12 2.1-5c0 0 0.6-2 1.7-2 1.4 0 1.2 2 1.2 2s0 1.3 0 3c0 0.7 0.2 1 1 1 6.5 0 6.9 0 6.9 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0 1.6-0.2 1.9 0.5C18.5 7.4 18.6 7.9 18.4 8.5zM1.5 19.5c-0.6 0-1-0.4-1-1v-10c0-0.6 0.4-1 1-1s1 0.4 1 1v10C2.5 19.1 2.1 19.5 1.5 19.5z"></path>\n        </symbol>\n    </svg>\n    \n</txpdiv>',this.dataset.$container=e.firstChild,this.dataset.$scroll=this.dataset.$container.querySelector(".txp_barrage_scroll_wrap"),t.appendChild(this.dataset.$container),this.updateSize(),this._setOpacity(this.dataset.opacity)}},{key:"_setOpacity",value:function(t){this.dataset.$container.style.opacity=t||1}},{key:"_start",value:function(t){this.dataset.timerState=1,this.updateSize(),this.Timer.start(t),this._handlePosition("top","resume"),this._handlePosition("bottom","resume")}},{key:"_pause",value:function(){this.dataset.timerState=2,this.Timer.stop(),this._handlePosition("top","pause"),this._handlePosition("bottom","pause")}},{key:"Animation",value:function(){this._defaultAnimation()}},{key:"_defaultAnimation",value:function(t){this.dataset.count>this.dataset.fps/2&&(this.dataset.count=0,this._create()),this._animate(t),this.dataset.count+=1}},{key:"_getAvailable",value:function(){var t=this,e=[],i=0;e.push({start:0,end:0}),this.active.checkLast((function(s,o){if(s.left+s.width+50>=t.dataset.width){var a=s.height,r=o*a,n=(o-1)*a;if(n===e[i].end)e[i].end=r;else if(n>e[i].end)e.push({start:n,end:r}),i+=1;else for(var l=0,h=e.length;l<h-1;l+=1)if(e[l].start>=r&&(0===l||e[l-1].end<=n)){e.splice(l,0,{start:n,end:r}),i+=1;break}}}));for(var s=this.dataset.actualNum,o=1,a=0,r=[];o<=s;){var n=(o-1)*this.dataset.lineHeight,l=o*this.dataset.lineHeight;e[a+1]?(n>=e[a].end&&l<=e[a+1].start&&r.push(o),l>e[a+1].end&&(a+=1)):n>=e[a].end&&r.push(o),o+=1}return r}},{key:"_create",value:function(){this.dataset.enablePosition?this._createPositionDanmu():this._createScroll()}},{key:"_createScroll",value:function(){if(this.dataset.enableScroll){var t=this._getAvailable();if(t.length)for(var e=0,i=t.length;e<i;e+=1){var s=t[e],o=this.list.get(this.dataset.index,1);if(this.dataset.loop&&this._addDanmu(o),!o)break;this._createScrollDanmu(o,s)}}}},{key:"_createScrollDanmu",value:function(t,e){this.emit("showDanmu",t);var i=this.BarragePool.get();i&&(this.dataset.enableColor&&!t.isStar||(t.color="#ffffff",t.gradienColor=[],t.gradienColor.push("#ffffff"),t.gradienColor.push("#ffffff")),i.render(t,this.dataset.fontSize,this.dataset.lineHeight),i.move(this.dataset.width,(e-1)*this.dataset.lineHeight),i.trail=e,this.active.push(i,e))}},{key:"_animate",value:function(){var t=this;this.active.handleDom((function(e){if(!e.isHove){var i=t.dataset.realSpeed[e.trail%2];e.isSys&&(i*=2);var s=e.left-i;if(e.move(s),s+e.width+50<0)return t.BarragePool.save(e),!0}return!1}))}},{key:"_toggleColor",value:function(t){t?this.dataset.enableColor=!0:(this.dataset.enableColor=!1,this.active.handleDom((function(t){return t.color("#ffffff"),!1})))}},{key:"_clear",value:function(){this._clearScroll(),this.dataset.enablePosition&&(this._handlePosition("top","clear"),this._handlePosition("bottom","clear"))}},{key:"_clearScroll",value:function(){this.active.handleDom((function(t){return t.move(-t.width-100),!1}))}},{key:"_addDanmu",value:function(t){this.list.addList(t)}},{key:"_windowResize",value:function(){var t=this,e=null;window.onresize=function(){1===t.dataset.state&&1===t.dataset.timerState&&t._pause(),e&&clearTimeout(e),e=setTimeout((function(){1===t.dataset.state&&t._start(),t.updateSize()}),300)}}},{key:"updateSize",value:function(){this.dataset.width=this.dataset.$container.clientWidth,this.dataset.height=this.dataset.$container.clientHeight,this.updateFont(),this.updateLineNum()}},{key:"updateLineNum",value:function(){this.dataset.maxNum=parseInt((this.dataset.height-this.dataset.marginBottom)/this.dataset.lineHeight,10),this.dataset.maxNum=this.dataset.maxNum>=0?this.dataset.maxNum:0,this.dataset.userNum>this.dataset.maxNum?this.dataset.actualNum=this.dataset.maxNum:this.dataset.actualNum=this.dataset.userNum,this.emit("lineUpdate",this.dataset.maxNum)}},{key:"updateFont",value:function(){this.dataset.autoFont&&(this.dataset.fontSize=ne(this.dataset.width,this.dataset.fontSetting),this.dataset.lineHeight=Math.ceil(1.5*this.dataset.fontSize))}},{key:"index",set:function(t){var e=t?parseInt(t,10):0;if(e!==this.dataset.index&&(this.dataset.index=e,1===this.dataset.state)){var i=Math.floor((e+1)/this.dataset.interval);i!==this.dataset.currentBlock&&(this.dataset.currentBlock=i,this.emit("blockChange",e))}},get:function(){return this.dataset.index}}]),t}();(le=he).prototype._createTopDanmu=function(){this.dataset.topList||(this.dataset.topList=[]);var t,e,i=this.dataset.topList;if(i.length<5)t=new this.Factory.TopBarrage,i.push(t),e=i.length;else for(var s=0,o=i.length;s<o;s+=1)if(i[s].available){t=i[s],e=s;break}if(t){var a=this.list.get(this.dataset.index,5);a&&(this.dataset.enableColor||(a.color="#ffffff",a.gradienColor=[],a.gradienColor.push("#ffffff"),a.gradienColor.push("#ffffff")),this.emit("showDanmu",a),t.render(a,this.dataset.fontSize,this.dataset.lineHeight),t.setTop(e*this.dataset.lineHeight))}},le.prototype._createBottomDanmu=function(){this.dataset.bottomList||(this.dataset.bottomList=[]);var t,e,i=this.dataset.bottomList;if(i.length<5)t=new this.Factory.BottomBarrage,i.push(t),e=i.length;else for(var s=0,o=i.length;s<o;s+=1)if(i[s].available){t=i[s],e=s;break}if(t){var a=this.list.get(this.dataset.index,6);a&&(this.emit("showDanmu",a),this.dataset.enableColor||(a.color="#ffffff",a.gradienColor=[],a.gradienColor.push("#ffffff"),a.gradienColor.push("#ffffff")),t.render(a,this.dataset.fontSize,this.dataset.lineHeight),t.setBottom(e*this.dataset.lineHeight+this.dataset.marginBottom))}},le.prototype._handlePosition=function(t,e){var i,s={clear:"removeAnimate",pause:"pauseAnimate",resume:"resumeAnimate"}[e]||"";switch(t){case"top":i=this.dataset.topList;break;case"bottom":i=this.dataset.bottomList}if(i&&s)for(var o=0,a=i.length;o<a;o+=1)i[o][s]&&i[o][s](!0)},le.prototype._createTop=function(){this.dataset.enableTop&&this._createTopDanmu()},le.prototype._createBottom=function(){this.dataset.enableBottom&&this._createBottomDanmu()},le.prototype._createPositionDanmu=function(){this._createScroll(),this._createTop(),this._createBottom()},function(t){t.prototype.start=function(t){this.dataset.state=1,this._start(t)},t.prototype.pause=function(){this.dataset.state=2,this._pause()},t.prototype.setFont=function(t){["xxs","xs","s","m","l","xl","xxl"].indexOf(t)>-1&&(this.dataset.fontSetting=t),this.updateFont(),this.updateLineNum()},t.prototype.setRate=function(t){this.dataset.rate!==t&&(this.dataset.rate=t,this.dataset.realSpeed={0:this.dataset.speed*this.dataset.rate*1.2,1:this.dataset.speed*this.dataset.rate})},t.prototype.setOpacity=function(t){this._setOpacity(t)},t.prototype.setLine=function(t){this.dataset.userNum=t,this.updateLineNum()},t.prototype.enableColor=function(){this._toggleColor(!0)},t.prototype.disableColor=function(){this._toggleColor(!1)},t.prototype.hideScroll=function(){this._clearScroll(),this.dataset.enableScroll=!1},t.prototype.showScroll=function(){this.dataset.enableScroll=!0},t.prototype.hideTop=function(){this._handlePosition("top","clear"),this.dataset.enableTop=!1},t.prototype.showTop=function(){this.dataset.enableTop=!0},t.prototype.hideBottom=function(){this._handlePosition("bottom","clear"),this.dataset.enableBottom=!1},t.prototype.showBottom=function(){this.dataset.enableBotton=!0},t.prototype.switchOn=function(){this.start()},t.prototype.play=t.prototype.switchOn,t.prototype.switchOff=function(){this.pause(),this._clear()},t.prototype.end=t.prototype.switchOff,t.prototype.updateTime=function(t){this.index=t},t.prototype.add=function(t){t&&this._addDanmu(JSON.parse(JSON.stringify(t)))}}(he);const de=window.weEmoji.EmojiData,ce={default:"无法发弹幕",1:"关注可发",2:"关注7天可发"},ue={default:"无法发弹幕",1:"关注后可发弹幕",2:"关注7天后可发弹幕"},pe=yt.extend({name:"danmu-plugin",data:()=>({step:1/0,buffer:"",inputTime:0,switchOn:!1,requestCnt:0,text:""}),computed:{...i({bizUin:t=>t.cgiData.biz||0,msgId:t=>t.cgiData.mid||0,idx:t=>t.cgiData.idx||0}),...i("mp-video-player",["fullscreenStatus","seekingStatus","orientationStatus"]),...i("mp-video-player/danmu-plugin",["inputStatus","danmuInfo"]),vid(){return this.controller.opt.vid},playerWidth(){return this.controller&&this.controller.getPlayer()&&this.controller.getPlayer().width},fullscreenType(){return this.fullscreenStatus?0===this.orientationStatus?2:3:1},inputPlaceholder(){if(!this.fullscreenStatus){const t=this.controller&&this.playerWidth,e=this.controller&&this.controller.getPlayer().duration;if(e&&e>=3600)return"弹幕";if(t<347)return"弹幕"}return this.danmuInfo&&!this.danmuInfo.isAllowPost?ce[this.danmuInfo.reasonId]||ce.default:2===this.inputStatus?"正在输入...":"发送弹幕"},inputBarConfig(){return{maxLength:30,text:this.text,useH5:A.isAndroid,isFullscreen:this.fullscreenStatus,isLandscape:1===this.orientationStatus,danmuSwitchOn:this.switchOn,submit:t=>{this.submitDanmu(t.replace(/\n/g," ")),this.text=""},cancel:t=>{this.text=t},input:t=>{this.setInputStatus({value:t?2:1})},show:()=>{this.fullscreenStatus&&this.controller.getPlayer().preventOperating(2),this.controller.getPlayer().showControlBar(),this.setInputStatus({value:1})},hide:()=>{this.controller.getPlayer().hideControlBarAfterTimeout(),this.controller.getPlayer().resumeOperating(),this.setInputStatus({value:0})},danmuSwitchFun:()=>{this.onSwitchClick()}}},display(){if(!this.fullscreenStatus){const t=this.controller&&this.playerWidth,e=this.controller&&this.controller.getPlayer().duration;if(e&&e>=3600){if(t<378)return!1}else if(t<312)return!1}return!0},isPortrait(){return this.fullscreenStatus&&1!==this.orientationStatus}},mounted(){this.LS=new w("video_danmu_plugin")},beforeDestroy(){this.controller&&this.controller.__danmuUtil&&(this.controller.__danmuUtil.switchOff(),this.controller.__danmuUtil.list.reset())},methods:{...o("mp-video-player",["setEnter23439ReportExData"]),...o("mp-video-player/danmu-plugin",["setInputStatus","setDanmuInfo"]),initPlugin(){const t=setTimeout((()=>{b.setSum(221764,4,1);const t="__biz:".concat(this.bizUin," || vid:").concat(this.vid," || netType:").concat(k.getQuery("nettype")," || version:").concat(A.getInner()," || platform:").concat(A.getPlatform());window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:GetInfoTimeout",t,{mid:"mmbizwap:danmu_api",view:"wap_business"})}),5e3);D({type:"GET",dataType:"json",scope:"mmbiz_video",url:k.join("/mp/danmu?action=get_danmu_info",{__biz:this.bizUin,vid:this.vid}),success:t=>{if(t&&t.base_resp&&1*t.base_resp.ret==0){const e=-1!==[9,70,10002].indexOf(1*window.appmsg_type)&&!!t.is_allow_danmu;if(this.setDanmuInfo({isAllow:e,isAllowPost:!!t.is_allow_post_danmu,unitId:t.unit_id,reasonId:t.reason_id}),console.log("[Danmu Plugin Get Info]",this.danmuInfo,t),this.danmuInfo&&(this.controller.triggerEvent("getDanmuInfo",this.danmuInfo),this.setEnter23439ReportExData({UserDanMuFlag:this.danmuInfo.isAllow?this.danmuInfo.isAllowPost?1:this.danmuInfo.reasonId+1:4})),!this.danmuInfo||!this.danmuInfo.isAllow)return;this.init(),b.setSum(221764,1,1)}else console.error("[Danmu Plugin Get Info Ret != 0]",t),b.setSum(221764,2,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:GetInfoRet!=0",JSON.stringify(t),{mid:"mmbizwap:danmu_api",view:"wap_business"})},error:(t,e)=>{console.error("[Danmu Plugin Get Info Error]",e),b.setSum(221764,3,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:GetInfoError",JSON.stringify(e),{mid:"mmbizwap:danmu_api",view:"wap_business"})},complete:()=>{clearTimeout(t),this.controller.triggerEvent("danmuPluginInited")}})},init(){this.controller.__danmuUtil||($(this.controller.$el).find(".js_page_video").append('<div aria-live="assertive" aria-atomic="false" aira-relevant="removals" class="js_video_danmu danmu_full"></div>'),this.controller.__danmuUtil=new he({wrapper:$(this.controller.$el).find(".js_video_danmu")[0],fontSize:this.fullscreenStatus?"s":"xs",userNum:this.fullscreenStatus?6:3,rate:(this.fullscreenStatus,.6)})),this.switchOn="number"!=typeof this.LS.get("switch")||1===this.LS.get("switch"),this.triggerDanmuSwitch(!0)},triggerDanmuSwitch(t){t||(this.switchOn=!this.switchOn,this.LS.set("switch",this.switchOn?1:2,Date.now()+31536e7),b.setSum(221764,this.switchOn?14:15,1),weui.toast(this.switchOn?"已显示弹幕":"已隐藏弹幕",750),D({type:"POST",url:"/mp/danmu?action=report_switch",dataType:"json",scope:"mmbiz_video",data:{__biz:this.bizUin,unit_id:this.danmuInfo.unitId,vid:this.vid,time_point:this.getCurTime(),video_duration:this.controller.getPlayer().duration,appmsgid:this.msgId,idx:this.idx,switch_option:this.switchOn?1:0,enterid:window.enterid||0,fullscreen_type:this.fullscreenType,item_show_type:k.getQuery("item_show_type")||window.item_show_type||window.cgiData.item_show_type}})),this.switchOn?(this.step=this.getCurTime(),this.controller.__danmuUtil.switchOn(),this.controller.getPlayer()&&this.controller.getPlayer().isPause()&&this.controller.__danmuUtil.pause()):(this.step=1/0,this.controller.__danmuUtil.switchOff(),this.controller.__danmuUtil.list.reset()),this.setEnter23439ReportExData({isDanShow:this.switchOn?1:2})},statusChangeHandler(t,e){this.switchOn&&("loading"===e.status&&"seeked"===e.subStatus?(this.step=this.parseTime(e.currentTime),this.controller.__danmuUtil._clear(),this.controller.__danmuUtil.list.reset()):"play"===e.status?this.controller.__danmuUtil.switchOn():"pause"===e.status?this.controller.__danmuUtil.pause():"end"===e.status&&(this.controller.__danmuUtil.switchOff(),this.controller.__danmuUtil.list.reset(),this.step=0))},timeupdateHandler(t,e){if(this.switchOn&&!this.seekingStatus){const t=parseInt(e.currentTime,10);this.controller.__danmuUtil.updateTime(t),t>this.step-2&&(this.requestDanmu(),this.step=this.getCurTime(5))}},fullscreenchangeHandler(t,e){a.hide(),this.controller&&(this.controller.__danmuUtil&&(this.controller.__danmuUtil.setFont(e.state?"s":"xs"),this.controller.__danmuUtil.setLine(e.state?6:3),this.controller.__danmuUtil.setRate((e.state,.6))),A.isAndroid&&$(this.controller.$el).find(".js_video_danmu .txp_barrage_external").css("top",e.state?this.controller.getPlayer().getSafeAreaInsets().top+16+"px":"0px"))},onInputClick(){this.danmuInfo.isAllowPost?window.is_temp_url?M.invoke("confirmDialog",{title:"预览状态下无法操作",contentDesc:"",confirmText:"确定"}):(this.inputTime=this.getCurTime(),a.show(this.inputBarConfig)):this.controller.getPlayer().showToast(ue[this.danmuInfo.reasonId]||ue.default,2e3)},onSwitchClick(){this.controller.getPlayer().hideControlBarAfterTimeout(),this.triggerDanmuSwitch()},submitDanmu(t){if(!t||!this.switchOn)return;this.controller.__danmuUtil.add({html:'<div class="danmu_self">'.concat(this.decodeEmoji(t.html(!0)),"</div>"),contentLength:t.length,mustShow:!0});const e=setTimeout((()=>b.setSum(221764,12,1)),5e3);D({type:"POST",url:"/mp/danmu?action=post_danmu",dataType:"json",scope:"mmbiz_video",data:{__biz:this.bizUin,unit_id:this.danmuInfo.unitId,content:t,vid:this.vid,time_point:this.inputTime,video_duration:this.controller.getPlayer().duration,appmsgid:this.msgId,idx:this.idx,enterid:window.enterid||0,fullscreen_type:this.fullscreenType,item_show_type:k.getQuery("item_show_type")||window.item_show_type||window.cgiData.item_show_type},success:t=>{if(t&&t.base_resp){switch(1*t.base_resp.ret){case 0:return this.controller.getPlayer().showSubscribeBtn(),void b.setSum(221764,9,1);case 2:b.setSum(221764,13,1)}}console.error("[Danmu Plugin Submit Ret != 0]",t),b.setSum(221764,10,1)},error:(t,e)=>{console.error("[Danmu Plugin Submit Error]",e),b.setSum(221764,11,1)},complete:()=>clearTimeout(e)})},requestDanmu(){if(!this.switchOn)return;const t=this.step,e=Math.floor(1e8*Math.random()),i=Date.now(),s=setTimeout((()=>{b.setSum(221764,8,1);const s={__biz:this.bizUin,unit_id:this.danmuInfo.unitId,vid:this.vid,buffer:this.buffer,step:t,request_id:e},o="req:".concat(JSON.stringify(s)," || reqStart: ").concat(i," || netType:").concat(k.getQuery("nettype")," || version:").concat(A.getInner()," || platform:").concat(A.getPlatform());window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:PullTimeout",o,{mid:"mmbizwap:danmu_api",view:"wap_business"})}),3e3),o=++this.requestCnt,a=[];D({type:"GET",dataType:"json",scope:"mmbiz_video",url:k.join("/mp/danmu?action=pull_danmu",{__biz:this.bizUin,unit_id:this.danmuInfo.unitId,vid:this.vid,buffer:this.buffer,step:t,request_id:e}),success:t=>{if(clearTimeout(s),o!==this.requestCnt)return console.warn("[Danmu Plugin Abort Pull Resp]",o,this.requestCnt,t),void b.setSum(221764,16,1);if(console.log("[Danmu Plugin Pull Resp]",t),t&&t.base_resp&&1*t.base_resp.ret==0){let i;try{i=JSON.parse(t.json)}catch(e){i={}}this.step=i.next_step||this.step,this.buffer=i.buffer||this.buffer;const s=i.list||[];if(s.length){const t=this.getCurTime(1);for(let e=0;e<s.length;e++){const i=s[e],o={html:this.decodeEmoji(i.content),index:Math.max(i.time_point,t),contentLength:i.content.length,mustShow:!!i.is_self};o&&a.push(o)}a.length&&(this.controller.__danmuUtil.list.reset(),this.controller.__danmuUtil.add(a))}b.setSum(221764,5,1)}else console.error("[Danmu Plugin Pull Ret != 0]",t),b.setSum(221764,6,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:PullRet!=0",JSON.stringify(t),{mid:"mmbizwap:danmu_api",view:"wap_business"})},error:(t,e)=>{console.error("[Danmu Plugin Pull Error]",e),clearTimeout(s),b.setSum(221764,7,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("Danmu:PullError",JSON.stringify(e),{mid:"mmbizwap:danmu_api",view:"wap_business"})},received:()=>clearTimeout(s),complete:()=>clearTimeout(s)})},decodeEmoji(t){if(!/\[[^\[\]]+\]/.test(t))return t;for(let e=0,i=de.length;e<i;e++){const i=de[e],s='<img src="https://res.wx.qq.com/mmbizappmsg/zh_CN/images/pic/pic_blank.gif" class="icon_emotion_single we-emoji #name#" alt="" />'.replace("#name#",i.style);if(i.cn){const e=new RegExp("\\["+i.cn.replace(/\[|\]/g,"")+"\\]","g");t=t.replace(e,s)}if(i.hk){const e=new RegExp("\\["+i.hk.replace(/\[|\]/g,"")+"\\]","g");t=t.replace(e,s)}if(i.us){const e=new RegExp("\\["+i.us.replace(/\[|\]/g,"")+"\\]","g");t=t.replace(e,s)}}return t},getCurTime(t=0){const e=this.controller&&this.controller.getPlayer()&&this.controller.getPlayer().$refs.video;return this.parseTime((e&&1*e.currentTime||0)+t)},parseTime:t=>parseInt(1*t||0,10)}});pe.type=yt.TYPE_CONTROL;const _e=R(pe,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{directives:[{name:"show",rawName:"v-show",value:t.danmuInfo&&t.danmuInfo.isAllow&&t.display,expression:"danmuInfo && danmuInfo.isAllow && display"}],class:["play_bullet-input__container",t.isPortrait?"":"text-size-none","js_danmu_invoke_input_container","close",t.switchOn?"active":"unactive"]},[t.isPortrait?t._e():e("div",{staticClass:"play_bullet-input_mode js_danmu_invoke_input",attrs:{"aria-hidden":"true"},on:{click:t.onInputClick}},[e("div",{staticClass:"play_bullet-input__wrapper"},[e("div",{staticClass:"play_bullet-input"},[t._v(t._s(t.inputPlaceholder))])])]),t.isPortrait?e("div",{staticClass:"play_bullet-screen-full_mode js_danmu_switch",on:{click:t.onInputClick}},[e("span",{staticClass:"play_bullet-full-screen",attrs:{role:"button"}})]):t._e(),t.isPortrait?t._e():e("div",{staticClass:"play_bullet-screen_mode js_danmu_switch",on:{click:t.onSwitchClick}},[e("span",{class:["play_bullet-screen",t.switchOn?"active":""],attrs:{role:"button","aria-label":"弹幕","aria-pressed":t.switchOn?"true":"false"}})]),t.isPortrait?t._e():e("div",{staticClass:"play_bullet-input_background"})])}),[],!1,null,null,null,null).exports,me=function(){this.player=null};me.prototype.setPlayer=function(t){this.player=t},me.prototype.setBlockEvt=function(t){this.player.setBlockPlugin(t,this)},me.prototype.setUnblockEvt=function(t){this.player.setBlockPlugin(t,null)},me.prototype.recv=function(...t){const e=this[t[0]+"Handler"];if("function"==typeof e){const i=e.apply(this,t);return null==i?0:i}return 0};const ge=me,fe=function(t,e){const i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.uber=e.prototype},ve=0;let ye;try{ye=window.parent.window.location.href.indexOf("&vconsole=1")>0}catch(hi){ye=window.location.href.indexOf("&vconsole=1")>0}function we(){this._g={reportData:{},uid:+new Date,random:Math.random(),_debug:ye}}fe(we,ge),we.prototype.destroy=function(){this.setUnblockEvt("initMonitor")},we.prototype.init=function(){this.setBlockEvt("initMonitor")},we.prototype.getuid=function(){return++this._g.uid},we.prototype.initDataByUid=function(t,e){const i=this._g.reportData;!e&&i[t]&&i[t].radio&&(e=i[t].radio),this._g.reportData[t]={data:{},radio:e||1}},we.prototype.initMonitorHandler=function(t,e,i){const s=this.getuid()+"_"+e;return this.initDataByUid(s,i),{data:s,code:7}},we.prototype.minusMonitorHandler=function(t,e,i){let s=this._g.reportData[e];if(!s||!i)return ve;s=s.data;for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]||(s[o]={key:o,value:0}),s[o].value=Math.max(0,s[o].value-i[o]||1));return ve},we.prototype.setMonitorHandler=function(t,e,i){let s=this._g.reportData[e];if(!s||!i)return ve;s=s.data;for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]||(s[o]={key:o,value:0}),s[o].value=i[o]||1);return ve},we.prototype.plusMonitorHandler=function(t,e,i){let s=this._g.reportData[e];if(!s||!i)return ve;s=s.data;for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]||(s[o]={key:o,value:0}),s[o].value=s[o].value+i[o]||1);return ve},we.prototype.clearMonitorHandler=function(t,e){return this.initDataByUid(e),ve},we.prototype.sendMonitorHandler=function(t,e){if(!e||-1===e.indexOf("_"))return ve;let i=this._g.reportData[e];if(!i)return ve;if(this._g.random>i.radio&&!this._g._debug)return ve;i=i.data;const s=(e+"").split("_")[1];for(const o in i){if(!Object.prototype.hasOwnProperty.call(i,o))continue;const t=i[o];t.value&&b.setSum(s,t.key,t.value)}return T.log("[Video] "+JSON.stringify(i)),this.initDataByUid(e),ve};const Se={install(t){t.directive("expose",{bind(t,e){let i=null,s=.8;"function"==typeof e.value?i=e.value:"object"==typeof e.value&&(i=e.value.callback,s=e.value.threshold),t.$exposeObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&e.intersectionRatio>s&&(i(),t.$exposeObserver.disconnect())}))}),{threshold:s}),t.$exposeObserver.observe(t)},unbind(t){t.$exposeObserver.disconnect()}})}};const be=R({name:"mp-toast",props:{message:{type:String,default:""}},data(){return{content:this.message,status:0,timeout:null}},methods:{open(t=null,e=3e3){null!==t&&(this.content=t),this.status=1,null!==e&&(this.timeout=setTimeout((()=>{this.status=0}),e))},hide(){this.status=0,clearTimeout(this.timeout)}}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"js-toast weui-toast weui-toast_text",style:{display:0===t.status?"none":""}},[t._t("default",(function(){return[e("p",{staticClass:"weui-toast__content"},[t._v(t._s(t.content))])]}))],2)}),[],!1,null,null,null,null).exports,Te=new w("player"),ke=t=>{const e="VIDEO_NOTICE_"+t,i=Te.get(e);let s;s=(new Date).getHours()<4?(new Date).setHours(0,0,0,0)+144e5:(new Date).setHours(0,0,0,0)+1008e5;let o=1;i&&i.noticeTime&&(o=i.noticeTime+1),Te.set(e,{noticeTime:o},s)},Pe={storeNoticeInfo:ke,isMobileNetwork:t=>!!t&&["2g","3g","4g","2g/3g"].indexOf(t)>-1,isVideoNeedFlowNotice:(t,e)=>{const i="VIDEO_NOTICE_"+e,s=Te.get(i);if(!s)return ke(e),!0;if(s&&5===e){const e=s.noticeTime;if(1===e&&t>=200||2===e&&t>=300)return ke(t),!0}return!1},isObjectValueEqual:(t,e)=>{const i=Object.getOwnPropertyNames(t),s=Object.getOwnPropertyNames(e);if(i.length!==s.length)return!1;for(let o=0;o<i.length;o++){const s=i[o];if(t[s]!==e[s])return!1}return!0},isNoneNetwork:t=>"no"===t||"none"===t},Ce=window.Vue;Ce.use(r),Ce.use(Se);const Ie={timeupdateCacheCount:3,loadingTimeout:18e4,outerWidth:window.orientation?window.outerHeight:window.outerWidth,screenWidth:window.orientation?window.screen.height:window.screen.width,screenLength:window.orientation?window.screen.width:window.screen.height,swipeBackSupport:B.os.iphone&&A.isWechat&&!A.isInMiniProgram&&A.gtVersion("8.0.20"),wcSlPlayerSupport:!1,allPlayersOfPage:{},statusDefine:{init:1,play:1,pause:1,loading:1,end:1,error:1},subStatusDefine:{init:1,play:1,playing:1,waiting:1,stalled:1,seeking:1,seeked:1,preload:1,resolutionchange:1},nettypeMap:{"network_type:fail":"fail","network_type:edge":"2g/3g","network_type:wwan":"2g/3g","network_type:wifi":"wifi"},cellType:["2g","3g","4g","2g/3g"],supportSubscribe:(B.os.iphone||B.os.ipad)&&A.isWechat&&A.gtVersion("7.0.15",1)||B.os.android&&A.isWechat&&A.gtVersion("7.0.17",1),showFullscreenMenu:(B.os.iphone||B.os.ipad)&&A.isWechat&&A.gtVersion("7.0.16",1)||B.os.android&&A.isWechat&&A.gtVersion("7.0.18",1),supportZaikanAutho:(B.os.iphone||B.os.ipad)&&A.isWechat&&A.gtVersion("8.0.18",1)||B.os.android&&A.isWechat&&A.gtVersion("8.0.19",1),menuPlaybackRateIcon:{light:"iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAAEi6oPRAAAAAXNSR0IArs4c6QAABvRJREFUeAHtW2moVVUYvS/TrLQyyXjC64FmiFaUQkilkiEU/YgGJAMpaIKkyDKQikKCEIoICaFCkoKiSQiEArGoDCqsQGmwJCp7zVY2+rRprdv+7lt3n2mf4T0x9wfL/e1v3Gfd+849Z59jq9W0zAgp+A+CCBV/3hWgzjuRNcky1ZHQD7UojHT2OJyN8RinYzgw5My8Zf7tnDxKpSGRs8YLSA32q7SDjMyLUGEAIJkWaMTCdHCIHXja0eb5EvFtap11HEbOV7u5+kY731POlxg0WJ1jXaLaTD/E+frMwFELfeXN1feh52NulzB4W5dlaELfzqFp1P5fDJyYczjH5fgSLn5PiPUJT6tlX8DNKb6OiV9xE56ltgAs2GtGN9L3KEDfdGdLHRigsgcTs3FFKj9iYj61t/UsB+15vr+skh6a2XTkIf2uBtHp2wV0NeqauOAbXRDP+L4sgoE5s3yHFmInzje6IJ8j+t51vs5gvzVmsIIs5kuer6WFGJhWgAXzfH7DOI8MRAZGiAH+YRI8WY0q0dN+HP5AzhEl8hKhWWfZ+Yj8E7AFLklkphumwfyb5C1PDwu32gL8jDelyQ7fibkx5Ls2SN630LMI8PM686wFdQKgLAQsjuMCIGtBcHXkNGiad1nHk6NYQk5IwvUJLFXy3pa87YmqzlC28MtSlLmh8iQCrddu6LyJaEvZz3QqsqwQx6cB/pRmHiF8FF7r8XrFcj+GzjziaGAfkCqWoM7HMDH7L9APU6fT075D90keG/LOv1CyGNI/+S9QxY5mPPTBnKr6Jz9B8viR/JSTl+l6Hx4u5tjMiHQHr6TJYn+6O1ojA5GByEBkIDJw8DJwc8VDr5pX2M6ue5YWRnYHWN7KbnP9mRW2cUpgSYu3cXZgXmEYCz4EbAKs+AB0XqDlCWNfAZ4ALI/XymOAWmILYhFeqvKS1Rqsg54ltiD6eRX6NWB5L9BYVXRBVmMOFCvO8UJzyEg7GVKZhonmXavOUJ0F+JGlySoYrQEv2nnNbJK2IPMtg2J5HE8wR8jIhKwFWf57UKzBVmfk3GfI4m2k3/I+N2PRGLIg1pgI6J1JyIKYdzigdyaP0KiSdRukMWk6t2u493ppmjPHxu2aI4G5LuZqjDyY+W6eGEIZ0sQ7MAllSPOucXnM3asO1css6FQpWGZBfV5e7h5SyIL4Uf0gRZ91etGXGmEtfpnZg9gMFErRgp5HBSv4PXTb9qMtb0EPSx6fewRv+2Ut6AopyJiZgErWgs5HEH2GeZoUojNRz0OTMecTfiu4IqMI/crQUZjzi2p5D2TkFZp1Qboz9kZBpi5Id8Y+KsgrdLPwl4Ad2R7o4wqz/ovnucnyyOrxAXmFIVaQ47mF0UMBmnf5kLm+xsIPVijDvGcq5MWUyEBkIDIQGYgMRAYiA5GByEBkIDIQGTgAGNiBNfLGj3uIvGks+1IBUkrJBkTbnS9vNvtLZe+HYFusP27DWsrc7ocu3d5j8fvtRIHFoUVGMk4Xyo0Zfzeafm7S3AOEbNQgLFeUIG7o6C62rYVvHq0FGtngyV1NgNMWxVH39i7GXLfUNI7ba2cE1E4LUYJ0T/AsBG8BtI/p3Ja7IK3YSNhsERyVIO09GZPHAd0MtTw+X1sBpL0WBnNCsgjSQG6g3gsMAtbHxr2w3Q8EvU6GuNpijTlmEaRNejC5EtB9Uq2xEb6ZQJaEEOTnngfDB4D2MZ1v+c/zE5qcWyOOIQT5vafCoA8ftB4fRFwPjJKkKgRJevvtSK6T5yntRZ0PMFYCwQ8xEFso2qQKQdqAj4xuAPSxkdZ/Dj4+fzebnoNgriSLkPUZYDV1fA32WZWqSpIWrEuQlG2rp+DflwDtoXoTBGlPPiTUF4C11274bgFGa0KIrkWaJkj7j8XkduBXwHo2TZD243NuPmv+RvpZ359h6wWCxJI4DhdBl6D2p4D2oj5cBM1F7XdS+rHndmABECy66KYImojua4C0i07t1xRBfG3iLoAnaa1PnSfztcAkoJJowToELUR3fVlF626F7xy3urq/YnaQp0N5FdA+pvMdgcUWWHe0ohzLEDQe8auAQUBrUN8HrAYmAL5UJYgn12UAX+/3+3HO/0TRDzQu2qyIoDno/hagOaZzVyDthTB/wWUIOgnJevdvvTh+B1wH8GQ8rKJNfYJ4+3AboL88Fs/bjnVAL1BG8gjiwV4FpP3ysO+LwHRgRMUOmCMJOhnYBKjd9AHYlwA9QFXxCepDobxrl1vhH1O1WRN5dvBZ43o0mdJEI1dDCUrr+TriZjfYr3Ypf5G7UHEpoPdPtZtIAZ8gvkh4N9Do/ZP0q63y+mA5MKN2pbACJOImgPs/USIDkYHIQGQgMhAZiAxEBvYzA/8CNRG0E/V3Z7sAAAAASUVORK5CYII=",dark:"iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAASKADAAQAAAABAAAASAAAAACQMUbvAAAGt0lEQVR4Ae2aeahVVRTG32u0yZwqCU0zK4sGm6RIQmkkw8oyzawsjITM0rJopEBJ0NJ65VBOqc8kMyOjWZGMkJCyiQYUxR6pZTmmL4f3+n10t5y33Pd5zj3nXPtjL/jYZ629z/rW/e7Z++z93q2oCBYUCAoEBYICQYGgQFAgKBAUCAoEBYICQYGgQFAgKBAUQIH6+vq2oD/oUA5B4Gle4Du3HHxxOSqLDaTYd+hrA+rAPDCxsrJyM20uBt84EnctJF9IOw6+tbmQJUjamEDLTJ4t+BPBPArfY/pSuwikL6FdJNFOrmeA6fDVRuJlvTwoAVtTxj4CZvNhuiS4r9Shh3HjQPA2fNeUmiTtfUkEclyncDGeoscATcG87XgIRsA1BZyRN5nNH1egDdyotShq3XDmUvRgcGS0I4NrTWc7rbR4z4DradAyA45YKeIKtIRs/YBdlw4lNgBoGvQARdc0xiSxlQy+CXxkblL+nkB8twPx52pxBapgoVwBBlGN1qHfTFWt8J8F0yj6LNNXkgvXevAEN2sd+skkOQr/AfAmfO7NZ4Zk48YWyNFR9CKubwbjwQ4XL7QSZzpFPwMkWmqDbzlJ7gAjwF8mYVv8cXBVgfamLxM3sUBipeidYCqXvcAHihm7Dn8+RQ8AehulMrjqgPZl4psFdpuEl+DPgWsYOMb0pXJLEsgxUvQf4Cn8u8APLl5oj6AdDDQNuhViqRq4tgFtKG8Bn5tkh+BrndQX0wuk+mwudyZJKPo7Eg4AWoc2gKhpK6AtgbYG2iKkNvjWgAdJNASsNgmb4T8OZsF3vulL7GYikFgpuB4s4FLT4HWwC0StC442mcOBNp2pDb4vSNIXjAXbTMLT8F+FaxRobfpiu5kJ5Bgpejuowu8NPnPxQnswbR+gadAbyE9lcO0G1SS5EcwH9SbhFfjz4BoEmpi+/bqZC+QYKboGDMPXOrTKxQvtsbSPgmqKvsj0leTCtRGM5Ob+4GuT5HD8gUBCXW36GnVzE8ixUvRSrm8FY8BWFy+0HWknUPRoWu1tUht8P4N7SPQYWGcSnoA/Er7JoJPp87q5CyRWCtY0mMOlpsFboA5ErTtOJvsmlxS+T7jWfm0SsMeWzsRmItKToAXXRa0sAjl2it4ERuH7ji1uWGYtXLXgNRJKqI9N4kr8G4DWQ/1hUNuEfaysAjl2inbHFq1D9tjihmXWwrcO6NWvdch3bNGWQfu1CyzpARHIFUHRC7nW224CsNPADcushW85ydyxZaNJfBL+WERqMNUPqECRAvW4l9PE5+PUsajBVGvglLNCcfFtXU4zFJS8kVOeuAbfeYx9GJzuuWcNsec0HaN9B0QgCj2VIlToPnM+WlxW1/DpC9Cx5CpPzr+JTQZvII49BDd8nDw3Zxqi0GYkHAR0HMl9esPXBB6tOXcCbRajph33AvAywtg/o+wdV5YniELFo1ftvcD354hFxM8BDRZI/JINziu5WW8nbQ6tfUNgNMLYN5odl/8TRKEXw/oQOHkf9oqKFcTGUOgyxunfPqkFIk8n8mj6dgbW1hOogu9D21HMz+0JotA2kOosdpmHfDMxvdrnU+weT3/iEHzNuek+cD2wb6h/iM0E0+GrpY1tmQtEoTpT3Q1uAza/xNBRYxKFbqFNbfCJow/Q+etoT8JPib0I31pP335D9gPs94ZiAyhU31oPcD9o6Rn3JbHnKXSlp6+kEJyXcqOe0naeBL8Q0/T9ytMXO5SJQBR6NozDwZke5hpi+j/7Yk9fSSH4JMhQ0NWTYBMxN33rPP2JQqkEotDjYNMTc62HdQexKWA24uz09CcOwacpNBD0BbZ2Td+5QNN3K20mZkliJaVQbcn7A6012mtYe4+A9hcbbEcpPnzaM/UEWoS1GFtbSkDTabXtSOsnFohiu0Oqx/tED/n3xFSo2kwMPr2u9drW69varwRegG+J7cjKjy0QhXaEVIVe6CHXk1IF3qdY7VBTG3ytSTIEFDseaPrqeLArNVkjCex+Ye9QCly21/nvXzkt8O3xQMVVg6kUuj0yPvElfNooureRtgCaxr7p+y7xV+D7kzZ3i/sEtfJUspiY3k41nr60oaaeBN8S0/HgR09fbqG4AkUL0D5G+xnta8phv0PyEnyxjwdZFpVEID32E0EuP8HzfChtDXQ8mIY4tZ7+soQaE2g1FbQH2mxpfcj1R5zkXwXcGrSQ6//Fjzipw28smi2AfqTUwT8i2yg8TUA/4DuFZ0sWsgUFggJBgaBAUCAoEBQICgQFggJBgaBAUCAoEBQICgQFiijwLxwPFVr0t277AAAAAElFTkSuQmCC"},menuResolutionIcon:{light:"iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAAEi6oPRAAAAAXNSR0IArs4c6QAAA0FJREFUeAHtWz2S1TAMfjDMMHCCpeYKdEDJKagXTkBBxQ4NDReA+t2CkqWjp+IaMFSL5I08jp8UOf59ycozxoksS58+K7aT5R0Otcq9ydBNikFUwvqVUfYGSInROdzcD6TkOhAdvuDNg1ASXXs3NNoLIsURtymYSMfhc+GOQHrr03NHoLyAwUQ6TNdmREvxLQXhxoW5S8pZBjlDWexyhgiZ1oqplxUSeMsdpwG1/uYMhMlXMo2hnex8cAC4LeAX8PB94uJNDicUGrd9Ldlz40qeNdE4IRIVhI5iRDPH1ULjZk2IwItnSEiaY2iWfJIh1hspW2sMbJeBI0DH9O5Z0adYCIioULlj5i9lBcEBXGFXEk5xjSx1kcXNCQGEdY2fZN1UQE3Y4FCmTFk3MAgwlSEumCayEYDwPUF6UIYwJIJBylNyqHRqFgHExrmEJQNPQflvPKDy/SOw93uy6bBwgLD/PdSHk2Lr5h84+NTaidk3BowBY8AYqMUAt3XQXlbLR4odjyM+D+EeNqJ4vzEg2lBxp0fUrSv6wUJ+xQPan1u95v+eHG+0A5qUT37Oa0PWAJE/ei+j+2ZtKqC3zRBEhuOkjrr73xogjXMth5o9TRIwmzKJGZKPYAgXW2nBFbcOAty9HcHQYpBnB0h77BejSewU84UbP4qhaw4MynowtGpxlQB9BrDvpCgqytHPYnkFvbRO9GzRryscndj5fOrv0fwAJ996ODIfxoAxYAwYA8aAMWAMGAPbZoA7vHIR4YH2GVT/4ZZT2qgM/9r7E2rWARqJ6fnaMdoXxjsr0gsiKcWvQUfo+AC11xd+wtGifQxGP0J9HRjHeFdl0hUMCGf1IjC2h8snUXxXcVClH2Hw/1yHBGrXsf+zvy8l6MXZR1gIsJSg0D39HQ13RqmG+pu4rklQ6pFhE8QQyJoEkc1dtUaQMp3aOUgZ7tYaTWfT/ZZByvQZQUaQ+4F5eIBVKJl3WwbN+Ti5M4JOKJkL7gJB+Hhll9JtPttxxYH0+2KJiJclvvZA0GUJAdrYPRDU9B1w7RqEX+H2VNR4tAzCD9phod9XhbI9XcfxJsV2BK3woLXXa4zTijFgDBgDxoAxYAzcHQb+A8TbERMpxGRsAAAAAElFTkSuQmCC",dark:"iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAASKADAAQAAAABAAAASAAAAACQMUbvAAACMklEQVR4Ae2bO07DQBCGbYQQV6EDiSJHcAm38B2ghDsQiXuQI6QLXVoKDoHSmH8lr7SPrGcdu9jHv5LlzOwj83+ZsZ1o0zRsJEACJEACJEACJEACJEACJEACJJAYgTYmnmEYNhh3h+MmZnxmY06I99i27f5c3CIgwHnDxO7c5MJ8O0B6dTVduQ7THjOnBjhKdjfqNRE0k4AwUpVVTc3Tey2od685Xxi/xfEnzMuh+xZB9jjMCnH1NhIgV+gWdfrrOnO1UVIfDiBPilRi7oQSMsfUJOqZC8hcvIrXc0vMgoIU/YTj3nJOGCjPx4nuJLuWZlA0nCTVRwS1FFDEW+Q9ZFGJOdJ/YB9Gn/iE7sxN1lwT0AHXmPdklV4YGEtMALcmoGLKymS2JiBz3WJeE5DwURIQAQkEhG5mkABo0XNQjt+tBB5eNzPIQ2I7CMjm4VkE5CGxHQRk8/AsAvKQ2I5FdzF7qTQt/Or5gsiedXRz77zMIE0ucCagABjtJiBNInAmoAAY7SYgTSJwrgHQENAe5a4BUBSI0KDsn4PwnKM3PYUy5SEkPsafPSCIfIoReukYlphArjZA3wIPrzv7Epv73cojIDhqyyABh989F5Da11dSE/XMLbF+3Ncnbl3LgKKC00txSoDULnSzdTDUUWpz9Yr7pI+lkgjo8vROXoNwh9hjoV1gsdLc6q8ISq/Voras4Lqzwawq/8xi0aJBAiRAAiRAAiRAAiRAAiRAAiRAAikQ+AfRfUIyNXGRbAAAAABJRU5ErkJggg=="},redirectWhiteList:[2756892560],redirectWiiteUinMod:100};try{Ie._debug=window.location.href.indexOf("&_debug=1")>0}catch(hi){Ie._debug=!1}const xe=A.getInner();window.parent===window&&A.isWechat&&!A.isInMiniProgram&&(B.os.iphone&&A.gtVersion("7.0.15",1)&&B.os.getNumVersion()>=10.3||B.os.android&&(xe>"27001037"&&xe<"27001060"||xe>="27001100")&&B.os.getNumVersion()>=5)&&(Ie.wcSlPlayerSupport=!0),console.log("support wcslplayer",Ie.wcSlPlayerSupport);const Ee=t=>Ie._debug&&console.log(t),Oe=t=>{let e=0,i=0,s=0;return t<.5&&(t=0),t=Math.floor(t),e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),s=t-3600*e-60*i,0!=e?(e<10&&(e="0"+e),e+=":"):e="",i<10&&(i="0"+i),s<10&&(s="0"+s),e+i+":"+s},Re=()=>{let t=(()=>{if("hidden"in document)return"hidden";let t=["webkit","moz","ms","o"];for(let e=0;e<t.length;e++)return t[e]+"Hidden";return null})();return!!t&&document[t]},Ae=(t,e)=>{const i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;return i&&i.call(t,e)};const Me=R({name:"mp-video-player",props:{opt:{type:Object,default:()=>({})},wrapStyle:{type:Object,default:()=>null},videoStyle:{type:Object,default:()=>null},posterStyle:{type:Object,default:()=>null},canLoad:{type:Boolean,default:!0}},components:{[be.name]:be},data(){const t=C.supportImmersiveMode;console.log("support immersive mode",t);const e=C.__useWcSlPlayer=this.supportWcSlPlayer()&&this.opt.useWcSlPlayer;console.log("use wcslplayer",e);const i=(this.opt.useFeFullscreen||!this.supportWcSlPlayer()&&this.opt.useWcSlPlayer)&&t;return console.log("use fefullscreen",i),{id:Date.now()+"_"+Math.floor(Math.random()*Math.floor(Date.now())),supportImmersiveMode:t,isImmersiveMode:this.opt.useImmersiveMode,isFeFullscreen:i,isWcSlPlayer:e,autoplay:!!this.opt.autoplay,initialTime:this.opt.initialTime,resolutionInfoIdx:0,playbackRateInfoIdx:0,showDefaultPlaybackRate:!1,mustHideFullScreen:!!B.browser.M1,isAndroid:B.os.android,isIPad:B.os.ipad,removeVideo:!1,fitVideo:!1,currentTime:0,videoDuration:0,bufferedPercent:0,touchToastSeperator:"/",touchToastPercent:0,touchToastCurVal:0,touchToastTotalVal:0,androidLandscapeFullOrientation:0,enableWcSlPlayerFullscreenAfterOrientationChange:!this.opt.preCreate,wcSlPlayerTransitionDuration:this.opt.useImmersiveMode?300:50,withoutCover:!1,longTouchPlaybackRatePrevValue:0,likedCommentTipsStatus:0,subscribeStatus:0,videoSnapshot:"",screenshot:"",swipingPos:0,isSwipingBack:!1,topTips:"",showPauseBtn:!this.opt.preCreate,fullscreenAnimation:{},bodyColor:"#ffffff",useQuic:!1,compare1:null,compare2:null,fitCover:!1,posterRatio:null,videoWrpRatio:null}},computed:{...i("mp-video-player",["fullscreenStatus","seekingStatus","status","subStatus","loadingStatus","controlBarStatus","coverStatus","banOprStatus","midPlayStatus","resolutionEntryStatus","subSettingStatus","accessPlayBtnStatus","touchOprStatus","orientationStatus","progressBarMark"]),isImmersiveListMode:()=>window.__immersiveListMode||window.__rowImmersiveStream,inAppmsgAndNotFullScreen(){return"0"===this.$store.state.cgiData.item_show_type&&1!==this.fullscreenStatus&&!this.opt.disableBorderRadius},updateStyleOnly(){return!this.isImmersiveMode&&"update-style-only"===this.enableWcSlPlayerFullscreenAfterOrientationChange},src(){const t=parseInt(this.$store.state.cgiData.user_uin||0);let e=0,i=this.opt.src;return t>0&&(Math.floor(t/100)%100<Ie.redirectWiiteUinMod||Ie.redirectWhiteList.indexOf(t)>-1)&&(e=1),this.opt.extinfo&&this.opt.extinfo.vid&&(i+="&vid="+this.opt.extinfo.vid+"&format_id="+this.opt.formatId),i&&(i+="".concat(-1!==i.indexOf("?")?"&":"?","support_redirect=").concat(e,"&mmversion=").concat(A.get())),this.useQuic?i.replace("mpvideo.qpic.cn","wxsnsdy.wxs.qq.com/130/20210/snssvpdownload/SH/reserved"):i},coverFit(){return this.opt.coverFit},cover(){return this.withoutCover?"":k.addWxfrom(this.opt.cover,16)},width(){return this.fullscreenStatus?Math.min(Ie.outerWidth,Ie.screenLength*this.videoRatio):Math.min(this.opt.width||300,Ie.screenWidth)},height(){return this.fullscreenStatus?Math.min(Ie.screenLength,Ie.outerWidth/this.videoRatio):Math.min(this.opt.height||300,Ie.screenLength)},ratio(){return this.width/this.height},muted(){return this.opt.muted||null},videoWidth(){return this.opt.videoWidth||300},videoHeight(){return this.opt.videoHeight||300},videoRatio(){return this.videoWidth/this.videoHeight},isLandscape(){return 1===this.orientationStatus},alwaysShowControl(){return this.opt.alwaysShowControl||!1},needFeFullscreen(){return window.__video_need_fe_fullscreen__=this.isWcSlPlayer||this.isFeFullscreen||this.isImmersiveMode,window.__video_need_fe_fullscreen__},display(){return this.opt.autoHide?"none":"block"},title(){return this.opt.videoTitle||""},headImgUrl(){return this.opt.headImgUrl||""},nickname(){return this.opt.bizNickName||"未命名账号"},readNum(){return E.formatReadNum(this.opt.readNum)},praiseNum(){return E.formatReadNum(this.opt.praiseNum)},likeNum(){return E.formatReadNum(this.opt.likeNum)},isPraised(){return!!this.opt.isPraised},isLiked(){return!!this.opt.isLiked},cancelPraiseTitle(){return this.isPraised?"轻点两下取消赞":""},cancelLikeTitle(){return this.isLiked?"轻点两下取消在看":""},oriStatus(){return this.opt.oriStatus},canShareVideo(){return this.opt.canShareVideo&&(this.supportImmersiveMode&&(this.needFeFullscreen||B.os.ipad)||this.supportNativeFullPlayer)},canPraiseVideo(){return!(!1===this.opt.canPraiseVideo)},canLikeVideo(){const t=this.$store.state.cgiData;return this.opt.canLikeVideo&&!t.is_temp_url&&!t.isPaySubscribe},canFullscreen(){return!(!1===this.opt.canFullscreen)},canChangePlaybackRate(){return!(!1===this.opt.canChangePlaybackRate)},canMute(){return this.opt.canMute||!1},blurFullscreenBackground(){return this.opt.blurFullscreenBackground||!1},supportNativeFullPlayer(){return A.isWechat&&!A.isInMiniProgram&&this.opt.videoMd5&&(A.isIOS&&A.gtVersion("7.0.9",1)||A.isAndroid&&A.gtVersion("7.0.10",1))},showFullscreenMenu(){return(!this.opt.inFeed||this.isLandscape)&&Ie.showFullscreenMenu&&!!this.opt.showFullscreenMenu},playbackRateInfo(){return this.opt.playbackRateInfo},maxPlaybackRateInfo(){let t;return this.playbackRateInfo&&this.playbackRateInfo.length&&this.playbackRateInfo.forEach((e=>{(!t||e.rate>t.rate)&&(t=e)})),t},resolutionInfo(){return this.opt.resolutionInfo&&this.opt.resolutionInfo.length?[].concat(this.opt.resolutionInfo):[]},flowNum(){return this.opt.flow>=100?this.opt.flow:0},duration(){return"number"==typeof this.opt.duration?this.opt.duration:this.videoDuration},progressPercent(){let t=this.currentTime/this.duration;return t=Math.ceil(100*t),t=Math.max(t,0),t=Math.min(t,100),t},playbackRateName(){const t=this.playbackRateInfo[this.playbackRateInfoIdx];return!this.showDefaultPlaybackRate&&1===t.rate||this.longTouchPlaybackRatePrevValue?"倍速":t&&t.name||"倍速"},resolutionName(){const t=this.resolutionInfo[this.resolutionInfoIdx];return t&&t.name||"清晰度"},formatCurrentTime(){return Oe(this.currentTime)},formatDuration(){return Oe(this.duration)},wrapPresentStyle(){if(this.fullscreenStatus&&this.needFeFullscreen){const t={width:"100%",height:"100%",transform:"translate3d(".concat(this.swipingPos,"px, 0, 0)"),zIndex:500,overflow:"hidden"};return B.os.android&&this.isLandscape&&90===this.androidLandscapeFullOrientation&&(t.right="-1px",delete t.left),t}return{display:this.display,width:"100%",height:this.height+"px",...this.wrapStyle}},videoPresentStyle(){return this.fullscreenStatus&&this.isLandscape?{width:Ie.screenLength+"px",height:Ie.outerWidth+"px"}:{display:"block",width:this.width+"px",height:this.height+"px",...this.fullscreenStatus?{}:this.videoStyle}},poster(){return this.videoSnapshot||this.cover.imgChange640()},posterPresentStyle(){const t={backgroundImage:"url(".concat(this.poster,")"),backgroundSize:this.fitCover?"cover":"contain"};return this.videoSnapshot&&(t.backgroundColor="transparent"),this.fullscreenStatus||this.isImmersiveMode?t:{...t,...this.posterStyle}},featureBarWidth(){return this.fullscreenStatus&&!this.isLandscape&&this.showFullSwitch?"calc(100% - 24px - 13px)":""},featureBarBottom(){return this.fullscreenStatus&&!this.isLandscape?this.videoRatio>1?"calc(50% - ".concat(Math.min(Ie.screenLength,Ie.outerWidth/this.videoRatio)/2,"px - 24px - 12px)"):B.os.android?"calc(1em + 12px)":"calc(1em + 12px + 24px)":0},showFullSwitch(){return!this.isIPad&&this.videoRatio>1&&!this.isLandscape&&(0===this.banOprStatus||3===this.banOprStatus)&&0===this.midPlayStatus&&this.fullscreenStatus&&this.needFeFullscreen},changeFullSwitchStyle(){return{bottom:"calc(50% - ".concat(Math.min(Ie.screenLength,Ie.outerWidth/this.videoRatio)/2,"px - 24px - 12px)")}},maxPlayerFontScale(){return this.fullscreenStatus?1.4:1},showCornerTips(){return!((0!==this.controlBarStatus&&(!this.fullscreenStatus&&1!==this.seekingStatus||this.isLandscape)||1!==this.seekingStatus&&this.fullscreenStatus&&!this.isLandscape)&&(0===this.subSettingStatus||this.isLandscape)&&(0===this.banOprStatus||3===this.banOprStatus)&&0===this.midPlayStatus&&"end"!==this.status)},hideDuration(){return this.opt.hideDuration||!1},maxPlayerFullscreenHeadScale:()=>window.is_care_mode?1.18:1,profileInfoShow(){return 1!==this.seekingStatus&&0===this.subSettingStatus&&(0===this.banOprStatus||3===this.banOprStatus)&&0===this.midPlayStatus&&this.fullscreenStatus&&this.needFeFullscreen&&!this.isLandscape}},watch:{opt(t,e){t!==e&&this.initPlayer()},isLandscape(t){this.isWcSlPlayer||t||!this.fullscreenStatus||this.triggerEvent("fullscreenchange",{state:this.fullscreenStatus,type:"orientation-change",isLandscape:t,supportSwipeBack:Ie.swipeBackSupport})},poster:{handler(t){if(t){const e=new Image;e.onload=()=>{const t=e.width/e.height;this.posterRatio=t},e.src=t}},immediate:!0},fullscreenStatus(t){0===t&&this.changeFullscreenLandscapeMode(0)}},created(){(this.isImmersiveMode||this.opt.preCreate)&&this.setFullscreenStatus({status:1})},mounted(){this.initPlayer(),this.mountedTime=(new Date).getTime(),this.firstLoadingTime=0;const t="function"==typeof window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)");t&&t.matches&&(this.bodyColor="#191919"),Ie.allPlayersOfPage[this.id]=this,M.on("onNetWorkChange",this.onNetworkChange),document.body.addEventListener("mousemove",this.onProgressMouseMove),document.body.addEventListener("mouseup",this.onProgressMouseUp),document.addEventListener("visibilitychange",this.onVisibilityChange),(A.isMac||A.isWindows)&&document.addEventListener("keydown",this.onKeyDown),!this.supportImmersiveMode&&this.isWcSlPlayer&&B.os.iphone&&M.on("onPageStateChange",this.onIOSPageStateChange),this.opt.initFullscreenStatus&&this.enterFullscreen(),this.isImmersiveMode&&!this.opt.preCreate&&(this.enterFullscreenEffect(),M.invoke("setNavigationBarButtons",{right:{color:"#FFFFFFCC",disableMinimizeBlock:!0}})),!this.opt.preCreate&&this.videoRatio<=1&&M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:0,lock:!0}),this.canShareVideo&&this.supportNativeFullPlayer&&!this.needFeFullscreen&&(this.__jsapiFullscreenErrCnt=0,setTimeout(this.getCoverBase64,1e3),M.on("onMPPageAction",this.onJsapiExitFullscreen)),window.addEventListener("resize",this.calcVideoWrpRatio),this.$watch((()=>this.posterRatio-this.videoWrpRatio),(()=>{this.posterRatio&&this.videoWrpRatio?this.fitCover=Math.abs(this.posterRatio-this.videoWrpRatio)<.02:this.fitCover=!1}),{immediate:!0}),this.calcDomPos(),setTimeout((()=>this.calcVideoWrpRatio()))},beforeDestroy(){delete Ie.allPlayersOfPage[this.id],M.remove("onNetWorkChange",this.onNetworkChange),document.body.removeEventListener("mousemove",this.onProgressMouseMove),document.body.removeEventListener("mouseup",this.onProgressMouseUp),document.removeEventListener("visibilitychange",this.onVisibilityChange),(A.isMac||A.isWindows)&&document.removeEventListener("keydown",this.onKeyDown),!this.supportImmersiveMode&&this.isWcSlPlayer&&B.os.iphone&&M.remove("onPageStateChange",this.onIOSPageStateChange),this.canShareVideo&&this.supportNativeFullPlayer&&!this.needFeFullscreen&&M.remove("onMPPageAction",this.onJsapiExitFullscreen),window.removeEventListener("resize",this.calcVideoWrpRatio)},methods:{...o("mp-video-player",["setFullscreenStatus","setSeekingStatus","setStatus","setLoadingStatus","setControlBarStatus","setCoverStatus","setMidPlayStatus","setResolutionEntryStatus","setSubSettingStatus","setAccessPlayBtnStatus","setTouchOprStatus","setBanOprStatus","setOrientationStatus"]),initPlayer(){if(this.isWcSlPlayer&&(this.useQuic&&b.setSum(237895,0,1),this.compare1&&b.setSum(237895,1,1),this.compare2&&b.setSum(237895,2,1),b.setSum(221515,1,1),b.setSum(221515,B.os.android?6:5,1)),!this.opt.src)return this.changeStatus({status:"error",subStatus:"5"}),void this.emitEvent("error",{errorcode:5});this.initData(),this.opt.preCreate||this.preventOperating(2),this.__inited?(this.currentTime=0,this.showCover(),this.hideMidPlayBtn()):(this.isImmersiveMode||this.setFullscreenStatus({status:0}),this.setSeekingStatus({status:0})),M.invoke("getNetworkType",{},(t=>{let e=Ie.nettypeMap[t.err_msg]||"fail";"network_type:edge"!=t.err_msg&&"network_type:wwan"!=t.err_msg||(t.detailtype&&Ie.cellType.indexOf(t.detailtype)>-1||t.subtype&&Ie.cellType.indexOf(t.subtype)>-1)&&(e=t.detailtype||t.subtype),this.__lastNetworkType={networkType:e,simType:t.simtype}}));const t={needToFit:!1,supportObjectFit:!1,os:B.os};this.$watch((()=>[this.width,this.height,this.videoWidth,this.videoHeight].join(":")),(()=>{if(this.width&&this.height&&this.videoWidth&&this.videoHeight){Math.abs(this.width/this.height-this.videoWidth/this.videoHeight)<=.1?(t.needToFit=!0,((t,e)=>{const i=document.createElement("div");return t in i.style&&(i.style[t]=e,i.style[t]===e)})("objectFit","fill")?(t.supportObjectFit=!0,this.fitVideo=!0):this.fitVideo=!1):this.fitVideo=!1}else this.fitVideo=!1}),{immediate:!0}),this.triggerEvent("afterCheckVideoFit",t),this.triggerEvent("loading",this.opt),this.__inited=!0},initData(){this.log={hasended:0,lastsec:0,duration:0,video_error:0},this.__hasBegunPlaying=!1,this.__canplay=!1,this.__seekedTimes=[],this.__playingBufferingStartTime=null,this.__hasEmittedDurationchange=!1,this.__userPlayTime=!1,this.__replaySec=null,this.__playQueue=[],this.__lastPlayTime=null,this.__totalPlayTime=0,this.__serialTimeupdateCache=[],this.__enableTimeupdateLog=!0,this.__isUserPause=!1,this.__pauseNetType=null,this.__hasReportedBeginPlay=!1,this.__fallbackFromWcSlVideoToH5Player=!1;const t=this.$store.state.cgiData.user_uin||0;if(this.__pageVideo_canSample=0!==t&&Math.floor(t/100)%1e3<1,this.__pageVideo_count=0,this.__pageVideo_time=0,this.__pageVideo_velocity=0,this.__pageVideo_lastDistance=0,this.__pageVideo_videoTmpTime=0,this.__pageVideo_startDragVideoTime=0,this.__pageVideo_hasReported=!1,this.__pageVideo_canTouchForward=!0,this.__pageVideo_isTouchMoveUpNDown=!1,this.__pageVideo_firstTouch=!1,this.__pageVideo_touchForwardId=null,this.playbackRateInfo&&this.playbackRateInfo.length)for(let e=0;e<this.playbackRateInfo.length;e++){if(1===this.playbackRateInfo[e].rate){this.playbackRateInfoIdx=e;break}}if(this.resolutionInfo&&this.resolutionInfo.length)for(let e=0;e<this.resolutionInfo.length;e++){if(this.resolutionInfo[e].src===this.opt.src){this.resolutionInfoIdx=e;break}}},addSerialTimeupdate(){if(!this.$refs.video)return;const t=this.$refs.video.currentTime,e=this.__serialTimeupdateCache.length;t>0&&(0===e||this.__serialTimeupdateCache[e-1].currentTime!=t)&&(this.__serialTimeupdateCache.length>=Ie.timeupdateCacheCount&&this.__serialTimeupdateCache.shift(),this.__serialTimeupdateCache.push({currentTime:t,timeStamp:Date.now()}))},checkPlayBySerialTimeupdate(){if(this.__serialTimeupdateCache.length<Ie.timeupdateCacheCount)return!1;let t=this.__serialTimeupdateCache.length,e=this.__serialTimeupdateCache[t-1],i=this.__serialTimeupdateCache[t-Ie.timeupdateCacheCount];return e.timeStamp-i.timeStamp<2500},startCountTime(){const t=this.$refs.video;t&&null===this.__lastPlayTime&&(this.__lastPlayTime=t.currentTime)},endCountTime(){const t=this.$refs.video;t&&t.currentTime>this.__lastPlayTime&&null!==this.__lastPlayTime&&(this.__totalPlayTime+=t.currentTime-this.__lastPlayTime,this.__lastPlayTime=null)},pauseOtherPlayersOfPage(){Object.keys(Ie.allPlayersOfPage).forEach((t=>{this.id!==t&&(Ie.allPlayersOfPage[t].pause(),Ie.allPlayersOfPage[t].opt.inFeed||(Ie.allPlayersOfPage[t].showMidPlayBtn(),Ie.allPlayersOfPage[t].hideControlBar()))}))},onVideoDurationchange(){const t=this.$refs.video;if(!t||this.__hasEmittedDurationchange)return;this.__hasEmittedDurationchange=!0,t.duration&&1!==t.duration&&(this.videoDuration=t.duration);const e=Date.now()-this.log.loadwait_start;this.log.loadwait=e,this.log.duration=this.duration,this.triggerEvent("durationchange",{loadwait:e}),setTimeout((()=>this.calcVideoWrpRatio()))},onLoadedmetadata(){if(this.opt.withoutCover&&(this.withoutCover=!0),this.onVideoDurationchange(),this.__playQueue&&this.__playQueue.length>0){const t=this.__playQueue[0].sec;this.__playQueue=[],this.play(t)}this.triggerEvent("loadedmetadata")},onTimeupdate(){const t=this.$refs.video;if(!t)return;if(this.hasBegunPlaying()&&!this.__canplay)return this.showLoading(),!1;null!==this.__replaySec&&(Ee(this.id+":timeupdate __replaySec"),t.pause(),t.currentTime=this.__replaySec,this.__lastPlayTime=this.__replaySec,t.play(),this.__replaySec=null),this.onVideoDurationchange();let e=t.currentTime;e>0&&(this.startCountTime(),this.addSerialTimeupdate(),"loading"===this.status&&"seeking"===this.subStatus||!this.checkPlayBySerialTimeupdate()||0!==this.loadingStatus&&this.hideLoading(),this.seekingStatus||1===this.touchOprStatus||(this.currentTime=e),(e>60||this.duration-e<.5)&&this.showSubscribeBtn(),this.coverStatus&&this.hideCover(),this.triggerEvent("timeupdate",{currentTime:e}),this.afterFirstLoaded())},onProgress(){const t=this.$refs.video;if(!t)return;const e=this.duration,i=this.currentTime/e;let s=i;this.isWcSlPlayer&&t.buffered?s=t.buffered.percent:t.buffered&&t.buffered.length>0&&t.buffered.end&&e&&(s=t.buffered.end(0)/e,s=Math.max(i,Math.ceil(parseInt(100*s)))),s>98&&(s=100),this.bufferedPercent=s,this.consoleLog("progress: "+s+"%",!0)},onCanplay(){const t=this.$refs.video;null!==this.__replaySec&&(t.currentTime=1*(1*this.__replaySec).toFixed(4),this.__lastPlayTime=this.__replaySec,this.__replaySec=null),this.__canplay=!0,this.triggerEvent("canplay"),setTimeout((()=>this.calcVideoWrpRatio()))},onEnded(){Ee("player inner is end:"+this.isEnd()),this.isEnd()&&this.onVideoEnded()},onVideoEnded(){this.changeStatus({status:"end",subStatus:""}),this.endCountTime(),this.triggerEvent("end"),(!A.isIOS&&!A.isAndroid&&this.fullscreenStatus||A.isNewMpApp)&&this.handleFullscreenChange({state:!1,type:"h5"}),this.opt.loop?(this.__canplay=!0,this.__firstPlayStart=Date.now(),this.__userPlayTime=!0,this.__hasBegunPlaying=!0,this.$refs.video.play(),this.videoCtlReport({step:9}),this.changeStatus({status:"loading",subStatus:"seeked"})):(this.currentTime=0,this.showMidPlayBtn())},onSeeked(){const t=this.$refs.video;0!==this.seekingStatus&&201!==this.seekingStatus||(this.changeStatus({status:"loading",subStatus:"seeked"}),1===this.__statusBeforeSeek?t.play():3===this.__statusBeforeSeek?(this.hideLoading(),this.changeStatus({status:"play",subStatus:"playing"})):2!==this.__statusBeforeSeek&&4!==this.__statusBeforeSeek||(this.hideLoading(),this.changeStatus({status:"pause",subStatus:""})),delete this.__statusBeforeSeek),Ee("video seeked event")},onSeeking(){Ee("seeking,hasBegunPlaying:"+this.hasBegunPlaying()),this.hasBegunPlaying()&&(this.changeStatus({status:"loading",subStatus:"seeking"}),this.showLoading())},onWaiting(){const t=this.$refs.video;if(Ee("waiting,hasBegunPlaying:"+this.hasBegunPlaying()),!this.hasBegunPlaying())return;this.changeStatus({status:"loading",subStatus:"waiting"}),this.showLoading(),this.consoleLog("waiting counting begin"),this.__loadingTimeoutId&&clearTimeout(this.__loadingTimeoutId);const e=t.currentTime;this.__loadingTimeoutId=setTimeout((()=>{if(t.currentTime===e){if(this.isWcSlPlayer)return void b.setSum(221515,B.os.android?15:14,1);this.changeStatus({status:"error",subStatus:"6"}),this.emitEvent("error",{errorcode:6})}}),Ie.loadingTimeout),this.__waitingTimeoutId&&(clearTimeout(this.__waitingTimeoutId),this.__waitingTimeoutId=null);let i=0;try{for(let t in Ie.allPlayersOfPage)if(Ie.allPlayersOfPage.hasOwnProperty(t)&&i++,i>1)break}catch(hi){}!this.isWcSlPlayer&&i>1&&(this.__waitingTimeoutId=setTimeout((()=>{if(0===t.readyState&&(!t.error||0===t.error.code)){this.__waitingTimeoutId&&(clearTimeout(this.__waitingTimeoutId),this.__waitingTimeoutId=null);let e=t.src;this.showLoading(),this.showCover(),t.pause(),t.src=e,t.load(),t.play(),Ee(this.id+":waiting timer")}}),1e4)),this.triggerEvent("waiting")},onPlay(t){Ee(this.id+":play playing"),this.changeStatus({status:"play",subStatus:t.type}),this.showPauseBtn=!0,this.pauseOtherPlayersOfPage(),this.hidePlayControl(),this.startCountTime(),this.triggerEvent("play"),this.isWcSlPlayer&&this.__canplay&&this.hideLoading()},onPause(){Ee(this.id+":video pause event"),this.changeStatus({status:"pause",subStatus:""}),this.endCountTime(),this.triggerEvent("pause")},onError(t){if(this.isWcSlPlayer){this.useQuic&&(b.setSum(237895,3,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&t.detail&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:UseQuicError",(window.__second_open__?"secopen:":"h5:")+JSON.stringify(t.detail),{mid:"mmbizwap:quic_Monitor",view:"wap_business"})),this.compare1&&b.setSum(237895,4,1),this.compare2&&b.setSum(237895,5,1),this.changeStatus({status:"error",subStatus:"3",errorMsg:t.detail}),b.setSum(221515,3,1),b.setSum(221515,B.os.android?10:9,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&t.detail&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:Error",(window.__second_open__?"secopen:":"h5:")+JSON.stringify(t.detail));const e=()=>this.triggerEvent("error",{errorcode:3,error:t.detail});return void(this.fullscreenStatus&&!this.isImmersiveMode||this.isImmersiveMode&&this.isLandscape?(this.enableWcSlPlayerFullscreenAfterOrientationChange=!0,this.exitFullscreen(),setTimeout(e,250)):e())}if(!this.$refs.video.error)return;if(!this.__hasErrorRetried&&this.opt.retryResolution){this.__hasErrorRetried=!0;const t=this.opt.retryResolution,e=this.$refs.video,i=e.currentTime,s=e.playbackRate,o=this.isPlay();return this.hasBegunPlaying()&&o&&(e.pause(),this.setVideoSnapshot()),this.$nextTick((()=>{e.src=t.url,e.src.indexOf("support_redirect=1")>-1&&(e.src=e.src.replace("support_redirect=1","support_redirect=0")),this.hasBegunPlaying()&&o&&(e.play(),this.play(i),this.setPlaybackRate(s))})),void this.triggerEvent("errorRetry")}let e=this.$refs.video.error.code,i=this.$refs.video.error.message;this.changeStatus({status:"error",subStatus:e||"",errorMsg:i||""});const s=encodeURIComponent(this.$refs.video.baseURI);i+="|"+this.src,i=encodeURIComponent(i),S({type:"GET",dataType:"json",timeout:3e4,url:"".concat("/mp/ad_video_report?action=report_video_play_error","&errorCode=").concat(e,"&videoUrl=").concat(s,"&errorMsg=").concat(i),success:()=>{},error:()=>{}});const o=()=>this.triggerEvent("error",{errorcode:e});this.isFeFullscreen&&this.fullscreenStatus?(this.exitFullscreen(),this.isLandscape?setTimeout((()=>{this.exitFullscreen(),setTimeout(o,250)}),250):setTimeout(o,250)):o()},onFullscreenchange(t){let e,i="h5";this.isWcSlPlayer?(e=t.detail.fullscreen,i="samelayer"):e="webkitbeginfullscreen"===t.type||"webkitendfullscreen"!==t.type&&(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen),e&&this.__needSyncSubscribeStatus&&(this.syncSubscribeStatus(),this.__needSyncSubscribeStatus=!1),this.setOrientationStatus({status:e?1:0}),(this.isImmersiveMode||this.__originFullscreenStatus)&&(e=!0,i=this.isImmersiveMode?"immersive":"frontend"),this.__originFullscreenStatus||this.handleFullscreenChange({state:e,type:i}),!this.isWcSlPlayer||1!==this.fullscreenStatus||t.detail.options&&t.detail.options.triggerEvent||this.setVideoFullPortraitAlign()},handleFullscreenChange({state:t,type:e}){t?(this.setFullscreenStatus({status:1}),this.showDefaultPlaybackRate=!1,this.showResolutionEntry(),this.setVideoFullPortraitAlign(),this.triggerShowSubscribeEvent(),M.invoke("handleDeviceInfo",{action:"setKeepScreenOn",enable:!0},(()=>{}))):(this.setFullscreenStatus({status:0}),this.$refs.video&&1!==this.$refs.video.playbackRate&&(this.showDefaultPlaybackRate=!0),this.hideResolutionEntry(),this.hideSubSetting(),this.resetVideoFullPortraitAlign(),M.invoke("handleDeviceInfo",{action:"setKeepScreenOn",enable:!1},(()=>{})),A.isIOS&&setTimeout((()=>{M.invoke("setNavigationBarColor",{wxcolor:{light:"#FFFFFF",dark:"#191919"},alpha:window.immersiveMode?0:1}),M.invoke("handleDeviceInfo",{action:"enableFullScreenLayout",enable:!!window.immersiveMode})}),50)),this.triggerEvent("fullscreenchange",{state:t,type:e,isLandscape:this.isLandscape,supportSwipeBack:Ie.swipeBackSupport})},setVideoFullPortraitAlign(){if(this.resetVideoFullPortraitAlign(),this.fullscreenStatus&&!this.isLandscape){const t=this.$refs.video,e=this.$refs.poster,i=A.isIOS&&Ie.screenLength>=812?34:0,s=Math.min(Ie.screenLength,Ie.outerWidth/this.videoRatio),o=[0,56+i,84+i,150+i,190+i];for(let a=1;a<o.length;a++)if(.55*Ie.screenLength-s/2<o[a]){let i=0;for(let t=a-1;t>=0&&(i=(Ie.screenLength-s)/2-o[t],!(s/2-i<Ie.screenLength/2));t--);if(i+="px",e&&(e.style.marginTop=i),t){t.parentElement.style.opacity=0;const e=()=>{t.style.marginTop=i,t.parentElement.style.opacity=null,t.removeEventListener("loadedmetadata",e)};this.isImmersiveMode&&!this.__hasEmittedDurationchange&&B.os.iphone?t.addEventListener("loadedmetadata",e):e()}break}B.os.android&&t&&!t.style.marginTop&&(t.style.marginTop=-.05*Ie.screenLength+"px",t.style.marginBottom=.05*Ie.screenLength+"px")}},resetVideoFullPortraitAlign(){const t=this.$refs.video,e=this.$refs.poster;t&&(t.style.marginTop=""),t&&(t.style.marginBottom=""),e&&(e.style.marginTop="")},getSafeAreaInsets:()=>({top:L.top,left:L.left,right:L.right,bottom:L.bottom}),onBinderror(t){this.fallbackFromWcSlVideoToH5Player(),b.setSum(221515,4,1),b.setSum(221515,B.os.android?12:11,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&t.detail&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:BindError",(window.__second_open__?"secopen:":"h5:")+JSON.stringify(t.detail)),this.triggerEvent("bindError",{error:t.detail})},onResolutionchange(){this.changeStatus({status:"loading",subStatus:"resolutionchange"});const t=this.isWcSlPlayer?this.$refs.video.resolutionSrc:this.$refs.video.src,e=this.resolutionInfo.filter((e=>e.src===t))[0];this.triggerEvent("resolutionChange",{action:"changed",infoBefore:this.__resolutionInfoBeforeChange,infoAfter:e})},onRatechange(){this.triggerEvent("rateChange",{action:"changed",rateBefore:this.__playbackRateBeforeChange,rateAfter:this.$refs.video.playbackRate})},onProcessstatechange(t){this.triggerEvent("processStateChange",{event:t.detail.event,playerType:t.detail.playerType,timeStamp:t.detail.__timestamp,data:t.detail})},onJumpProfile(){if(1!==this.$store.state.cgiData.isprofileblock){const t=()=>{M.invoke("profile",{username:this.opt.bizUserName,tabType:this.opt.profileTabType||2,scene:"204"},(()=>{this.triggerEvent("profileJump",{scene:"fullscreen"})}))};A.isIOS&&this.isLandscape&&!B.os.ipad?(this.changeFullscreenLandscapeMode(0),setTimeout(t,250)):t()}},onShowFullscreenMenu(){if(this.fullscreenStatus&&this.needFeFullscreen){const t=[],e=window.matchMedia("(prefers-color-scheme: dark)");0===this.banOprStatus&&this.playbackRateInfo&&this.playbackRateInfo.length&&t.push({id:"playbackRate",title:this.playbackRateName,iconData:Ie.menuPlaybackRateIcon[e.matches?"dark":"light"]}),0===this.banOprStatus&&this.resolutionInfo&&this.resolutionInfo.length&&t.push({id:"resolution",title:this.resolutionName,iconData:Ie.menuResolutionIcon[e.matches?"dark":"light"]}),M.invoke("handleMPPageAction",{action:"showMenu",forbidFlag:3,menuItems:t}),this.triggerEvent("showMenu",{fullScreen:1})}},onFullscreenMenuClick(t){switch(t.id){case"playbackRate":this.onPlaybackRateEntryClick();break;case"resolution":this.onResolutionEntryClick()}},checkIfOutsideTouchSafeInset(t,e){return this.fullscreenStatus&&this.isLandscape?e<80||e>window.innerHeight-80:t<30||t>window.innerWidth-30},showSeekingStatus(){this.seekingStatus||(this.__setSeekingStatusTimeoutId&&clearTimeout(this.__setSeekingStatusTimeoutId),this.setSeekingStatus({status:101}),this.__setSeekingStatusTimeoutId=setTimeout((()=>{this.setSeekingStatus({status:1}),this.showControlBar()}),100)),this.triggerEvent("seekingStatusChange",!0)},hideSeekingStatus(){this.seekingStatus&&(this.__setSeekingStatusTimeoutId&&clearTimeout(this.__setSeekingStatusTimeoutId),this.setSeekingStatus({status:201}),this.__setSeekingStatusTimeoutId=setTimeout((()=>{this.setSeekingStatus({status:0}),this.hideControlBarAfterTimeout()}),100),this.triggerEvent("seekingStatusChange",!1))},swipeBack(t){this.banOprStatus||(this.swipingPos=Math.max(Math.min(this.swipingPos+t,window.innerWidth),0),this.triggerEvent("swipeBack",{position:this.swipingPos}),this.isSwipingBack||(this.isSwipingBack=!0))},releaseSwipeBack(){this.isSwipingBack&&(this.isSwipingBack=!1,this.fullscreenAnimation={transition:"transform 150ms ease-out"},this.swipingPos>window.innerWidth/3?(this.swipingPos=window.innerWidth,this.exitFullscreen()):this.swipingPos=0,setTimeout((()=>{this.fullscreenAnimation={},this.swipingPos=0}),150),this.triggerEvent("swipeBack",{position:this.swipingPos,release:!0}))},showTouchHorizontalOprBar(t){this.currentTime=t,this.showSeekingStatus(),this.setTouchOprStatus({status:1}),this.touchToastSeperator="/",this.touchToastPercent=100*t/this.duration,this.touchToastCurVal=Oe(t),this.touchToastTotalVal=this.formatDuration},showTouchVerticalOprBar(t,e){e=Math.min(e,1),e=Math.max(e,0),this.setTouchOprStatus({status:2}),this.touchToastSeperator=":",this.touchToastPercent=100*e,this.touchToastCurVal=t,this.touchToastTotalVal=parseInt(100*e,10)+"%"},hideTouchOprBar(){this.hideSeekingStatus(),this.setTouchOprStatus({status:0})},touchMoveHorizontally(t){const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;this.__pageVideo_touchForwardId&&(clearTimeout(this.__pageVideo_touchForwardId),this.__pageVideo_touchForwardId=null),this.__pageVideo_firstTouch=!1;let s=Date.now(),o=s-this.__pageVideo_lastTime,a=e-this.__pageVideo_lastPos.x,r=i-this.__pageVideo_lastPos.y,n=Math.sqrt(Math.pow(a,2)+Math.pow(r,2))+this.__pageVideo_lastDistance,l=Math.min(Math.ceil(n/o),6);const h=this.duration;this.__pageVideo_time=Math.floor(.1*n+.2*l*l*l)*Math.ceil(h/500),0===this.__pageVideo_time?this.__pageVideo_lastDistance=n:this.__pageVideo_lastDistance=0,a<0&&(this.__pageVideo_time=-this.__pageVideo_time),this.__pageVideo_videoTmpTime+=this.__pageVideo_time,this.__pageVideo_videoTmpTime<0&&(this.__pageVideo_videoTmpTime=0),this.__pageVideo_videoTmpTime>h&&(this.__pageVideo_videoTmpTime=1*h);this.fullscreenStatus&&!this.isImmersiveMode&&!this.isLandscape&&Ie.swipeBackSupport&&(t=>{const{x:e,y:i}=t;return i<this.__profileInfoPos.top?e<window.innerWidth/2:(i<this.__progressBarPos.top||i>this.__progressBarPos.bottom)&&e<16})(this.__pageVideo_startPos)?this.swipeBack(a):this.fullscreenStatus&&!this.isLandscape||this.showTouchHorizontalOprBar(this.__pageVideo_videoTmpTime),t.preventDefault(),this.__pageVideo_lastPos={x:e,y:i},this.__pageVideo_lastTime=s},touchMoveVertically(t){if(this.isWcSlPlayer&&this.fullscreenStatus){const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;this.__pageVideo_isTouchMoveUpNDown=!0;let s=(this.width/this.height>1?Math.max:Math.min)(window.screen.height,window.screen.width),o=parseInt(2*(this.__pageVideo_lastPos.y-i)/s*100);o&&(o/=100,this.__pageVideo_startPos.x<s/2?(o=this.$refs.video.brightness+o,this.$refs.video.brightness=o,this.showTouchVerticalOprBar("亮度",o),this.__setBrightnessChangeEventEmitTimeoutId&&clearTimeout(this.__setBrightnessChangeEventEmitTimeoutId),this.__setBrightnessChangeEventEmitTimeoutId=setTimeout((()=>{this.__setBrightnessChangeEventEmitTimeoutId=null,this.triggerEvent("brightnessChange",{value:o,touch:!0})}),1e3)):(o=this.$refs.video.volume+o,this.$refs.video.volume=o,this.showTouchVerticalOprBar("音量",o),this.__setVolumeChangeEventEmitTimeoutId&&clearTimeout(this.__setVolumeChangeEventEmitTimeoutId),this.__setVolumeChangeEventEmitTimeoutId=setTimeout((()=>{this.__setVolumeChangeEventEmitTimeoutId=null,this.triggerEvent("volumeChange",{value:o,touch:!0})}),1e3)),this.__pageVideo_lastPos={x:e,y:i})}else this.__pageVideo_canTouchForward=!1;this.__pageVideo_firstTouch=!1},checkIfUntouchable(t){return!(this.fullscreenStatus&&!this.isLandscape)&&(((t,e,i)=>{let s=!1;for(;t&&!(s=Ae(t,i));)t=t!==e&&null!=t&&t.nodeType!==t.DOCUMENT_NODE&&t.parentNode;return s})(t,this.$el,"div.js_progress_bar,div.js_control,div.js_video_fullscreen_profile")||t.classList.contains("js_progress_bar")||t.classList.contains("js_control")||t.classList.contains("js_video_fullscreen_profile"))},calcDomPos(){this.__progressBarPos=this.$refs.controlBar.getBoundingClientRect(),this.__profileInfoPos=this.$refs.profileInfo.getBoundingClientRect()},onPageVideoTouchStart(t){this.calcDomPos(),1===t.targetTouches.length&&0===this.banOprStatus&&(this.isEnd()||this.checkIfUntouchable(t.changedTouches[0].target)||this.opt.blockTouchVideo||0!==this.midPlayStatus||(this.__pageVideo_touchForwardId&&(clearTimeout(this.__pageVideo_touchForwardId),this.__pageVideo_touchForwardId=null),this.__pageVideo_startTime=this.__pageVideo_lastTime=new Date,this.__pageVideo_startPos=this.__pageVideo_lastPos={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY},this.setTouchOprStatus({status:0}),this.__pageVideo_firstTouch=!0,this.__pageVideo_canTouchForward=!0,this.__pageVideo_startDragVideoTime=this.__pageVideo_videoTmpTime=this.getCurTime(),this.clearFastForwardTimeout(),this.maxPlaybackRateInfo&&this.isPlay()&&!this.checkIfOutsideTouchSafeInset(t.targetTouches[0].clientX,t.targetTouches[0].clientY)&&this.startFastForwardTimeout(),document.body.style.webkitUserSelect="none",document.body.style.userSelect="none"))},onPageVideoTouchMove(t){if(!this.__pageVideo_startPos)return;if(!this.__pageVideo_canTouchForward)return;if(1!==t.targetTouches.length)return;if(0!==this.banOprStatus)return;if(this.isEnd())return;if(this.checkIfUntouchable(t.changedTouches[0].target))return;if(this.checkIfOutsideTouchSafeInset(t.targetTouches[0].clientX,t.targetTouches[0].clientY))return;if(this.opt.blockTouchVideo||0!==this.midPlayStatus)return;const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,s=Math.abs(e-this.__pageVideo_startPos.x),o=Math.abs(i-this.__pageVideo_startPos.y);this.__pageVideo_isTouchMoveUpNDown||this.__pageVideo_firstTouch&&(o>=20||o>s)||(t.preventDefault(),s>=20&&(this.touchMoveHorizontally(t),this.triggerEvent("touchMoveHorizontally",t))),this.clearFastForwardTimeout()},onPageVideoTouchEnd(t){if(0!==this.touchOprStatus&&!this.__pageVideo_isTouchMoveUpNDown){if(this.__statusBeforeSeek=this.isPlay()?3:4,this.__pageVideo_touchForwardId=setTimeout((()=>{this.play(this.__pageVideo_videoTmpTime)}),0),this.__pageVideo_canSample&&(b.setSum(28307,29,1),!this.__pageVideo_hasReported)){let e={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY},i=e.x-this.__pageVideo_startPos.x,s=e.y-this.__pageVideo_startPos.y,o=parseInt(Math.sqrt(Math.pow(i,2)+Math.pow(s,2))),a=parseInt(180*Math.atan2(s,i)/Math.PI);a>=-30&&a<=30||a>=150&&a<=180||a>=-180&&a<=-150||b.setSum(28307,35,1),b.setSum(28307,31,1),b.setSum(28307,33,o),b.setSum(28307,34,this.__pageVideo_velocity),this.__pageVideo_hasReported=!0}this.videoCtlReport({step:13}),this.__pageVideo_startDragVideoTime&&this.__seekedTimes.push(Math.round(1e3*this.__pageVideo_startDragVideoTime)+":#:"+Math.round(1e3*this.__pageVideo_videoTmpTime)),this.triggerEvent("handDragComplete",{playTime:this.__pageVideo_videoTmpTime,startDragVideoTime:this.__pageVideo_startDragVideoTime}),t.preventDefault()}this.releaseSwipeBack(),this.hideTouchOprBar(),this.__pageVideo_time=0,this.__pageVideo_firstTouch=!1,this.__pageVideo_canTouchForward=!0,this.__pageVideo_isTouchMoveUpNDown=!1,this.__pageVideo_count=0,this.longTouchPlaybackRatePrevValue&&t.preventDefault(),this.stopFastForward(),this.clearFastForwardTimeout(),setTimeout((()=>{document.body.style.webkitUserSelect="",document.body.style.userSelect=""}),50),this.triggerEvent("playerTouchEnd",t)},onPageVideoClick(t){if(1!==this.likedCommentTipsStatus){if(!this.checkIfIgnorePageVideoClick(t)&&!this.isEnd()&&0===this.touchOprStatus){const e=this.needFeFullscreen&&this.fullscreenStatus&&!this.isLandscape&&0===this.subSettingStatus;if(e||this.__pageVideo_lastTouchVideoTs&&Date.now()-this.__pageVideo_lastTouchVideoTs<300)return this.clickPlaySwitch(e?1:2),delete this.__pageVideo_lastTouchVideoTs,void t.preventDefault();this.__pageVideo_lastTouchVideoTs=Date.now(),this.triggerEvent("touchVideo")}}else this.hideLikedCommentTips()},startFastForwardTimeout(){this.__pageVideo_longTouchPlaybackRateForwardId=setTimeout((()=>{this.longTouchPlaybackRatePrevValue=this.$refs.video.playbackRate,this.setPlaybackRate(this.maxPlaybackRateInfo.rate),this.__pageVideo_longTouchPlaybackRateForwardId=null,this.__pageVideo_canTouchForward=!1,this.triggerEvent("fastForward")}),500)},clearFastForwardTimeout(){this.__pageVideo_longTouchPlaybackRateForwardId&&(clearTimeout(this.__pageVideo_longTouchPlaybackRateForwardId),this.__pageVideo_longTouchPlaybackRateForwardId=null)},stopFastForward(){this.longTouchPlaybackRatePrevValue&&(this.setPlaybackRate(this.longTouchPlaybackRatePrevValue),this.longTouchPlaybackRatePrevValue=0)},checkIfIgnorePageVideoClick(t){const e=e=>e&&(t.target===e||e.contains(t.target));return!!(e(this.$refs.controlBar)||e(this.$refs.featureBar)||e(this.$refs.navigationBar)||e(this.$refs.subSettingMenu))},firstPlay(){const t=()=>{this.changeStatus({status:"loading",subStatus:"preload"});let t=2;this.__hasReportedBeginPlay?t=9:/^wxv_/.test(this.opt&&this.opt.extinfo&&this.opt.extinfo.vid||"")||(t=11),this.videoCtlReport({step:t}),this.__hasReportedBeginPlay=!0,this.triggerEvent("readyBeginPlay")};"function"==typeof this.opt.checkPlayAuthority?this.opt.checkPlayAuthority({allowPlay:t}):t(),this.showLoading()},onMidPlayBtnClick(){this.hasBegunPlaying()?(this.play(),this.hideMidPlayBtn()):this.isEnd()?this.replay():this.firstPlay(),this.$refs.ariaSwitch&&(this.$refs.ariaSwitch.focus(),B.os.android&&setTimeout((()=>{this.$refs.ariaSwitch&&(this.$refs.ariaSwitch.setAttribute("role","checkbox"),this.$refs.ariaSwitch.focus())}),100)),this.triggerEvent("midPlayClick",this.hasBegunPlaying())},onPlaySwitchClick(){this.clickPlaySwitch()},onMuteSwitchClick(){const t=this.$refs.video;if(t){const e=!this.opt.muted;t.muted=e,this.$set(this.opt,"muted",e),this.triggerEvent("muteChange",e)}},onFullscreenSwitchClick(t){this.opt&&"function"==typeof this.opt.customFullscreenAction?this.opt.customFullscreenAction(t):(this.isWcSlPlayer?this.fullscreenStatus?this.exitFullscreen():this.enterFullscreen():(this.fullscreenStatus?this.exitFullscreen():(b.setSum(28307,56,1),Ie.swipeBackSupport?(this.setVideoSnapshot(),setTimeout(this.enterFullscreen,50)):this.enterFullscreen()),t.preventDefault()),t.stopPropagation())},onProgressTouchStart(t){const e=t.changedTouches[0];this.onPointerDownHandler(t,e.pageX,e.pageY)},onProgressTouchMove(t){if(!this.seekingStatus)return;const e=t.changedTouches[0];this.onPointerMoveHandler(t,e.pageX,e.pageY)},onProgressTouchEnd(t){if(!this.seekingStatus)return;const e=t.changedTouches[0];this.onPointerUpHandler(t,e.pageX,e.pageY)},onProgressMouseDown(t){this.onPointerDownHandler(t,t.pageX||t.clientX,t.pageY||t.clientY)},onProgressMouseMove(t){this.seekingStatus&&this.onPointerMoveHandler(t,t.pageX||t.clientX,t.pageY||t.clientY)},onProgressMouseUp(t){this.seekingStatus&&this.onPointerUpHandler(t,t.pageX||t.clientX,t.pageY||t.clientY)},onPointerDownHandler(t,e,i){0===this.banOprStatus&&(t.preventDefault(),this.__statusBeforeSeek=this.isPlay()?1:2,this.__seekingData={x1:e,y1:i,startTime:this.$refs.video.currentTime},this.pause(),this.showControlBar(),this.showSeekingStatus(),A.isIOS&&!this.fullscreenStatus&&M.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!0}))},onPointerMoveHandler(t,e,i){this.__hasSeeked=!0,this.__seekingData||(this.__seekingData={startTime:this.$refs.video.currentTime}),this.__seekingData.x2=e,this.__seekingData.y2=i;const s=this.$refs.progressBar.getBoundingClientRect().width,o=(e-(parseInt(window.getComputedStyle(this.$refs.playedBar).paddingLeft)||0)-this.$refs.playedBar.getBoundingClientRect().left)/s;let a=1*(this.duration*o).toFixed(4);a>this.duration&&(a=this.duration-.1);const r=void 0===this.__seekingData.dragTime,n=Math.abs(1*a-1*this.__seekingData.dragTime);(r||n>=.5)&&(this.__seekingData.dragTime=a,Ee("onPointerMoveHandler set currentTime, dragTime:"+a+" currentTime:"+this.$refs.video.currentTime),this.currentTime=a),t&&t.preventDefault()},onPointerUpHandler(t,e,i){t.preventDefault(),this.__seekingData&&void 0!==this.__seekingData.dragTime||this.onPointerMoveHandler(null,e,i);const s=this.__seekingData.startTime;let o=this.__seekingData.dragTime;o===this.$refs.video.currentTime&&(o-=.1),s&&this.__seekedTimes.push(Math.round(1e3*s)+":#:"+Math.round(1e3*o)),Ee("onPointerUpHandler dragTime:"+o+" currentTime:"+this.$refs.video.currentTime),this.__seekingData=null,this.isEnd()||(this.showLoading(),this.play(o),this.videoCtlReport({step:13}),this.triggerEvent("barDragComplete",{playTime:o,startDragVideoTime:s})),this.hideSeekingStatus(),this.hideControlBarAfterTimeout(),A.isIOS&&!this.fullscreenStatus&&M.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!1})},onKeyDown(t){const e=this.$el&&this.$el.getBoundingClientRect().top>window.innerHeight||this.$el.getBoundingClientRect().bottom<0,i=document.activeElement&&(["INPUT","TEXTAREA"].indexOf(document.activeElement.tagName)>-1&&-1===document.activeElement.className.indexOf("aria_hidden_abs")||document.activeElement.isContentEditable);if(0===this.midPlayStatus&&!e&&!i){const e=this.$refs.video.currentTime;let i=0;switch(t.keyCode){case 32:case 75:t.preventDefault(),this.onPlaySwitchClick();break;case 74:i=Math.max(this.currentTime-10,.1);break;case 76:i=Math.min(this.currentTime+10,this.duration-1);break;case 37:i=Math.max(this.currentTime-5,.1);break;case 39:i=Math.min(this.currentTime+5,this.duration-1)}i&&this.isPlay()&&(t.preventDefault(),this.showControlBar(),this.play(i),this.videoCtlReport({step:13}),e&&this.__seekedTimes.push(Math.round(1e3*e)+":#:"+Math.round(1e3*i)),this.triggerEvent("keyDragComplete",{playTime:i,startDragVideoTime:e}))}},onPlaybackRateEntryClick(){if(this.fullscreenStatus)this.hideControlBar(),this.showSubSetting(2),this.triggerEvent("rateChange",{action:"show"});else{let t=this.playbackRateInfoIdx;this.$refs.video.playbackRate<this.playbackRateInfo[this.opt.playbackRateBtnInfoDefaultId].rate||t>=this.playbackRateInfo.length-1||t<=0?t=this.opt.playbackRateBtnInfoDefaultId:t++;const e=this.playbackRateInfo[t].rate;this.showControlBar(),this.hideControlBarAfterTimeout(),this.setPlaybackRate(e,t),this.showDefaultPlaybackRate=!0,this.triggerEvent("rateChange",{action:"select"})}},onPlaybackRateSelect(t){const e=this.playbackRateInfo[t].rate;if(this.setPlaybackRate(e,t),this.hideSubSettingAfterTimeout(),this.triggerEvent("rateChange",{action:"select"}),this.showControlBar(),this.isPlay()&&this.hideControlBarAfterTimeout(),this.fullscreenStatus){const e=this.playbackRateInfo[t].name;this.showTopTips("切换到#value#速播放".replace("#value#",e))}},setPlaybackRate(t,e){if(this.$refs.video.playbackRate!==t&&(this.__playbackRateBeforeChange=this.$refs.video.playbackRate,this.$refs.video.playbackRate=t,this.isWcSlPlayer||this.isPlay()||this.$refs.video.play()),e)this.playbackRateInfoIdx=e;else for(let i=0;i<this.playbackRateInfo.length;i++)if(t===this.playbackRateInfo[i].rate){this.playbackRateInfoIdx=i;break}},onResolutionEntryClick(){this.hideControlBar(),this.showSubSetting(1),this.triggerEvent("resolutionChange",{action:"show"})},onResolutionSelect(t){if(this.setResolution(t),this.hideSubSettingAfterTimeout(),this.triggerEvent("resolutionChange",{action:"select"}),this.showControlBar(),this.isPlay()&&this.hideControlBarAfterTimeout(),this.fullscreenStatus){const e=this.resolutionInfo[t].name;this.showTopTips("切换到#value#播放".replace("#value#",e))}},onIPadOrientationChange(){90===window.orientation||-90===window.orientation?(this.setOrientationStatus({status:1}),this.resetVideoFullPortraitAlign()):(this.setOrientationStatus({status:0}),this.setVideoFullPortraitAlign()),setTimeout((()=>{this.fullscreenStatus&&!this.isImmersiveMode&&M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!0,showStatusBar:!0,hideBottomBar:!0})}),250)},onAndroidOrientationChange(t){if(!(this.videoRatio<=1)&&this.fullscreenStatus&&t&&!t.sysLock&&!this.isImmersiveMode){const e=()=>{M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:t.newOrientation,lock:!0})};-1!==[90,-90].indexOf(t.newOrientation)?(this.setOrientationStatus({status:1}),this.resetVideoFullPortraitAlign(),e()):1===this.orientationStatus&&0===t.newOrientation&&(this.setOrientationStatus({status:0}),this.setVideoFullPortraitAlign(),e())}},calcVideoWrpRatio(){const t=this.$refs.videoWrp;this.videoWrpRatio=t?t.clientWidth/t.clientHeight:null},onWindowResize(){this.videoRatio<=1||this.fullscreenStatus&&(this.swipingPos=0,this.isLandscape||Ie.outerWidth===window.outerWidth?this.isLandscape&&Ie.outerWidth===window.outerWidth&&(this.setOrientationStatus({status:0}),this.setVideoFullPortraitAlign(),this.isWcSlPlayer&&this.enableWcSlPlayerFullscreenAfterOrientationChange&&this.$refs.video.exitFullscreen({updateStyleOnly:this.updateStyleOnly})):(this.setOrientationStatus({status:1}),this.resetVideoFullPortraitAlign()))},onOrientationChange(){this.videoRatio<=1||(setTimeout((()=>{this.isLandscape||90!==window.orientation&&-90!==window.orientation?this.$refs.video&&this.isLandscape&&0===window.orientation&&(this.setOrientationStatus({status:0}),this.setVideoFullPortraitAlign(),this.isWcSlPlayer&&this.enableWcSlPlayerFullscreenAfterOrientationChange&&this.$refs.video.exitFullscreen({updateStyleOnly:this.updateStyleOnly})):(this.setOrientationStatus({status:1}),this.resetVideoFullPortraitAlign(),this.$refs.video&&this.isWcSlPlayer&&this.enableWcSlPlayerFullscreenAfterOrientationChange&&this.fullscreenStatus&&this.$refs.video.requestFullscreen(window.orientation,{updateStyleOnly:this.updateStyleOnly}))}),250),B.os.iphone||(this.fullscreenStatus&&90===window.orientation?this.androidLandscapeFullOrientation=90:this.androidLandscapeFullOrientation=0))},onIOSPageStateChange(t){!this.fullscreenStatus&&t&&t.active&&(M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!0}),M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!1}),M.invoke("setNavigationBarColor",{wxcolor:{light:"#FFFFFF",dark:"#191919"},alpha:window.immersiveMode?0:1}))},onVisibilityChange(){Re()||(this.fullscreenStatus&&this.needFeFullscreen?this.syncSubscribeStatus():this.__needSyncSubscribeStatus=!0),!Re()&&B.os.iphone&&this.fullscreenStatus&&!this.isLandscape&&M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!this.isImmersiveMode,orientation:0,animate:!1}),this.isWcSlPlayer||(Re()?this.hasBegunPlaying()&&this.isPlay()&&(this.pause4outer(),this.__pausedWhenInvisible=!0):this.__pausedWhenInvisible&&(delete this.__pausedWhenInvisible,this.hasBegunPlaying()&&!this.isEnd()&&this.play4outer()))},onNetworkChange(t){t&&(t.networkType||(t.networkType=t.netType),t.networkType&&t.simType&&(this.__lastNetworkType&&this.__lastNetworkType.networkType===t.networkType&&this.__lastNetworkType.simType===t.simType||(Pe.isMobileNetwork(t.networkType)&&1!==t.simType&&this.__lastNetworkType&&("wifi"===this.__lastNetworkType.networkType||Pe.isNoneNetwork(this.__lastNetworkType.networkType))&&(this.__isUserPause=!1,this.__pauseNetType=null,!this.isPlay()&&!this.isEnd()&&this.isPause()&&this.hasBegunPlaying()?(this.__isUserPause=!0,this.__pauseNetType=this.__lastNetworkType.networkType):this.isPlay()&&("wifi"===this.__lastNetworkType.networkType&&Pe.isVideoNeedFlowNotice(this.opt.flow,2)||Pe.isNoneNetwork(this.__lastNetworkType.networkType)&&Pe.isVideoNeedFlowNotice(this.opt.flow,4))&&this.showFlowNotice()),this.__lastNetworkType={networkType:t.networkType,simType:t.simType})))},setResolution(t){if(this.resolutionInfoIdx!==t){const e=this.resolutionInfo[this.resolutionInfoIdx],i=this.resolutionInfo[t],s=this.$refs.video;if(this.isWcSlPlayer)s.resolutionSrc=i.src;else{s.pause(),this.setVideoSnapshot();const t=s.currentTime,e=s.playbackRate;this.$nextTick((()=>{s.src=i.src,s.play(),this.play(t),this.setPlaybackRate(e),this.onResolutionchange()}))}this.__resolutionInfoBeforeChange=e,this.resolutionInfoIdx=t}},setVideoSnapshot(){if(!this.isWcSlPlayer)try{const t=this.$refs.video,e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,i.drawImage(t,0,0,e.width,e.height),this.videoSnapshot=e.toDataURL("image/jpeg",0)}catch(t){this.videoSnapshot="",console.error(t)}},setScreenshot(){Ie.swipeBackSupport&&M.invoke("handleMPPageAction",{action:"takeSnapshot"},(t=>{-1!==t.err_msg.indexOf("ok")&&(this.videoSnapshot="",setTimeout((()=>{this.screenshot="data:image/jpeg;base64,"+t.data,this.triggerEvent("screenshotChange",this.screenshot)}),500))}))},setNativeSnapshot(t){if(Ie.swipeBackSupport){if(t&&!this.screenshot)return;M.invoke("handleMPPageAction",{action:"setSnapshotOnWindow",data:t?this.screenshot:null,show:t})}},showLoading(){this.__hasShownLoading&&this.$refs.video&&this.$refs.video.currentTime>1||(this.__hasShownLoading=!0,this.__resetShowingLoadingTimeoutId&&(clearTimeout(this.__resetShowingLoadingTimeoutId),delete this.__resetShowingLoadingTimeoutId),this.__resetShowingLoadingTimeoutId=setTimeout((()=>{this.__hasShownLoading=!1}),1e3),this.__showingLoadingTimeoutId&&(clearTimeout(this.__showingLoadingTimeoutId),delete this.__showingLoadingTimeoutId),this.__showingLoadingTimeoutId=setTimeout((()=>{this.__firstShowLoadingTime||(this.__firstShowLoadingTime=(new Date).getTime()),this.setLoadingStatus({status:1})}),800))},hideLoading(){this.setLoadingStatus({status:0}),this.firstLoadingTime||(this.firstLoadingTime=this.__firstShowLoadingTime?(new Date).getTime()-this.__firstShowLoadingTime:0),this.__showingLoadingTimeoutId&&(clearTimeout(this.__showingLoadingTimeoutId),delete this.__showingLoadingTimeoutId),this.videoSnapshot&&(this.videoSnapshot="")},showControlBar(){1!==this.controlBarStatus&&(this.__touchVideoTimeoutId&&(clearTimeout(this.__touchVideoTimeoutId),delete this.__touchVideoTimeoutId),this.__hidingControlBarTimeoutId&&(clearTimeout(this.__hidingControlBarTimeoutId),delete this.__hidingControlBarTimeoutId),this.__userPlayTime||this.setControlBarStatus({status:1}),this.triggerEvent("showControlBar"))},hideControlBar(){0===this.controlBarStatus||101===this.controlBarStatus||this.$refs.ariaSwitch.checked||(this.__hidingControlBarTimeoutId&&clearTimeout(this.__hidingControlBarTimeoutId),this.setControlBarStatus({status:101}),this.__hidingControlBarTimeoutId=setTimeout((()=>{this.setControlBarStatus({status:0}),this.showDefaultPlaybackRate=!1,this.triggerEvent("hideControlBar")}),100))},triggerAriaSwitch(){this.$refs.ariaSwitch.checked?this.showControlBar():this.hideControlBar()},hideControlBarAfterTimeout(){this.__touchVideoTimeoutId&&clearTimeout(this.__touchVideoTimeoutId),this.__touchVideoTimeoutId=setTimeout((()=>{this.seekingStatus?this.hideControlBarAfterTimeout():this.isPlay()&&this.hideControlBar()}),5e3)},showLikedCommentTips(){1!==this.likedCommentTipsStatus&&(this.likedCommentTipsStatus=1,this.triggerEvent("likedCommentTipsStatusChange",!0))},hideLikedCommentTips(){1===this.likedCommentTipsStatus&&(this.likedCommentTipsStatus=101,setTimeout((()=>this.likedCommentTipsStatus=0),100),this.triggerEvent("likedCommentTipsStatusChange",!1)),this.__hideLikedCommentTipsTimeoutId&&(clearTimeout(this.__hideLikedCommentTipsTimeoutId),this.__hideLikedCommentTipsTimeoutId=null)},showCover(){this.setCoverStatus({status:1})},hideCover(){this.setCoverStatus({status:0})},showMidPlayBtn(){this.setMidPlayStatus({status:1})},hideMidPlayBtn(){this.setMidPlayStatus({status:0})},showSubscribeBtn(t,e){"number"!=typeof t&&(t=1),(e||0===window.isFans&&Ie.supportSubscribe&&(0===this.subscribeStatus&&1===t||1===this.subscribeStatus&&2===t))&&(this.subscribeStatus=t,this.triggerShowSubscribeEvent())},triggerShowSubscribeEvent(){1===this.subscribeStatus&&this.fullscreenStatus&&this.triggerEvent("showSubscribe")},hideSubscribeBtn(){this.subscribeStatus&&(this.subscribeStatus=3)},syncSubscribeStatus(t=3){t>0&&setTimeout((()=>{S({url:"/mp/immersive_player?action=check_contact&biz_username=".concat(this.opt.bizUserName,"&__biz=").concat(this.opt.__biz),dataType:"json",async:!1,success:t=>{1===t.subscribed&&0===window.isFans?(this.showSubscribeBtn(2,!0),window.isFans=1):0===t.subscribed&&1===window.isFans&&(this.hideSubscribeBtn(),window.isFans=0)},complete:()=>this.syncSubscribeStatus(--t)})}),500)},changeFullscreenLandscapeMode(t){if(B.os.ipad)return this.exitFullscreen();const e=this.updateStyleOnly;this.isWcSlPlayer&&(90===t?(this.$refs.video.requestFullscreen(t,{updateStyleOnly:e}),this.showControlBar(),this.hideControlBarAfterTimeout()):this.$refs.video.exitFullscreen({updateStyleOnly:e})),(()=>{M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:t,lock:!!B.os.android}),this.isImmersiveMode&&M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:Boolean(t),orientation:t,animate:!1})})(),this.triggerEvent("fullLandscapeModeChange",t)},enterFullscreen(){if(!this.fullscreenStatus)return this.isWcSlPlayer||this.isFeFullscreen?(this.showPauseBtn=!this.opt.preCreate,this.__originFullscreenStatus=!0,this.opt.preCreate||(this.preventOperating(3),setTimeout((()=>{this.resumeOperating()}),500)),this.setFullscreenStatus({status:1}),this.handleFullscreenChange({state:!0,type:this.isImmersiveMode?"immersive":"frontend"}),void(this.opt.preCreate||(this.isImmersiveMode||(A.isIOS?(this.swipingPos=0,this.setScreenshot(),setTimeout((()=>{M.invoke("setNavigationBarColor",{color:"#000000",alpha:0}),M.invoke("handleDeviceInfo",{action:"enableFullScreenLayout",enable:!0}),M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!0,orientation:B.os.ipad?window.orientation:0,animate:!1,showStatusBar:!0,hideBottomBar:!0},(t=>{-1!==t.err_msg.indexOf(":ok")&&(A.isIOS&&M.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!0}),B.os.ipad&&this.onIPadOrientationChange())}))}),70)):M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!0,orientation:0})),this.enterFullscreenEffect()))):void this.callJsapiFullscreen()},enterFullscreenEffect(){this.enableWcSlPlayerFullscreenAfterOrientationChange=!!this.isImmersiveMode||"update-style-only",setTimeout((()=>this.wcSlPlayerTransitionDuration=300),500),M.on("menu:haokan",this.onLikedCommentWrite),M.on("menu:share:appmessage",this.showSubscribeBtn),M.on("menu:share:timeline",this.showSubscribeBtn),this.needFeFullscreen&&(window.addEventListener("unload",this.exitFullscreen),M.on("onMPCustomMenuItemClick",this.onFullscreenMenuClick),B.os.android&&!this.isImmersiveMode&&M.on("onExitFullscreen",this.__onAndroidExitFullscreen=()=>this.exitFullscreen({directExit:!0}))),this.isImmersiveMode&&M.on("onNavigationBarRightButtonClick",this.onShowFullscreenMenu),B.os.iphone||B.os.android?(window.addEventListener("orientationchange",this.onOrientationChange),B.os.android?M.on("onOrientationsChange",this.onAndroidOrientationChange):(this.isFeFullscreen||this.isWcSlPlayer&&!this.isImmersiveMode)&&window.addEventListener("resize",this.onWindowResize)):B.os.ipad&&this.isFeFullscreen&&(this.onIPadOrientationChange(),window.addEventListener("orientationchange",this.onIPadOrientationChange)),M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:0,lock:this.videoRatio<=1})},exitFullscreen(t={}){this.fullscreenStatus&&((!this.isLandscape||B.os.ipad||t.directExit)&&this.triggerEvent("exitFullscreen"),this.showPauseBtn=!0,this.enableWcSlPlayerFullscreenAfterOrientationChange=!0,this.__originFullscreenStatus=!1,this.setFullscreenStatus({status:101}),setTimeout((()=>{A.isIOS&&(this.setNativeSnapshot(!0),M.invoke("setNavigationBarColor",{wxcolor:{light:"#FFFFFF",dark:"#191919"},alpha:window.immersiveMode?0:1}),setTimeout((()=>{M.invoke("handleDeviceInfo",{action:"enableFullScreenLayout",enable:!!window.immersiveMode},(()=>{this.screenshot="",this.triggerEvent("screenshotChange",""),setTimeout((()=>this.setNativeSnapshot(!1)),120)}))}),150)),M.invoke("handleDeviceInfo",{action:"enableFullScreen",enable:!1,orientation:0,animate:!1},(t=>{-1!==t.err_msg.indexOf(":ok")&&(A.isIOS&&M.invoke("handleDeviceInfo",{action:"disableInteractivePop",disable:!1}),this.handleFullscreenChange({state:!1,type:this.isImmersiveMode?"immersive":"frontend"}))}))}),150),M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:0,lock:this.videoRatio<=1}),this.exitFullscreenEffect(),A.isAndroid&&t.directExit&&this.onOrientationChange())},exitFullscreenEffect(){this.wcSlPlayerTransitionDuration=this.opt.useImmersiveMode?300:50,M.remove("menu:haokan",this.onLikedCommentWrite),M.remove("menu:share:appmessage",this.showSubscribeBtn),M.remove("menu:share:timeline",this.showSubscribeBtn),this.isImmersiveMode&&M.remove("onNavigationBarRightButtonClick",this.onShowFullscreenMenu),this.needFeFullscreen&&(window.removeEventListener("unload",this.exitFullscreen),M.remove("onMPCustomMenuItemClick",this.onFullscreenMenuClick),this.isFeFullscreen&&B.os.android&&M.remove("onExitFullscreen",this.__onAndroidExitFullscreen)),B.os.iphone||B.os.android?(window.removeEventListener("orientationchange",this.onOrientationChange),B.os.android?M.remove("onOrientationsChange",this.onAndroidOrientationChange):(this.isFeFullscreen||this.isWcSlPlayer&&!this.isImmersiveMode)&&window.removeEventListener("resize",this.onWindowResize)):B.os.ipad&&this.isFeFullscreen&&window.removeEventListener("orientationchange",this.onIPadOrientationChange)},callH5Fullscreen(){this.__jsapiFullscreenTimeoutId&&(clearTimeout(this.__jsapiFullscreenTimeoutId),this.__jsapiFullscreenTimeoutId=null);const t=this.$refs.video;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()},callJsapiFullscreen(){if(this.__jsapiFullscreenTimeoutId&&(clearTimeout(this.__jsapiFullscreenTimeoutId),this.__jsapiFullscreenTimeoutId=null),!this.supportNativeFullPlayer||this.__jsapiFullscreenErrCnt>=2)return void this.callH5Fullscreen();B.os.android||this.pause4outer({triggerEvent:!1});const t=this.$refs.video,e=this.$store.state.cgiData,i=window.source||"",s=window.msg_link.html(!1),o=window.user_name||(e?e.user_name:"")||"",a=window.nickname||(e?e.nick_name:"")||"";let r="";if(B.os.ios){const e=document.createElement("canvas"),i=e.getContext("2d");e.style.width=this.opt.videoWidth+"px",e.width=this.opt.videoWidth,e.style.height=this.opt.videoHeight+"px",e.height=this.opt.videoHeight,i.drawImage(t,0,0,this.opt.videoWidth,this.opt.videoHeight),r=e.toDataURL("image/jpeg",1)}const n=t.getBoundingClientRect(),l={left:n.left,top:n.top,height:n.bottom-n.top,width:n.right-n.left},h=this.opt.extinfo,d=h&&h.vid||"",c={action:"enterEmbedMpVideo",mpBizUin:this.opt.__biz||"",mpAppMsgId:this.opt.mid||"",mpIndex:this.opt.idx||"",mpUrl:s,bizUsrName:o,bizNickName:a,videoUrl:k.addParam(this.opt.src,"video_md5",this.opt.videoMd5||""),videoTitle:this.opt.videoTitle,videoCurrTime:this.getCurTime(),videoWidth:this.opt.videoWidth,videoHeight:this.opt.videoHeight,videoThumbUrl:this.opt.cover,videoDuration:1*this.opt.duration,videoVid:d,playerX:l.left,playerY:l.top,playerWidth:l.width,playerHeight:l.height,subscene:1*i,headImgUrl:this.opt.headImgUrl,currFrameData:r,forbidForward:this.canShareVideo?0:1};r&&(this.__jsapiFullscreenTimeoutId=setTimeout((()=>{this.setFullscreenStatus({status:0})}),2e3)),M.invoke("handleMPPageAction",c,(t=>{this.__jsapiFullscreenTimeoutId&&(clearTimeout(this.__jsapiFullscreenTimeoutId),this.__jsapiFullscreenTimeoutId=null),/:ok$/.test(t.err_msg)?(this.setFullscreenStatus({status:1}),this.handleFullscreenChange({state:!0,type:"jsapi"})):(this.setFullscreenStatus({status:0}),B.os.android||this.play4outer(NaN,{triggerEvent:!1}),this.__jsapiFullscreenErrCnt++)})),B.os.android&&(window.CustomFullscreenApi&&"function"==typeof window.CustomFullscreenApi._customEnterFullscreen&&window.CustomFullscreenApi._customEnterFullscreen(!0),this.callH5Fullscreen())},onJsapiExitFullscreen(t){if(!t||"onExitMpVideoFullPage"!==t.action)return;const e=this.opt.extinfo,i=e&&e.vid||"";if(i&&i===t.videoVid){if(!B.os.android){let e=1*t.videoCurrTime;e=-1===e?NaN:e;let i=this.duration;parseInt(i,10)===parseInt(e,10)||e>i?this.onVideoEnded():(this.__statusBeforeSeek=1,this.play4outer(e,{triggerEvent:!1}))}this.fullscreenStatus&&this.handleFullscreenChange({state:!1,type:"jsapi"})}},showResolutionEntry(){this.setResolutionEntryStatus({status:1})},hideResolutionEntry(){this.setResolutionEntryStatus({status:0})},showSubSetting(t){this.__hideSubSettingTimeoutId&&clearTimeout(this.__hideSubSettingTimeoutId),this.setSubSettingStatus({status:t})},hideSubSetting(){this.setSubSettingStatus({status:0})},hideSubSettingAfterTimeout(){if(0===this.subSettingStatus)return;this.__hideSubSettingTimeoutId&&clearTimeout(this.__hideSubSettingTimeoutId);const t=this.subSettingStatus;this.setSubSettingStatus({status:100+t}),this.__hideSubSettingTimeoutId=setTimeout((()=>{this.setSubSettingStatus({status:0}),1===t?this.triggerEvent("resolutionChange",{action:"hide"}):2===t&&this.triggerEvent("rateChange",{action:"hide"})}),250)},clickPlaySwitch(t,e){0===this.banOprStatus&&(this.isPlay()?(t||this.videoCtlReport({step:12}),this.triggerEvent("clickPlaySwitch",!1),this.pause4outer({tapType:t,triggerEvent:e})):(this.triggerEvent("clickPlaySwitch",!0),this.play4outer(NaN,{tapType:t})))},preventOperating(t){this.setBanOprStatus({status:t||1})},resumeOperating(){this.setBanOprStatus({status:0})},consoleLog(t,e){const i=["vid:","videosrc:"];this.opt&&this.opt.extinfo&&this.opt.extinfo.vid&&(i[0]+=this.opt.extinfo.vid),this.$refs.video&&this.$refs.video.src&&(i[1]+=this.$refs.video.src),console.info("videoplayer "+t+";"+i.join(";")),!0===e&&T.info("videoplayer "+t+";"+i.join(";"))},triggerEvent(t,e){if("timeupdate"!==t||"timeupdate"===t&&this.__enableTimeupdateLog){"timeupdate"===t&&(this.__enableTimeupdateLog=!1,setTimeout((()=>{this.__enableTimeupdateLog=!0}),5e3));try{let i="";const s=Object.prototype.toString.call(e);i="[object String]"===s?e:"[object Object]"===s||"[object Array]"===s?JSON.stringify(e):"no params",this.consoleLog("trigger:"+t+";arg:"+i+";")}catch(s){}}const i=this[t+"InnerHandler"];i&&i.call(this,e),this.emitEvent(t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase())),e)},emitEvent(t,...e){this.$refs.video&&t&&this.$emit(t,...e)},errorInnerHandler(){this.isWcSlPlayer||this.$refs.video.removeAttribute("src")},loadingInnerHandler(t){this.triggerEvent("ready",t)},readyInnerHandler(t){this.triggerEvent("loaded",t)},loadedInnerHandler(t){if((this.checkAndResetSecOpenAutoPlay()||t&&t.autoplay||this.autoplay)&&A.isWechat)return this.videoCtlReport({step:15}),this.__hasReportedBeginPlay=!0,void this.triggerEvent("readyBeginPlay",t);this.setBeginPlayStatus()},readyBeginPlayInnerHandler(t){setTimeout((()=>this.play(this.initialTime||0)),0),this.triggerEvent("beginPlay",t),this.isWcSlPlayer||null!==this.__replaySec&&0!==this.__replaySec||!B.os.ios||(this.$refs.video.currentTime=.1)},beginPlayInnerHandler(t){const e=this.$refs.video,i=()=>{this.__userPlayTime=!0,this.__hasBegunPlaying=!0,this.showCover(),this.hideMidPlayBtn(),this.showLoading(),this.opt.flowNotice&&this.firstLoadedFlowNoticeJudge()};setTimeout((()=>{try{if(this.__continueSec&&(this.__replaySec=this.__continueSec,this.__continueSec=null),this.consoleLog("set continue:"+this.__replaySec),this.__firstPlayStart=Date.now(),this.isWcSlPlayer)t&&t.replay?(this.setControlBarStatus({status:0}),this.__canplay=!0,this.__statusBeforeSeek=1,this.bufferedPercent=0,this.currentTime=0,e.currentTime=0):this.autoplay||(this.__canplay=!0,e.play()),i();else{const t=e.play();"object"==typeof t?t.then(i).catch((t=>{"AbortError"!==t.name&&"NotAllowedError"!==t.name||M.invoke("getNetworkType",{},(()=>{e.play().then(i).catch((t=>{"AbortError"!==t.name&&"NotAllowedError"!==t.name||(this.setBeginPlayStatus(),b.setSum(114217,16,1))}))}))})):i()}}catch(hi){this.consoleLog("play error:"+hi.toString())}}))},replayInnerHandler(){this.videoCtlReport({step:9}),this.afterReplay()},endInnerHandler(){this.setAccessPlayBtnStatus({status:3}),this.__canplay=!1,this.__hasBegunPlaying=!1,this.hidePlayControl(),this.hideTouchOprBar(),this.hideSubSettingAfterTimeout()},touchVideoInnerHandler(t={}){if(this.opt.blockTouchVideo||this.seekingStatus||this.__userPlayTime)return!1;!this.__canplay||this.isEnd()&&this.opt.hideControlBarAtEnd?this.hideControlBar():(!0===t.isShow||0===this.controlBarStatus?this.showControlBar():this.hideControlBar(),this.isPlay()&&this.hideControlBarAfterTimeout(),this.hideSubSettingAfterTimeout())},firstLoadedFlowNoticeJudge(){A.isWechat&&this.__lastNetworkType&&this.__lastNetworkType.networkType&&this.__lastNetworkType.simType&&Pe.isMobileNetwork(this.__lastNetworkType.networkType)&&1!==this.__lastNetworkType.simType&&Pe.isVideoNeedFlowNotice(this.opt.flow,this.flowNum?5:1)&&this.showFlowNotice()},showTopTips(t){this.__topTipsTimeoutId&&clearTimeout(this.__topTipsTimeoutId),this.topTips=t,this.__topTipsTimeoutId=setTimeout((()=>{this.__topTipsTimeoutId=null,this.topTips=""}),3500)},showFlowNotice(){const t=this.flowNum?2:1;this.videoCtlReport({step:16,noticeType:t}),this.triggerEvent("flowNotice",{flow:parseInt(1024*this.opt.flow),noticeType:t}),this.showTopTips(this.flowNum?"正在使用流量播放，该视频预计消耗".concat(this.flowNum,"M"):"当前为非Wi-Fi环境，请注意流量消耗")},hidePlayControl(){this.__isUserPause&&A.isWechat&&("wifi"===this.__pauseNetType&&Pe.isVideoNeedFlowNotice(this.opt.flow,3)||Pe.isNoneNetwork(this.__pauseNetType)&&Pe.isVideoNeedFlowNotice(this.opt.flow,4)?this.showFlowNotice():(this.__isUserPause=!1,this.__pauseNetType=null)),this.hideMidPlayBtn(),this.hideControlBarAfterTimeout()},showPlayControl(){this.isEnd()||this.showControlBar()},reinitVideo(){this.__canplay=!1,this.removeVideo=!0,this.$nextTick((()=>{this.removeVideo=!1,this.$nextTick((()=>this.triggerEvent("loading")))}))},fallbackFromWcSlVideoToH5Player(){this.consoleLog("fallback from wcslplayer to h5player: "+this.$refs.video.error),C.__useWcSlPlayer=this.isWcSlPlayer=!1,this.__fallbackFromWcSlVideoToH5Player=!0,this.reinitVideo()},afterReplay(){this.__hasBegunPlaying=!0,this.__userPlayTime=!0,this.__firstPlayStart=Date.now(),this.showLoading(),this.play(),this.triggerEvent("afterReplay")},supportWcSlPlayer(){return!window.__failConfigWxOpen&&(!this.__fallbackFromWcSlVideoToH5Player&&Ie.wcSlPlayerSupport)},videoCtlReport(t={}){let e=this.opt.extinfo;if(e){let i={__biz:this.opt.__biz,step:t.step,__biz:this.opt.__biz,vid:e.vid,hit_bizuin:e.hit_bizuin,hit_vid:e.hit_vid,traceid:e.pageplayer.getTraceId(),orderid:e.pageplayer.getOrderid(),ori_status:e.pageplayer.getOriStatus(),type:void 0!==this.opt.videoReportType?this.opt.videoReportType:-1,fromid:e.pageplayer.getFromid()};t.step>=16?(i.remind_traffic_size=parseInt(1024*this.opt.flow),i.traffic_reminder_type=t.noticeType,n.commReport(i)):n.report(i)}},replay(){this.hideMidPlayBtn(),this.triggerEvent("readyBeginPlay",{replay:!0}),this.triggerEvent("replay")},resetVideo(){this.autoplay=!1,this.initialTime=0,this.showCover(),this.reinitVideo(),this.checkAndResetSecOpenAutoPlay()},changeStatus(t){if(!Ie.statusDefine[t.status]||t.subStatus&&!Ie.subStatusDefine[t.subStatus]&&"error"!==t.status)return;if(this.status===t.status&&this.subStatus===t.subStatus)return;let e=0;"end"===t.status||"error"===t.status?(this.__playingBufferingStartTime=null,this.__userPlayTime=!1):"pause"===t.status?this.__playingBufferingStartTime=null:"play"===t.status&&"playing"===t.subStatus&&null!==this.__playingBufferingStartTime?(e=Date.now()-this.__playingBufferingStartTime,this.__playingBufferingStartTime=null):this.hasBegunPlaying()&&this.__canplay&&!this.__userPlayTime&&"loading"===t.status&&"waiting"===t.subStatus&&null===this.__playingBufferingStartTime&&(this.__playingBufferingStartTime=Date.now());const i=this.status,s=this.subStatus;this.setStatus({status:t.status,subStatus:t.subStatus});const o=["player statusChange, preStatus:",i,"; status:",this.status,"; preSubStatus:",s,"; subStatus:",this.subStatus,"; video_duration:",this.$refs.video?this.$refs.video.duration:"0","; getvinfo_duration:",this.duration,"; current_time:",this.$refs.video?this.$refs.video.currentTime:"0","; play_total_time:",this.getPlayTotalTime()].join("");this.consoleLog(o),"error"===t.status&&window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&(this.consoleLog("client api get video begin: "+this.src),this.src?M.invoke("request",{url:this.src,method:"GET",data:{},header:{Range:"bytes=0-1"}},(e=>{this.consoleLog("client api get video end: "+this.src);const i=/^https?:\/\/\[/.test(this.src)?"Player:IPv6Error":"Player:IPv4Error",s="errorCode: ".concat(t.subStatus,"; errorMsg: ").concat(t.errorMsg,"; src: ").concat(this.src,"; ").concat(window.__second_open__?"secopen":"h5","; res: ").concat(JSON.stringify(e));window.WX_BJ_REPORT.BadJs.report(i,s)})):window.WX_BJ_REPORT.BadJs.report("Player:IPv4Error","errorCode: ".concat(t.subStatus,"; errorMsg: ").concat(t.errorMsg,"; src: ").concat(this.src,"; ").concat(window.__second_open__?"secopen":"h5"))),Ee(o),this.triggerEvent("statusChange",{currentTime:this.$refs.video&&this.$refs.video.currentTime,preStatus:i,preSubStatus:s,status:this.status,subStatus:this.subStatus}),e&&(this.triggerEvent("playingBufferingTime",{bufferingTime:e}),this.useQuic&&(b.setSum(237895,15,e),b.setSum(237895,18,1),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:UseQuicBufferingTime",(window.__second_open__?"secopen:":"h5:")+e,{mid:"mmbizwap:quic_Monitor",view:"wap_business"})),this.compare1&&(b.setSum(237895,16,e),b.setSum(237895,19,1)),this.compare2&&(b.setSum(237895,17,e),b.setSum(237895,20,1)))},play(t){const e=this.$refs.video;if(!this.isEnd())if(this.isWcSlPlayer&&e&&null==e.readyState)"number"!=typeof this.initialTime||0===this.initialTime?this.__playQueue[0]={sec:t}:(this.__lastPlayTime=t,this.currentTime=t);else if(e&&0!==e.readyState){t*=1;try{if(isNaN(t)||"number"!=typeof t)this.__canplay&&this.isPause()||0===e.currentTime?e.play():e.currentTime=0;else{const i=this.duration;t>=i&&(t=i-1),t<0&&(t=0),t=1*(1*t).toFixed(4),this.__lastPlayTime=t,this.currentTime=t,e.currentTime===t?e.play():e.currentTime=t}}catch(hi){0===e.currentTime?e.play():e.currentTime=0,console.error(hi)}}else this.__playQueue[0]={sec:t}},pause(t={}){t.withoutPauseBtn&&(this.showPauseBtn=!1);const e=this.$refs.video;e&&null!=e.readyState&&0!==e.readyState&&(this.__replaySec=null,this.__waitingTimeoutId&&(clearTimeout(this.__waitingTimeoutId),this.__waitingTimeoutId=null),e.pause(),Ee(this.id+":pause function"))},play4outer(t,e={}){this.play(t),!1!==e.triggerEvent&&this.triggerEvent("userplay",{tapType:e.tapType||0}),this.hideMidPlayBtn(),this.hidePlayControl()},pause4outer(t={}){this.hideLoading(),this.pause(),!1!==t.triggerEvent&&this.triggerEvent("userpause",{tapType:t.tapType||0}),this.hideControlBar(),this.showPlayControl()},afterFirstLoaded(){this.__userPlayTime&&(this.__userPlayTime=!1,this.reportRealLoadingTime(),this.resumeOperating(),this.triggerEvent("afterfirstloaded"))},reportRealLoadingTime(){const t=parseInt(Date.now()-(this.__firstPlayStart||Date.now()));console.info("[视频点击播放耗时]",t),this.__firstPlayStart=null,this.triggerEvent("firstBufferingTime",{bufferingTime:t,initialTime:this.initialTime}),this.useQuic&&(b.setSum(237895,9,t),t>3e5&&window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("WcSlPlayer:UseQuicfirstPlayTime",(window.__second_open__?"secopen:":"h5:")+t,{mid:"mmbizwap:quic_Monitor",view:"wap_business"})),this.compare1&&b.setSum(237895,10,t),this.compare2&&b.setSum(237895,11,t)},hasSeeked(){return!!this.__hasSeeked},getCurTime(){return this.$refs.video&&this.$refs.video.currentTime||0},getPlaybackRate(){return this.$refs.video&&this.$refs.video.playbackRate||1},getResolutionInfo(){if(this.$refs.video){const t=this.isWcSlPlayer?this.$refs.video.resolutionSrc:this.$refs.video.src;return this.resolutionInfo?this.resolutionInfo.filter((e=>e.src===t))[0]:null}},getSeekedTimes(){return this.__seekedTimes},getPlayTotalTime(){return this.endCountTime(),this.$refs.video&&(this.__lastPlayTime=this.$refs.video.currentTime),this.__totalPlayTime},getLog(){const t=this.log||{};return{hasended:t.hasended,last_ms:Math.floor(1e3*(t.lastsec||0)),duration_ms:Math.floor(1e3*(t.duration||0)),video_error:t.video_error||0,video_error_code:t.video_error_code||0,loadwait:t.loadwait||0}},isPlay(){return!!this.$refs.video&&(!this.$refs.video.paused&&!this.isEnd())},isPause(){return!this.$refs.video||!!this.$refs.video.paused},isEnd(){return!!this.$refs.video&&!!this.$refs.video.ended},hasBegunPlaying(){return this.__hasBegunPlaying},setBeginPlayStatus(){this.opt.preCreate||this.showMidPlayBtn(),setTimeout((()=>{this.hideLoading()}))},showToast(t,e){this.$refs.toast.open(t,e)},shareVideo(){this.opt.extinfo&&this.opt.extinfo.preview?window.weui.alert("预览状态下无法分享视频"):this.canShareVideo&&((this.needFeFullscreen||B.os.ipad)&&this.supportImmersiveMode?(M.invoke("handleMPPageAction",{action:"share"}),this.triggerEvent("shareVideo"),this.showSubscribeBtn()):this.supportNativeFullPlayer&&this.callJsapiShareVideo("shareEmbedMpVideo"))},vibrate(){M.invoke("vibrateShort",{style:"medium"},(t=>{console.log("vibrateShort",t)}))},praiseVideo(){this.opt.extinfo&&this.opt.extinfo.preview?window.weui.alert("预览状态下无法点赞视频"):(this.triggerEvent("praiseVideo"),this.isPraised&&(this.vibrate(),this.showSubscribeBtn()))},likeVideo(){if(!this.canLikeVideo)return void window.weui.alert("该视频不支持在看");const t=()=>{this.triggerEvent("likeVideo"),this.isLiked?(this.vibrate(),this.showControlBar(),this.hideControlBarAfterTimeout(),this.showLikedCommentTips(),this.showSubscribeBtn(),this.__hideLikedCommentTipsTimeoutId=setTimeout(this.hideLikedCommentTips,3e3)):this.hideLikedCommentTips()};Ie.supportZaikanAutho&&!this.isLiked?setTimeout((()=>{const e=setTimeout((()=>{1===this.fullscreenStatus&&this.isLandscape&&!B.os.ipad&&this.changeFullscreenLandscapeMode(0)}),100);WeixinJSBridge.invoke("handleHaokanAction",{action:"checkSyncHaoKanPermission"},(i=>{clearTimeout(e);0!==i.result&&t()}))}),250):t()},writeLikedComment(){WeixinJSBridge.invoke("handleHaokanAction",{action:"checkSyncCommentPermission"},(function(t){0!==t.result&&M.invoke("handleHaokanAction",{action:"shareToGoodLook"})}))},onLikedCommentWrite(t){if(this.canLikeVideo){if(this.fullscreenStatus&&this.needFeFullscreen&&this.supportImmersiveMode){let e=this,i=t;Ie.supportZaikanAutho?setTimeout((()=>{WeixinJSBridge.invoke("handleHaokanAction",{action:"checkSyncHaoKanPermission"},(function(t){0!==t.result&&(e.triggerEvent("likeVideo",i),e.showSubscribeBtn(),e.isLiked?(e.showControlBar(),e.hideControlBarAfterTimeout(),e.showSubscribeBtn(),e.__hideLikedCommentTipsTimeoutId=setTimeout(e.hideLikedCommentTips,3e3)):e.hideLikedCommentTips())}))}),250):(e.triggerEvent("likeVideo",i),e.showSubscribeBtn(),e.isLiked?(e.showControlBar(),e.hideControlBarAfterTimeout(),e.showSubscribeBtn(),e.__hideLikedCommentTipsTimeoutId=setTimeout(e.hideLikedCommentTips,3e3)):e.hideLikedCommentTips())}}else window.weui.alert("该视频不支持在看")},openSourcePage(){this.isImmersiveMode||this.opt.preCreate?F.openUrlWithExtraWebview((this.opt.href||location.href).replace("#rd","").replace("item_show_type=16","").replace(/&scene=\d*/,"")+"&scene=206#rd"):this.exitFullscreen(),this.triggerEvent("openSourcePage")},clickSubscribe(){0===window.isFans&&Ie.supportSubscribe&&1===this.subscribeStatus&&(M.invoke("quicklyAddBrandContact",{username:this.opt.bizUserName,scenenote:location.href||"",scene:203},(t=>{if(t.err_msg.indexOf("ok")>-1)this.showSubscribeBtn(2),window.isFans=1;else if(B.os.harmony&&B.cpVersion("5.0",1,!0)&&A.getInner()<"f3100422"){const t=cgiData.appuin||cgiData.biz;location.href="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz="+t+"&scene=112#wechat_redirect"}})),this.triggerEvent("clickSubscribe"))},checkAndResetSecOpenAutoPlay(){const t=this.$store.state.cgiData.iframeIdx,e=document.getElementById("js_mp_video_container_".concat(t)),i=e&&e.getAttribute("__sec_open_auto_play__");return e&&e.removeAttribute("__sec_open_auto_play__"),i},callJsapiShareVideo(t){if(this.__loadingCoverBase64)return;const e=()=>{const e=this.$store.state.cgiData,i=window.msg_link.html(!1),s=window.user_name||(e?e.user_name:"")||"",o=window.nickname||(e?e.nick_name:"")||"",a=this.opt.extinfo,r=a&&a.vid||"",n={action:t,mpUrl:i,bizUsrName:s,bizNickName:o,videoVid:r,videoUrl:k.addParam(this.opt.src,"video_md5",this.opt.videoMd5||""),videoThumbUrl:this.opt.cover,videoThumbData:this.__coverBase64,videoTitle:this.opt.videoTitle,videoDuration:1*this.opt.duration};M.invoke("handleMPPageAction",n,(()=>{}))};this.__loadingCoverBase64=!0,this.getCoverBase64((()=>{this.__loadingCoverBase64=!1,e()}))},getCoverBase64(t){if(this.__coverBase64)"function"==typeof t&&t({cover64:this.__coverBase64||""});else{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{e.onload=null,e.onerror=null;try{let t=e.naturalWidth||e.width,i=e.naturalHeight||e.height,s=document.createElement("canvas"),o=s.getContext("2d");s.width=t,s.height=i,s.style.width=t+"px",s.style.height=i+"px",o.drawImage(e,0,0,t,i),this.__coverBase64=s.toDataURL("image/jpeg",1)}catch(hi){this.consoleLog("jsapi shareEmbedMpVideo error: "+hi.toString()),this.__coverBase64=""}"function"==typeof t&&t({cover64:this.__coverBase64})},e.onerror=function(){this.onload=null,this.onerror=null,"function"==typeof t&&t({cover64:""})},e.src=this.cover}}},_getFormatTime:Oe,_getAllPlayersOfPage:()=>Object.assign({},Ie.allPlayersOfPage)},(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{directives:[{name:"max-font-scale",rawName:"v-max-font-scale",value:t.maxPlayerFontScale,expression:"maxPlayerFontScale"}],ref:"videoWrp",staticClass:"js_mpvedio page_video_wrapper",attrs:{id:"js_mpvedio_"+t.id}},[e("div",{class:["js_page_video","page_video","ratio_primary","align_upper_center",t.ratio===4/3?"video_skin_primary":"",0===t.controlBarStatus?"page_video_without-control":"page_video_control",t.fullscreenStatus&&t.needFeFullscreen?t.isLandscape?"page_video_skin-horizontal "+(!t.opt.preCreate&&"player_fade_in"):"page_video_skin-vertical "+(!t.opt.preCreate&&"player_fade_in"):"page_video_skin-normal",t.opt.duration>=3600?"page_video_long_duration":""],style:{...t.wrapPresentStyle,...t.fullscreenAnimation},attrs:{role:t.fullscreenStatus?"dialog":null,"aria-modal":t.fullscreenStatus?"true":null},on:{touchstart:t.onPageVideoTouchStart,touchmove:t.onPageVideoTouchMove,touchend:t.onPageVideoTouchEnd,touchcancel:t.onPageVideoTouchEnd,mousemove:t.onProgressMouseMove,mouseup:t.onProgressMouseUp,click:t.onPageVideoClick}},[t.inAppmsgAndNotFullScreen?[e("svg",{staticClass:"border_filler border_filler_lefttop",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2 2",width:"4px",height:"4px"}},[e("path",{attrs:{d:"M1.85.005A2 2 0 000 2V0h2z",fill:t.bodyColor,"fill-rule":"evenodd"}})]),e("svg",{staticClass:"border_filler border_filler_righttop",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2 2",width:"4px",height:"4px"}},[e("path",{attrs:{d:"M1.85.005A2 2 0 000 2V0h2z",fill:t.bodyColor,"fill-rule":"evenodd"}})]),e("svg",{staticClass:"border_filler border_filler_rightbot",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2 2",width:"4px",height:"4px"}},[e("path",{attrs:{d:"M1.85.005A2 2 0 000 2V0h2z",fill:t.bodyColor,"fill-rule":"evenodd"}})]),e("svg",{staticClass:"border_filler border_filler_leftbot",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2 2",width:"4px",height:"4px"}},[e("path",{attrs:{d:"M1.85.005A2 2 0 000 2V0h2z",fill:t.bodyColor,"fill-rule":"evenodd"}})])]:t._e(),t.canLoad?[e("div",{directives:[{name:"show",rawName:"v-show",value:(0!==t.controlBarStatus&&!(t.isIPad&&t.isImmersiveMode)&&1!==t.banOprStatus||!t.isLandscape)&&t.fullscreenStatus&&t.needFeFullscreen,expression:"(controlBarStatus !== 0 && !(isIPad && isImmersiveMode) && banOprStatus !== 1 || !isLandscape) && fullscreenStatus && needFeFullscreen"},{name:"max-font-scale",rawName:"v-max-font-scale",value:t.maxPlayerFullscreenHeadScale,expression:"maxPlayerFullscreenHeadScale"}],ref:"navigationBar",class:["js_video_fullscreen_profile","video_full-screen__head",101===t.controlBarStatus&&t.isLandscape?"opr_fade_out":""],style:{"padding-top":t.isAndroid&&t.fullscreenStatus&&t.needFeFullscreen&&!t.isLandscape?(t.getSafeAreaInsets().top?t.getSafeAreaInsets().top:16)+"px":"","padding-left":t.isAndroid&&t.fullscreenStatus&&t.needFeFullscreen&&t.isLandscape?Math.max(t.getSafeAreaInsets().top,t.getSafeAreaInsets().bottom)+20+"px":"","padding-right":t.isAndroid&&t.fullscreenStatus&&t.needFeFullscreen&&t.isLandscape?Math.max(t.getSafeAreaInsets().top,t.getSafeAreaInsets().bottom)+20+"px":""}},[e("div",{staticClass:"video_full-screen__head__inner"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isImmersiveMode||t.isLandscape,expression:"!isImmersiveMode || isLandscape"}],staticClass:"video_full-screen__head__body"},[e("div",{staticClass:"js_video_fullscreen_profile_exit video_full-screen__head__item"},[e("div",{staticClass:"video_full-screen__article-title"},[e("button",{directives:[{name:"show",rawName:"v-show",value:t.fullscreenStatus&&t.isLandscape,expression:"fullscreenStatus && isLandscape"}],staticClass:"weui-wa-hotarea js_video_fullscreen_profile_exit reset_btn video_close_fullscreen_btn",on:{click:function(e){return t.changeFullscreenLandscapeMode(0)}}},[e("i",{staticClass:"weui-icon-back-arrow"},[t._v("切换到竖屏全屏")])]),e("button",{directives:[{name:"show",rawName:"v-show",value:!t.opt.inFeed&&t.fullscreenStatus&&!t.isLandscape,expression:"!opt.inFeed && fullscreenStatus && !isLandscape"}],staticClass:"weui-wa-hotarea js_video_fullscreen_profile_exit reset_btn video_close_fullscreen_btn",on:{click:t.exitFullscreen}},[e("i",{staticClass:"weui-icon-close"},[t._v("退出全屏")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isLandscape,expression:"isLandscape"}],staticClass:"video_full-screen__account",attrs:{role:"button"}},[e("div",{staticClass:"video_full-screen__account-info"},[e("span",{staticClass:"weui-wa-hotarea video_full-screen__account-avatar",style:{background:"url("+t.headImgUrl+") no-repeat center / cover"},on:{click:function(e){return e.stopPropagation(),t.onJumpProfile.apply(null,arguments)}}}),e("span",{staticClass:"weui-wa-hotarea video_full-screen__account-name",on:{click:function(e){return e.stopPropagation(),t.onJumpProfile.apply(null,arguments)}}},[t._v(t._s(t.nickname))]),e("button",{directives:[{name:"show",rawName:"v-show",value:1===t.subscribeStatus||2===t.subscribeStatus,expression:"subscribeStatus === 1 || subscribeStatus === 2"}],staticClass:"reset_btn video_profile_follow_btn weui-wa-hotarea",attrs:{disabled:2===t.subscribeStatus,type:"button"},on:{click:function(e){return e.stopPropagation(),t.clickSubscribe.apply(null,arguments)}}},[t._v(t._s(1===t.subscribeStatus?"关注":"已关注"))])])])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isImmersiveMode||t.isLandscape,expression:"!isImmersiveMode || isLandscape"}],staticClass:"video_full-screen__head__ft"},[e("a",{directives:[{name:"show",rawName:"v-show",value:t.showFullscreenMenu,expression:"showFullscreenMenu"}],staticClass:"video_menu_more js_video_fullscreen_menu_more weui-wa-hotarea_before",attrs:{"aria-label":"更多操作",role:"button",href:"javascript:;"},on:{click:t.onShowFullscreenMenu}},[e("i",{staticClass:"weui-icon-outlined-more"})])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.canShareVideo&&!t.fullscreenStatus&&0!==t.controlBarStatus&&(0===t.banOprStatus||3===t.banOprStatus)&&0===t.midPlayStatus&&1!==t.seekingStatus,expression:"canShareVideo && !fullscreenStatus && controlBarStatus !== 0 && (banOprStatus === 0 || banOprStatus === 3) && midPlayStatus === 0 && seekingStatus !== 1"}],class:["js_share_btn_contain","top_screen_opr","video_share_opr",101===t.controlBarStatus?"opr_fade_out":""]},[e("div",{staticClass:"wx_video_share_area"},[e("button",{staticClass:"js_share_btn wx_video_share_btn weui-wa-hotarea",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.shareVideo.apply(null,arguments)}}},[t._v("分享视频")])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.loadingStatus,expression:"loadingStatus !== 0"}],staticClass:"wrp_loading js_loading",attrs:{role:"alert","aria-label":"加载中"}},[t._m(0)]),t._t("poster",(function(){return[e("div",{directives:[{name:"show",rawName:"v-show",value:(t.cover&&0!==t.coverStatus||t.videoSnapshot)&&!t.opt.withoutCover,expression:"(cover && coverStatus !== 0 || videoSnapshot) && !opt.withoutCover"}],staticClass:"poster_cover",style:t.posterPresentStyle})]}),{cover:t.cover,coverStatus:t.coverStatus,videoSnapshot:t.videoSnapshot,withoutCover:t.withoutCover}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showPauseBtn&&0!==t.midPlayStatus&&!t.opt.preCreate,expression:"showPauseBtn && midPlayStatus !== 0 && !opt.preCreate"}],staticClass:"full_screen_opr wx_video_play_opr"},[e("button",{staticClass:"mid_play_box reset_btn",class:t.hideDuration?"hide_duration":"",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.onMidPlayBtnClick.apply(null,arguments)}}},[e("i",{staticClass:"pic_mid_play",attrs:{"aria-label":"播放视频"}}),t.hideDuration?t._e():[e("span",{staticClass:"aria_hidden_abs"},[t._v("，时长")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.duration,expression:"duration"}],staticClass:"video_length"},[t._v(t._s(t.formatDuration))])]],2)]),t.$slots.cornerTips?e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCornerTips,expression:"showCornerTips"}],staticClass:"corner_tips_area"},[t._t("cornerTips",null,{show:t.showCornerTips})],2):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.topTips,expression:"topTips"}],class:["top_screen_opr","wx_video_flow_wrap",t.topTips?"flow_fade_out":""],attrs:{role:"alert"}},[e("div",{staticClass:"wx_video_flow"},[e("p",{staticClass:"wx_video_flow_tips"},[t._v(t._s(t.topTips))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false && touchOprStatus !== 0 && (!fullscreenStatus || !needFeFullscreen || isLandscape)"}],staticClass:"mid_opr fast_pre_next"},[e("div",{staticClass:"video_processor_bar"},[e("div",{staticClass:"processor_bar_inner js_forward_bar",style:{width:t.touchToastPercent+"%"}})]),e("p",{staticClass:"video_length"},[e("span",{staticClass:"played_time js_forward_play_time"},[t._v(t._s(t.touchToastCurVal))]),e("span",{staticClass:"js_forward_seperator"},[t._v(t._s(t.touchToastSeperator))]),e("span",{staticClass:"total_time js_forward_total_time"},[t._v(t._s(t.touchToastTotalVal))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:1===t.seekingStatus,expression:"seekingStatus === 1"}],class:["wx_video_progress_msg",t.fullscreenStatus&&t.needFeFullscreen&&!t.isLandscape?"":"full_screen_opr"],attrs:{role:"alert"}},[e("div",{staticClass:"wx_video_progress_msg_inner"},[e("span",{staticClass:"wx_video_progress_current"},[t._v(t._s(t.formatCurrentTime))]),e("span",{staticClass:"wx_video_progress_gap"},[t._v("/")]),e("span",{staticClass:"wx_video_progress_total"},[t._v(t._s(t.formatDuration))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:(0!==t.controlBarStatus||!t.isLandscape)&&(0===t.subSettingStatus||t.isLandscape)&&(0===t.banOprStatus||3===t.banOprStatus)&&0===t.midPlayStatus&&t.fullscreenStatus&&t.needFeFullscreen,expression:"(controlBarStatus !== 0 || !isLandscape) && (subSettingStatus === 0 || isLandscape) && (banOprStatus === 0 || banOprStatus === 3) && midPlayStatus === 0 && fullscreenStatus && needFeFullscreen"}],class:["video_fullscreen_mask",101===t.controlBarStatus&&t.isLandscape?"opr_fade_out":""]}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showFullSwitch,expression:"showFullSwitch"}],staticClass:"video_screen_mode_switch",style:t.changeFullSwitchStyle,on:{click:function(e){return e.stopPropagation(),t.changeFullscreenLandscapeMode(90)}}},[e("button",{staticClass:"reset_btn video_screen_mode_switch_btn weui-wa-hotarea",attrs:{type:"button"}},[t._v(" 切换到横屏模式 ")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showPauseBtn&&t.fullscreenStatus&&t.needFeFullscreen&&!t.isLandscape&&"pause"===t.status&&!t.seekingStatus,expression:"showPauseBtn && fullscreenStatus && needFeFullscreen && !isLandscape && status === 'pause' && !seekingStatus"}],staticClass:"full_screen_opr wx_video_pause_full_mod"},[e("button",{staticClass:"reset_btn wx_video_pause_full_btn",attrs:{type:"button"}},[t._v("继续播放")])]),e("input",{ref:"ariaSwitch",staticClass:"aria_hidden_abs",attrs:{"aria-hidden":0!==t.midPlayStatus||null,type:"checkbox",title:"显示工具栏"},on:{click:function(t){t.stopPropagation()},change:t.triggerAriaSwitch}}),e("div",{ref:"controlBar",staticClass:"js_control video_opr video_opr_normal",class:t.inAppmsgAndNotFullScreen?"padding_play_bar":""},[t.fullscreenStatus&&(t.isLandscape||0!==t.banOprStatus&&3!==t.banOprStatus||"pause"!==t.status)?t._e():e("div",{staticClass:"opr_inner"},[e("div",{staticClass:"opr_inner_fl"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.alwaysShowControl||1!==t.banOprStatus&&(0!==t.controlBarStatus&&2!==t.banOprStatus||!t.fullscreenStatus||!t.isLandscape)&&0===t.midPlayStatus&&0===t.subSettingStatus&&"end"!==t.status,expression:"alwaysShowControl || (banOprStatus !== 1 && (controlBarStatus !== 0 && banOprStatus !== 2 || !fullscreenStatus || !isLandscape) && midPlayStatus === 0 && subSettingStatus === 0 && status !== 'end')"}],class:["js_play_bar_wrapper","wrp_play_bar",t.seekingStatus?"wrp_progress__draging":"",0!==t.controlBarStatus&&2!==t.banOprStatus||t.fullscreenStatus&&t.isLandscape||1===t.seekingStatus||t.alwaysShowControl?"":"wrp_play_bar_hide_speed-dot"]},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.duration,expression:"duration"}],staticClass:"js_progress_bar wrp_progress",style:{"padding-top":"6px","padding-bottom":t.fullscreenStatus?"8px":0},on:{touchstart:t.onProgressTouchStart,touchmove:t.onProgressTouchMove,touchend:t.onProgressTouchEnd,mousedown:t.onProgressMouseDown}},[e("div",{ref:"progressBar",class:["progress_bar",t.fullscreenStatus?"progress_bar_fullscreen":""]},[e("div",{staticClass:"background_bar"}),e("div",{ref:"playedBar",staticClass:"js_played_bar played_bar",style:{width:t.progressPercent+"%"},attrs:{role:"option","aria-labelledby":"ariaPlayedCurrent",title:"按住可调"}},[e("span",{staticClass:"aria_hidden_abs",attrs:{id:"ariaPlayedCurrent"}},[t._v("进度条，百分之"+t._s(t.progressPercent))])]),e("div",{staticClass:"js_buffer_bar buffer_bar",style:{width:t.bufferedPercent+"%"}}),t.progressBarMark&&t.progressBarMark.length?t._l(t.progressBarMark,(function(t){return e("div",{key:t.id,staticClass:"bar_mark",style:"left:"+100*t.pos+"%"})})):t._e(),e("div",{class:["weui-wa-hotarea","js_played_speed_cnt","wrp_speed_dot",101===t.controlBarStatus?"opr_fade_out":""],style:{left:t.progressPercent+"%"}},[e("i",{staticClass:"speed_dot"})])],2)])])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.alwaysShowControl||(0!==t.controlBarStatus&&(!t.fullscreenStatus&&1!==t.seekingStatus||t.isLandscape)||1!==t.seekingStatus&&t.fullscreenStatus&&!t.isLandscape)&&(0===t.subSettingStatus||t.isLandscape)&&(0===t.banOprStatus||3===t.banOprStatus)&&0===t.midPlayStatus&&"end"!==t.status,expression:"alwaysShowControl || ((controlBarStatus !== 0 && (!fullscreenStatus && seekingStatus !== 1 || isLandscape) || seekingStatus !== 1 && fullscreenStatus && !isLandscape) && (subSettingStatus === 0 || isLandscape) && (banOprStatus === 0 || banOprStatus === 3) && midPlayStatus === 0 && status !== 'end')"}],ref:"featureBar",class:["js_control video_opr video_opr_sns",t.alwaysShowControl||201!==t.seekingStatus||!t.fullscreenStatus||t.isLandscape?"":"opr_fade_in",!t.alwaysShowControl&&101===t.controlBarStatus&&(!t.fullscreenStatus||t.isLandscape)||101===t.seekingStatus&&t.fullscreenStatus&&!t.isLandscape?"opr_fade_out":"",t.fullscreenStatus&&!t.isLandscape?t.videoRatio>1?"full_portrait video_ratio_bottom":"full_portrait":""],style:{width:t.featureBarWidth,bottom:t.featureBarBottom}},[e("div",{staticClass:"opr_inner"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.alwaysShowControl||!t.fullscreenStatus||!t.needFeFullscreen||t.isLandscape,expression:"alwaysShowControl || !fullscreenStatus || !needFeFullscreen || isLandscape"}],staticClass:"opr_inner_fl"},[e("div",{class:["js_switch","weui-wa-hotarea","switch","play"===t.status||"loading"===t.status?"switch_off":"switch_on"],on:{click:t.onPlaySwitchClick}},[e("a",{staticClass:"btn_opr",attrs:{href:"javascript:;",role:"button"}},[t._v(t._s("play"===t.status||"loading"===t.status?"暂停":"播放"))])]),e("div",{attrs:{role:"option"}},[e("div",{staticClass:"played_time js_now_play_time"},[t._v(t._s(t.formatCurrentTime))]),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.fullscreenStatus,expression:"!fullscreenStatus"}]},[t._v("/")]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.fullscreenStatus,expression:"!fullscreenStatus"}],staticClass:"total_time js_total_time"},[t._v(t._s(t.formatDuration))])]),t.fullscreenStatus&&t.needFeFullscreen&&t.isLandscape?e("div",{directives:[{name:"show",rawName:"v-show",value:1!==t.banOprStatus&&(0!==t.controlBarStatus&&2!==t.banOprStatus||!t.fullscreenStatus||!t.isLandscape)&&0===t.midPlayStatus&&"end"!==t.status,expression:"banOprStatus !== 1 && (controlBarStatus !== 0 && banOprStatus !== 2 || !fullscreenStatus || !isLandscape) && midPlayStatus === 0 && status !== 'end'"}],class:["js_play_bar_wrapper","wrp_play_bar",t.seekingStatus?"wrp_progress__draging":"",0!==t.controlBarStatus&&2!==t.banOprStatus||t.fullscreenStatus&&t.isLandscape?"":"wrp_play_bar_hide_speed-dot"]},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.duration,expression:"duration"}],staticClass:"js_progress_bar wrp_progress",style:{"padding-top":"10px","padding-bottom":t.fullscreenStatus?"12px":0},on:{touchstart:t.onProgressTouchStart,touchmove:t.onProgressTouchMove,touchend:t.onProgressTouchEnd,mousedown:t.onProgressMouseDown}},[e("div",{ref:"progressBar",staticClass:"progress_bar"},[e("div",{staticClass:"background_bar"}),e("div",{ref:"playedBar",staticClass:"js_played_bar played_bar",style:{width:t.progressPercent+"%"}}),e("div",{staticClass:"js_buffer_bar buffer_bar",style:{width:t.bufferedPercent+"%"}}),t.progressBarMark&&t.progressBarMark.length?t._l(t.progressBarMark,(function(t){return e("div",{key:t.id,style:"left:"+100*t.pos+"%",attrs:{lass:"bar_mark"}})})):t._e(),e("div",{class:["weui-wa-hotarea","js_played_speed_cnt","wrp_speed_dot",101===t.controlBarStatus?"opr_fade_out":""],style:{left:t.progressPercent+"%"},attrs:{role:"slider","aria-label":"进度滑块"}},[e("i",{staticClass:"speed_dot"})])],2)])]):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.fullscreenStatus&&t.needFeFullscreen&&t.isLandscape,expression:"fullscreenStatus && needFeFullscreen && isLandscape"}],staticClass:"total_time js_total_time",attrs:{role:"option"}},[t._v(t._s(t.formatDuration))])]),e("div",{staticClass:"opr_inner_fr"},[t._t("control"),(t.supportImmersiveMode||t.isWcSlPlayer)&&(!t.fullscreenStatus||t.isLandscape)&&t.playbackRateInfo&&t.playbackRateInfo.length&&t.canChangePlaybackRate?e("div",{staticClass:"weui-wa-hotarea play_setting_mode play_setting_mode__rate js_playback_mode_change",on:{click:t.onPlaybackRateEntryClick}},[e("a",{staticClass:"play_setting",attrs:{role:"button",href:"javascript:;",id:"play_setting_mode__rate"}},[t._v(t._s(t.playbackRateName))])]):t._e(),(t.supportImmersiveMode||t.isWcSlPlayer)&&t.fullscreenStatus&&t.isLandscape&&t.resolutionInfo&&t.resolutionInfo.length?e("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.resolutionEntryStatus,expression:"resolutionEntryStatus !== 0"}],staticClass:"weui-wa-hotarea play_setting_mode js_play_mode_change",on:{click:t.onResolutionEntryClick}},[e("a",{staticClass:"play_setting",attrs:{role:"button",href:"javascript:;"}},[t._v(t._s(t.resolutionName))])]):t._e(),t.canMute?e("div",{staticClass:"weui-wa-hotarea muted_control",class:t.muted?"mute":"",attrs:{role:"button"},on:{click:t.onMuteSwitchClick}},[e("i",{staticClass:"icon_control"},[t._v("静音")])]):t._e(),t.fullscreenStatus&&(t.needFeFullscreen||t.mustHideFullScreen)||t.isImmersiveListMode||!t.canFullscreen?t._e():e("div",{staticClass:"weui-wa-hotarea js_full_screen_control screenSize_control full",attrs:{role:"button"},on:{click:t.onFullscreenSwitchClick}},[e("i",{staticClass:"icon_control"},[t._v("全屏")])])],2)])]),e("mp-toast",{ref:"toast",attrs:{role:"alert"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.longTouchPlaybackRatePrevValue,expression:"longTouchPlaybackRatePrevValue"}],staticClass:"full_screen_opr video_quick_play_context",attrs:{role:"alert"}},[t._m(1)]),e("div",{ref:"subSettingMenu",class:["js_sub_setting video_full-screen__footer video_full-screen__footer__sub-setting",-1!==[0,101,102].indexOf(t.subSettingStatus)?"hide":""],style:{"padding-right":t.isAndroid&&t.fullscreenStatus&&t.isLandscape?Math.max(t.getSafeAreaInsets().top,t.getSafeAreaInsets().bottom)+20+"px":""}},[t.playbackRateInfo&&t.playbackRateInfo.length?e("div",{directives:[{name:"show",rawName:"v-show",value:2===t.subSettingStatus||102===t.subSettingStatus,expression:"subSettingStatus === 2 || subSettingStatus === 102"}],staticClass:"video_full-screen__sub-setting video_full-screen__sub-setting__speed js_playback_mode_select"},t._l(t.playbackRateInfo,(function(i,s){return e("a",{key:s,class:["video_full-screen__sub-setting__item",t.playbackRateInfoIdx===s?"current":"","js_playback_"+s],attrs:{href:"javascript:;"},on:{click:function(e){return e.stopPropagation(),t.onPlaybackRateSelect(s)}}},[t._v(" "+t._s(i.name)+" ")])})),0):t._e(),t.resolutionInfo&&t.resolutionInfo.length?e("div",{directives:[{name:"show",rawName:"v-show",value:1===t.subSettingStatus||101===t.subSettingStatus,expression:"subSettingStatus === 1 || subSettingStatus === 101"}],staticClass:"video_full-screen__sub-setting video_full-screen__sub-setting__ratio js_play_mode_select"},t._l(t.resolutionInfo,(function(i,s){return e("a",{key:s,class:["video_full-screen__sub-setting__item",t.resolutionInfoIdx===s?"current":"","js_resolution_"+s],attrs:{href:"javascript:;"},on:{click:function(e){return e.stopPropagation(),t.onResolutionSelect(s)}}},[t._v(" "+t._s(i.name)+" ")])})),0):t._e()]),e("div",{class:["js_inner","inner",t.fullscreenStatus?"":"not_fullscreen"],style:t.videoPresentStyle&&t.videoPresentStyle.zIndex?{zIndex:t.videoPresentStyle.zIndex}:null},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isWcSlPlayer||"init"!==t.status,expression:"isWcSlPlayer || status !== 'init'"}],staticClass:"js_video_poster video_poster"},[e("div",{staticClass:"video_mask"}),t.isWcSlPlayer&&!t.removeVideo?e("wx-open-video",{ref:"video",style:t.videoPresentStyle,attrs:{src:t.src,poster:t.cover,"transition-duration":t.wcSlPlayerTransitionDuration,width:t.width,height:t.height,"initial-time":t.autoplay?t.initialTime:null,autoplay:t.autoplay,muted:t.muted,"fullscreen-after-orientation-change":t.enableWcSlPlayerFullscreenAfterOrientationChange,"hide-ios-exit-btn-when-fullscreen":"","transport-protocol":t.useQuic?"quic":"","prevent-exit-fullscreen-when-destroy":""},on:{contextmenu:function(t){t.preventDefault()},loadedmetadata:t.onLoadedmetadata,timeupdate:t.onTimeupdate,progress:t.onProgress,canplay:t.onCanplay,ended:t.onEnded,seeked:t.onSeeked,seeking:t.onSeeking,waiting:t.onWaiting,play:t.onPlay,playing:t.onPlay,pause:t.onPause,error:t.onError,binderror:t.onBinderror,ratechange:t.onRatechange,fullscreenchange:t.onFullscreenchange,resolutionchange:t.onResolutionchange,processstatechange:t.onProcessstatechange}}):t.removeVideo?t._e():e("video",{ref:"video",class:[t.fitVideo?"video_fill":""],attrs:{src:t.src,poster:t.cover,"webkit-playsinline":"isiPhoneShowPlaysinline",playsinline:"isiPhoneShowPlaysinline",preload:"metadata",crossorigin:"anonymous",controlslist:"nodownload"},domProps:{muted:t.muted},on:{contextmenu:function(t){t.preventDefault()},loadedmetadata:t.onLoadedmetadata,timeupdate:t.onTimeupdate,progress:t.onProgress,canplay:t.onCanplay,ended:t.onEnded,seeked:t.onSeeked,seeking:t.onSeeking,waiting:t.onWaiting,play:t.onPlay,playing:t.onPlay,pause:t.onPause,error:t.onError,ratechange:t.onRatechange,fullscreenchange:t.onFullscreenchange,webkitbeginfullscreen:t.onFullscreenchange,webkitendfullscreen:t.onFullscreenchange,webkitfullscreenchange:t.onFullscreenchange,mozfullscreenchange:t.onFullscreenchange}},[t._v(" 您的浏览器不支持 video 标签 ")]),t._t("video_background",null,{cover:t.cover})],2),t._t("inner")],2),t._t("cover")]:t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.profileInfoShow,expression:"profileInfoShow"}],ref:"profileInfo",class:["video_profile_area",201===t.seekingStatus?"opr_fade_in":"",101===t.seekingStatus?"opr_fade_out":""]},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.likedCommentTipsStatus,expression:"!likedCommentTipsStatus"}]},[t._t("profile")],2),e("div",{staticStyle:{width:"fit-content","max-width":"100%"},attrs:{role:"link",tabindex:"0"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.likedCommentTipsStatus,expression:"!likedCommentTipsStatus"}],ref:"profileInfoTitle",staticClass:"weui-wa-hotarea video_profile_desc_wrp",attrs:{role:"option"},on:{click:function(e){return e.stopPropagation(),t.openSourcePage.apply(null,arguments)}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:-1!==[1,2].indexOf(t.oriStatus),expression:"[1, 2].indexOf(oriStatus) !== -1"}],staticClass:"icon_appmsg_tag_wrp"},[e("div",{staticClass:"icon_appmsg_tag"},[t._v(t._s(1===t.oriStatus?"原创":"转载"))])]),e("div",{staticClass:"weui-hidden_abs"},[t._v(",")]),e("div",{staticClass:"video_profile_desc"},[t._v(t._s(t.title))]),e("i",{staticClass:"weui-icon-outlined-arrow video_profile_desc_arrow"})])]),e("div",{staticClass:"video_profile_wrp weui-flex"},[e("div",{staticClass:"video_profile weui-flex weui-flex__item"},[e("span",{staticClass:"video_profile_avatar weui-wa-hotarea",style:{background:"url("+t.headImgUrl+") no-repeat center / cover"},on:{click:function(e){return e.stopPropagation(),t.onJumpProfile.apply(null,arguments)}}}),e("span",{staticClass:"video_profile_nickname weui-wa-hotarea",on:{click:function(e){return e.stopPropagation(),t.onJumpProfile.apply(null,arguments)}}},[t._v(t._s(t.nickname))]),e("button",{directives:[{name:"show",rawName:"v-show",value:1===t.subscribeStatus||2===t.subscribeStatus,expression:"subscribeStatus === 1 || subscribeStatus === 2"}],staticClass:"reset_btn video_profile_follow_btn weui-wa-hotarea",attrs:{disabled:2===t.subscribeStatus,type:"button"},on:{click:function(e){return e.stopPropagation(),t.clickSubscribe.apply(null,arguments)}}},[t._v(t._s(1===t.subscribeStatus?"关注":"已关注"))])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.supportImmersiveMode,expression:"supportImmersiveMode"}],staticClass:"video_sns_context"},[e("button",{directives:[{name:"show",rawName:"v-show",value:t.canShareVideo,expression:"canShareVideo"}],staticClass:"video_sns_btn video_sns_btn_share",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.shareVideo.apply(null,arguments)}}},[e("span",{staticClass:"video_sns_num"},[t._v("分享")])]),e("button",{class:["video_sns_btn","video_sns_btn_praise",t.isPraised?"video_sns_btn_praise_praised":""],attrs:{type:"button",title:t.cancelPraiseTitle},on:{click:function(e){return e.stopPropagation(),t.praiseVideo.apply(null,arguments)}}},[e("span",{staticClass:"video_sns_num"},[t.praiseNum?[e("span",{staticClass:"aria_hidden_abs"},[t._v("赞")]),t._v(t._s(t.praiseNum))]:[t._v("点赞")]],2)]),e("button",{directives:[{name:"show",rawName:"v-show",value:t.canLikeVideo,expression:"canLikeVideo"}],class:["video_sns_btn","video_sns_btn_love",t.isLiked?"video_sns_btn_love_loved":""],attrs:{type:"button",title:t.cancelLikeTitle},on:{click:function(e){return e.stopPropagation(),t.likeVideo.apply(null,arguments)}}},[e("span",{staticClass:"video_sns_num"},[t.likeNum?[e("span",{staticClass:"aria_hidden_abs"},[t._v("在看")]),t._v(t._s(t.likeNum))]:[t._v("在看")]],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.fullscreenStatus&&!t.isLandscape&&t.likedCommentTipsStatus,expression:"fullscreenStatus && !isLandscape && likedCommentTipsStatus"}],class:["like_comment_wrp",101===t.likedCommentTipsStatus?"opr_fade_out":""],attrs:{role:"alert"}},[e("div",{staticClass:"like_comment_inner"},[e("div",{staticClass:"like_comment_bd"},[e("div",{staticClass:"like_comment_tips"},[e("i",{staticClass:"weui-icon-success"}),e("i",{staticClass:"icon-success-primary"}),t._v("已同步到看一看"),e("a",{staticClass:"like_comment_share_link weui-wa-hotarea_before",attrs:{href:"javascript:;"},on:{click:function(e){return e.stopPropagation(),t.writeLikedComment.apply(null,arguments)}}},[t._v("写下你的评论")])])])])])])])],2)])}),[function(){var t=this._self._c;return this._self._setupProxy,t("span",{staticClass:"weui-primary-loading weui-primary-loading_transparent"},[t("span",{staticClass:"weui-primary-loading__dot"})])},function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"video_quick_play_msg"},[e("i",{staticClass:"icon_video_quick_play"}),t._v(" 倍速播放中 ")])}],!1,null,"05b2c52f",null,null).exports,Be=window.Vue,De={cacheTime:6e5,networkType:"",isPc:/(WindowsNT)|(Windows NT)|(Macintosh)/i.test(navigator.userAgent),defaultErrorWording:"视频加载失败，请刷新页面再试",defaultHeadImgUrl:"http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8p5jb6RZ8aYfjfS2AVle8URwBt8QIu6XbGewB9wiaWYWkPwq4R7pfdsFibuLkic16UcxDSNYtB8HnC1Q/0",playerStatus:{formatId:null},netTypeMap:{"network_type:fail":"fail","network_type:edge":"2g/3g","network_type:wwan":"2g/3g","network_type:wifi":"wifi"},definitionMap:{20003:4,10002:3,10003:2,10004:1,10102:3,10103:2,10104:1},resolutionNameMap:{10002:"超清",10003:"高清",10004:"流畅",10102:"超清",10103:"高清",10104:"流畅",20003:"自动"},playbackRateInfo:[{rate:.5,name:"0.5倍"},{rate:.75,name:"0.75倍"},{rate:1,name:"1.0倍"},{rate:1.5,name:"1.5倍"},{rate:2,name:"2.0倍"}]},Le=new w("video_info"),Fe=["继续观看",""],Ve=["再次观看","refresh"],Ne={1:Fe.concat("135px"),2:Ve.concat("135px"),201:Fe.concat("100%"),202:Ve.concat("100%"),203:Fe.concat("135px"),204:Ve.concat("135px")},We="update_recommend_status",je={NOT_IN_WECHAT:91,VIDEO_BAN:92},Ue=Be.extend({components:{[Me.name]:Me},provide:{playerScene:"normal"},data:()=>({opt:null,playerOpt:null,wrapStyle:null,videoStyle:null,posterStyle:null,topStickyExpendWhenPaused:!1,showScreenshotMask:!1,screenshot:"",toastTips:"",canLoad:!0}),computed:{...i(["cgiData"]),...i("mp-video-player",["errType","errCode","errMsg","banOprStatus","fullscreenStatus","orientationStatus","refreshBtnStatus","topStickyInfoStatus","commonReportData"]),innerPlugins(){return this.opt&&this.opt.plugins&&this.opt.plugins.filter((t=>t.type===yt.TYPE_INNER))||[]},coverPlugins(){return this.opt&&this.opt.plugins&&this.opt.plugins.filter((t=>t.type===yt.TYPE_COVER))||[]},controlPlugins(){return this.opt&&this.opt.plugins&&this.opt.plugins.filter((t=>t.type===yt.TYPE_CONTROL))||[]},profilePlugins(){return this.opt&&this.opt.plugins&&this.opt.plugins.filter((t=>t.type===yt.TYPE_PROFILE))||[]},topStickyInfoWording(){const t=Ne[this.topStickyInfoStatus];return t&&t[0]||"继续观看"},topStickyInfoIconClass(){const t=Ne[this.topStickyInfoStatus];return t&&t[1]||""},topStickyInfoMaskWidth(){const t=Ne[this.topStickyInfoStatus];return t&&t[2]||"100%"},isDramaVideo(){return this.cgiData.drama_info&&this.cgiData.drama_info.appid},processingTips(){if(window.is_temp_url){const t=(Object.keys(this.opt&&this.opt.videoPageInfo||[]).length?this.opt.videoPageInfo:window.__videoPageInfo)||{};return t.is_mp_video_transing?"转码中":t.is_mp_video_checking?"审核中":""}return""}},watch:{banOprStatus(){this.setVideoMenuItems()},orientationStatus(t){this.onOrientationStatusChange(),this.$emit("orientation-change",t),this.fullscreenStatus?1===t?this.showScreenshotMask=!0:setTimeout((()=>{this.showScreenshotMask=!1}),250):this.showScreenshotMask=!1}},mounted(){this.opt&&this.opt.dontAutoInit||this.init(),window.addEventListener("unload",this.__onLeaveReport23443EventType1=()=>this.onLeaveReport23443({event:1})),window.addEventListener("unload",this.__onLeaveReport23443EventType2or3=()=>this.onLeaveReport23443()),window.addEventListener("unload",this.onLeaveReport23442),window.addEventListener("unload",this.onKykLeaveReport),window.addEventListener("unload",this.onPageUnload),window.addEventListener("resize",this.onPageResize),document.addEventListener("visibilitychange",this.onVisibilityChange)},beforeDestroy(){this.disableTopSticky(),window.removeEventListener("unload",this.__onLeaveReport23443EventType1),window.removeEventListener("unload",this.__onLeaveReport23443EventType2or3),window.removeEventListener("unload",this.onLeaveReport23442),window.removeEventListener("unload",this.onKykLeaveReport),window.removeEventListener("unload",this.onPageUnload),window.removeEventListener("resize",this.onPageResize),document.removeEventListener("visibilitychange",this.onVisibilityChange)},methods:{...o("mp-video-player",["setError","setTopStickyInfoStatus","setCommonReportData","setEnter23439ReportExData","setPlay23440ReportExData","setPerf23442ReportExData","setLeave23443ReportExData","setOp23444ReportExData","setReload23445ReportExData","setAd23446ReportExData"]),...s("mp-video-player",["reportEnter23439","reportPlay23440","reportPerf23442","reportLeave23443","reportOp23444","reportReload23445","reportAd23446"]),init(){this.initController(),this.opt.preCreate||this.reportPv23447(),I.leaveReport(23443,(()=>this.onLeaveReport23443({event:1,type:"leaveReport"}))),I.leaveReport(23443,(()=>this.onLeaveReport23443({type:"leaveReport"}))),I.leaveReport(23442,(()=>this.onLeaveReport23442({type:"leaveReport"}))),x.addReport((()=>this.onKykLeaveReport({type:"leaveReport"}))),x.addReport((()=>this.onPageUnload({type:"leaveReport"}))),x.addSpecificReport("native_data",(()=>({video_data:{vid:this.opt.vid,lastPlayedTime:this.getCurrentTime(),lastPlayedTimeExpiredTime:(Date.now()+De.cacheTime)/1e3}}))),"number"==typeof this.opt.leaveReport12710Type&&this.leaveReport12710()},initController(){var t;(this.opt={bizUserName:"",bizNickName:"",profileTabType:2,videoTitle:"",headImgUrl:"",preview:!1,fromid:0,oriStatus:3,isMpVideo:0,mpVideoCoverUrl:"",mpVideoTransInfo:[],showFullscreenMenu:!0,videoMd5:"",oriVid:"",vid:"",ckey:"",width:0,height:0,autoplay:!1,muted:!1,loop:!1,__biz:"",uin:"",mid:"",idx:"",comment_id:"",scene_type:0,hitBizuin:"",hitVid:"",totalRange:10,useWcSlPlayer:!1,useImmersiveMode:!1,useFeFullscreen:!1,coverFit:"contain",lazyLoad:!1,canShareVideo:!0,canLikeVideo:!0,...this.$options.opt},this.opt.oriVid=this.opt.oriVid||this.opt.vid,this.opt.headImgUrl=this.opt.headImgUrl||De.defaultHeadImgUrl,1!=this.opt.oriStatus&&2!=this.opt.oriStatus&&(this.opt.oriStatus=3),this.__reportData=l.getVideoReportData(),this.__gWidth=this.__gWidth||this.opt.width,this.__gHeight=this.__gHeight||this.opt.height,this.__playRangeInfo=[],this.__dynamicErrMsg="",this.__isUnloaded=!1,this.__isShowTx=!1,this.__dataCount=0,this.__targetDataCount=2,this.__coverUrl="",this.__cacheStartTs=0,this.__initialData=null,this.__preventResize=Boolean(this.opt.initFullscreenStatus),this.__vInfo={status:null,coverUrl:"",dynamicData:null},this.initLazyLoad(),this.hideError(),this.initLegacyPlugins(),this.initReportData(),this.initKykReportData(),this.initImmersiveReportCommonData(1),h.report115849(71),!0!==this.replaceByTxVideo())?(this.getCache(),window.__timelineInitialData&&(this.__initialData=window.__timelineInitialData,delete window.__timelineInitialData),this.getCoverUrl(),this.getAdvanceCodecSupportBeforeCallback((()=>{De.playerStatus&&!De.playerStatus.formatId?$e((()=>this.getDynamicData())):this.getDynamicData()})),C.supportImmersiveMode&&(t={biz:this.opt.__biz,mid:this.opt.mid,idx:this.opt.idx,vid:this.opt.vid,onSuccess:t=>{this.playerOpt?(this.playerOpt.readNum=t.view_num&&t.view_num.pv||0,this.playerOpt.praiseNum=t.like_num&&t.like_num.pv||0,this.playerOpt.likeNum=t.seen_num&&t.seen_num.pv||0,this.playerOpt.isPraised=t.like_num&&t.like_num.liked||0,this.playerOpt.isLiked=t.seen_num&&t.seen_num.seen||0):this.__immersiveData=t,this.opt.preview||!this.opt.useImmersiveMode||this.opt.preCreate||M.invoke("handleHaokanAction",{action:We,recommend:t.seen_num.seen?1:0,permission:1})}},D({url:"/mp/immersive_player?action=get_player_data&__biz=".concat(t.biz||"","&mid=").concat(t.mid||"","&idx=").concat(t.idx||"","&vid=").concat(t.vid||"","&item_show_type=").concat(window.real_item_show_type),dataType:"json",timeout:3e4,type:"GET",scope:"mmbiz_video",success(e){var i;if(console.info("[沉浸式播放器数据响应请求]: ",e),T.info("[Player] success get immersive data"),0===(null==(i=null==e?void 0:e.base_resp)?void 0:i.ret)?"function"==typeof t.onSuccess&&t.onSuccess(e):"function"==typeof t.onError&&t.onError(),e)try{T.info("[Player] success get immersive data, immersive data is: ".concat(JSON.stringify(e)))}catch(hi){}else T.info("[Player] success get immersive data, immersive data is empty")},error(){"function"==typeof t.onError&&t.onError()},complete(){"function"==typeof t.onComplete&&t.onComplete()}}))):h.report115849(70)},reinit(t){this.opt&&"object"==typeof this.opt&&(this.$options.opt=t),delete this.__gWidth,delete this.__gHeight,this.$nextTick(this.init)},reload(){this.playerOpt=null,this.initController(),this.triggerEvent("reload")},resetPlayer(){const t=this.$refs.player;t&&(t.__canplay=!1,t.pause(),t.preventOperating(2),t.$refs.video.currentTime=0,t.currentTime=0)},initLazyLoad(){this.canLoad=!this.opt.lazyLoad,this.opt.lazyLoad&&(this.$on("startLoadVideo",(()=>{this.canLoad=!0,this.$nextTick((()=>{this.initPlugins(),this.triggerEvent("playerReady")}))})),this.$on("hideVideo",(()=>{this.canLoad=!1})))},initLegacyPlugins(){const t=this.opt.plugins||[];this.__blockPlugin={},this.__legacyPlugins=[];const e=new we;e.setPlayer(this),e.init&&e.init(),this.__legacyPlugins.push(e);for(let i=0,s=t.length;i<s;i++){const e=t[i];e.prototype instanceof yt||(e.setPlayer(this),e.init&&e.init(),this.__legacyPlugins.push(e))}},initPlugins(){this.$refs.innerPlugins&&this.$refs.innerPlugins.forEach((t=>t.initContext(this))),this.$refs.coverPlugins&&this.$refs.coverPlugins.forEach((t=>t.initContext(this))),this.$refs.controlPlugins&&this.$refs.controlPlugins.forEach((t=>t.initContext(this))),this.$refs.profilePlugins&&this.$refs.profilePlugins.forEach((t=>t.initContext(this)))},destroyPlugins(){this.opt.plugins=[],this.__legacyPlugins.forEach((t=>t.destroy&&t.destroy())),this.__legacyPlugins=[],this.__blockPlugin={}},initReportData(){let t=this.__reportData;t.mid=this.opt.mid,t.__biz=this.opt.__biz,t.idx=this.opt.idx,t.vid=this.opt.vid,t.commentid=this.opt.comment_id,t.scene_type=this.opt.scene_type,t.auto_play=this.opt.autoplay?1:0,t.fromid=this.opt.fromid,t.hit_bizuin=this.opt.hitBizuin,t.hit_vid=this.opt.hitVid,this.__monitorUid=this.triggerEvent("initMonitor",64728),this.__monitorUid2=this.triggerEvent("initMonitor",110644)},initKykReportData(){this.__videoReportInfo={hasUnloadReport:!1,hasApiReport:!1,every_start_play_time:0,every_end_play_time:0,total_play_time:0},this.__kanReportData={rec_expand:E.getParam("rec_expand")||"",scene:E.getParam("scene")||"",report_action:1,vid:this.opt.vid,start_play_time:0,end_play_time:0,play_time:0,has_end:0,replay_cnt:0,pause_cnt:0,auto_play:this.opt.autoplay?1:0,has_full_screen:this.fullscreenStatus?1:0}},initImmersiveReportCommonData(t){if(1===t){let t=0;try{t=1*window.atob(this.opt.__biz)}catch(hi){}let e=-1;A.isIOS?e=1:A.isAndroid&&(e=2);const i={DeviceModel:d(),DeviceBrand:d(),OsName:c(),OsVersion:u(),NetType:p(),MiaoKai:_(),ScreenWidth:window.screen.width,ScreenHeight:window.screen.height};this.__hasFirstPlayed=!1,this.__hasReport23439EnterStatus=0,this.__hasReport23444SubscribeBtnExpose=!1,this.__hasLeaveReport23443EventType1=!1,this.__hasLeaveReport23443EventType2or3=!1,this.__23443ReportPageEnterTime=Date.now(),this.__23443ReportPageTotalStayTime=0,this.__23443ReportPageTotalPlayTime=0,this.__23443ReportImmersiveTotalStayTime=0,this.__23443ReportImmersiveTotalPlayTime=0,this.setCommonReportData({Vid:this.opt.vid,BizUin:t,MsgId:1*this.opt.mid,ItemIdx:1*this.opt.idx,PlayerType:C.isWcSlPage()?1:this.__isShowTx?3:2,Scene:Math.max(0,1*(window.source||this.cgiData.scene||E.getParam("scene"))||0),SubScene:Math.max(0,1*(this.cgiData.subscene||window.subscene||E.getParam("subscene"))||0),ItemShowType:this.opt.useImmersiveMode?16:1*window.real_item_show_type,SourceItemShowType:1*this.cgiData.item_show_type||1*window.real_item_show_type,EnterId:1*this.cgiData.enterid||1*window.enterid||parseInt(Date.now()/1e3,10),SessionId:(window.sessionid||"")+"",ChannelId:(E.getParam("channel_session_id")||"")+"",ReloadId:(window.reloadid||"")+"",ReloadSeq:1*(window.reloadseq||1),OrStatus:1*this.opt.oriStatus,PageUrl:window.location.href,ExpType:window.exptype,Device:e}),this.setPlay23440ReportExData({...i}),this.setPerf23442ReportExData({...i}),this.setOp23444ReportExData({FullscreenType:1}),this.setReload23445ReportExData({FullscreenType:1})}else if(2===t){const t=this.__vInfo.dynamicData&&this.__vInfo.dynamicData.data||{};this.setCommonReportData({Duration:parseInt(1e3*(t.time||0)),VideoUrl:t.totalUrl||""})}else 3===t&&this.setCommonReportData({IsFans:window.isFans?2:1})},getReportTypeBySceneType(){return 0==this.opt.scene_type?1:1==this.opt.scene_type||2==this.opt.scene_type?2:4==this.opt.scene_type?3:7==this.opt.scene_type?4:0},onPageUnload(t){if(this.__isUnloaded)return;this.__isUnloaded=!0;let e=this.__reportData;if(0===e.videoerror?this.cacheData():this.clearCache(),this.getPlayerReportData(),t&&"leaveReport"===t.type){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(i+"="+encodeURIComponent(e[i]));return{reportUrl:"/mp/videoreport?",method:"POST",reportData:t.join("&")}}l.videoreport({data:e,async:!1})},onLeaveReport23442(t){let e,i;if(this.$refs.player&&(this.$refs.player.__firstPlayStart?(e=6,i=Date.now()-this.$refs.player.__firstPlayStart):this.$refs.player.__playingBufferingStartTime&&(e=7,i=Date.now()-this.$refs.player.__playingBufferingStartTime)),e){const s={EventType:e,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,BufferTime:i};if(t&&"leaveReport"===t.type)return Object.assign({},this.commonReportData,s);this.reportPerf23442(s)}},onLeaveReport23443(t={}){if(1===t.event&&this.__hasLeaveReport23443EventType1||1!==t.event&&this.__hasLeaveReport23443EventType2or3)return;let e;if(1===t.event?(this.__hasLeaveReport23443EventType1=!0,e={EventType:1,EventTime:this.getCurrentTimeMs(),PlayTime:this.getRealPlayTime(),StayTime:Date.now()-this.__23443ReportPageEnterTime}):(this.__hasLeaveReport23443EventType2or3=!0,e=this.fullscreenStatus?{EventType:3,EventTime:this.getCurrentTimeMs(),ImmersivePlayTime:this.getIntervalPlayTimeFor23443(),ImmersiveStayTime:this.getIntervalStayTimeFor23443()}:{EventType:2,EventTime:this.getCurrentTimeMs(),PagePlayTime:this.getIntervalPlayTimeFor23443(),PageStayTime:this.getIntervalStayTimeFor23443()}),e){if("leaveReport"===t.type)return Object.assign({},this.commonReportData,e);this.reportLeave23443(e)}},onKykLeaveReport(t){if(t&&"leaveReport"===t.type&&!this.__videoReportInfo.hasUnloadReport||!this.__videoReportInfo.hasApiReport)if(this.__videoReportInfo.every_end_play_time=Math.round(1e3*this.getCurrentTime()),this.__pauseTimestamp||(this.__videoReportInfo.total_play_time+=this.__videoReportInfo.every_end_play_time-this.__videoReportInfo.every_start_play_time),this.__kanReportData.play_time=this.__videoReportInfo.total_play_time,this.__kanReportData.end_play_time=Date.parse(new Date)/1e3,t&&"leaveReport"===t.type){if(E.getParam("rec_expand")&&1*E.getParam("scene")==94){this.__videoReportInfo.hasApiReport=!0,console.log("kanReportData"+JSON.stringify(this.__kanReportData));const t=[];for(let e in this.__kanReportData)this.__kanReportData.hasOwnProperty(e)&&t.push(e+"="+encodeURIComponent(this.__kanReportData[e]));return{reportUrl:"https://mp.weixin.qq.com/mp/videoreport?action=report_for_kyk",reportData:t.join("&"),method:"POST"}}}else this.__videoReportInfo.hasUnloadReport=!0,console.log("real play time"+this.__videoReportInfo.total_play_time),m.reportKanData(this.__kanReportData)},onVisibilityChange(){document.hidden&&this.cacheData()},onPageResize(){this.__preventResize||(this.$refs.player&&this.$refs.player.isWcSlPlayer?this.fullscreenStatus||setTimeout((()=>{const t=this.$el.parentNode,e=t&&t.getBoundingClientRect(),i=e&&e.width||0;0!==i&&this.setVideoSize({width:i})}),0):this.opt.height&&this.opt.width&&(this.__isShowTx&&this.__txPlayer?setTimeout((()=>{try{const t=this.$el.parentNode,e=t&&t.getBoundingClientRect(),i=this.opt.width/this.opt.height,s=e&&e.width||0,o=Math.floor(s/i);0!==s&&(t.style.height=o+"px",this.__gWidth=s,this.__gHeight=o,this.__txPlayer.resize({width:s,height:o}))}catch(hi){}}),0):setTimeout((()=>{const t=this.$el.parentNode,e=t&&t.getBoundingClientRect(),i=this.opt.width/this.opt.height,s=e&&e.width||0,o=Math.floor(s/i);0!==s&&(t.style.height=o+"px",this.__gWidth=s,this.__gHeight=o,this.setVideoSize({width:s,height:o}))}),250)))},getCache(){const t=function(t,e,i,s){let o=Le.get(s);if(!o)return null;try{if(o=JSON.parse(o)||{},!o.time||Date.now()-De.cacheTime>1*o.time)return Xe(s),o.videoInfo={status:Qe(t,e,i,s)},o}catch(hi){return Xe(s),null}return o=o.videoInfo?o:{videoInfo:{}},o.videoInfo.status=Qe(t,e,i,s),o.videoInfo?o:null}(this.opt.__biz,this.opt.mid,this.opt.idx,this.opt.vid);if(t){const e=this.__vInfo;e.dynamicData=t.videoInfo.dynamicData||null,e.coverUrl=t.videoInfo.coverUrl||"",e.status=t.videoInfo.status||null,this.__cacheStartTs=t.time||null}},cacheData(){const t=this.$refs.player,e=this.__vInfo;t&&(e.status||(e.status={}),"function"==typeof t.isEnd&&(e.status.isEnd=t.isEnd()),"function"==typeof t.getCurTime&&(e.status.playTime=t.getCurTime()),"function"==typeof t.getPlaybackRate&&(e.status.playbackRate=t.getPlaybackRate()),!this.__initialData&&this.__coverUrl&&(e.coverUrl=this.__coverUrl),function(t,e,i,s,o,a){let r={dynamicData:o.dynamicData||null,coverUrl:o.coverUrl||""};const n=Date.now()+864e5;Le.set(s,JSON.stringify({time:a||Date.now(),videoInfo:r}),n),o.status&&Le.set(t+e+i+s,JSON.stringify(o.status),n)}(this.opt.__biz,this.opt.mid,this.opt.idx,this.opt.vid,this.__vInfo,this.__cacheStartTs))},clearCache(){Xe(this.opt.vid)},leaveReport12710(){const t={type:this.opt.leaveReport12710Type,step:17,useruin:this.opt.uin,bizuin:this.opt.__biz,mid:this.opt.mid,idx:this.opt.idx,vid:this.opt.vid,is_temp_url:window.is_temp_url||0};x.addReport((()=>{const e=this.getRealPlayTime();if(!e)return!1;const i=this.getVideoData();return t.duration=Math.round(1e3*i.time),t.fromid=this.getFromid(),t.clienttime=Date.now(),t.real_play_time=e,t.appmsg_scene=window.source||window.scene||0,{reportUrl:"https://mp.weixin.qq.com/mp/ad_video_report?action=video_play_exit_report",reportData:Object.keys(t).map((e=>"".concat(e,"=").concat(encodeURIComponent(t[e]||"")))).join("&"),method:"POST"}}))},getCoverUrl(){let t="";if(this.__initialData&&this.__initialData.initialCover?t=this.__initialData.initialCover:this.opt.isMpVideo&&(this.opt.mpVideoCoverUrl||window.__mpVideoCoverUrl)?(t=this.opt.mpVideoCoverUrl||window.__mpVideoCoverUrl,delete window.__mpVideoCoverUrl,this.opt.mpVideoCoverUrl=""):this.__vInfo.coverUrl&&(t=this.__vInfo.coverUrl),t)return this.__coverUrl=t,this.__dataCount++,this.videoDataReady(),void this.getFloatCoverBase64(this.__coverUrl);this.__coverUrl=qe(this.opt.vid,this.opt.isMpVideo),this.__dataCount++,this.videoDataReady(),this.getFloatCoverBase64(this.__coverUrl)},getDynamicData(){try{!this.opt.isMpVideo||this.isDramaVideo||!window.__videoPageInfos||window.__videoPageInfos.length&&window.__videoPageInfos.find((t=>t.video_id===this.opt.vid))||this.reportPerf23442({EventType:4,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,PlayErrType:100001})}catch(s){}const t=window.cgiData.is_teenager||window.is_teenager;if(this.isDramaVideo&&!t){if(!A.isWechat)return this.__dynamicErrMsg="请在微信客户端打开",this.__reportData.videoerror=je.NOT_IN_WECHAT,this.__reportData.duration_ms=0,this.__vInfo.dynamicData=null,this.__dataCount=this.__targetDataCount,void setTimeout((()=>this.videoDataReady()),0);if(this.cgiData.is_drama_ban||!window.__dramaVideoTransInfo||!window.__dramaVideoTransInfo.length)return this.__dynamicErrMsg="视频暂时无法播放",this.__reportData.videoerror=je.VIDEO_BAN,this.__reportData.duration_ms=0,this.__vInfo.dynamicData=null,this.__dataCount=this.__targetDataCount,setTimeout((()=>this.videoDataReady()),0),void T.error("player controller: failed to play drama video: isDramaBan:".concat(this.cgiData.is_drama_ban," transInfo:").concat(window.__dramaVideoTransInfo&&window.__dramaVideoTransInfo.length));this.__dataCount++;const t=window.__dramaVideoTransInfo,e=t[0],i=this.cgiData.drama_info||{};return this.__vInfo.dynamicData={data:{formatid:1*e.format_id||0,time:e.duration||0,title:i.drama_title||"",width:e.width||0,height:e.height||0,file_size:e.filesize||0,totalUrl:e.play_url?e.play_url.htmlDecode():"",rate:0,flow:0,ori_url_info:t.map((t=>(t.play_url=t.play_url?t.play_url.htmlDecode():"",t))),vid:this.opt.vid,uploadtime:cgiData.upload_time,bizuin:cgiData.src_bizuin}},delete window.__dramaVideoTransInfo,void this.videoDataReady()}if(this.opt.isMpVideo&&!t&&(this.opt.mpVideoTransInfo&&this.opt.mpVideoTransInfo.length>0||window.__mpVideoTransInfo&&window.__mpVideoTransInfo.length>0)){this.__dataCount++;const t=this.$store.state.cgiData,e=this.opt.mpVideoTransInfo&&this.opt.mpVideoTransInfo.length>0?this.opt.mpVideoTransInfo:window.__mpVideoTransInfo,i=this.opt&&this.opt.videoPageInfo||{};return this.__vInfo.dynamicData={data:ze({h265:this.__supportH256,src_vid:this.opt.vid,src_bizuin:t.src_bizuin||i.videoid_bizuin,src_vid_uploadtime:t.upload_time||i.videoid_uploadtime,hit_vid:t.hit_vid||i.hit_vid,hit_bizuin:t.hit_bizuin||i.hit_bizuin,hit_vid_uploadtime:t.hit_upload_time,url_info:e.map((t=>(t.url=t.url?t.url.htmlDecode():"",t)))})},delete window.__mpVideoTransInfo,this.opt.mpVideoTransInfo=[],void this.videoDataReady()}if(this.__vInfo.dynamicData&&!t){this.__dataCount++;let t=this.__vInfo.dynamicData;return this.__reportData.getvinfo_ret=void 0!==t.ret_code?t.ret_code:-2,this.__reportData.getvinfo_time=t.c_time||0,this.opt.isMpVideo&&t.data&&t.data.ori_url_info&&t.data.ori_url_info.length>0&&(this.__vInfo.dynamicData={data:ze({h265:this.__supportH256,src_vid:t.data.vid,src_bizuin:t.data.bizuin,src_vid_uploadtime:t.data.uploadtime,hit_vid:t.data.hit_vid,hit_bizuin:t.data.hit_bizuin,hit_vid_uploadtime:t.data.hit_uploadtime,url_info:t.data.ori_url_info})}),void this.videoDataReady()}if(t)return this.__dynamicErrMsg="未成年人模式下暂不支持观看视频",this.__reportData.duration_ms=0,this.__vInfo.dynamicData=null,this.__dataCount=this.__targetDataCount,void setTimeout((()=>this.videoDataReady()),0);const e=this.__monitorUid,i=this.__monitorUid2;if(this.opt.isMpVideo){const t=(Object.keys(this.opt.videoPageInfo||[]).length?this.opt.videoPageInfo:window.__videoPageInfo)||{};let e="",s=0;return t.is_mp_video_delete?(e="该视频已被发布者删除",s=72,this.triggerEvent("setMonitor",i,{70:1})):t.is_mp_video_forbid?90016===t.mp_video_forbid_reason?(e="该视频因版权问题暂无法播放",s=73,this.triggerEvent("setMonitor",i,{102:1})):(e="该视频因违规已下架",s=73,this.triggerEvent("setMonitor",i,{71:1})):1*t.is_mp_video_transing==1?(e="正在转码，转码完成后可播放",s=78,this.triggerEvent("setMonitor",i,{75:1})):t.is_mp_video_checking?(e="审核中",s=75,this.triggerEvent("setMonitor",i,{72:1})):t.is_mp_video_check_fail?(e="审核失败",s=76,this.triggerEvent("setMonitor",i,{73:1})):1*t.is_appmsg_unauthorized==1?(e="该视频因未经授权使用而无法查看",s=77,this.triggerEvent("setMonitor",i,{74:1})):1*t.mp_video_overseas_limit>=1?(e="该内容因版权原因在该地区无法播放",s=77,this.triggerEvent("setMonitor",i,{103:1})):(e=De.defaultErrorWording,s=71,this.triggerEvent("setMonitor",i,{69:1})),this.triggerEvent("sendMonitor",i),this.$nextTick((()=>{console.log("[videoplayer] error on getDynamicData",s,e),this.__reportData.videoerror=s,this.__dynamicErrMsg=e||"",this.__reportData.duration_ms=0,this.__vInfo.dynamicData=null,this.__dataCount=this.__targetDataCount,this.videoDataReady()})),void this.reportPerf23442({EventType:4,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,PlayErrType:s<0?1e5-s:s})}!function(t){let e=t.retry||1;const i=Date.now(),s="function"==typeof t.onSuccess?t.onSuccess:()=>{},o=(i,s)=>{if(i&&i<-20&&e>0)return e--,void r();"function"==typeof t.onError&&t.onError(i,s)},a=["https://h5vv6.video.qq.com/getvinfo?dtype=1&otype=ojson&appVer=1&encryptVer=6.3&platform=61001&use_proxy_sdk=0","https:"===location.protocol?"&sphttps=1":"","&vid=",t.vid,"&cKey=",t.ckey,"&sdtfrom=",l.getsdtfrom(),"&device=",l.getPlatformType(),t.h265?"&hevclv=16":""].join("");function r(){S({type:"GET",dataType:"json",timeout:3e4,url:a,notJoinUrl:!0,noXRequestedWidthHeader:!0,success:e=>{const a=Date.now()-i;void 0===(e=e||{}).em&&(e.em=0);let r,n=e.em;if(0==e.em){if(e.exem>0?n=-4:0==e.exem&&e.vl&&e.vl.vi&&e.vl.vi[0]&&8==e.vl.vi[0].st&&(n=e.preview>0?-5:-3),0!=n||e.vl&&e.vl.vi&&e.vl.vi[0]||(n=-2),0==n){let t=e.vl.vi[0];if(r={newVid:t.lnk,time:Math.floor(t.td),title:t.ti,width:t.vw,height:t.vh,file_size:t.fs,rate:Math.round(t.fs/1024*8/t.td),flow:(parseFloat(t.fs)/1024/1024).toFixed(2)},t.ul&&t.ul.ui&&t.ul.ui[0]){let i=t.ul.ui[0],s=i.url+t.fn,o=e.fl,a="";if(o&&o.cnt>0){r.formatid=10003,a="高清",r.resolution="高清;(480P)".replace(/^.*;\((:?.*)P\)$/,"$1")||0,r.format=a,r.vt=i.vt,r.totalUrl=[s,-1!=s.indexOf("?")?"&":"?","vkey=",t.fvkey,"&sdtfrom=",l.getsdtfrom(),"&type=",1==i.dt?"tflv":2==i.dt||0==i.dt?"mp4":"","&platform=",l.getPlatformType(),"&fmt=",a,"&level=",t.level,"&br=",t.br,"&sp=",t.sp].join("");for(let t=0;t<o.fi.length;t++)if(o.fi[t].sl){-1!==[2,8].indexOf(o.fi[t].video)&&(r.formatid+=100);break}}else n=-2}}0==n?(l.getinfoReport({vid:t.vid,val:a,val1:n,vurl:r.totalUrl}),s({data:r,oriData:e,c_time:a,ret_code:n})):(l.getinfoReport({vid:t.vid,val:a,val1:n,vurl:""}),o(-2,{ret_code:n,http_status:200,c_time:a,err_msg:Je(1*n,1*e.exem)}))}else o(n,{ret_code:n,http_status:200,c_time:a,err_msg:Je(n)})},error:e=>{const s=Date.now()-i;let a;a=e?e.status>=200&&e.status<400?-23:e.status>=400&&e.status<500||e.status>=500&&e.status<600?-22:(0==e.status&&e.readyState,-21):-23,l.getinfoReport({vid:t.vid,val:s,val1:a,vurl:""}),o(a,{ret_code:a,http_status:e&&e.status||0,c_time:s,err_msg:Je(-1)})}})}$e(r)}({vid:this.opt.vid,ckey:this.opt.ckey,h265:this.__supportH256,onSuccess:t=>{if(this.triggerEvent("setMonitor",e,{10:1,11:1,13:Math.min(t.c_time,6e4)}),t.data.width&&t.data.height){let i=Math.round(10*t.data.width/t.data.height*1);i>20?i=20:i<0&&(i=0);const s={};s[41+2*i]=1,this.triggerEvent("setMonitor",e,s)}else this.triggerEvent("setMonitor",e,{83:1});this.triggerEvent("sendMonitor",e),this.__dataCount++,this.__vInfo.dynamicData=t,this.__reportData.getvinfo_ret=t.ret_code,this.__reportData.getvinfo_time=t.c_time,this.__reportData.file_size=t.data.file_size,this.__reportData.rate=t.data.rate,this.__reportData.resolution=t.data.resolution,this.__reportData.format=t.data.format,this.__reportData.vt=t.data.vt,this.__reportData.video_ext=l.getsdtfrom(),this.videoDataReady()},onError:(t,i)=>{if(this.triggerEvent("setMonitor",e,{10:1,12:1,13:Math.min(i.c_time,6e4)}),-2==t)switch(1*i.ret_code){case-2:this.triggerEvent("setMonitor",e,{17:1}),this.__reportData.videoerror=2;break;case-3:this.triggerEvent("setMonitor",e,{40:1}),this.__reportData.videoerror=53;break;case-4:this.triggerEvent("setMonitor",e,{109:1}),this.__reportData.videoerror=54;break;case-5:this.triggerEvent("setMonitor",e,{110:1}),this.__reportData.videoerror=55;break;case 61:this.triggerEvent("setMonitor",e,{18:1}),this.__reportData.videoerror=25;break;case 62:this.triggerEvent("setMonitor",e,{19:1}),this.__reportData.videoerror=26;break;case 64:this.triggerEvent("setMonitor",e,{20:1}),this.__reportData.videoerror=27;break;case 67:this.triggerEvent("setMonitor",e,{21:1}),this.__reportData.videoerror=28;break;case 69:this.triggerEvent("setMonitor",e,{22:1}),this.__reportData.videoerror=52;break;case 80:this.triggerEvent("setMonitor",e,{23:1}),this.__reportData.videoerror=29;break;case 81:this.triggerEvent("setMonitor",e,{24:1}),this.__reportData.videoerror=50;break;case 85:this.triggerEvent("setMonitor",e,{25:1}),this.__reportData.videoerror=51;break;default:this.triggerEvent("setMonitor",e,{26:1}),this.__reportData.videoerror=24}else{switch(1*t){case-21:this.triggerEvent("setMonitor",e,{14:1});break;case-22:this.triggerEvent("setMonitor",e,{15:1});break;case-23:this.triggerEvent("setMonitor",e,{16:1})}this.__reportData.videoerror=-1*t}this.triggerEvent("sendMonitor",e),this.__dynamicErrMsg=i.err_msg||"",this.__reportData.getvinfo_ret=i.ret_code,this.__reportData.duration_ms=0,this.__reportData.getvinfo_time=i.c_time||0,this.__vInfo.dynamicData=null,this.__dataCount=this.__targetDataCount,this.videoDataReady(),this.reportPerf23442({EventType:4,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,PlayErrType:this.__reportData.videoerror<0?1e5-this.__reportData.videoerror:this.__reportData.videoerror}),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("TxGetVInfoApi:".concat(i.http_status),"httpStatus: ".concat(i.http_status,"; errorCode: ").concat(this.__reportData.videoerror,"; vid: ").concat(this.opt.vid,"; ckey: ").concat(this.opt.ckey),{mid:"mmbizwap:txvideo_api",view:"wap_business"})}})},videoDataReady(){this.__dataCount===this.__targetDataCount&&(this.__isShowTx?this.removeLoading():this.__vInfo.dynamicData?this.createPlayer():(this.removeLoading(),T.error("player controller: failed to create player because no dynamic data")))},createPlayer(){let t=this.__vInfo,e=this.__reportData,i=t.dynamicData.data;var s;this.__reportData.duration_ms=parseInt(1e3*i.time),this.initPlayRangeInfo({durationMs:this.__reportData.duration_ms}),e.vtitle=this.opt.vtitle||i.title||"",this.initImmersiveReportCommonData(2),s=()=>{this.initImmersiveReportCommonData(3),this.__hasReport23439EnterStatus<3&&(-1===this.controlPlugins.indexOf(_e)||2===this.__hasReport23439EnterStatus?(this.__hasReport23439EnterStatus=3,this.opt.preCreate||this.reportEnter23439()):this.__hasReport23439EnterStatus=1)},window.ext_complete?s():N.on("ext-complete",s);const o=this.getReportTypeBySceneType();let a,r;if(i.ori_url_info){const t=He({h265:this.__supportH256,url_info:i.ori_url_info});a=i.ori_url_info.find((t=>10004===t.format_id)),r=Object.keys(t).filter((t=>1*t!==De.definitionMap[20003]||this.opt.useWcSlPlayer&&A.isWechat&&A.isAndroid&&A.gtVersion("7.0.16",1))).sort(((t,e)=>e-t)).map((e=>{const i=t[e];return{name:i.video_quality_wording||De.resolutionNameMap[i.format_id],formatId:i.format_id,height:i.height,width:i.width,src:i.url}}))}const n=k.getQuery("play_time");let l=0;this.__initialData?l=this.__initialData.initialTime||0:""!==n?l=1*n||0:t.status&&!t.status.isEnd&&(l=t.status.playTime||0),console.info("[Video Info]",i),T.info("player controller: begin to create player",JSON.stringify(i));const h=window.__videoPageInfos||[window.__videoPageInfo];if(Array.isArray(h)&&h.length){const t=h.find((t=>t.video_id===this.opt.vid));this.__coverUrl_16_9=t&&t.cover_url_16_9}this.playerOpt={...this.opt,__biz:this.opt.__biz,mid:this.opt.mid,idx:this.opt.idx,bizUserName:this.opt.bizUserName,bizNickName:this.opt.bizNickName,profileTabType:this.opt.profileTabType,videoTitle:e.vtitle,videoReportType:o,coverFit:this.opt.coverFit,cover:this.__coverUrl,cover_16_9:this.__coverUrl_16_9,width:this.__gWidth,height:this.__gHeight,videoWidth:i.width,videoHeight:i.height,duration:i.time,autoplay:this.opt.autoplay,flowNotice:this.opt.flowNotice,flow:i.flow,loop:this.opt.loop,muted:this.opt.muted,src:i.totalUrl,formatId:i.formatid,headImgUrl:this.opt.headImgUrl,useWcSlPlayer:this.opt.useWcSlPlayer,useImmersiveMode:this.opt.useImmersiveMode,useFeFullscreen:this.opt.useFeFullscreen,oriStatus:this.opt.oriStatus,initialTime:l,resolutionInfo:r,retryResolution:a,playbackRateInfo:De.playbackRateInfo,playbackRateBtnInfoDefaultId:2,showFullscreenMenu:this.opt.showFullscreenMenu,videoMd5:this.opt.videoMd5,extinfo:{hit_bizuin:this.opt.hitBizuin,hit_vid:this.opt.hitVid,vid:this.opt.vid,preview:this.opt.preview,pageplayer:this},fileSize:i.file_size,checkPlayAuthority:this.checkPlayAuthority,readNum:this.__immersiveData&&this.__immersiveData.view_num&&this.__immersiveData.view_num.pv||0,praiseNum:this.__immersiveData&&this.__immersiveData.like_num&&this.__immersiveData.like_num.pv||0,likeNum:this.__immersiveData&&this.__immersiveData.seen_num&&this.__immersiveData.seen_num.pv||0,isPraised:this.__immersiveData&&this.__immersiveData.like_num&&this.__immersiveData.like_num.liked||0,isLiked:this.__immersiveData&&this.__immersiveData.seen_num&&this.__immersiveData.seen_num.seen||0},this.qqVideoReport({step:3}),this.$nextTick((()=>{this.initPlugins(),this.triggerEvent("playerReady")}))},removeLoading(){this.afterRemoveLoading()},afterRemoveLoading(){if(!this.__isShowTx&&!this.__vInfo.dynamicData)if(this.opt.isMpVideo){let t=1;(72==this.__reportData.videoerror||73==this.__reportData.videoerror||window.cgiData.is_teenager||window.is_teenager||-1!==Object.values(je).indexOf(this.__reportData.videoerror))&&(t=2),this.showError(this.__dynamicErrMsg,t)}else this.isDramaVideo?this.showError(this.__dynamicErrMsg||"",2):this.showError(this.__dynamicErrMsg||"",window.cgiData.is_teenager||window.is_teenager?2:void 0);const t=this.getVideoData();this.triggerEvent("videoReady",{formatId:t&&t.formatid})},showError(t,e){t=t||De.defaultErrorWording,this.setError({type:e||1,code:this.__reportData.videoerror,msg:t,refresh:t===De.defaultErrorWording?1:0}),this.disableTopSticky()},hideError(){this.setError({type:0,code:0,msg:"",refresh:0})},checkPlayAuthority(t){this.opt.checkNoPaid?S({type:"GET",dataType:"json",timeout:3e4,url:"/mp/videoplayer?action=check_video_paid_status&__biz=".concat(this.opt.__biz,"&mid=").concat(this.opt.mid,"&idx=").concat(this.opt.idx),success:e=>{1==!e.can_play?window.weui.confirm("此视频来自于付费内容，在原文付费后才可播放",{buttons:[{type:"default",label:"取消"},{label:"前往原文",onClick:()=>{this.opt.openArticle()}}]}):"function"==typeof t.allowPlay&&t.allowPlay()}}):"function"==typeof t.allowPlay&&t.allowPlay()},onLoaded(){setTimeout((()=>{this.removeLoading()}),0),T.info("player controller: succ created player")},onTimeupdate(t){if(!this.__reportedTimeupdate){this.__reportedTimeupdate=!0,n.report({step:6,vid:this.opt.vid,traceid:this.getTraceId(),orderid:this.getOrderid(),type:this.getReportTypeBySceneType(),fromid:this.opt.fromid});const t=this.$refs.player.getLog().loadwait||0;this.qqVideoReport({step:6,loadwait:t})}if(!this.__reportedPv){this.__reportedPv=!0;const t=this.__monitorUid,e=this.__monitorUid2;this.triggerEvent("clearMonitor",t),this.triggerEvent("clearMonitor",e),this.opt.isMpVideo?(this.triggerEvent("setMonitor",e,{12:1,13:1}),this.triggerEvent("sendMonitor",e)):(this.triggerEvent("setMonitor",t,{0:1,1:1}),this.triggerEvent("sendMonitor",t))}this.__reportData.last_ms=parseInt(1e3*t.currentTime),this.__reportData.video_play_time=parseInt(1e3*t.currentTime),this.reportCurRangeInfo({curTime:this.__reportData.last_ms}),this.triggerEvent("timeupdate",t)},onBeginPlay(){const t=this.__reportData;t.client_time_when_play=Math.round(Date.now()/1e3),t.click_play_button=1,!this.$refs.player.autoplay&&this.recoverPlaybackRate(),this.triggerEvent("beginPlay")},onDurationchange(){this.$refs.player.autoplay&&this.recoverPlaybackRate()},onEnterFullscreen(t){this.__preventResize=!0,this.$refs.player.needFeFullscreen&&C.supportImmersiveMode&&this.$refs.player.canShareVideo&&g.currentMpInfo({disableShowFinderLiveTopBar:1,isDisableMenuHeader:!0,itemShowType:"16",canReadArticle:!1}),this.triggerEvent("enterfullscreen",t)},onExitFullscreen(){document.body.style.backgroundColor=null,this.__preventResize=!1,this.$refs.player.needFeFullscreen&&C.supportImmersiveMode&&this.$refs.player.canShareVideo&&g.currentMpInfo({disableShowFinderLiveTopBar:0,isDisableMenuHeader:!1,itemShowType:window.item_show_type,canReadArticle:window.canReadArticle||!1}),this.triggerEvent("exitfullscreen")},onFullLandscapeModeChange(t){90===t&&(this.showScreenshotMask=!0)},onFullscreenchange(t){if(t.state?(this.__kanReportData.has_full_screen=1,document.body.style.backgroundColor="#000",document.body.style.overflow="hidden"):(this.showScreenshotMask=!1,document.body.style.overflow="auto",document.body.style.backgroundColor=null),"immersive"===t.type||"samelayer"===t.type&&C.supportImmersiveMode||"frontend"===t.type)if(t.state){if(("immersive"===t.type||this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange)&&this.onEnterFullscreen(),this.setLoop(!0),this.opt.preCreate||(this.setVideoShareInfo(),this.setVideoMenuItems()),f.hideCurrentMpInfo(),this.setOp23444ReportExData({FullscreenType:2}),this.setReload23445ReportExData({FullscreenType:2}),"immersive"!==t.type){const e=!this.opt.useImmersiveMode&&"samelayer"===t.type&&this.$refs.player&&this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange;this.opt.preCreate||this.reportOp23444({EventType:e?15:11,EventTime:this.getCurrentTimeMs(),FullscreenType:e?3:2});const i=this.getIntervalPlayTimeFor23443(),s=this.getIntervalStayTimeFor23443();this.__23443ReportPageTotalPlayTime+=i,this.__23443ReportPageTotalStayTime+=s,this.reportLeave23443({EventType:2,EventTime:this.getCurrentTimeMs(),PagePlayTime:i,PageStayTime:s})}"immersive"===t.type?b.setSum(283598,0,1):"frontend"===t.type?b.setSum(283598,1,1):b.setSum(283598,2,1)}else if(this.setLoop(this.opt.loop),this.opt.preCreate||(this.recoverVideoShareInfo(),this.recoverVideoMenuItems()),this.setOp23444ReportExData({FullscreenType:1}),this.setReload23445ReportExData({FullscreenType:1}),"immersive"!==t.type){const e=!this.opt.useImmersiveMode&&"samelayer"===t.type&&this.$refs.player&&this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange;this.reportOp23444({EventType:e?16:14,EventTime:this.getCurrentTimeMs()});const i=this.getIntervalPlayTimeFor23443(),s=this.getIntervalStayTimeFor23443();this.__23443ReportImmersiveTotalPlayTime+=i,this.__23443ReportImmersiveTotalStayTime+=s,this.reportLeave23443({EventType:3,EventTime:this.getCurrentTimeMs(),ImmersivePlayTime:i,ImmersiveStayTime:s})}this.topStickyInfoStatus>0&&(t.state?this.$refs.player.resumeOperating():this.$refs.player.preventOperating()),this.triggerEvent("fullscreenchange",t)},onOrientationStatusChange(){if(this.fullscreenStatus&&this.$refs.player&&(this.opt.useImmersiveMode||!this.$refs.player.isWcSlPlayer||!this.$refs.player.enableWcSlPlayerFullscreenAfterOrientationChange)){const t=0===this.orientationStatus?2:3;this.setOp23444ReportExData({FullscreenType:t}),this.setReload23445ReportExData({FullscreenType:t}),this.reportOp23444({EventType:0===this.orientationStatus?13:12,EventTime:this.getCurrentTimeMs()})}},onTouchVideo(){this.triggerEvent("touchVideo")},onShareVideo(){if(this.opt.preview)return void window.weui.alert("预览状态下无法分享视频");window.customShareSource=3,this.fullscreenStatus||this.setVideoShareInfo({itemShowType:"16",disableShowFinderLiveTopBar:1,isDisableMenuHeader:!0});const t=E.debounce((e=>{(A.isIOS?!!(1*e.hasFocus):!e.hasFocus)||(M.remove("onWindowFocusChanged",t),this.fullscreenStatus||this.recoverVideoShareInfo(),delete window.customShareSource)}),100);M.on("onWindowFocusChanged",t),this.reportOp23444({EventType:24,EventTime:this.getCurrentTimeMs()})},onPraiseVideo(){this.opt.preview?window.weui.alert("预览状态下无法点赞视频"):(this.playerOpt.isPraised=!this.playerOpt.isPraised,this.playerOpt.isPraised?this.playerOpt.praiseNum++:this.playerOpt.praiseNum--,st({biz:this.opt.__biz,vid:this.opt.vid,mid:this.opt.mid,idx:this.opt.idx,type:this.playerOpt.isPraised?3:5,styleType:6}),this.reportOp23444({EventType:25,EventTime:this.getCurrentTimeMs()}))},onLikeVideo(t){if(this.opt.preview)return void window.weui.alert("预览状态下无法在看视频");const e=this.cgiData,i=t&&1*t.recommend||!this.playerOpt.isLiked;console.log("[like video]"),t&&t.comment?this.showToast("已发送"):!this.playerOpt.isLiked&&i?(this.playerOpt.likeNum++,1*e.item_show_type==5&&(this.$store.commit("SET_RECOMMEND_STATUS",{hasRecommended:i}),this.$store.commit("SET_RECOMMEND_NUM",{recommendNum:this.playerOpt.likeNum}))):this.playerOpt.isLiked&&!i&&(this.showToast("已取消"),this.playerOpt.likeNum--,1*e.item_show_type==5&&(this.$store.commit("SET_RECOMMEND_STATUS",{hasRecommended:i}),this.$store.commit("SET_RECOMMEND_NUM",{recommendNum:this.playerOpt.likeNum}))),this.playerOpt.isLiked=i,st({biz:this.opt.__biz,vid:this.opt.vid,mid:this.opt.mid,idx:this.opt.idx,comment:t&&t.comment||"",type:i?4:6,styleType:t?5:7,onSuccess:()=>{((t,e)=>{const i={origin:"mp",isLike:t?1:0,url:encodeURIComponent(window.msg_link.html(!1)),content:e||""};M.invoke("handleHaokanAction",{action:"submitMsgToTL",recommend:t?1:0,server_data:JSON.stringify(i)},(function(t){console.log("handleHaokanAction",t)})),M.invoke("handleHaokanAction",{action:We,permission:1,recommend:t?1:0},(function(t){console.log("handleHaokanAction for client",t)}))})(i,t&&t.comment||"")},onError:()=>{t&&t.comment&&t.comment.length>200?window.weui.alert("想法不可以超过#value#字".replace("#value#",200)):window.weui.alert("网络异常，请稍后再试")}}),this.reportOp23444({EventType:26,EventTime:this.getCurrentTimeMs()})},onOpenSourcePage(){this.triggerEvent("openSourcePage"),this.reportOp23444({EventType:20,EventTime:this.getCurrentTimeMs()})},onShowSubscribe(){this.triggerEvent("showSubscribe"),this.__hasReport23444SubscribeBtnExpose||(this.__hasReport23444SubscribeBtnExpose=!0,this.reportOp23444({EventType:22,EventTime:this.getCurrentTimeMs()}))},onClickSubscribe(){this.triggerEvent("clickSubscribe"),this.reportOp23444({EventType:23,EventTime:this.getCurrentTimeMs()})},onFastForward(){this.triggerEvent("fastForward"),this.reportOp23444({EventType:17,EventTime:this.getCurrentTimeMs()})},onReplay(){this.triggerEvent("replay")},onStatusChange(t){const e=this.__reportData;if("loading"!==t.status||"seeked"!==t.subStatus&&"seeking"!==t.subStatus||this.initPlayRangeInfo({durationMs:e.duration_ms}),"pause"===t.status?(this.computePlayTotalTimeForKyk(t),this.__kanReportData.pause_cnt+=1):"play"===t.status?this.__videoReportInfo.every_start_play_time=Math.round(1e3*t.currentTime):"end"===t.status&&(this.__videoReportInfo.every_end_play_time=Math.round(1e3*this.getCurrentTime()),console.log("real play time"+this.__videoReportInfo.total_play_time),this.__kanReportData.play_time=this.__videoReportInfo.total_play_time,this.__kanReportData.end_play_time=Date.parse(new Date)/1e3,this.__kanReportData.has_end=1,m.reportKanData(this.__kanReportData)),"loading"===t.status&&"waiting"===t.subStatus){let e=0;"play"===t.preStatus?e=1:"loading"===t.preStatus&&"seeked"===t.preSubStatus?e=2:"loading"===t.preStatus&&"resolutionchange"===t.preSubStatus&&(e=3),e&&this.reportPerf23442({EventType:2,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,BufferType:e})}this.triggerEvent("statusChange",t)},onAfterReplay(){this.triggerEvent("afterReplay")},onHandDragComplete(t){this.reportOp23444({EventType:8,EventTime:this.getCurrentTimeMs(),BarBefore:t.startDragVideoTime+"",BarAfter:t.playTime+""}),this.triggerEvent("handDragComplete",t)},onBarDragComplete(t){this.triggerEvent("barDragComplete",t),this.reportOp23444({EventType:7,EventTime:this.getCurrentTimeMs(),BarBefore:t.startDragVideoTime+"",BarAfter:t.playTime+""})},onEnd(){const t=this.__vInfo,e=this.__reportData,i=t.dynamicData.data,s=this.getReportTypeBySceneType();e.hasended=1,n.report({step:7,vid:this.opt.vid,ext1:1e3*i.time,traceid:this.getTraceId(),orderid:this.getOrderid(),type:s,fromid:this.opt.fromid}),this.triggerEvent("beforeEnd",this.playerOpt.loop),this.playerOpt.loop?(this.__reportedPv=!1,this.__reportData.replay=1,this.qqVideoReport({step:3})):this.triggerEvent("resetVideo"),this.triggerEvent("end",this.playerOpt.loop),this.reportCurRangeInfo({curTime:e.last_ms}),this.initPlayRangeInfo({durationMs:e.duration_ms})},onError(t){const e=this.__reportData,i=this.__monitorUid,s=this.__monitorUid2;if(!t||!t.errorcode||t.errorcode>5||t.errorcode<=0?e.videoerror=46:e.videoerror=t.errorcode+40,this.opt.isMpVideo){switch(this.__reportedPv||(this.__reportedPv=!0,this.triggerEvent("setMonitor",s,{12:1})),this.triggerEvent("setMonitor",s,{14:1}),1*t.errorcode){case 1:this.triggerEvent("setMonitor",s,{15:1});break;case 2:this.triggerEvent("setMonitor",s,{16:1});break;case 3:this.triggerEvent("setMonitor",s,{17:1});break;case 4:this.triggerEvent("setMonitor",s,{18:1});break;case 5:this.triggerEvent("setMonitor",s,{19:1});break;case 6:this.triggerEvent("setMonitor",s,{39:1});break;default:this.triggerEvent("setMonitor",s,{20:1})}this.triggerEvent("sendMonitor",s)}else{switch(this.__reportedPv||(this.__reportedPv=!0,this.triggerEvent("setMonitor",i,{0:1})),this.triggerEvent("setMonitor",i,{2:1,3:1}),1*t.errorcode){case 1:this.triggerEvent("setMonitor",i,{4:1});break;case 2:this.triggerEvent("setMonitor",i,{5:1});break;case 3:this.triggerEvent("setMonitor",i,{6:1});break;case 4:this.triggerEvent("setMonitor",i,{7:1});break;case 5:this.triggerEvent("setMonitor",i,{8:1});break;default:this.triggerEvent("setMonitor",i,{9:1})}this.triggerEvent("sendMonitor",i),this.triggerEvent("sendMonitor",s)}e.v_err_code=t.errorcode;const o=(Object.keys(this.opt.videoPageInfo||[]).length?this.opt.videoPageInfo:window.__videoPageInfo)||{};-1!==[3,4].indexOf(e.v_err_code)&&window.is_temp_url&&o.is_mp_video_transing?this.showError("正在转码，转码完成后可播放"):this.showError(),this.qqVideoReport({step:1999,val:e.videoerror}),this.initPlayRangeInfo({durationMs:e.duration_ms})},onErrorRetry(){const t=this.__monitorUid2;this.triggerEvent("setMonitor",t,{64:1}),this.triggerEvent("sendMonitor",t)},onFirstBufferingTime(t){var e;let i;this.reportPerf23442({EventType:1,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,BufferTime:t.bufferingTime}),i=this.__hasFirstPlayed?3:this.$refs.player.autoplay?1:2;const s={PlayType:i};if(this.opt.isMpVideo){const t=this.$store.state.cgiData,i=this.getVideoData(),o=null==(e=i.ori_url_info)?void 0:e.some((t=>1*t.format_id%1e3>100)),a=1*i.formatid%1e3>100,r=1*i.formatid>2e4;Object.assign(s,{VideoIdUploadTime:i.uploadtime||0,VideoIdBizUin:1*i.bizuin||0,HitVideoId:i.hit_vid||"",HitVideoIdUploadTime:i.hit_uploadtime||0,MassSendTimeStamp:t.create_time||0,HitBizUin:1*i.hit_bizuin||0,HasH265:o?1:0,UseH265LinkPlay:a?1:0,VideoPlayType:r?2:1})}if(this.reportPlay23440(s),this.reportH265Play(),this.__kanReportData.start_play_time=Date.parse(new Date)/1e3,this.__hasFirstPlayed){this.__kanReportData.replay_cnt+=1;const t={rec_expand:E.getParam("rec_expand")||"",scene:E.getParam("scene")||"",report_action:1,vid:this.opt.vid,end_play_time:0,play_time:0,has_end:0,pause_cnt:0,auto_play:this.opt.autoplay?1:0,has_full_screen:this.fullscreenStatus?1:0};this.__videoReportInfo={hasUnloadReport:!1,hasApiReport:!1,every_start_play_time:0,every_end_play_time:0,total_play_time:0},this.__kanReportData=Object.assign(this.__kanReportData,t)}else this.__hasFirstPlayed=!0;!function(t){let e="/mp/immersive_player?action=player_report&item_show_type=".concat(window.real_item_show_type);Object.keys(t).forEach((i=>{"onSuccess"!==i&&"onError"!==i&&void 0!==t[i]&&(e+="&"+i+"="+t[i])})),D({url:e,dataType:"json",timeout:3e4,type:"GET",scope:"mmbiz_video",success(e){var i;0===(null==(i=null==e?void 0:e.base_resp)?void 0:i.ret)?"function"==typeof t.onSuccess&&t.onSuccess(e):"function"==typeof t.onError&&t.onError(e)},error(e){"function"==typeof t.onError&&t.onError(e)},complete(e){"function"==typeof t.onComplete&&t.onComplete(e)}})}({biz:this.opt.__biz,vid:this.opt.vid,mid:this.opt.mid,idx:this.opt.idx});const o=JSON.parse(sessionStorage.getItem("hasReadList"));sessionStorage.setItem("hasReadList",JSON.stringify([...o||[],{biz:this.opt.__biz,vid:this.opt.vid,mid:this.opt.mid,idx:this.opt.idx}])),this.triggerEvent("firstBufferingTime",t)},onPlayingBufferingTime(t){this.reportPerf23442({EventType:3,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,BufferTime:t.bufferingTime}),this.triggerEvent("playingBufferingTime",t)},onFlowNotice(t){this.reportPerf23442({EventType:5,EventTime:this.getCurrentTimeMs(),Definition:this.getCurrentDefinition(),VideoWidth:this.playerOpt&&this.playerOpt.videoWidth||0,VideoHeight:this.playerOpt&&this.playerOpt.videoHeight||0,Traffic:t.flow}),this.triggerEvent("flowNotice",t)},onUserplay(t){this.triggerEvent("userplay",t);let e=6;1===t.tapType?e=4:2===t.tapType&&(e=2),this.reportOp23444({EventType:e,EventTime:this.getCurrentTimeMs()})},onUserpause(t){this.triggerEvent("userpause",{curTime:this.getCurrentTime(),...t});const e=this.__reportData;e.pause_num=(e.pause_num||0)+1;let i=5;1===t.tapType?i=3:2===t.tapType&&(i=1),this.reportOp23444({EventType:i,EventTime:this.getCurrentTimeMs()})},onWaiting(t){this.triggerEvent("waiting",t)},onPlay(t){this.__pauseTimestamp&&(this.reportOp23444({EventType:18,EventTime:this.getCurrentTimeMs(),PauseTime:Date.now()-this.__pauseTimestamp}),delete this.__pauseTimestamp),this.triggerEvent("play",t)},onPause(t){this.triggerEvent("pause",t),this.__pauseTimestamp=Date.now()},onMidPlayClick(){this.reportOp23444({EventType:19,EventTime:this.getCurrentTimeMs()})},onAfterCheckVideoFit(t){let e={97:1};!0===t.needToFit&&(e[98]=1,e[100]=1,t.os.ios&&(e[103]=1),t.os.android&&(e[106]=1),!0===t.supportObjectFit&&(e[101]=1,t.os.ios&&(e[104]=1),t.os.android&&(e[107]=1)));const i=this.__monitorUid;this.triggerEvent("setMonitor",i,e),this.triggerEvent("sendMonitor",i)},onBindError(t){this.triggerEvent("bindError",t)},onRateChange(t){this.triggerEvent("rateChange",t),"changed"===t.action&&(this.cacheData(),this.reportOp23444({EventType:9,EventTime:this.getCurrentTimeMs(),SpeedBefore:t.rateBefore+"",SpeedAfter:t.rateAfter+""}))},onResolutionChange(t){"changed"===t.action&&(De.playerStatus.formatId=t.infoAfter&&t.infoAfter.formatId||null,Le.set("playerStatus",JSON.stringify({playerStatus:De.playerStatus}),Date.now()+6048e5),M.invoke("handleMPPageAction",{action:"setLocalData",key:"formatId",data:String(De.playerStatus.formatId),url:location.href},(t=>{console.log("setLocalData"+JSON.stringify(t))})),T.info("player controller: set player status cache "+JSON.stringify(De.playerStatus)),this.reportOp23444({EventType:10,EventTime:this.getCurrentTimeMs(),DefinitionBefore:De.definitionMap[t.infoBefore.formatId]+"",DefinitionAfter:De.definitionMap[t.infoAfter.formatId]+""}),this.setPerf23442ReportExData({DefinitionBefore:De.definitionMap[t.infoBefore.formatId],VideoWidthBefore:t.infoBefore.width,VideoHeightBefore:t.infoBefore.height})),this.triggerEvent("resolutionChange",t)},onBrightnessChange(t){this.triggerEvent("brightnessChange",t)},onVolumeChange(t){this.triggerEvent("volumeChange",t)},onLoadedMetaData(){this.triggerEvent("loadedmetadata")},onProfileJump(t){this.triggerEvent("profileJump",t),this.reportOp23444({EventType:21,EventTime:this.getCurrentTimeMs()})},onProcessStateChange(t){this.triggerEvent("processStateChange",t)},onCanplay(t){this.triggerEvent("canplay",t)},onShowControlBar(t){this.triggerEvent("showControlBar",t)},onHideControlBar(t){this.triggerEvent("hideControlBar",t)},onShowMenu(t){this.triggerEvent("showMenu",t)},triggerEvent(t,...e){const i=[].concat(this.$refs.innerPlugins||[],this.$refs.coverPlugins||[],this.$refs.controlPlugins||[],this.$refs.profilePlugins||[],this.__legacyPlugins),s=this.__blockPlugin[t]||this.__blockPlugin.all;let o,a,r=0;if(s&&"function"==typeof s.recv&&(o=s.recv(t,...e),"[object Object]"===Object.prototype.toString.call(o)?(r|=o.code,a=o.data):r|=o,1&r))return a;for(let l=0,h=i.length;l<h;++l){try{o=i[l].recv(t,...e)}catch(n){console.error("player controller plugin error:",n,t,e)}if("[object Object]"===Object.prototype.toString.call(o)?(r|=o.code,a=o.data):r|=o,2&r)break}if(!(this._blockInnerHandler||4&r)){const i=this[t+"InnerHandler"];i&&(o=i.apply(this,[t,...e]),"[object Object]"===Object.prototype.toString.call(o)&&(a=o.data))}return 8&r||this.emitEvent(t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase())),...e),a},emitEvent(t,...e){t&&this.$emit(t,...e)},setBlockPlugin(t,e){this.__blockPlugin[t]=e},replaceByTxVideo(){if(!this.opt.ckey&&!this.opt.isMpVideo&&!this.isDramaVideo){this.__isShowTx=!0;let t=this.$el.getAttribute("id");t||(t="js_tx_video_container_"+Math.random(),this.$el.setAttribute("id",t));const e=L&&L.top||60;this.opt.useImmersiveMode&&(this.$el.style.paddingTop=e+"px",this.$el.style.paddingBottom="60px"),M.invoke("handleDeviceInfo",{action:"setOrientation",orientation:0,lock:!0}),et.createTxVideo({win:window,containerId:t,vid:this.opt.vid,width:this.opt.useImmersiveMode?window.screen.width:this.__gWidth,height:this.opt.useImmersiveMode?window.screen.height-e-60:this.__gHeight,autoplay:!1,allowFullScreen:!0,onSuccess:t=>{this.__txPlayer=t.player,this.__dataCount=this.__targetDataCount,this.videoDataReady()},onError:()=>{}});const i=this.__monitorUid;return 1==this.cgiData.is_login?this.triggerEvent("setMonitor",i,{38:1}):this.triggerEvent("setMonitor",i,{39:1}),this.triggerEvent("sendMonitor",i),!0}return!1},getPlayer(){return this.$refs.player},supportWcSlPlayer(){return!!this.$refs.player&&this.$refs.player.supportWcSlPlayer()},getAdvanceCodecSupportBeforeCallback(t){this.checkH265Support(t)},checkH265Support(t){if(this.opt.useWcSlPlayer&&B.os.iphone)this.__supportH256=!0,"function"==typeof t&&t(),this.reportH265Support(!0);else if(this.opt.useWcSlPlayer&&B.os.android)A.gtVersion("8.0.14",1)?M.invoke("handleVideoAction",{action:"supportCodec",codecId:172,height:1920,width:1080,frameRate:60},(e=>{const i=-1!==e.err_msg.indexOf(":ok");this.__supportH256=i,"function"==typeof t&&t(),this.reportH265Support(i)})):(this.__supportH256=!1,"function"==typeof t&&t(),this.reportH265Support(!1));else{let e=!1;e=A.isIOS&&B.os.getNumVersion()>=11?!B.isLockdownMode():A.isAndroid?this.checkH5VideoCanPlayType('video/mp4; codecs="hvc1"'):this.checkH5VideoCanPlayType('video/mp4; codecs="hevc"'),this.__supportH256=e,"function"==typeof t&&t(),this.reportH265Support(e)}},checkH5VideoCanPlayType(t){const e=document.createElement("video");if("function"==typeof e.canPlayType){const i=e.canPlayType(t);if("maybe"==i.toLowerCase()||"probably"==i.toLowerCase())return!0}return!1},reportH265Support(t=!1){if(this.opt.isMpVideo){const e=this.__monitorUid2;this.triggerEvent("setMonitor",e,{36:1}),t&&this.triggerEvent("setMonitor",e,{37:1}),this.triggerEvent("sendMonitor",e)}console.log("support h256",t)},reportH265Play(){const t=this.getVideoData();if(this.opt.isMpVideo&&t){const e=this.__monitorUid2,i=54,s={SlIOS:0,H5IOS:2,SlAndroid:4,H5Android:6,H5Others:8};let o=this.$refs.player.isWcSlPlayer?"Sl":"H5";if(A.isIOS?o+="IOS":A.isAndroid?o+="Android":o+="Others","number"==typeof s[o]){const a=i+s[o],r=1*t.formatid%1e3>100,n=t.uploadtime>1656327600,l=this.$store.state.cgiData.create_time>1656327600;this.triggerEvent("setMonitor",e,{[a]:1}),n&&this.triggerEvent("setMonitor",e,{66:1}),l&&this.triggerEvent("setMonitor",e,{68:1}),r&&(this.triggerEvent("setMonitor",e,{[a+1]:1}),n&&this.triggerEvent("setMonitor",e,{65:1}),l&&this.triggerEvent("setMonitor",e,{67:1}),window.WX_BJ_REPORT&&window.WX_BJ_REPORT.BadJs&&window.WX_BJ_REPORT.BadJs.report("H265PlayInfo","support h265: ".concat(this.__supportH256," || video data: ").concat(JSON.stringify(t)),{mid:"mmbizwap:h265_support",view:"wap_business"})),this.triggerEvent("sendMonitor",e),console.log("report h256 play",o,r)}}},initPlayRangeInfo(t){if(t.durationMs<=0)return;const e=this.opt.totalRange;function i(t,e){const i=[{start:0,end:t,hasReport:!1}];for(;;){let s=i[i.length-1];if(s.end>=e)break;i.push({start:s.end,end:s.end+t,hasReport:!1})}return i}1e3*e>=t.durationMs?this.__playRangeInfo=i(1e3,t.durationMs):this.__playRangeInfo=i(Math.ceil(t.durationMs/e),t.durationMs)},reportCurRangeInfo(t){const e=this.__playRangeInfo;if(!e||0===e.length)return;const i=e.length;for(let s=0;s<i;s++){let o=e[s];if(o.start<t.curTime&&o.end>=t.curTime){o.hasReport||(o.hasReport=!0,n.report({step:14,__biz:this.opt.__biz,vid:this.opt.vid,hit_bizuin:this.opt.hitBizuin,hit_vid:this.opt.hitVid,traceid:this.getTraceId(),orderid:this.getOrderid(),ori_status:this.getOriStatus(),type:this.getReportTypeBySceneType(),fromid:this.getFromid(),total_range:i,current_range:s+1,duration:this.__reportData.duration_ms||e[i-1].end}));break}}},getTraceId:()=>0,getOrderid:()=>0,getOriStatus(){return this.opt.oriStatus},getFromid(){return this.opt.fromid},qqVideoReport(t){t.step,t.loadwait,t.val,this.opt.vid,6==t.step&&this.__reportData.vt},resetVideoInnerHandler(){this.$refs.player.isWcSlPlayer?this.$refs.player.showCover():this.$refs.player.resetVideo()},danmuPluginInitedInnerHandler(){this.__hasReport23439EnterStatus<3&&(1===this.__hasReport23439EnterStatus?(this.__hasReport23439EnterStatus=3,this.opt.preCreate||this.reportEnter23439()):this.__hasReport23439EnterStatus=2)},getPlayerReportData(){let t=this.__reportData,e=this.$refs.player;e&&(t.play_time=this.getRealPlayTime(),t.full_screen=this.fullscreenStatus?1:0,t.quick_play=e.hasSeeked()?1:0,t.drag_times=e.getSeekedTimes().join(":|:")),t.webviewid=n.getWebviewid()},pause(){this.$refs.player&&this.$refs.player.pause4outer()},play(){this.$refs.player&&this.$refs.player.play4outer()},topStickyInfoPlay(){const t=this.$refs.player;t&&(t.isEnd()?t.replay():t.play4outer())},getRealPlayTime(){let t=0,e=this.$refs.player;return e&&(t=Math.round(1e3*e.getPlayTotalTime())),t},getIntervalPlayTimeFor23443(){return Math.max(0,this.getRealPlayTime()-this.__23443ReportPageTotalPlayTime-this.__23443ReportImmersiveTotalPlayTime)},getIntervalStayTimeFor23443(){return Math.max(0,Date.now()-this.__23443ReportPageEnterTime-this.__23443ReportPageTotalStayTime-this.__23443ReportImmersiveTotalStayTime)},getCurrentTime(){let t=0,e=this.$refs.player;return e&&(t=e.getCurTime()),t},getCurrentTimeMs(){return Math.round(1e3*this.getCurrentTime())},getVideoData(){return this.__vInfo&&this.__vInfo.dynamicData&&this.__vInfo.dynamicData.data?this.__vInfo.dynamicData.data:null},getReportData(){return this.__reportData},extendMpReportData(t){Object.assign(this.__reportData,t)},getMpReportData(){return this.__reportData},recoverPlaybackRate(){const t=this.__vInfo.status,e=t&&t.playbackRate||1;this.$refs.player.setPlaybackRate(e),this.$refs.player.isWcSlPlayer&&setTimeout((()=>{this.$refs.player&&this.$refs.player.setPlaybackRate(e)}),250)},setLoop(t){this.playerOpt&&(this.playerOpt.loop=t)},setMuted(t){this.playerOpt&&(this.playerOpt.muted=t)},setAutoplay(t){this.$refs.player&&(this.$refs.player.autoplay=t)},setVideoSize(t){this.playerOpt&&("number"==typeof t.width&&(this.playerOpt.width=t.width),"number"==typeof t.height&&(this.playerOpt.height=t.height))},setVideoTopSticky(){const t=this.$refs.player,e=-this.$el.getBoundingClientRect().top+(window.immersiveMode&&window.normalTopInset||0);if(!t||e<0)return this.unsetVideoTopSticky();const i=!this.supportWcSlPlayer()||t.isPlay()||this.topStickyExpendWhenPaused,s=3*this.opt.width/4,o=this.opt.height-s,a=Math.max(0,Math.min(e,o)),r=i?this.opt.height-a:Math.max(this.opt.height-e,72);if(this.wrapStyle={position:"fixed",zIndex:9,top:window.immersiveMode?"".concat(window.normalTopInset||0,"px"):0,left:0,height:r+"px",transition:this.__isPlayingWhenLastStick!==i?"height .2s ease-out":"height 0s"},this.posterStyle={top:"auto",bottom:0,minHeight:Math.min(this.opt.height,s)+"px"},this.supportWcSlPlayer()){const e=1-a/this.opt.height,s=this.__isPlayingWhenLastStick!==i?"transform .25s":"transform 0s",n=i&&o<0?"transform-origin .25s linear":"transform-origin 0s";(r>72||0===this.topStickyInfoStatus)&&(this.videoStyle={bottom:0,left:i?"auto":0,position:"absolute",transition:"".concat(n,", ").concat(s),transform:"scale3d(".concat(e,", ").concat(e,", 1.1)"),transformOrigin:"bottom"}),r>72?this.resetVideoTopStickyInfo():0===this.topStickyInfoStatus&&(this.__topStickyAnimTimer=setTimeout((()=>{if(this.topStickyInfoStatus>200){const e=135/this.opt.width;this.videoStyle={bottom:0,left:i?"auto":0,position:"absolute",transition:"".concat(o<0?n:"transform-origin .2s",", transform .25s"),transform:"scale3d(".concat(e,", ").concat(e,", 1.1) translate(0, ").concat(this.opt.height*e-r,"px)"),transformOrigin:"left bottom",zIndex:999},this.__topStickyAnimTimer=setTimeout((()=>{this.setTopStickyInfoStatus({status:t.isEnd()?2:1}),this.__topStickyAnimTimer=null}),200),this.setTopStickyInfoStatus({status:t.isEnd()?204:203})}}),200),t.preventOperating(),this.setTopStickyInfoStatus({status:t.isEnd()?202:201})),this.__isPlayingWhenLastStick=i}},unsetVideoTopSticky(){this.wrapStyle=null,this.posterStyle=null,this.supportWcSlPlayer()&&(this.videoStyle=null,this.resetVideoTopStickyInfo())},resetVideoTopStickyInfo(){if(this.topStickyInfoStatus>0){const t=this.$refs.player;t&&t.resumeOperating(),this.setTopStickyInfoStatus({status:0}),this.__topStickyAnimTimer&&(clearTimeout(this.__topStickyAnimTimer),this.__topStickyAnimTimer=null)}},enableTopSticky(){this.__videoTopStickyEnabled||(window.addEventListener("scroll",this.setVideoTopSticky),this.__videoTopStickyEnabled=!0)},disableTopSticky(){this.__videoTopStickyEnabled&&(window.removeEventListener("scroll",this.setVideoTopSticky),this.__videoTopStickyEnabled=!1)},setVideoShareInfo(t={}){if(this.playerOpt){const e=this.cgiData;if("0"===window.item_show_type){const i=["https://mp.weixin.qq.com/s?item_show_type=16","&vid=",this.opt.vid,"&__biz=",this.opt.__biz,"&mid=",this.opt.mid,"&idx=",this.opt.idx,"&sn=",e.sn||"","#wechat_redirect"].join("");window.customShareInfo={vid:this.opt.vid,link:i,title:e.title||window.msg_title,img_url:this.playerOpt.cover_16_9||this.playerOpt.cover,headImg:e.hd_head_img||e.roundHeadImg,voiceid:e.vid,duration:this.playerOpt.duration,img_width:"120",img_height:"90",forbid_msg:this.opt.preview?"预览状态下无法#op#视频":e.isPaySubscribe?"付费图文内视频暂不支持#op#":null,coverPicImageUrl:this.playerOpt.cover_16_9||this.playerOpt.cover,coverPicWidth:this.playerOpt&&this.playerOpt.videoWidth||120,coverPicHeight:this.playerOpt&&this.playerOpt.videoHeight||90},g.currentMpInfo({vid:this.opt.vid,duration:this.playerOpt.duration,videoWidth:this.playerOpt&&this.playerOpt.videoWidth||120,videoHeight:this.playerOpt&&this.playerOpt.videoHeight||90,videoCover:this.playerOpt.cover_16_9||this.playerOpt.cover,customSnapShot:A.isIOS&&this.__floatCoverBase64||"",isMenuShowBrandInfo:0,title:e.title||window.msg_title,itemShowType:this.fullscreenStatus?"16":"0",brandIcon:e.hd_head_img||e.roundHeadImg,headImg:e.hd_head_img||e.roundHeadImg,userName:e.user_name||e.username,brandName:e.nick_name,bizNickName:e.nick_name,voiceid:e.vid,...t})}else if("5"===window.item_show_type){const i=["https://mp.weixin.qq.com/s?t=pages/video_detail_new&item_show_type=16&scene=#scene#","&vid=",this.opt.vid,"&__biz=",this.opt.__biz,"&mid=",this.opt.mid,"&idx=",this.opt.idx,"&sn=",e.sn||"","&vidsn=",e.vidsn||"","#wechat_redirect"].join("");window.customShareInfo={vid:this.opt.vid,link:i,img_url:this.playerOpt.cover_16_9||this.playerOpt.cover,title:e.title,desc:e.desc||e.digest,headImg:e.hd_head_img||e.roundHeadImg,voiceid:e.vid,duration:this.playerOpt.duration,img_width:"120",img_height:"90",forbid_msg:this.opt.preview?"预览状态下无法#op#视频":e.isPaySubscribe?"付费图文内视频暂不支持#op#":null,coverPicImageUrl:this.playerOpt.cover_16_9||this.playerOpt.cover,coverPicWidth:this.playerOpt&&this.playerOpt.videoWidth||120,coverPicHeight:this.playerOpt&&this.playerOpt.videoHeight||90},g.currentMpInfo({customSnapShot:A.isIOS&&this.__floatCoverBase64||"",isMenuShowBrandInfo:0,itemShowType:this.fullscreenStatus?"16":"5",userName:e.user_name||e.username,brandName:e.nick_name,bizNickName:e.nick_name,title:e.title,brandIcon:e.hd_head_img||e.roundHeadImg,headImg:e.hd_head_img||e.roundHeadImg,voiceid:e.vid,duration:this.playerOpt.duration,vid:e.vid,videoWidth:this.playerOpt&&this.playerOpt.videoWidth||120,videoHeight:this.playerOpt&&this.playerOpt.videoHeight||90,...t})}v(!1),f.setTopBar()}},recoverVideoShareInfo(){this.playerOpt&&(delete window.customShareInfo,"0"===window.item_show_type?g.currentMpInfo({vid:"",duration:0,videoWidth:0,videoHeight:0,videoCover:"",customSnapShot:"",isMenuShowBrandInfo:1,itemShowType:"0",userName:this.cgiData.user_name||this.cgiData.username}):"5"===window.item_show_type&&g.currentMpInfo({customSnapShot:"",isMenuShowBrandInfo:1,itemShowType:"5",userName:this.cgiData.user_name||this.cgiData.username}),v(!0),f.setTopBar())},setVideoMenuItems(){this.fullscreenStatus&&this.$refs.player&&this.$refs.player.needFeFullscreen&&C.supportImmersiveMode&&(this.opt.preview?M.invoke("hideMenuItems",{menuList:["menuItem:share:appMessage"]}):this.banOprStatus||this.$store.state.cgiData.isPaySubscribe?(M.invoke("hideMenuItems",{menuList:["menuItem:share:appMessage","menuItem:share:timeline"]}),M.invoke("handleHaokanAction",{action:We,permission:0})):(this.banOprStatus||M.invoke("showMenuItems",{menuList:["menuItem:share:appMessage","menuItem:share:timeline"]}),this.opt.canLikeVideo&&M.invoke("handleHaokanAction",{action:We,permission:1,recommend:this.playerOpt.isLiked?1:0})))},recoverVideoMenuItems(){this.opt.preview?M.invoke("showMenuItems",{menuList:["menuItem:share:appMessage"]}):(M.invoke("showMenuItems",{menuList:["menuItem:share:appMessage","menuItem:share:timeline"]}),this.opt.canLikeVideo&&M.invoke("handleHaokanAction",{action:We,permission:1,recommend:window.__article_liked__?1:0}))},getFloatCoverBase64(t){const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{e.onload=null,e.onerror=null;try{const t=e.naturalWidth||e.width,i=e.naturalHeight||e.height,s=document.createElement("canvas"),o=s.getContext("2d"),a=640,r=1280;s.width=a,s.height=r,s.style.width=a+"px",s.style.height=r+"px";const n=function(t="cover",e,i,s,o){let a=1,r=0,n=0,l=s,h=o,d=0,c=0,u=e,p=i,_=e/i,m=s/o;"cover"===t?m>=_?(a=i/o,r=(s-e/a)/2,l=e/a,h=o):(a=e/s,n=(o-i/a)/2,l=s,h=i/a):"contain"===t&&(m>=_?(a=e/s,c=(i-o*a)/2,p=o*a):(a=i/o,d=(e-s*a)/2,u=s*a));return[r,n,l,h,d,c,u,p]}("contain",a,r,t,i);o.drawImage(e,...n),o.beginPath(),o.moveTo(a/2-50,r/2-60),o.lineTo(a/2-50,r/2+60),o.lineTo(a/2+50,r/2),o.fillStyle="rgba(255,255,255,0.8)",o.strokeStyle="rgba(255,255,255,0.8)",o.shadowBlur=100,o.shadowColor="rgba(0,0,0,0.5)",o.fill(),o.closePath(),o.stroke(),this.__floatCoverBase64=s.toDataURL("image/jpeg",0),this.__floatCoverBase64=this.__floatCoverBase64.replace("data:image/jpeg;base64,",""),this.opt.useImmersiveMode&&(this.opt.preCreate||this.setVideoShareInfo())}catch(hi){this.__floatCoverBase64="",console.error(hi)}},e.onerror=()=>{this.__floatCoverBase64="",e.onload=null,e.onerror=null},e.src=t},showToast(t){this.__toastTimeoutId&&clearTimeout(this.__toastTimeoutId),this.toastTips=t,this.__toastTimeoutId=setTimeout((()=>{this.__toastTimeoutId=null,this.toastTips=""}),1e3)},reportPv23447(){if(!this.opt.useImmersiveMode||this.opt.preCreate){const t=this.cgiData;S({type:"POST",timeout:2e3,url:"/mp/appmsgreport?action=immersive",data:{__biz:this.opt.__biz,mid:this.opt.mid,idx:this.opt.idx,vid:this.opt.vid,scene:t.scene,sub_scene:t.subscene,devicetype:t.devicetype,version:t.clientversion,enterid:t.enterid,sessionid:t.sessionid,item_show_type:this.opt.useImmersiveMode?16:1*t.item_show_type,channel_session_id:t.channel_session_id}})}},computePlayTotalTimeForKyk(t){this.__videoReportInfo.every_end_play_time=Math.round(1e3*t.currentTime),this.__videoReportInfo.total_play_time+=this.__videoReportInfo.every_end_play_time-this.__videoReportInfo.every_start_play_time,console.log("real play time**********"+this.__videoReportInfo.total_play_time)},getCurrentDefinition(){return De.playerStatus.formatId?De.definitionMap[De.playerStatus.formatId]:this.__vInfo.dynamicData?De.definitionMap[this.__vInfo.dynamicData.data.formatid]:0},onTouchMoveHorizontally(t){this.triggerEvent("touchMoveHorizontally",t)},onPlayerTouchEnd(t){this.triggerEvent("playerTouchEnd",t)},onSeekingStatusChange(t){this.triggerEvent("seekingStatusChange",t)},onLikedCommentTipsStatusChange(t){this.triggerEvent("likeCommentTipsStatusChange",t)},onSwipeBack(t){this.triggerEvent("swipeBack",t)},onScreenshotChange(t){this.screenshot=t}}});function He(t){const e={};return t.url_info.forEach((i=>{let s;const o=i.format_id;switch(1*o){case 20003:case 10002:case 10003:case 10004:e[De.definitionMap[o]]||(s=De.definitionMap[o]);break;case 10102:case 10103:case 10104:t.h265&&(s=De.definitionMap[o])}s&&(e[s]=i)})),e}function ze(t){const e=He(t);let i;if(De.playerStatus&&De.playerStatus.formatId&&"3g"!==De.networkType&&"2g"!==De.networkType&&1*t.is_mp_video_urgent_state!=1)switch(1*De.playerStatus.formatId){case 10002:case 10003:case 10004:case 10102:case 10103:case 10104:e[De.definitionMap[De.playerStatus.formatId]]&&(i=e[De.definitionMap[De.playerStatus.formatId]])}i||("2g"===De.networkType||1*t.is_mp_video_urgent_state==1?e[De.definitionMap[10004]]?i=e[De.definitionMap[10004]]:e[De.definitionMap[10003]]&&(i=e[De.definitionMap[10003]]):De.isPc||"wifi"===De.networkType?e[De.definitionMap[10002]]?i=e[De.definitionMap[10002]]:e[De.definitionMap[10003]]&&(i=e[De.definitionMap[10003]]):e[De.definitionMap[10003]]?i=e[De.definitionMap[10003]]:e[De.definitionMap[10002]]&&(i=e[De.definitionMap[10002]])),i||(i=t.url_info[0]);i=(i=>{if(!i)return t.url_info[0];if(Math.floor(Math.max(i.width,i.height))>3841)switch(1*i.format_id){case 10002:case 10102:case 10003:case 10103:i=e[De.definitionMap[10004]],b.setSum(27302,7,1)}return i})(i);let s=Math.floor(i.duration_ms/1e3),o=(parseFloat(i.filesize)/1024/1024).toFixed(2);return{formatid:1*i.format_id,time:s,title:i.title||"",width:i.width,height:i.height,file_size:i.filesize,totalUrl:i.url,rate:Math.round(i.filesize/1024*8/s),flow:o,ori_url_info:t.url_info,vid:t.src_vid,uploadtime:t.src_vid_uploadtime,bizuin:t.src_bizuin,hit_vid:t.hit_vid,hit_bizuin:t.hit_bizuin,hit_uploadtime:t.hit_vid_uploadtime}}function $e(t){!De.networkType&&A.isWechat&&(A.isIOS||A.isAndroid)?M.invoke("getNetworkType",{},(e=>{De.networkType=De.netTypeMap[e.err_msg]||"fail","network_type:edge"!=e.err_msg&&"network_type:wwan"!=e.err_msg||(e.detailtype||e.subtype)&&(De.networkType=e.detailtype||e.subtype),"function"==typeof t&&t()})):"function"==typeof t&&t()}function Je(t,e){let i="";switch(1*t){case-4:case-5:case-3:i="因版权限制，该视频不支持播放";break;case 61:i="当前视频不存在，暂无法观看";break;case 62:i="当前视频已下架，暂无法观看";break;case 63:case 65:case 67:i="视频加载失败，暂无法观看";break;case 69:i="视频格式不支持移动端观看，请在电脑上观看";break;case 71:case 73:case 74:i="视频加载失败，暂无法观看";break;case 80:switch(1*e){case 1:i="很抱歉，当前IP地址所在地区暂不支持播放";break;case 2:i="因版权限制，暂不支持播放";break;default:i="因版权限制，该视频不支持播放"}break;case 81:case 82:i="视频加载失败，暂无法观看";break;case 83:switch(1*e){case-1:i=De.defaultErrorWording;break;case-2:i="因版权限制，该视频不支持播放";break;default:i="该片为付费视频，请前往腾讯视频观看"}break;case 84:i="很抱歉，根据您的IP地址，暂无法播放";break;default:i=De.defaultErrorWording}return console.log("[videoplay] getVinfoErrMsg",i,t,e),i}function qe(t,e){const i=window.__videoPageInfos||[window.__videoPageInfo];if(Array.isArray(i)&&i.length){const e=i.find((e=>e.video_id===t));return e&&e.cover_url||""}return""}function Qe(t,e,i,s){let o=Le.get(t+e+i+s);if(!o)return null;try{o=JSON.parse(o)||{}}catch(hi){return function(t,e,i,s){Le.remove(t+e+i+s)}(t,e,i,s),null}return o}function Xe(t){Le.remove(t)}$e(),function(){let t=Le.get("playerStatus");if(t){try{t=JSON.parse(t)||{}}catch(hi){return void Xe("playerStatus")}t.playerStatus&&(De.playerStatus=t.playerStatus,T.info("player controller: get player status cache "+JSON.stringify(De.playerStatus)))}}();const Ge=Ue,Ye=Me._getFormatTime,Ke=Me._getAllPlayersOfPage;const Ze={mpVideoPlayer:R(Ge,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"mp-video-player",style:{height:t.fullscreenStatus?"100vh":"100%"}},[0===t.errType&&t.playerOpt?e("mp-video-player",{ref:"player",class:101===t.fullscreenStatus?"opr_fade_out":"",attrs:{opt:t.playerOpt,"can-load":t.canLoad,"wrap-style":t.wrapStyle,"video-style":t.videoStyle,"poster-style":t.posterStyle},on:{loaded:t.onLoaded,timeupdate:t.onTimeupdate,"begin-play":t.onBeginPlay,durationchange:t.onDurationchange,fullscreenchange:t.onFullscreenchange,"status-change":t.onStatusChange,"after-replay":t.onAfterReplay,"hand-drag-complete":t.onHandDragComplete,"bar-drag-complete":t.onBarDragComplete,end:t.onEnd,error:t.onError,"error-retry":t.onErrorRetry,"first-buffering-time":t.onFirstBufferingTime,"playing-buffering-time":t.onPlayingBufferingTime,"flow-notice":t.onFlowNotice,userplay:t.onUserplay,userpause:t.onUserpause,waiting:t.onWaiting,play:t.onPlay,pause:t.onPause,"mid-play-click":t.onMidPlayClick,"after-check-video-fit":t.onAfterCheckVideoFit,"bind-error":t.onBindError,"rate-change":t.onRateChange,"resolution-change":t.onResolutionChange,"brightness-change":t.onBrightnessChange,"volume-change":t.onVolumeChange,"profile-jump":t.onProfileJump,"process-state-change":t.onProcessStateChange,canplay:t.onCanplay,"show-control-bar":t.onShowControlBar,"hide-control-bar":t.onHideControlBar,"show-menu":t.onShowMenu,replay:t.onReplay,"touch-video":t.onTouchVideo,"share-video":t.onShareVideo,"praise-video":t.onPraiseVideo,"like-video":t.onLikeVideo,"open-source-page":t.onOpenSourcePage,"show-subscribe":t.onShowSubscribe,"click-subscribe":t.onClickSubscribe,"enter-fullscreen":t.onEnterFullscreen,"exit-fullscreen":t.onExitFullscreen,"full-landscape-mode-change":t.onFullLandscapeModeChange,"fast-forward":t.onFastForward,loadedmetadata:t.onLoadedMetaData,"touch-move-horizontally":t.onTouchMoveHorizontally,"player-touch-end":t.onPlayerTouchEnd,"seeking-status-change":t.onSeekingStatusChange,"liked-comment-tips-status-change":t.onLikedCommentTipsStatusChange,"screenshot-change":t.onScreenshotChange,"swipe-back":t.onSwipeBack},scopedSlots:t._u([{key:"inner",fn:function(){return[t._l(t.innerPlugins,(function(t,i){return e(t,{key:i,ref:"innerPlugins",refInFor:!0,tag:"component"})})),e("div",{directives:[{name:"show",rawName:"v-show",value:t.topStickyInfoStatus&&!t.fullscreenStatus,expression:"topStickyInfoStatus && !fullscreenStatus"}],staticClass:"video_poster__info__play",style:{zIndex:t.topStickyInfoStatus>200?-2:""},on:{click:t.topStickyInfoPlay}},[e("i",{class:t.topStickyInfoIconClass})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.topStickyInfoStatus&&!t.fullscreenStatus,expression:"topStickyInfoStatus && !fullscreenStatus"}],staticClass:"video_poster__info",style:{zIndex:t.topStickyInfoStatus>200?-2:""},on:{click:t.topStickyInfoPlay}},[e("p",{staticClass:"video_poster__info__title",staticStyle:{"font-size":"17px"}},[t._v(t._s(t.topStickyInfoWording))]),e("p",{staticClass:"video_poster__info__desc",staticStyle:{"font-size":"12px"}},[t._v(" "+t._s(t.playerOpt&&t.playerOpt.videoTitle||"")+" ")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.topStickyInfoStatus&&!t.fullscreenStatus,expression:"topStickyInfoStatus && !fullscreenStatus"}],staticClass:"video_poster__info__mask",style:{width:t.topStickyInfoMaskWidth}})]},proxy:!0},{key:"cover",fn:function(){return t._l(t.coverPlugins,(function(t,i){return e(t,{key:i,ref:"coverPlugins",refInFor:!0,tag:"component"})}))},proxy:!0},{key:"control",fn:function(){return t._l(t.controlPlugins,(function(t,i){return e(t,{key:i,ref:"controlPlugins",refInFor:!0,tag:"component"})}))},proxy:!0},{key:"profile",fn:function(){return t._l(t.profilePlugins,(function(t,i){return e(t,{key:i,ref:"profilePlugins",refInFor:!0,tag:"component"})}))},proxy:!0},t.processingTips?{key:"cornerTips",fn:function(){return[e("span",[t._v(t._s(t.processingTips))])]},proxy:!0}:null],null,!0)}):1===t.errType?e("div",{staticClass:"wrp_pop_tips wx_video_error_box js_error_box",style:{height:t.fullscreenStatus?"100%":"calc(100% - 12px)"}},[e("div",{staticClass:"wx_video_error_msg js_error_area"},[e("p",{attrs:{role:"heading"}},[t._v(t._s(t.errMsg))]),t.opt.isMpVideo?t._e():e("i",{staticClass:"wx_video_error_code"},[t._v("错误码："+t._s(t.errCode))]),0!==t.refreshBtnStatus?e("a",{staticClass:"wx_video_error_msg_btn js_video_errormsg_btn",attrs:{role:"button",href:"javascript:void(0);"},on:{click:t.reload}},[e("img",{staticClass:"wx_video_error_refresh",attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAqCAMAAADhynmdAAAAQlBMVEUAAACcnJycnJycnJyoqKicnJycnJycnJycnJycnJyfn5+cnJydnZ2enp6kpKSdnZ2cnJyenp6cnJycnJycnJybm5t8KrXMAAAAFXRSTlMAyeb3CNp3tJRvHIEtJhBgqztWRJ+p5TqGAAABCklEQVQ4y5WTi27DIAxFAUMhgTzX8/+/urB2pdKI0x0pSoRuruyLbf7gF3PBaDE6X44LyY0D1SJQsfd9PpMM/CJx60v8SmV1HMSi1lKyA1n0jnwWSO08l04uJbxpBmTrpDtbGB6fmxC6Tc4BHv9aZDJdJsHW9w43Jez9x8T5M4l31WZsJn2bsYY+nUum2lQkGIVANPZ4FCLWOJImSTgjZE2SkU9crmu57mj9JBc93Qzj9R1d3HSG5bN5MRsnUzcGKK8Ns02z+Da7rYQE4bUE2PG1C6kVnkCyf0pwX8/jwbyxCLhcHpKTFkvkwK3pRmXtRrVFoTGYLvN+t0EUl0qrRaF1pFBz0anp/ptvNB4SY1XDAVMAAAAASUVORK5CYII=",alt:""}}),t._v(" 刷新 ")]):t._e()]),e("img",{staticClass:"wx_video_error_loading js_video_errormsg_loading",staticStyle:{display:"none"},attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADkAAAA5CAMAAAC7xnO3AAAAY1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+aRQ2gAAAAIXRSTlMAOx20pMJbzBQNTDGTh2ohLCZmeUF2hEmXCFdxUquef4yHE17nAAACnklEQVRIx9WW2xqiIBSFRc1AUATJU1a+/1MOm0NYKvnNXM260ZLftRcbqCQinOLI0yiY/iXKuUZPjx5Fk+6RhF1yHiVF0wC6IZfr9fqIkpRqdNyQ9AoiUU8g+YZ8Xn96YmNKvkhkLMskKgEo/yJzaxkXeZsGsjeWKEIFU/FBZgA+D5yEwGtTgR0J18lYUvdcLZ1YkUjLf+a0saYYSG/J3Hury+WSkTCjCETtF6Mvd8QGJMZSWIfsAlKhWGRl5zQ1ZNBDgy/zzvvFavWUK7SyTRs+rsiUZS/4LHIHyo8VgBx7vDkKx2WhPS7dD1Q6cNlu2dTa0gMys4bz/vJR6ph8ADgcVcSVUkfnhzJTc6gRj8fbCOHk30UI2KC+V4gKjskJQqC5frFHli0kafogFIfFkAXVCSqdAFVR8pmtVCWiXCtaarbWpGtQAYx7sjf2GCbfjFRQpH7lTLucveSMBE7+Z6VqViT2/PVs0d7hPk9TUcTaUuVaT8k/f/v6SXOgyG7InZaSvM8vj/309LrbvpSAORDH2/kWGyHhm/u5AYUc8qdFBRRrsV749bRv6I5x1OY50GZUUxQz9aGplAXZcOQ1DL3vwsTyvHQ2YWgjZV2rDTmxYRjUuoBvcQDr7QRLBiiNzJ4BawG3FLtTmEMGBigTRyC2oIKht1vbwLWrKmXKBZal+yApDGhm4q5JCVdNdrZeQBe8B44WnE2NGmxrR1bCvMugHdkhSwMWI9wjIGeosnPlJmNrst6PQrpeFkBSyAmkdD016DYqAVC6HHcNtnCPgazcuytAd5IqB/qYtq4bkP7vnEaL3W4KH9/HhKBAKl8XFUlMIWYIek4hZgh6UtjHBLVA4pPkCKRf9jOQ5Kwp1UvPDyb3qkPJaRG8Ln7f8Q8Bki/Kj5IYnQAAAABJRU5ErkJggg=="}})]):2===t.errType?e("div",{staticClass:"wrp_pop_tips wx_video_msg_primary js_error_box",style:{height:t.fullscreenStatus?"100%":"calc(100% - 12px)"}},[e("div",{staticClass:"wx_video_msg_primary_inner"},[e("p",{staticClass:"wx_video_msg_primary_text"},[t._v(t._s(t.errMsg))])])]):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.toastTips,expression:"toastTips"}]},[e("div",{staticClass:"weui-mask_transparent"}),e("div",{staticClass:"weui-toast",style:{top:0===t.orientationStatus?"45%":"50%",position:"absolute"}},[e("i",{staticClass:"weui-icon-success-no-circle weui-icon_toast"}),e("p",{staticClass:"weui-toast__content"},[t._v(t._s(t.toastTips))])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showScreenshotMask,expression:"showScreenshotMask"}],staticClass:"fullscreen-screenshot__layer",staticStyle:{"background-color":"#000"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.screenshot,expression:"screenshot"}],staticClass:"fullscreen-screenshot__layer",style:"z-index: -1; background-image: url("+t.screenshot+")"})],1)}),[],!1,null,"db5bdc2b",null,null).exports,getFormatTime:Ye,getAllPlayersOfPage:Ke,getHashByVid:function(t){let e=0;for(let i=0,s=t.length;i<s;i++)e=(e<<5)+e+t.charCodeAt(i);return e%1e8},getCoverByVid:qe,getQQVideoStaticInfo:function(t){const e=["https://h5vv6.video.qq.com/getextinfo?otype=ojson","&vid=",t.vid].join("");S({type:"GET",dataType:"json",timeout:3e4,url:e,notJoinUrl:!0,noXRequestedWidthHeader:!0,success:e=>{if(!e||"o"!=e.s||e.vl.cnt<=0)return void("function"==typeof t.onError&&t.onError(-1));const i=e.vl.vi[0],s={title:i.title||"视频",desc:1*i.desc==0?"":i.desc||"",director:i.director||"",leading_actor:i.leading_actor||"",costar:i.costar||"",time:Math.floor(i.td)||0};if(i.pl&&i.pl.cnt>0){const t=i.pl.pi;s.p400_300=t[0]?t[0].url:"",s.p140_100=t[1]?t[1].url:"",s.p120_90=t[2]?t[2].url:"",s.p400_300=s.p400_300&&-1==s.p400_300.indexOf("http")?"http://"+s.p400_300:s.p400_300,s.p140_100=s.p140_100&&-1==s.p140_100.indexOf("http")?"http://"+s.p140_100:s.p140_100,s.p120_90=s.p120_90&&-1==s.p120_90.indexOf("http")?"http://"+s.p120_90:s.p120_90}"function"==typeof t.onSuccess&&t.onSuccess(s)},error:e=>{let i;i=e?e.status>=200&&e.status<400?-1:e.status>=400&&e.status<500||e.status>=500&&e.status<600?400:(0==e.status&&e.readyState,500):-1,"function"==typeof t.onError&&t.onError(i)}})},global:De};const ti=R({name:"mp-feed-item",props:{item:{type:Object},index:{type:Number,require:!0},curPage:{type:Number,require:!0},feedVm:{type:Object},fullscreenStatus:{type:[Boolean,Number]}},data:()=>({vm:null,hasLoaded:!1}),computed:{...i(["moreVideoList","isListEnd"]),isCurPage(){return this.index===this.curPage},isActived(){return this.index<=this.curPage+1&&this.index>=this.curPage-1},player(){return this.vm&&this.vm.getPlayer()},shouldPlay(){return this.hasLoaded&&this.isCurPage}},mounted(){this.createPlayerController(),this.onActivedStatusChange()},beforeDestroy(){this.$emit("set-feed-vm",null,this.index),this.beUnselected(),this.vm&&this.vm.$destroy()},watch:{isCurPage(t,e){t!==e&&(t?setTimeout(this.beSelected,0):this.beUnselected())},isActived(t,e){t!==e&&this.onActivedStatusChange()},shouldPlay(t,e){t!==e&&t&&this.fullscreenStatus&&this.player.onMidPlayBtnClick()}},methods:{...s(["markRead"]),onActivedStatusChange(){this.isActived?this.loadVideo():this.hideVideo()},beSelected(){const t=this.vm;if(t.setVideoShareInfo(),!this.fullscreenStatus)return t.recoverVideoShareInfo();this.player?(this.player.enterFullscreenEffect(),this.player.enableWcSlPlayerFullscreenAfterOrientationChange=!!this.player.isImmersiveMode||"update-style-only",this.reportOrResetReport()):console.log("???????not ready",this.vm,this.item.videoTitle),t.setVideoMenuItems(),this.markRead(this.item.vid)},beUnselected(){this.player&&(this.player.pause({withoutPauseBtn:!0}),this.player.exitFullscreenEffect(),this.player.enableWcSlPlayerFullscreenAfterOrientationChange=!1,this.resetReportStatus())},reportOrResetReport(){this.item.inFeed&&(this.player.__userPlayTime=!0,this.vm.reportPv23447(),this.vm.reportEnter23439(),this.vm.reportOp23444({EventType:11,EventTime:this.vm.getCurrentTimeMs(),FullscreenType:2}))},resetReportStatus(){this.item.inFeed&&(setTimeout((()=>{this.vm.__hasLeaveReport23443EventType1=!1,this.vm.__hasLeaveReport23443EventType2or3=!1}),1e3),this.vm.__onLeaveReport23443EventType1(),this.vm.__onLeaveReport23443EventType2or3())},loadVideo(){this.vm&&this.vm.$emit("startLoadVideo")},hideVideo(){this.vm&&this.vm.$emit("hideVideo")},createPlayerController(){const t=(window.__videoPageInfos||[]).find((t=>t.video_id===this.item.cgiData.vid))||{},e={...this.item,mpVideoTransInfo:t.mp_video_trans_info,mpVideoCoverUrl:t.cover_url,videoPageInfo:t,dontAutoInit:!1},i=this.item.storeFactory(e.cgiData,this.index);this.vm=new Ze.mpVideoPlayer({store:i,opt:e,el:"#controller_container_".concat(e.vid)}),this.$emit("set-feed-vm",this.vm,this.index),this.initPlayerController(),this.bindEvent()},bindEvent(){this.bindFeedEvent(),this.proxyEvent()},initPlayerController(){this.vm.$watch((()=>this.moreVideoList),(()=>{this.vm.$store.commit("mp-video-player/see-more-plugin/setIsSeeMoreAllow",this.moreVideoList.length>0)}),{immediate:!0}),this.isCurPage&&this.markRead(this.item.vid)},bindFeedEvent(){const t=this.vm;t.$on("enterfullscreen",(()=>{this.$emit("enterfullscreen")})),t.$on("exitfullscreen",(()=>{this.isCurPage&&this.$emit("exitfullscreen")})),t.$on("player-ready",(()=>{this.item.mpVideoTransInfo||(this.item.mpVideoTransInfo=this.vm.__vInfo.dynamicData.data.ori_url_info,this.item.mpVideoCoverUrl=this.vm.__coverUrl)})),t.$on("reload",(()=>{this.loadVideo(),setTimeout(this.beSelected,0)})),t.$on("fullscreenchange",(t=>{this.$emit("fullscreenchange",t)})),t.$on("show-more-modal",(()=>{this.$emit("show-more-modal")})),t.$on("seeking-status-change",(t=>{this.$emit("seeking-status-change",t)})),t.$on("swipe-back",(t=>{this.$emit("swipe-back",t)})),t.$on("orientation-change",(t=>{this.isCurPage&&this.$emit("orientation-change",t)})),t.$on("click-subscribe",(()=>{this.$emit("click-subscribe",this.vm)})),t.$on("loadedmetadata",(()=>{this.hasLoaded=!0})),t.$on("pause",(()=>{this.$emit("pause")}))},proxyEvent(){["userplay","userpause","timeupdate","status-change","process-state-change","hand-drag-complete","bar-drag-complete","begin-play","fullscreenchange","enterfullscreen","exitfullscreen","first-buffering-time","playing-buffering-time","video-ready","flow-notice","resolution-change","show-hls-tips","click-hls-tips","canplay","brightness-change","volume-change","rate-change","profile-jump","get-danmu-info","bind-error","show-menu"].forEach((t=>{this.vm.$on(t,(e=>{this.feedVm.$emit(t,e,this.vm)}))}))}}},(function(){var t=this;return(0,t._self._c)("div",{attrs:{id:"controller_container_".concat(t.item.vid)}},[t._v(t._s(t.item.vid))])}),[],!1,null,null,null,null).exports,ei=window.Vue,ii={screenHeight:window.orientation?window.screen.width:window.screen.height},si=ei.extend({components:{[vt.name]:vt,[rt.name]:rt,[ti.name]:ti},data(){return{playerStartPoint:null,playerOffset:0,curPage:0,startPage:0,startControllerOpt:null,playerControllerList:[],fullscreenStatus:this.$options.opt.useImmersiveMode?1:0,touchDisableScroll:!1,isLandscape:!1,infinityListPageHeight:this.$options.opt.useImmersiveMode?ii.screenHeight:this.$options.opt.height,opt:this.$options.opt,onlyOne:!this.$options.opt.useImmersiveMode,isAndroid:B.os.android,subscene:window.scene,headerPos:0,pauseTask:[]}},created(){this.startControllerOpt={data:{...this.opt,inFeed:this.hasFeedScrollGray},init:!0,key:this.$options.opt.vid},this.playerControllerList.push(this.startControllerOpt)},watch:{needSuppleMoreVideoList:{handler(t){if(t){let t;t=this.playerControllerList[this.curPage]?{...this.playerControllerList[this.curPage].data.cgiData,title:this.playerControllerList[this.curPage].data.videoTitle}:{...this.opt.cgiData,title:this.opt.videoTitle},this.setIsListEnd(!1),this.suppleMoreVideoList(t).finally((()=>{this.loadTailListDataV2(),this.setIsListEnd(!0)}))}},immediate:!0}},computed:{...i(["moreVideoList","isListEnd","pageSize"]),safeAreaInsets:()=>L,infiniteMode:()=>!0,needSuppleMoreVideoList(){return this.hasFeedScrollGray&&this.fullscreenStatus&&this.moreVideoList.length<=Math.floor(this.pageSize/2)},feedVm(){return this},currentControllerOpt(){return this.playerControllerList[this.curPage]},currentPlayer(){return this.currentControllerOpt.vm&&this.currentControllerOpt.vm.getPlayer()},hasFeedScrollGray:()=>!1},methods:{...s(["getMoreVideoList","suppleMoreVideoList"]),...o(["setIsListEnd"]),report23445(t){this.currentControllerOpt.vm.reportReload23445(t)},onVideoPause(){let t=this.pauseTask.shift();for(;t;)t(),t=this.pauseTask.shift()},onSetFeedVm(t,e){this.playerControllerList[e]&&(this.playerControllerList[e].vm=t)},handleVisibilityChange(){if(!document.hidden&&this.fullscreenStatus)try{this.doWhenVideoPause((()=>{this.$refs.audio.play().catch((()=>{})),setTimeout((()=>{this.$refs.audio.pause()}),500)}))}catch(hi){console.error("??????",hi)}},onPageEnter(t){t&&t.vm},onFeedItemClickSubscribe(t){this.playerControllerList.forEach((e=>{if(e.vm!==t){const t=e.vm&&e.vm.getPlayer();t&&(t.subscribeStatus=3)}}))},isCurPage(t){return t===this.currentControllerOpt},onNextPlayerReady(t){t.loading=!1},onFinishScrollPage({curPage:t,type:e}){this.loadTailListDataV2(t),this.$refs.moreVideoBottomModal.scrollTo({top:0}),window.reloadseq++;const i=this.playerControllerList[t].vm,s=parseInt(Date.now()/1e3)+ht(i);i.setCommonReportData({ReloadSeq:window.reloadseq,Scene:e===mt?230:229,SubScene:this.subscene,EnterId:s}),i.$store.commit("SET_CGI_DATA",{...i.cgiData,scene:e===mt?230:229,subscene:this.subscene,enterid:s})},onOrientationChange(t){t?(this.isLandscape=!0,this.$refs.moreVideoBottomModal.hide()):this.isLandscape=!1},onSeekingStatusChange(t){this.touchDisableScroll=t},onSwipeBack(t){this.headerPos=t.position,this.touchDisableScroll=!t.release},showMoreMenu(){this.currentPlayer.onShowFullscreenMenu()},onExitFullscreen(){this.$refs.moreVideoBottomModal.hide(),this.playerControllerList.forEach((t=>{t!==this.currentControllerOpt&&t.vm&&t.vm.getPlayer()&&t.vm.getPlayer().exitFullscreen()}))},clickExitFullscreen(){this.fullscreenStatus=101,this.currentPlayer?this.currentPlayer.exitFullscreen():this.startControllerOpt.vm.getPlayer().exitFullscreen()},onFullscreenChange({state:t,isLandscape:e}){t!==this.fullscreenStatus&&(t?(e||(this.onlyOne=!t),this.fullscreenStatus=1,this.infinityListPageHeight=ii.screenHeight,this.headerPos=0):(this.curPage=this.startPage,this.onlyOne=!0,this.fullscreenStatus=0,this.infinityListPageHeight=this.opt.height))},onPageBeforeDestory(t){t&&(t.loading=!1)},changeFirstVideo(t=!1){if(t)this.startControllerOpt.data={...this.$options.opt,cgiData:window.cgiData,initFullscreenStatus:!1,withoutCover:!1,preCreate:!1,lazyLoad:!1,autoplay:!1},this.__hasChangeFirstVideo=!1;else{if(this.__hasChangeFirstVideo||this.curPage<=1)return;this.startControllerOpt.data.withoutCover=!0,this.startControllerOpt.data.preCreate=!0,this.startControllerOpt.data.inFeed=this.hasFeedScrollGray,this.startControllerOpt.data.autoplay=!1,this.startControllerOpt.data.initFullscreenStatus=!this.startControllerOpt.data.useImmersiveMode,this.__hasChangeFirstVideo=!0}return this.startControllerOpt.data},onShowMoreModal(){this.$refs.moreVideoBottomModal.show(),document.getElementById("js_player_relate_video_list").classList.add("relayout"),setTimeout((function(){document.getElementById("js_player_relate_video_list").classList.remove("relayout")}),100)},onSwitchVideo(t){if(this.$refs.moreVideoBottomModal.hide(),t.related_tag_video.vid===this.opt.vid)return this.$refs.infinityList.scrollToPage({page:this.startPage,type:gt});this.appendNextVideo(t),setTimeout((()=>{this.$refs.infinityList.scrollToPage({page:this.curPage+1,type:gt})}),300)},appendNextVideo(t){const e=this.playerControllerList.findIndex((e=>e.data.vid===t.related_tag_video.vid));this.playerControllerList.splice(this.curPage+1,this.playerControllerList.length-(this.curPage+1)),e<this.curPage&&-1!==e&&(this.playerControllerList.splice(e,1),this.curPage--,0===e&&(this.startControllerOpt=this.playerControllerList[this.startPage])),this.playerControllerList.push(this.config2ControllerOpt(t))},replaceCurrentVideo(t,e){this.currentControllerOpt.vm.resetPlayer(),this.currentControllerOpt.vm.destroyPlugins(),this.currentControllerOpt.vm.reinit(t),this.currentControllerOpt.vm.setAutoplay(e),this.currentControllerOpt.data=t},videoData2Config(t){const e={...this.opt.cgiData,...t.video_page_info,...t.related_tag_video,item_show_type:t.item_show_type},i=this.$options.opt.width,s=i*(e.videoHeight/e.videoWidth)||this.$options.opt.height;return{...this.$options.opt,cgiData:e,hitBizuin:e.hit_bizuin,hitVid:e.hit_vid,vid:e.vid,oriVid:e.vid,ckey:e.txvideo_vid?"":e.ckey,oriStatus:e.ori_status,videoTitle:e.title,showFullscreenMenu:!0,likeNum:e.like_num,flowNotice:!1,headImgUrl:e.head_img_url||e.round_head_img,duration:e.duration,bizNickName:e.srcDisplayName||e.nick_name,bizUserName:e.srcUserName,mpVideoCoverUrl:e.cover,coverFit:"contain",canShareVideo:!e.is_in_pay_subscribe,vtitle:e.title,autoplay:!1,isMpVideo:e.txvideo_vid?0:e.is_mp_video,width:i,height:s,mid:e.mid,__biz:e.__biz||e.biz,idx:e.idx,sn:e.sn,mpVideoTransInfo:e.mp_video_trans_info,href:e.url,loop:!0,preCreate:!0,inFeed:this.hasFeedScrollGray,initFullscreenStatus:!this.startControllerOpt.data.useImmersiveMode}},config2ControllerOpt(t){return{data:this.videoData2Config(t),vm:null,key:t.related_tag_video.vid}},loadTailListDataV2(t){if(!this.playerControllerList[t+1]){const t=this.moreVideoList.find((t=>-1===this.playerControllerList.findIndex((e=>e.data.vid===t.related_tag_video.vid))));t&&this.appendNextVideo(t)}},doWhenVideoPause(t){"play"===this.currentPlayer.status?this.pauseTask.push(t):t()}}});const oi=R(si,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"feed-wrapper"},[e("mp-more-video-bottom-modal",{directives:[{name:"show",rawName:"v-show",value:!t.onlyOne,expression:"!onlyOne"}],ref:"moreVideoBottomModal",attrs:{hideWhenSideslip:""},on:{"switch-video":t.onSwitchVideo,"more-video-item-click":t.report23445,"more-video-item-expose":t.report23445}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.hasFeedScrollGray&&!t.opt.useImmersiveMode&&!t.isLandscape&&t.fullscreenStatus,expression:"hasFeedScrollGray && !opt.useImmersiveMode && !isLandscape && fullscreenStatus"}],class:["js_video_fullscreen_profile","video_full-screen__head video_full-screen__head_fixed",1===t.fullscreenStatus?"player_fade_in":"",101===t.fullscreenStatus?"opr_fade_out":""],style:{"padding-top":t.isAndroid&&(t.safeAreaInsets.top?t.safeAreaInsets.top:16)+"px",transform:"translate3d("+t.headerPos+"px, 0, 0)"}},[e("div",{staticClass:"video_full-screen__head__inner"},[e("div",{staticClass:"video_full-screen__head__body"},[e("div",{staticClass:"js_video_fullscreen_profile_exit video_full-screen__head__item"},[e("div",{staticClass:"video_full-screen__article-title"},[e("button",{staticClass:"weui-wa-hotarea js_video_fullscreen_profile_exit reset_btn video_close_fullscreen_btn",on:{click:t.clickExitFullscreen}},[e("i",{staticClass:"weui-icon-close"},[t._v("退出全屏")])])])])]),e("div",{staticClass:"video_full-screen__head__ft"},[e("a",{staticClass:"video_menu_more js_video_fullscreen_menu_more weui-wa-hotarea_before",attrs:{"aria-label":"更多操作",role:"button",href:"javascript:;"},on:{click:t.showMoreMenu}},[e("i",{staticClass:"weui-icon-outlined-more"})])])])]),e("mp-infinity-list",{ref:"infinityList",attrs:{"container-class":t.fullscreenStatus?"video-scroll-list__wrapper":"",list:t.playerControllerList,"page-height":t.infinityListPageHeight,"disabled-scroll":!t.fullscreenStatus||t.isLandscape||t.touchDisableScroll||1===t.playerControllerList.length&&t.isListEnd,"only-one":!t.hasFeedScrollGray||t.onlyOne,"loading-height":136,"is-end":t.isListEnd,"keep-first-alive":"","disabled-refresh":""},on:{"finish-scroll-page":t.onFinishScrollPage,"page-enter":t.onPageEnter,"page-before-destory":t.onPageBeforeDestory},scopedSlots:t._u([{key:"main",fn:function({item:i,index:s}){return[e("mp-feed-item",{attrs:{"feed-vm":t.feedVm,"fullscreen-status":t.fullscreenStatus,item:i,index:s,"cur-page":t.curPage},on:{"seeking-status-change":t.onSeekingStatusChange,"swipe-back":t.onSwipeBack,"orientation-change":t.onOrientationChange,fullscreenchange:t.onFullscreenChange,exitfullscreen:t.onExitFullscreen,"show-more-modal":t.onShowMoreModal,"click-subscribe":t.onFeedItemClickSubscribe,"set-feed-vm":t.onSetFeedVm,pause:t.onVideoPause}})]}},{key:"loading",fn:function(){return[e("div",{staticClass:"infinity-list__loading-custom"},[e("span",{staticClass:"weui-primary-loading",attrs:{role:"img","aria-label":"加载中"}},[e("i",{staticClass:"weui-primary-loading__dot"})])])]},proxy:!0},{key:"end",fn:function(){return[e("div",{staticClass:"weui-loadmore weui-loadmore_default weui-loadmore_line player_feed_video_list_end_line"},[e("span",{staticClass:"weui-loadmore__tips"},[t._v("暂无更多内容")])])]},proxy:!0}]),model:{value:t.curPage,callback:function(e){t.curPage=e},expression:"curPage"}}),e("audio",{ref:"audio",staticStyle:{display:"none"},attrs:{loop:"",preload:"auto"}},[e("source",{attrs:{src:"https://res.wx.qq.com/voice/getvoice?mediaid=MzA3MzA0MTAyNF8xMDAwMDI3Njk="}})]),t.fullscreenStatus?e("div",{staticClass:"feed-mask"}):t._e()],1)}),[],!1,null,null,null,null).exports,ai=yt.extend({name:"see-more-plugin",data:()=>({}),computed:{...i("mp-video-player/see-more-plugin",["isSeeMoreAllow"])},methods:{...s("mp-video-player",["reportReload23445"]),...o("mp-video-player/see-more-plugin",["setIsSeeMoreAllow"]),onClick(){this.controller.triggerEvent("show-more-modal")}}});ai.type=yt.TYPE_PROFILE;const ri=R(ai,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("button",{directives:[{name:"show",rawName:"v-show",value:t.isSeeMoreAllow,expression:"isSeeMoreAllow"}],staticClass:"reset_btn video_profile_relate_video_btn js_wx_tap_highlight wx_tap_link",on:{click:function(e){return e.stopPropagation(),t.onClick.apply(null,arguments)}}},[t._v("观看更多"),e("i",{staticClass:"weui-icon-filled-arrow video_profile_relate_video_btn_arrow"})])}),[],!1,null,null,null,null).exports,ni=yt.extend({name:"cover-next-plugin",inject:["playerScene"],filters:{hotViewFormatter(t){let e="";if(isNaN(parseInt(t,10)))return t;if(parseInt(t,10)>99e4)e="99万+";else if(parseInt(t,10)>1e4&&parseInt(t,10)<=99e4){const i="".concat(parseInt(t,10)/1e4),s=i.indexOf(".");e=-1===s?"".concat(i,"万"):"".concat(i.substr(0,s),".").concat(i.charAt(s+1),"万")}else e=0===parseInt(t,10)?"":t||"";return e}},data:()=>({show:!1}),computed:{...i(["cgiData"]),...i("mp-video-player",["fullscreenStatus"]),...i("mp-video-player/popup-plugin",["popupData"]),cover(){return this.fromCpsVideo&&this.cpsOperaInfo?this.cpsOperaInfo.cover_url||"":this.fromOperaVideo?this.operaInfo.cover_url||"":this.popupInfo&&this.popupInfo.avatar||""},title(){return this.fromCpsVideo&&this.cpsOperaInfo?this.cpsOperaInfo.drama_name||"":this.fromOperaVideo?this.operaInfo.drama_name||"":this.popupInfo&&this.popupInfo.title||""},desc(){return this.popupInfo&&this.popupInfo.desc||""},fromOperaVideo(){return!(!this.operaInfo||!this.operaInfo.appid)},fromCpsVideo(){return"cps"===this.playerScene},buttonWording(){return this.fromOperaVideo?"去观看":"查看详情"},videoRatio(){const t=this.controller&&this.controller.getPlayer();return t&&t.videoRatio},popupInfo(){return this.popupData&&this.popupData[0]&&1===this.popupData[0].type?this.popupData[0].info:null},operaInfo(){return this.cgiData.drama_info},cpsOperaInfo(){return console.log("data====aaaa",this.controller),this.controller&&this.controller.extInfo&&this.controller.extInfo.dramaInfo},nextSerialNum(){return this.fromOperaVideo&&this.operaInfo?this.operaInfo.media_count===this.operaInfo.this_media_no?1:this.operaInfo.next_media_no:0},useSmallCard(){return!this.fromCpsVideo&&!(this.videoRatio<1)},report17149Data(){const{cgiData:t}=this;let e=0;return this.cgiData.drama_info&&this.cgiData.drama_info.appid?e=3:this.cgiData.is_finder_video?e=2:this.cgiData.is_mp_video||(e=1),{BizUserName:t.biz,MsgId:1*t.mid,Idx:1*t.idx,EnterId:t.enterid,VideoId:t.vid,Scene:t.scene,Subscene:1*t.subscene,SessionIdStr:t.sessionid,ChannelSessionId:t.channel_session_id,ContinueId:"".concat(t.continueid),ReloadId:"".concat(t.reloadid),Device:t.devicetype,IsTempUrl:window.is_temp_url?1:2,VideoType:e}}},watch:{show(t,e){t!=e&&this.controller.triggerEvent("coverNextShowStatusChange",t),t&&!e&&(this.fromCpsVideo||this.report17149({EventType:102}),this.__hasReportClick=!1)}},methods:{jump(){this.fromCpsVideo&&this.cpsOperaInfo||this.fromOperaVideo?this.jumpToOpera():this.jumpToWeApp(),this.controller.triggerEvent("coverNextClick",!this.__hasReportClick),this.__hasReportClick||(this.fromCpsVideo||this.report17149({EventType:104}),this.__hasReportClick=!0)},jumpToWeApp(){const t=this.popupInfo;y.jumpUrl({options:{userName:t.originalId,scene:1144,relativeURL:decodeURIComponent(t.relativeURL),sceneNote:[encodeURIComponent(location.href),window.cgiData.user_name,window.cgiData.msg_title,window.cgiData.video_title,t.title,t.desc,encodeURIComponent(t.avatar),t.relativeURL].join(":")}})},jumpToOpera(t=1305){const e=this.cpsOperaInfo||this.operaInfo;if(!e||!e.appid||!e.next_path&&!e.jump_path)return;const i=this.cpsOperaInfo?e.jump_path:e.next_path;M.invoke("openWeApp",{appId:e.appid,scene:t,relativeURL:decodeURIComponent(i?i.replace(/&amp;/g,"&"):""),sceneNote:[encodeURIComponent(location.href),window.cgiData.user_name,window.cgiData.msg_title,window.cgiData.video_title,i].join(":")},(t=>console.log("openWeApp",t)))},beforeEndHandler(){(this.popupInfo||this.fromOperaVideo||this.fromCpsVideo&&this.cpsOperaInfo)&&this.controller.setLoop(!1)},endHandler(){if(this.popupInfo||this.fromOperaVideo||this.fromCpsVideo&&this.cpsOperaInfo){this.controller.setLoop(!1),this.controller.topStickyExpendWhenPaused=!0;const t=this.controller.getPlayer();return t.preventOperating(),t.showPauseBtn=!1,this.show=!0,yt.BLOCK_REST_PLUGINS}},replayVideo(){if(this.controller.getPlayer().replay(),this.controller.setLoop(!0),this.show){this.controller.topStickyExpendWhenPaused=!1;const t=this.controller.getPlayer();t.resumeOperating(),t.showPauseBtn=!0,this.show=!1}},report17149(t){const e={...this.report17149Data,...t};I.report(17149,e)}}});ni.type=yt.TYPE_COVER;const li=R(ni,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"cover-next-wrp",class:{"small-card":t.useSmallCard,"cps-card":t.fromCpsVideo}},[e("div",{staticClass:"cover-next-info",style:t.cpsOperaInfo&&t.cpsOperaInfo.cover_next_info_style,on:{click:function(e){return e.stopPropagation(),e.preventDefault(),(()=>t.fromCpsVideo&&t.cpsOperaInfo&&t.jump()).apply(null,arguments)}}},[e("div",{staticClass:"cover",style:t.cpsOperaInfo&&t.cpsOperaInfo.cover_style},[e("img",{attrs:{src:t.cover}})]),e("div",{ref:"info",staticClass:"info"},[t.fromCpsVideo?[e("div",{staticClass:"info-content"},[e("div",{staticClass:"title"},[t._v(t._s(t.title))]),e("div",{staticClass:"desc"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.cpsOperaInfo&&t.cpsOperaInfo.drama_class,expression:"cpsOperaInfo && cpsOperaInfo.drama_class"}]},[t._v(t._s(t.cpsOperaInfo&&t.cpsOperaInfo.drama_class))]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.cpsOperaInfo&&t.cpsOperaInfo.drama_class&&t.cpsOperaInfo.total_num,expression:"cpsOperaInfo && cpsOperaInfo.drama_class && cpsOperaInfo.total_num"}]},[t._v(" ")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.cpsOperaInfo&&t.cpsOperaInfo.total_num,expression:"cpsOperaInfo && cpsOperaInfo.total_num"}]},[t._v(t._s(t.cpsOperaInfo&&t.cpsOperaInfo.total_num)+"集")])])]),e("div",{staticClass:"info-ext"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.cpsOperaInfo&&t.cpsOperaInfo.hot_view,expression:"cpsOperaInfo && cpsOperaInfo.hot_view"}]},[t._v("热度"+t._s(t._f("hotViewFormatter")(t.cpsOperaInfo&&t.cpsOperaInfo.hot_view)))])])]:t.fromOperaVideo?[t.operaInfo.media_count===t.operaInfo.this_media_no?e("div",{staticClass:"title"},[t._v("已看完，重头观看")]):e("div",{staticClass:"title"},[t._v("继续观看")]),e("div",{staticClass:"title"},[e("span",{staticClass:"opera-title"},[t._v(t._s(t.title))]),e("span",{staticClass:"opera-serial-num"},[t._v(" 第"+t._s(t.nextSerialNum)+"集")])])]:[e("div",{staticClass:"title"},[t._v(t._s(t.title))]),e("div",{staticClass:"desc"},[t._v(t._s(t.desc))])]],2)]),t.fromCpsVideo?t._e():e("div",{staticClass:"button",on:{click:t.jump}},[e("i",{staticClass:"icon-weapp"}),e("span",[t._v(t._s(t.buttonWording))])]),e("div",{staticClass:"replay-button",on:{click:t.replayVideo}},[e("i",{staticClass:"icon_replay"}),e("span",[t._v("重播")])])])}),[],!1,null,"b5ccadb0",null,null).exports;export{at as F,Me as P,et as T,oi as V,ri as a,_e as b,yt as c,we as d,li as e,he as f,Se as g,Ze as h,Pe as p};
